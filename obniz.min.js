var Obniz=function(e){var t={};function i(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(r,s,function(t){return e[t]}.bind(null,s));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=109)}([function(e,t,i){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */
var r=i(111),s=i(112),n=i(55);function a(){return h.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function o(e,t){if(a()<t)throw new RangeError("Invalid typed array length");return h.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=h.prototype:(null===e&&(e=new h(t)),e.length=t),e}function h(e,t,i){if(!(h.TYPED_ARRAY_SUPPORT||this instanceof h))return new h(e,t,i);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return u(this,e)}return c(this,e,t,i)}function c(e,t,i,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,i,r){if(t.byteLength,i<0||t.byteLength<i)throw new RangeError("'offset' is out of bounds");if(t.byteLength<i+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===i&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,i):new Uint8Array(t,i,r);h.TYPED_ARRAY_SUPPORT?(e=t).__proto__=h.prototype:e=l(e,t);return e}(e,t,i,r):"string"==typeof t?function(e,t,i){"string"==typeof i&&""!==i||(i="utf8");if(!h.isEncoding(i))throw new TypeError('"encoding" must be a valid string encoding');var r=0|p(t,i),s=(e=o(e,r)).write(t,i);s!==r&&(e=e.slice(0,s));return e}(e,t,i):function(e,t){if(h.isBuffer(t)){var i=0|f(t.length);return 0===(e=o(e,i)).length?e:(t.copy(e,0,0,i),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?o(e,0):l(e,t);if("Buffer"===t.type&&n(t.data))return l(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function d(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function u(e,t){if(d(t),e=o(e,t<0?0:0|f(t)),!h.TYPED_ARRAY_SUPPORT)for(var i=0;i<t;++i)e[i]=0;return e}function l(e,t){var i=t.length<0?0:0|f(t.length);e=o(e,i);for(var r=0;r<i;r+=1)e[r]=255&t[r];return e}function f(e){if(e>=a())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a().toString(16)+" bytes");return 0|e}function p(e,t){if(h.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var i=e.length;if(0===i)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":case void 0:return U(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return F(e).length;default:if(r)return U(e).length;t=(""+t).toLowerCase(),r=!0}}function m(e,t,i){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===i||i>this.length)&&(i=this.length),i<=0)return"";if((i>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return R(this,t,i);case"utf8":case"utf-8":return I(this,t,i);case"ascii":return P(this,t,i);case"latin1":case"binary":return O(this,t,i);case"base64":return A(this,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return M(this,t,i);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function _(e,t,i){var r=e[t];e[t]=e[i],e[i]=r}function g(e,t,i,r,s){if(0===e.length)return-1;if("string"==typeof i?(r=i,i=0):i>2147483647?i=2147483647:i<-2147483648&&(i=-2147483648),i=+i,isNaN(i)&&(i=s?0:e.length-1),i<0&&(i=e.length+i),i>=e.length){if(s)return-1;i=e.length-1}else if(i<0){if(!s)return-1;i=0}if("string"==typeof t&&(t=h.from(t,r)),h.isBuffer(t))return 0===t.length?-1:y(e,t,i,r,s);if("number"==typeof t)return t&=255,h.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?s?Uint8Array.prototype.indexOf.call(e,t,i):Uint8Array.prototype.lastIndexOf.call(e,t,i):y(e,[t],i,r,s);throw new TypeError("val must be string, number or Buffer")}function y(e,t,i,r,s){var n,a=1,o=e.length,h=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;a=2,o/=2,h/=2,i/=2}function c(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(s){var d=-1;for(n=i;n<o;n++)if(c(e,n)===c(t,-1===d?0:n-d)){if(-1===d&&(d=n),n-d+1===h)return d*a}else-1!==d&&(n-=n-d),d=-1}else for(i+h>o&&(i=o-h),n=i;n>=0;n--){for(var u=!0,l=0;l<h;l++)if(c(e,n+l)!==c(t,l)){u=!1;break}if(u)return n}return-1}function b(e,t,i,r){i=Number(i)||0;var s=e.length-i;r?(r=Number(r))>s&&(r=s):r=s;var n=t.length;if(n%2!=0)throw new TypeError("Invalid hex string");r>n/2&&(r=n/2);for(var a=0;a<r;++a){var o=parseInt(t.substr(2*a,2),16);if(isNaN(o))return a;e[i+a]=o}return a}function v(e,t,i,r){return z(U(t,e.length-i),e,i,r)}function w(e,t,i,r){return z(function(e){for(var t=[],i=0;i<e.length;++i)t.push(255&e.charCodeAt(i));return t}(t),e,i,r)}function S(e,t,i,r){return w(e,t,i,r)}function E(e,t,i,r){return z(F(t),e,i,r)}function C(e,t,i,r){return z(function(e,t){for(var i,r,s,n=[],a=0;a<e.length&&!((t-=2)<0);++a)i=e.charCodeAt(a),r=i>>8,s=i%256,n.push(s),n.push(r);return n}(t,e.length-i),e,i,r)}function A(e,t,i){return 0===t&&i===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,i))}function I(e,t,i){i=Math.min(e.length,i);for(var r=[],s=t;s<i;){var n,a,o,h,c=e[s],d=null,u=c>239?4:c>223?3:c>191?2:1;if(s+u<=i)switch(u){case 1:c<128&&(d=c);break;case 2:128==(192&(n=e[s+1]))&&(h=(31&c)<<6|63&n)>127&&(d=h);break;case 3:n=e[s+1],a=e[s+2],128==(192&n)&&128==(192&a)&&(h=(15&c)<<12|(63&n)<<6|63&a)>2047&&(h<55296||h>57343)&&(d=h);break;case 4:n=e[s+1],a=e[s+2],o=e[s+3],128==(192&n)&&128==(192&a)&&128==(192&o)&&(h=(15&c)<<18|(63&n)<<12|(63&a)<<6|63&o)>65535&&h<1114112&&(d=h)}null===d?(d=65533,u=1):d>65535&&(d-=65536,r.push(d>>>10&1023|55296),d=56320|1023&d),r.push(d),s+=u}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);var i="",r=0;for(;r<t;)i+=String.fromCharCode.apply(String,e.slice(r,r+=4096));return i}(r)}t.Buffer=h,t.SlowBuffer=function(e){+e!=e&&(e=0);return h.alloc(+e)},t.INSPECT_MAX_BYTES=50,h.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=a(),h.poolSize=8192,h._augment=function(e){return e.__proto__=h.prototype,e},h.from=function(e,t,i){return c(null,e,t,i)},h.TYPED_ARRAY_SUPPORT&&(h.prototype.__proto__=Uint8Array.prototype,h.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&h[Symbol.species]===h&&Object.defineProperty(h,Symbol.species,{value:null,configurable:!0})),h.alloc=function(e,t,i){return function(e,t,i,r){return d(t),t<=0?o(e,t):void 0!==i?"string"==typeof r?o(e,t).fill(i,r):o(e,t).fill(i):o(e,t)}(null,e,t,i)},h.allocUnsafe=function(e){return u(null,e)},h.allocUnsafeSlow=function(e){return u(null,e)},h.isBuffer=function(e){return!(null==e||!e._isBuffer)},h.compare=function(e,t){if(!h.isBuffer(e)||!h.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var i=e.length,r=t.length,s=0,n=Math.min(i,r);s<n;++s)if(e[s]!==t[s]){i=e[s],r=t[s];break}return i<r?-1:r<i?1:0},h.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},h.concat=function(e,t){if(!n(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return h.alloc(0);var i;if(void 0===t)for(t=0,i=0;i<e.length;++i)t+=e[i].length;var r=h.allocUnsafe(t),s=0;for(i=0;i<e.length;++i){var a=e[i];if(!h.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(r,s),s+=a.length}return r},h.byteLength=p,h.prototype._isBuffer=!0,h.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)_(this,t,t+1);return this},h.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)_(this,t,t+3),_(this,t+1,t+2);return this},h.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)_(this,t,t+7),_(this,t+1,t+6),_(this,t+2,t+5),_(this,t+3,t+4);return this},h.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?I(this,0,e):m.apply(this,arguments)},h.prototype.equals=function(e){if(!h.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===h.compare(this,e)},h.prototype.inspect=function(){var e="",i=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,i).match(/.{2}/g).join(" "),this.length>i&&(e+=" ... ")),"<Buffer "+e+">"},h.prototype.compare=function(e,t,i,r,s){if(!h.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===i&&(i=e?e.length:0),void 0===r&&(r=0),void 0===s&&(s=this.length),t<0||i>e.length||r<0||s>this.length)throw new RangeError("out of range index");if(r>=s&&t>=i)return 0;if(r>=s)return-1;if(t>=i)return 1;if(this===e)return 0;for(var n=(s>>>=0)-(r>>>=0),a=(i>>>=0)-(t>>>=0),o=Math.min(n,a),c=this.slice(r,s),d=e.slice(t,i),u=0;u<o;++u)if(c[u]!==d[u]){n=c[u],a=d[u];break}return n<a?-1:a<n?1:0},h.prototype.includes=function(e,t,i){return-1!==this.indexOf(e,t,i)},h.prototype.indexOf=function(e,t,i){return g(this,e,t,i,!0)},h.prototype.lastIndexOf=function(e,t,i){return g(this,e,t,i,!1)},h.prototype.write=function(e,t,i,r){if(void 0===t)r="utf8",i=this.length,t=0;else if(void 0===i&&"string"==typeof t)r=t,i=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(i)?(i|=0,void 0===r&&(r="utf8")):(r=i,i=void 0)}var s=this.length-t;if((void 0===i||i>s)&&(i=s),e.length>0&&(i<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var n=!1;;)switch(r){case"hex":return b(this,e,t,i);case"utf8":case"utf-8":return v(this,e,t,i);case"ascii":return w(this,e,t,i);case"latin1":case"binary":return S(this,e,t,i);case"base64":return E(this,e,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,e,t,i);default:if(n)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),n=!0}},h.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function P(e,t,i){var r="";i=Math.min(e.length,i);for(var s=t;s<i;++s)r+=String.fromCharCode(127&e[s]);return r}function O(e,t,i){var r="";i=Math.min(e.length,i);for(var s=t;s<i;++s)r+=String.fromCharCode(e[s]);return r}function R(e,t,i){var r=e.length;(!t||t<0)&&(t=0),(!i||i<0||i>r)&&(i=r);for(var s="",n=t;n<i;++n)s+=q(e[n]);return s}function M(e,t,i){for(var r=e.slice(t,i),s="",n=0;n<r.length;n+=2)s+=String.fromCharCode(r[n]+256*r[n+1]);return s}function x(e,t,i){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>i)throw new RangeError("Trying to access beyond buffer length")}function D(e,t,i,r,s,n){if(!h.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>s||t<n)throw new RangeError('"value" argument is out of bounds');if(i+r>e.length)throw new RangeError("Index out of range")}function k(e,t,i,r){t<0&&(t=65535+t+1);for(var s=0,n=Math.min(e.length-i,2);s<n;++s)e[i+s]=(t&255<<8*(r?s:1-s))>>>8*(r?s:1-s)}function T(e,t,i,r){t<0&&(t=4294967295+t+1);for(var s=0,n=Math.min(e.length-i,4);s<n;++s)e[i+s]=t>>>8*(r?s:3-s)&255}function B(e,t,i,r,s,n){if(i+r>e.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function L(e,t,i,r,n){return n||B(e,0,i,4),s.write(e,t,i,r,23,4),i+4}function N(e,t,i,r,n){return n||B(e,0,i,8),s.write(e,t,i,r,52,8),i+8}h.prototype.slice=function(e,t){var i,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),h.TYPED_ARRAY_SUPPORT)(i=this.subarray(e,t)).__proto__=h.prototype;else{var s=t-e;i=new h(s,void 0);for(var n=0;n<s;++n)i[n]=this[n+e]}return i},h.prototype.readUIntLE=function(e,t,i){e|=0,t|=0,i||x(e,t,this.length);for(var r=this[e],s=1,n=0;++n<t&&(s*=256);)r+=this[e+n]*s;return r},h.prototype.readUIntBE=function(e,t,i){e|=0,t|=0,i||x(e,t,this.length);for(var r=this[e+--t],s=1;t>0&&(s*=256);)r+=this[e+--t]*s;return r},h.prototype.readUInt8=function(e,t){return t||x(e,1,this.length),this[e]},h.prototype.readUInt16LE=function(e,t){return t||x(e,2,this.length),this[e]|this[e+1]<<8},h.prototype.readUInt16BE=function(e,t){return t||x(e,2,this.length),this[e]<<8|this[e+1]},h.prototype.readUInt32LE=function(e,t){return t||x(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},h.prototype.readUInt32BE=function(e,t){return t||x(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},h.prototype.readIntLE=function(e,t,i){e|=0,t|=0,i||x(e,t,this.length);for(var r=this[e],s=1,n=0;++n<t&&(s*=256);)r+=this[e+n]*s;return r>=(s*=128)&&(r-=Math.pow(2,8*t)),r},h.prototype.readIntBE=function(e,t,i){e|=0,t|=0,i||x(e,t,this.length);for(var r=t,s=1,n=this[e+--r];r>0&&(s*=256);)n+=this[e+--r]*s;return n>=(s*=128)&&(n-=Math.pow(2,8*t)),n},h.prototype.readInt8=function(e,t){return t||x(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},h.prototype.readInt16LE=function(e,t){t||x(e,2,this.length);var i=this[e]|this[e+1]<<8;return 32768&i?4294901760|i:i},h.prototype.readInt16BE=function(e,t){t||x(e,2,this.length);var i=this[e+1]|this[e]<<8;return 32768&i?4294901760|i:i},h.prototype.readInt32LE=function(e,t){return t||x(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},h.prototype.readInt32BE=function(e,t){return t||x(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},h.prototype.readFloatLE=function(e,t){return t||x(e,4,this.length),s.read(this,e,!0,23,4)},h.prototype.readFloatBE=function(e,t){return t||x(e,4,this.length),s.read(this,e,!1,23,4)},h.prototype.readDoubleLE=function(e,t){return t||x(e,8,this.length),s.read(this,e,!0,52,8)},h.prototype.readDoubleBE=function(e,t){return t||x(e,8,this.length),s.read(this,e,!1,52,8)},h.prototype.writeUIntLE=function(e,t,i,r){(e=+e,t|=0,i|=0,r)||D(this,e,t,i,Math.pow(2,8*i)-1,0);var s=1,n=0;for(this[t]=255&e;++n<i&&(s*=256);)this[t+n]=e/s&255;return t+i},h.prototype.writeUIntBE=function(e,t,i,r){(e=+e,t|=0,i|=0,r)||D(this,e,t,i,Math.pow(2,8*i)-1,0);var s=i-1,n=1;for(this[t+s]=255&e;--s>=0&&(n*=256);)this[t+s]=e/n&255;return t+i},h.prototype.writeUInt8=function(e,t,i){return e=+e,t|=0,i||D(this,e,t,1,255,0),h.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},h.prototype.writeUInt16LE=function(e,t,i){return e=+e,t|=0,i||D(this,e,t,2,65535,0),h.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):k(this,e,t,!0),t+2},h.prototype.writeUInt16BE=function(e,t,i){return e=+e,t|=0,i||D(this,e,t,2,65535,0),h.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):k(this,e,t,!1),t+2},h.prototype.writeUInt32LE=function(e,t,i){return e=+e,t|=0,i||D(this,e,t,4,4294967295,0),h.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):T(this,e,t,!0),t+4},h.prototype.writeUInt32BE=function(e,t,i){return e=+e,t|=0,i||D(this,e,t,4,4294967295,0),h.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):T(this,e,t,!1),t+4},h.prototype.writeIntLE=function(e,t,i,r){if(e=+e,t|=0,!r){var s=Math.pow(2,8*i-1);D(this,e,t,i,s-1,-s)}var n=0,a=1,o=0;for(this[t]=255&e;++n<i&&(a*=256);)e<0&&0===o&&0!==this[t+n-1]&&(o=1),this[t+n]=(e/a>>0)-o&255;return t+i},h.prototype.writeIntBE=function(e,t,i,r){if(e=+e,t|=0,!r){var s=Math.pow(2,8*i-1);D(this,e,t,i,s-1,-s)}var n=i-1,a=1,o=0;for(this[t+n]=255&e;--n>=0&&(a*=256);)e<0&&0===o&&0!==this[t+n+1]&&(o=1),this[t+n]=(e/a>>0)-o&255;return t+i},h.prototype.writeInt8=function(e,t,i){return e=+e,t|=0,i||D(this,e,t,1,127,-128),h.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},h.prototype.writeInt16LE=function(e,t,i){return e=+e,t|=0,i||D(this,e,t,2,32767,-32768),h.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):k(this,e,t,!0),t+2},h.prototype.writeInt16BE=function(e,t,i){return e=+e,t|=0,i||D(this,e,t,2,32767,-32768),h.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):k(this,e,t,!1),t+2},h.prototype.writeInt32LE=function(e,t,i){return e=+e,t|=0,i||D(this,e,t,4,2147483647,-2147483648),h.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):T(this,e,t,!0),t+4},h.prototype.writeInt32BE=function(e,t,i){return e=+e,t|=0,i||D(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),h.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):T(this,e,t,!1),t+4},h.prototype.writeFloatLE=function(e,t,i){return L(this,e,t,!0,i)},h.prototype.writeFloatBE=function(e,t,i){return L(this,e,t,!1,i)},h.prototype.writeDoubleLE=function(e,t,i){return N(this,e,t,!0,i)},h.prototype.writeDoubleBE=function(e,t,i){return N(this,e,t,!1,i)},h.prototype.copy=function(e,t,i,r){if(i||(i=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<i&&(r=i),r===i)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-i&&(r=e.length-t+i);var s,n=r-i;if(this===e&&i<t&&t<r)for(s=n-1;s>=0;--s)e[s+t]=this[s+i];else if(n<1e3||!h.TYPED_ARRAY_SUPPORT)for(s=0;s<n;++s)e[s+t]=this[s+i];else Uint8Array.prototype.set.call(e,this.subarray(i,i+n),t);return n},h.prototype.fill=function(e,t,i,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,i=this.length):"string"==typeof i&&(r=i,i=this.length),1===e.length){var s=e.charCodeAt(0);s<256&&(e=s)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!h.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<i)throw new RangeError("Out of range index");if(i<=t)return this;var n;if(t>>>=0,i=void 0===i?this.length:i>>>0,e||(e=0),"number"==typeof e)for(n=t;n<i;++n)this[n]=e;else{var a=h.isBuffer(e)?e:U(new h(e,r).toString()),o=a.length;for(n=0;n<i-t;++n)this[n+t]=a[n%o]}return this};var j=/[^+\/0-9A-Za-z-_]/g;function q(e){return e<16?"0"+e.toString(16):e.toString(16)}function U(e,t){var i;t=t||1/0;for(var r=e.length,s=null,n=[],a=0;a<r;++a){if((i=e.charCodeAt(a))>55295&&i<57344){if(!s){if(i>56319){(t-=3)>-1&&n.push(239,191,189);continue}if(a+1===r){(t-=3)>-1&&n.push(239,191,189);continue}s=i;continue}if(i<56320){(t-=3)>-1&&n.push(239,191,189),s=i;continue}i=65536+(s-55296<<10|i-56320)}else s&&(t-=3)>-1&&n.push(239,191,189);if(s=null,i<128){if((t-=1)<0)break;n.push(i)}else if(i<2048){if((t-=2)<0)break;n.push(i>>6|192,63&i|128)}else if(i<65536){if((t-=3)<0)break;n.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;n.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return n}function F(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(j,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function z(e,t,i,r){for(var s=0;s<r&&!(s+i>=t.length||s>=e.length);++s)t[s+i]=e[s];return s}}).call(this,i(13))},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}}},function(e,t,i){var r=i(0),s=r.Buffer;function n(e,t){for(var i in e)t[i]=e[i]}function a(e,t,i){return s(e,t,i)}s.from&&s.alloc&&s.allocUnsafe&&s.allocUnsafeSlow?e.exports=r:(n(r,t),t.Buffer=a),n(s,a),a.from=function(e,t,i){if("number"==typeof e)throw new TypeError("Argument must not be a number");return s(e,t,i)},a.alloc=function(e,t,i){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=s(e);return void 0!==t?"string"==typeof i?r.fill(t,i):r.fill(t):r.fill(0),r},a.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return s(e)},a.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},function(e,t,i){(function(e){!function(e,t){"use strict";function r(e,t){if(!e)throw new Error(t||"Assertion failed")}function s(e,t){e.super_=t;var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}function n(e,t,i){if(n.isBN(e))return e;this.negative=0,this.words=null,this.length=0,this.red=null,null!==e&&("le"!==t&&"be"!==t||(i=t,t=10),this._init(e||0,t||10,i||"be"))}var a;"object"==typeof e?e.exports=n:t.BN=n,n.BN=n,n.wordSize=26;try{a=i(168).Buffer}catch(e){}function o(e,t,i){for(var r=0,s=Math.min(e.length,i),n=t;n<s;n++){var a=e.charCodeAt(n)-48;r<<=4,r|=a>=49&&a<=54?a-49+10:a>=17&&a<=22?a-17+10:15&a}return r}function h(e,t,i,r){for(var s=0,n=Math.min(e.length,i),a=t;a<n;a++){var o=e.charCodeAt(a)-48;s*=r,s+=o>=49?o-49+10:o>=17?o-17+10:o}return s}n.isBN=function(e){return e instanceof n||null!==e&&"object"==typeof e&&e.constructor.wordSize===n.wordSize&&Array.isArray(e.words)},n.max=function(e,t){return e.cmp(t)>0?e:t},n.min=function(e,t){return e.cmp(t)<0?e:t},n.prototype._init=function(e,t,i){if("number"==typeof e)return this._initNumber(e,t,i);if("object"==typeof e)return this._initArray(e,t,i);"hex"===t&&(t=16),r(t===(0|t)&&t>=2&&t<=36);var s=0;"-"===(e=e.toString().replace(/\s+/g,""))[0]&&s++,16===t?this._parseHex(e,s):this._parseBase(e,t,s),"-"===e[0]&&(this.negative=1),this.strip(),"le"===i&&this._initArray(this.toArray(),t,i)},n.prototype._initNumber=function(e,t,i){e<0&&(this.negative=1,e=-e),e<67108864?(this.words=[67108863&e],this.length=1):e<4503599627370496?(this.words=[67108863&e,e/67108864&67108863],this.length=2):(r(e<9007199254740992),this.words=[67108863&e,e/67108864&67108863,1],this.length=3),"le"===i&&this._initArray(this.toArray(),t,i)},n.prototype._initArray=function(e,t,i){if(r("number"==typeof e.length),e.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(e.length/3),this.words=new Array(this.length);for(var s=0;s<this.length;s++)this.words[s]=0;var n,a,o=0;if("be"===i)for(s=e.length-1,n=0;s>=0;s-=3)a=e[s]|e[s-1]<<8|e[s-2]<<16,this.words[n]|=a<<o&67108863,this.words[n+1]=a>>>26-o&67108863,(o+=24)>=26&&(o-=26,n++);else if("le"===i)for(s=0,n=0;s<e.length;s+=3)a=e[s]|e[s+1]<<8|e[s+2]<<16,this.words[n]|=a<<o&67108863,this.words[n+1]=a>>>26-o&67108863,(o+=24)>=26&&(o-=26,n++);return this.strip()},n.prototype._parseHex=function(e,t){this.length=Math.ceil((e.length-t)/6),this.words=new Array(this.length);for(var i=0;i<this.length;i++)this.words[i]=0;var r,s,n=0;for(i=e.length-6,r=0;i>=t;i-=6)s=o(e,i,i+6),this.words[r]|=s<<n&67108863,this.words[r+1]|=s>>>26-n&4194303,(n+=24)>=26&&(n-=26,r++);i+6!==t&&(s=o(e,t,i+6),this.words[r]|=s<<n&67108863,this.words[r+1]|=s>>>26-n&4194303),this.strip()},n.prototype._parseBase=function(e,t,i){this.words=[0],this.length=1;for(var r=0,s=1;s<=67108863;s*=t)r++;r--,s=s/t|0;for(var n=e.length-i,a=n%r,o=Math.min(n,n-a)+i,c=0,d=i;d<o;d+=r)c=h(e,d,d+r,t),this.imuln(s),this.words[0]+c<67108864?this.words[0]+=c:this._iaddn(c);if(0!==a){var u=1;for(c=h(e,d,e.length,t),d=0;d<a;d++)u*=t;this.imuln(u),this.words[0]+c<67108864?this.words[0]+=c:this._iaddn(c)}},n.prototype.copy=function(e){e.words=new Array(this.length);for(var t=0;t<this.length;t++)e.words[t]=this.words[t];e.length=this.length,e.negative=this.negative,e.red=this.red},n.prototype.clone=function(){var e=new n(null);return this.copy(e),e},n.prototype._expand=function(e){for(;this.length<e;)this.words[this.length++]=0;return this},n.prototype.strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},n.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},n.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var c=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],d=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],u=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function l(e,t,i){i.negative=t.negative^e.negative;var r=e.length+t.length|0;i.length=r,r=r-1|0;var s=0|e.words[0],n=0|t.words[0],a=s*n,o=67108863&a,h=a/67108864|0;i.words[0]=o;for(var c=1;c<r;c++){for(var d=h>>>26,u=67108863&h,l=Math.min(c,t.length-1),f=Math.max(0,c-e.length+1);f<=l;f++){var p=c-f|0;d+=(a=(s=0|e.words[p])*(n=0|t.words[f])+u)/67108864|0,u=67108863&a}i.words[c]=0|u,h=0|d}return 0!==h?i.words[c]=0|h:i.length--,i.strip()}n.prototype.toString=function(e,t){var i;if(t=0|t||1,16===(e=e||10)||"hex"===e){i="";for(var s=0,n=0,a=0;a<this.length;a++){var o=this.words[a],h=(16777215&(o<<s|n)).toString(16);i=0!==(n=o>>>24-s&16777215)||a!==this.length-1?c[6-h.length]+h+i:h+i,(s+=2)>=26&&(s-=26,a--)}for(0!==n&&(i=n.toString(16)+i);i.length%t!=0;)i="0"+i;return 0!==this.negative&&(i="-"+i),i}if(e===(0|e)&&e>=2&&e<=36){var l=d[e],f=u[e];i="";var p=this.clone();for(p.negative=0;!p.isZero();){var m=p.modn(f).toString(e);i=(p=p.idivn(f)).isZero()?m+i:c[l-m.length]+m+i}for(this.isZero()&&(i="0"+i);i.length%t!=0;)i="0"+i;return 0!==this.negative&&(i="-"+i),i}r(!1,"Base should be between 2 and 36")},n.prototype.toNumber=function(){var e=this.words[0];return 2===this.length?e+=67108864*this.words[1]:3===this.length&&1===this.words[2]?e+=4503599627370496+67108864*this.words[1]:this.length>2&&r(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-e:e},n.prototype.toJSON=function(){return this.toString(16)},n.prototype.toBuffer=function(e,t){return r(void 0!==a),this.toArrayLike(a,e,t)},n.prototype.toArray=function(e,t){return this.toArrayLike(Array,e,t)},n.prototype.toArrayLike=function(e,t,i){var s=this.byteLength(),n=i||Math.max(1,s);r(s<=n,"byte array longer than desired length"),r(n>0,"Requested array length <= 0"),this.strip();var a,o,h="le"===t,c=new e(n),d=this.clone();if(h){for(o=0;!d.isZero();o++)a=d.andln(255),d.iushrn(8),c[o]=a;for(;o<n;o++)c[o]=0}else{for(o=0;o<n-s;o++)c[o]=0;for(o=0;!d.isZero();o++)a=d.andln(255),d.iushrn(8),c[n-o-1]=a}return c},Math.clz32?n.prototype._countBits=function(e){return 32-Math.clz32(e)}:n.prototype._countBits=function(e){var t=e,i=0;return t>=4096&&(i+=13,t>>>=13),t>=64&&(i+=7,t>>>=7),t>=8&&(i+=4,t>>>=4),t>=2&&(i+=2,t>>>=2),i+t},n.prototype._zeroBits=function(e){if(0===e)return 26;var t=e,i=0;return 0==(8191&t)&&(i+=13,t>>>=13),0==(127&t)&&(i+=7,t>>>=7),0==(15&t)&&(i+=4,t>>>=4),0==(3&t)&&(i+=2,t>>>=2),0==(1&t)&&i++,i},n.prototype.bitLength=function(){var e=this.words[this.length-1],t=this._countBits(e);return 26*(this.length-1)+t},n.prototype.zeroBits=function(){if(this.isZero())return 0;for(var e=0,t=0;t<this.length;t++){var i=this._zeroBits(this.words[t]);if(e+=i,26!==i)break}return e},n.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},n.prototype.toTwos=function(e){return 0!==this.negative?this.abs().inotn(e).iaddn(1):this.clone()},n.prototype.fromTwos=function(e){return this.testn(e-1)?this.notn(e).iaddn(1).ineg():this.clone()},n.prototype.isNeg=function(){return 0!==this.negative},n.prototype.neg=function(){return this.clone().ineg()},n.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},n.prototype.iuor=function(e){for(;this.length<e.length;)this.words[this.length++]=0;for(var t=0;t<e.length;t++)this.words[t]=this.words[t]|e.words[t];return this.strip()},n.prototype.ior=function(e){return r(0==(this.negative|e.negative)),this.iuor(e)},n.prototype.or=function(e){return this.length>e.length?this.clone().ior(e):e.clone().ior(this)},n.prototype.uor=function(e){return this.length>e.length?this.clone().iuor(e):e.clone().iuor(this)},n.prototype.iuand=function(e){var t;t=this.length>e.length?e:this;for(var i=0;i<t.length;i++)this.words[i]=this.words[i]&e.words[i];return this.length=t.length,this.strip()},n.prototype.iand=function(e){return r(0==(this.negative|e.negative)),this.iuand(e)},n.prototype.and=function(e){return this.length>e.length?this.clone().iand(e):e.clone().iand(this)},n.prototype.uand=function(e){return this.length>e.length?this.clone().iuand(e):e.clone().iuand(this)},n.prototype.iuxor=function(e){var t,i;this.length>e.length?(t=this,i=e):(t=e,i=this);for(var r=0;r<i.length;r++)this.words[r]=t.words[r]^i.words[r];if(this!==t)for(;r<t.length;r++)this.words[r]=t.words[r];return this.length=t.length,this.strip()},n.prototype.ixor=function(e){return r(0==(this.negative|e.negative)),this.iuxor(e)},n.prototype.xor=function(e){return this.length>e.length?this.clone().ixor(e):e.clone().ixor(this)},n.prototype.uxor=function(e){return this.length>e.length?this.clone().iuxor(e):e.clone().iuxor(this)},n.prototype.inotn=function(e){r("number"==typeof e&&e>=0);var t=0|Math.ceil(e/26),i=e%26;this._expand(t),i>0&&t--;for(var s=0;s<t;s++)this.words[s]=67108863&~this.words[s];return i>0&&(this.words[s]=~this.words[s]&67108863>>26-i),this.strip()},n.prototype.notn=function(e){return this.clone().inotn(e)},n.prototype.setn=function(e,t){r("number"==typeof e&&e>=0);var i=e/26|0,s=e%26;return this._expand(i+1),this.words[i]=t?this.words[i]|1<<s:this.words[i]&~(1<<s),this.strip()},n.prototype.iadd=function(e){var t,i,r;if(0!==this.negative&&0===e.negative)return this.negative=0,t=this.isub(e),this.negative^=1,this._normSign();if(0===this.negative&&0!==e.negative)return e.negative=0,t=this.isub(e),e.negative=1,t._normSign();this.length>e.length?(i=this,r=e):(i=e,r=this);for(var s=0,n=0;n<r.length;n++)t=(0|i.words[n])+(0|r.words[n])+s,this.words[n]=67108863&t,s=t>>>26;for(;0!==s&&n<i.length;n++)t=(0|i.words[n])+s,this.words[n]=67108863&t,s=t>>>26;if(this.length=i.length,0!==s)this.words[this.length]=s,this.length++;else if(i!==this)for(;n<i.length;n++)this.words[n]=i.words[n];return this},n.prototype.add=function(e){var t;return 0!==e.negative&&0===this.negative?(e.negative=0,t=this.sub(e),e.negative^=1,t):0===e.negative&&0!==this.negative?(this.negative=0,t=e.sub(this),this.negative=1,t):this.length>e.length?this.clone().iadd(e):e.clone().iadd(this)},n.prototype.isub=function(e){if(0!==e.negative){e.negative=0;var t=this.iadd(e);return e.negative=1,t._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(e),this.negative=1,this._normSign();var i,r,s=this.cmp(e);if(0===s)return this.negative=0,this.length=1,this.words[0]=0,this;s>0?(i=this,r=e):(i=e,r=this);for(var n=0,a=0;a<r.length;a++)n=(t=(0|i.words[a])-(0|r.words[a])+n)>>26,this.words[a]=67108863&t;for(;0!==n&&a<i.length;a++)n=(t=(0|i.words[a])+n)>>26,this.words[a]=67108863&t;if(0===n&&a<i.length&&i!==this)for(;a<i.length;a++)this.words[a]=i.words[a];return this.length=Math.max(this.length,a),i!==this&&(this.negative=1),this.strip()},n.prototype.sub=function(e){return this.clone().isub(e)};var f=function(e,t,i){var r,s,n,a=e.words,o=t.words,h=i.words,c=0,d=0|a[0],u=8191&d,l=d>>>13,f=0|a[1],p=8191&f,m=f>>>13,_=0|a[2],g=8191&_,y=_>>>13,b=0|a[3],v=8191&b,w=b>>>13,S=0|a[4],E=8191&S,C=S>>>13,A=0|a[5],I=8191&A,P=A>>>13,O=0|a[6],R=8191&O,M=O>>>13,x=0|a[7],D=8191&x,k=x>>>13,T=0|a[8],B=8191&T,L=T>>>13,N=0|a[9],j=8191&N,q=N>>>13,U=0|o[0],F=8191&U,z=U>>>13,W=0|o[1],$=8191&W,V=W>>>13,G=0|o[2],H=8191&G,K=G>>>13,Y=0|o[3],J=8191&Y,Q=Y>>>13,X=0|o[4],Z=8191&X,ee=X>>>13,te=0|o[5],ie=8191&te,re=te>>>13,se=0|o[6],ne=8191&se,ae=se>>>13,oe=0|o[7],he=8191&oe,ce=oe>>>13,de=0|o[8],ue=8191&de,le=de>>>13,fe=0|o[9],pe=8191&fe,me=fe>>>13;i.negative=e.negative^t.negative,i.length=19;var _e=(c+(r=Math.imul(u,F))|0)+((8191&(s=(s=Math.imul(u,z))+Math.imul(l,F)|0))<<13)|0;c=((n=Math.imul(l,z))+(s>>>13)|0)+(_e>>>26)|0,_e&=67108863,r=Math.imul(p,F),s=(s=Math.imul(p,z))+Math.imul(m,F)|0,n=Math.imul(m,z);var ge=(c+(r=r+Math.imul(u,$)|0)|0)+((8191&(s=(s=s+Math.imul(u,V)|0)+Math.imul(l,$)|0))<<13)|0;c=((n=n+Math.imul(l,V)|0)+(s>>>13)|0)+(ge>>>26)|0,ge&=67108863,r=Math.imul(g,F),s=(s=Math.imul(g,z))+Math.imul(y,F)|0,n=Math.imul(y,z),r=r+Math.imul(p,$)|0,s=(s=s+Math.imul(p,V)|0)+Math.imul(m,$)|0,n=n+Math.imul(m,V)|0;var ye=(c+(r=r+Math.imul(u,H)|0)|0)+((8191&(s=(s=s+Math.imul(u,K)|0)+Math.imul(l,H)|0))<<13)|0;c=((n=n+Math.imul(l,K)|0)+(s>>>13)|0)+(ye>>>26)|0,ye&=67108863,r=Math.imul(v,F),s=(s=Math.imul(v,z))+Math.imul(w,F)|0,n=Math.imul(w,z),r=r+Math.imul(g,$)|0,s=(s=s+Math.imul(g,V)|0)+Math.imul(y,$)|0,n=n+Math.imul(y,V)|0,r=r+Math.imul(p,H)|0,s=(s=s+Math.imul(p,K)|0)+Math.imul(m,H)|0,n=n+Math.imul(m,K)|0;var be=(c+(r=r+Math.imul(u,J)|0)|0)+((8191&(s=(s=s+Math.imul(u,Q)|0)+Math.imul(l,J)|0))<<13)|0;c=((n=n+Math.imul(l,Q)|0)+(s>>>13)|0)+(be>>>26)|0,be&=67108863,r=Math.imul(E,F),s=(s=Math.imul(E,z))+Math.imul(C,F)|0,n=Math.imul(C,z),r=r+Math.imul(v,$)|0,s=(s=s+Math.imul(v,V)|0)+Math.imul(w,$)|0,n=n+Math.imul(w,V)|0,r=r+Math.imul(g,H)|0,s=(s=s+Math.imul(g,K)|0)+Math.imul(y,H)|0,n=n+Math.imul(y,K)|0,r=r+Math.imul(p,J)|0,s=(s=s+Math.imul(p,Q)|0)+Math.imul(m,J)|0,n=n+Math.imul(m,Q)|0;var ve=(c+(r=r+Math.imul(u,Z)|0)|0)+((8191&(s=(s=s+Math.imul(u,ee)|0)+Math.imul(l,Z)|0))<<13)|0;c=((n=n+Math.imul(l,ee)|0)+(s>>>13)|0)+(ve>>>26)|0,ve&=67108863,r=Math.imul(I,F),s=(s=Math.imul(I,z))+Math.imul(P,F)|0,n=Math.imul(P,z),r=r+Math.imul(E,$)|0,s=(s=s+Math.imul(E,V)|0)+Math.imul(C,$)|0,n=n+Math.imul(C,V)|0,r=r+Math.imul(v,H)|0,s=(s=s+Math.imul(v,K)|0)+Math.imul(w,H)|0,n=n+Math.imul(w,K)|0,r=r+Math.imul(g,J)|0,s=(s=s+Math.imul(g,Q)|0)+Math.imul(y,J)|0,n=n+Math.imul(y,Q)|0,r=r+Math.imul(p,Z)|0,s=(s=s+Math.imul(p,ee)|0)+Math.imul(m,Z)|0,n=n+Math.imul(m,ee)|0;var we=(c+(r=r+Math.imul(u,ie)|0)|0)+((8191&(s=(s=s+Math.imul(u,re)|0)+Math.imul(l,ie)|0))<<13)|0;c=((n=n+Math.imul(l,re)|0)+(s>>>13)|0)+(we>>>26)|0,we&=67108863,r=Math.imul(R,F),s=(s=Math.imul(R,z))+Math.imul(M,F)|0,n=Math.imul(M,z),r=r+Math.imul(I,$)|0,s=(s=s+Math.imul(I,V)|0)+Math.imul(P,$)|0,n=n+Math.imul(P,V)|0,r=r+Math.imul(E,H)|0,s=(s=s+Math.imul(E,K)|0)+Math.imul(C,H)|0,n=n+Math.imul(C,K)|0,r=r+Math.imul(v,J)|0,s=(s=s+Math.imul(v,Q)|0)+Math.imul(w,J)|0,n=n+Math.imul(w,Q)|0,r=r+Math.imul(g,Z)|0,s=(s=s+Math.imul(g,ee)|0)+Math.imul(y,Z)|0,n=n+Math.imul(y,ee)|0,r=r+Math.imul(p,ie)|0,s=(s=s+Math.imul(p,re)|0)+Math.imul(m,ie)|0,n=n+Math.imul(m,re)|0;var Se=(c+(r=r+Math.imul(u,ne)|0)|0)+((8191&(s=(s=s+Math.imul(u,ae)|0)+Math.imul(l,ne)|0))<<13)|0;c=((n=n+Math.imul(l,ae)|0)+(s>>>13)|0)+(Se>>>26)|0,Se&=67108863,r=Math.imul(D,F),s=(s=Math.imul(D,z))+Math.imul(k,F)|0,n=Math.imul(k,z),r=r+Math.imul(R,$)|0,s=(s=s+Math.imul(R,V)|0)+Math.imul(M,$)|0,n=n+Math.imul(M,V)|0,r=r+Math.imul(I,H)|0,s=(s=s+Math.imul(I,K)|0)+Math.imul(P,H)|0,n=n+Math.imul(P,K)|0,r=r+Math.imul(E,J)|0,s=(s=s+Math.imul(E,Q)|0)+Math.imul(C,J)|0,n=n+Math.imul(C,Q)|0,r=r+Math.imul(v,Z)|0,s=(s=s+Math.imul(v,ee)|0)+Math.imul(w,Z)|0,n=n+Math.imul(w,ee)|0,r=r+Math.imul(g,ie)|0,s=(s=s+Math.imul(g,re)|0)+Math.imul(y,ie)|0,n=n+Math.imul(y,re)|0,r=r+Math.imul(p,ne)|0,s=(s=s+Math.imul(p,ae)|0)+Math.imul(m,ne)|0,n=n+Math.imul(m,ae)|0;var Ee=(c+(r=r+Math.imul(u,he)|0)|0)+((8191&(s=(s=s+Math.imul(u,ce)|0)+Math.imul(l,he)|0))<<13)|0;c=((n=n+Math.imul(l,ce)|0)+(s>>>13)|0)+(Ee>>>26)|0,Ee&=67108863,r=Math.imul(B,F),s=(s=Math.imul(B,z))+Math.imul(L,F)|0,n=Math.imul(L,z),r=r+Math.imul(D,$)|0,s=(s=s+Math.imul(D,V)|0)+Math.imul(k,$)|0,n=n+Math.imul(k,V)|0,r=r+Math.imul(R,H)|0,s=(s=s+Math.imul(R,K)|0)+Math.imul(M,H)|0,n=n+Math.imul(M,K)|0,r=r+Math.imul(I,J)|0,s=(s=s+Math.imul(I,Q)|0)+Math.imul(P,J)|0,n=n+Math.imul(P,Q)|0,r=r+Math.imul(E,Z)|0,s=(s=s+Math.imul(E,ee)|0)+Math.imul(C,Z)|0,n=n+Math.imul(C,ee)|0,r=r+Math.imul(v,ie)|0,s=(s=s+Math.imul(v,re)|0)+Math.imul(w,ie)|0,n=n+Math.imul(w,re)|0,r=r+Math.imul(g,ne)|0,s=(s=s+Math.imul(g,ae)|0)+Math.imul(y,ne)|0,n=n+Math.imul(y,ae)|0,r=r+Math.imul(p,he)|0,s=(s=s+Math.imul(p,ce)|0)+Math.imul(m,he)|0,n=n+Math.imul(m,ce)|0;var Ce=(c+(r=r+Math.imul(u,ue)|0)|0)+((8191&(s=(s=s+Math.imul(u,le)|0)+Math.imul(l,ue)|0))<<13)|0;c=((n=n+Math.imul(l,le)|0)+(s>>>13)|0)+(Ce>>>26)|0,Ce&=67108863,r=Math.imul(j,F),s=(s=Math.imul(j,z))+Math.imul(q,F)|0,n=Math.imul(q,z),r=r+Math.imul(B,$)|0,s=(s=s+Math.imul(B,V)|0)+Math.imul(L,$)|0,n=n+Math.imul(L,V)|0,r=r+Math.imul(D,H)|0,s=(s=s+Math.imul(D,K)|0)+Math.imul(k,H)|0,n=n+Math.imul(k,K)|0,r=r+Math.imul(R,J)|0,s=(s=s+Math.imul(R,Q)|0)+Math.imul(M,J)|0,n=n+Math.imul(M,Q)|0,r=r+Math.imul(I,Z)|0,s=(s=s+Math.imul(I,ee)|0)+Math.imul(P,Z)|0,n=n+Math.imul(P,ee)|0,r=r+Math.imul(E,ie)|0,s=(s=s+Math.imul(E,re)|0)+Math.imul(C,ie)|0,n=n+Math.imul(C,re)|0,r=r+Math.imul(v,ne)|0,s=(s=s+Math.imul(v,ae)|0)+Math.imul(w,ne)|0,n=n+Math.imul(w,ae)|0,r=r+Math.imul(g,he)|0,s=(s=s+Math.imul(g,ce)|0)+Math.imul(y,he)|0,n=n+Math.imul(y,ce)|0,r=r+Math.imul(p,ue)|0,s=(s=s+Math.imul(p,le)|0)+Math.imul(m,ue)|0,n=n+Math.imul(m,le)|0;var Ae=(c+(r=r+Math.imul(u,pe)|0)|0)+((8191&(s=(s=s+Math.imul(u,me)|0)+Math.imul(l,pe)|0))<<13)|0;c=((n=n+Math.imul(l,me)|0)+(s>>>13)|0)+(Ae>>>26)|0,Ae&=67108863,r=Math.imul(j,$),s=(s=Math.imul(j,V))+Math.imul(q,$)|0,n=Math.imul(q,V),r=r+Math.imul(B,H)|0,s=(s=s+Math.imul(B,K)|0)+Math.imul(L,H)|0,n=n+Math.imul(L,K)|0,r=r+Math.imul(D,J)|0,s=(s=s+Math.imul(D,Q)|0)+Math.imul(k,J)|0,n=n+Math.imul(k,Q)|0,r=r+Math.imul(R,Z)|0,s=(s=s+Math.imul(R,ee)|0)+Math.imul(M,Z)|0,n=n+Math.imul(M,ee)|0,r=r+Math.imul(I,ie)|0,s=(s=s+Math.imul(I,re)|0)+Math.imul(P,ie)|0,n=n+Math.imul(P,re)|0,r=r+Math.imul(E,ne)|0,s=(s=s+Math.imul(E,ae)|0)+Math.imul(C,ne)|0,n=n+Math.imul(C,ae)|0,r=r+Math.imul(v,he)|0,s=(s=s+Math.imul(v,ce)|0)+Math.imul(w,he)|0,n=n+Math.imul(w,ce)|0,r=r+Math.imul(g,ue)|0,s=(s=s+Math.imul(g,le)|0)+Math.imul(y,ue)|0,n=n+Math.imul(y,le)|0;var Ie=(c+(r=r+Math.imul(p,pe)|0)|0)+((8191&(s=(s=s+Math.imul(p,me)|0)+Math.imul(m,pe)|0))<<13)|0;c=((n=n+Math.imul(m,me)|0)+(s>>>13)|0)+(Ie>>>26)|0,Ie&=67108863,r=Math.imul(j,H),s=(s=Math.imul(j,K))+Math.imul(q,H)|0,n=Math.imul(q,K),r=r+Math.imul(B,J)|0,s=(s=s+Math.imul(B,Q)|0)+Math.imul(L,J)|0,n=n+Math.imul(L,Q)|0,r=r+Math.imul(D,Z)|0,s=(s=s+Math.imul(D,ee)|0)+Math.imul(k,Z)|0,n=n+Math.imul(k,ee)|0,r=r+Math.imul(R,ie)|0,s=(s=s+Math.imul(R,re)|0)+Math.imul(M,ie)|0,n=n+Math.imul(M,re)|0,r=r+Math.imul(I,ne)|0,s=(s=s+Math.imul(I,ae)|0)+Math.imul(P,ne)|0,n=n+Math.imul(P,ae)|0,r=r+Math.imul(E,he)|0,s=(s=s+Math.imul(E,ce)|0)+Math.imul(C,he)|0,n=n+Math.imul(C,ce)|0,r=r+Math.imul(v,ue)|0,s=(s=s+Math.imul(v,le)|0)+Math.imul(w,ue)|0,n=n+Math.imul(w,le)|0;var Pe=(c+(r=r+Math.imul(g,pe)|0)|0)+((8191&(s=(s=s+Math.imul(g,me)|0)+Math.imul(y,pe)|0))<<13)|0;c=((n=n+Math.imul(y,me)|0)+(s>>>13)|0)+(Pe>>>26)|0,Pe&=67108863,r=Math.imul(j,J),s=(s=Math.imul(j,Q))+Math.imul(q,J)|0,n=Math.imul(q,Q),r=r+Math.imul(B,Z)|0,s=(s=s+Math.imul(B,ee)|0)+Math.imul(L,Z)|0,n=n+Math.imul(L,ee)|0,r=r+Math.imul(D,ie)|0,s=(s=s+Math.imul(D,re)|0)+Math.imul(k,ie)|0,n=n+Math.imul(k,re)|0,r=r+Math.imul(R,ne)|0,s=(s=s+Math.imul(R,ae)|0)+Math.imul(M,ne)|0,n=n+Math.imul(M,ae)|0,r=r+Math.imul(I,he)|0,s=(s=s+Math.imul(I,ce)|0)+Math.imul(P,he)|0,n=n+Math.imul(P,ce)|0,r=r+Math.imul(E,ue)|0,s=(s=s+Math.imul(E,le)|0)+Math.imul(C,ue)|0,n=n+Math.imul(C,le)|0;var Oe=(c+(r=r+Math.imul(v,pe)|0)|0)+((8191&(s=(s=s+Math.imul(v,me)|0)+Math.imul(w,pe)|0))<<13)|0;c=((n=n+Math.imul(w,me)|0)+(s>>>13)|0)+(Oe>>>26)|0,Oe&=67108863,r=Math.imul(j,Z),s=(s=Math.imul(j,ee))+Math.imul(q,Z)|0,n=Math.imul(q,ee),r=r+Math.imul(B,ie)|0,s=(s=s+Math.imul(B,re)|0)+Math.imul(L,ie)|0,n=n+Math.imul(L,re)|0,r=r+Math.imul(D,ne)|0,s=(s=s+Math.imul(D,ae)|0)+Math.imul(k,ne)|0,n=n+Math.imul(k,ae)|0,r=r+Math.imul(R,he)|0,s=(s=s+Math.imul(R,ce)|0)+Math.imul(M,he)|0,n=n+Math.imul(M,ce)|0,r=r+Math.imul(I,ue)|0,s=(s=s+Math.imul(I,le)|0)+Math.imul(P,ue)|0,n=n+Math.imul(P,le)|0;var Re=(c+(r=r+Math.imul(E,pe)|0)|0)+((8191&(s=(s=s+Math.imul(E,me)|0)+Math.imul(C,pe)|0))<<13)|0;c=((n=n+Math.imul(C,me)|0)+(s>>>13)|0)+(Re>>>26)|0,Re&=67108863,r=Math.imul(j,ie),s=(s=Math.imul(j,re))+Math.imul(q,ie)|0,n=Math.imul(q,re),r=r+Math.imul(B,ne)|0,s=(s=s+Math.imul(B,ae)|0)+Math.imul(L,ne)|0,n=n+Math.imul(L,ae)|0,r=r+Math.imul(D,he)|0,s=(s=s+Math.imul(D,ce)|0)+Math.imul(k,he)|0,n=n+Math.imul(k,ce)|0,r=r+Math.imul(R,ue)|0,s=(s=s+Math.imul(R,le)|0)+Math.imul(M,ue)|0,n=n+Math.imul(M,le)|0;var Me=(c+(r=r+Math.imul(I,pe)|0)|0)+((8191&(s=(s=s+Math.imul(I,me)|0)+Math.imul(P,pe)|0))<<13)|0;c=((n=n+Math.imul(P,me)|0)+(s>>>13)|0)+(Me>>>26)|0,Me&=67108863,r=Math.imul(j,ne),s=(s=Math.imul(j,ae))+Math.imul(q,ne)|0,n=Math.imul(q,ae),r=r+Math.imul(B,he)|0,s=(s=s+Math.imul(B,ce)|0)+Math.imul(L,he)|0,n=n+Math.imul(L,ce)|0,r=r+Math.imul(D,ue)|0,s=(s=s+Math.imul(D,le)|0)+Math.imul(k,ue)|0,n=n+Math.imul(k,le)|0;var xe=(c+(r=r+Math.imul(R,pe)|0)|0)+((8191&(s=(s=s+Math.imul(R,me)|0)+Math.imul(M,pe)|0))<<13)|0;c=((n=n+Math.imul(M,me)|0)+(s>>>13)|0)+(xe>>>26)|0,xe&=67108863,r=Math.imul(j,he),s=(s=Math.imul(j,ce))+Math.imul(q,he)|0,n=Math.imul(q,ce),r=r+Math.imul(B,ue)|0,s=(s=s+Math.imul(B,le)|0)+Math.imul(L,ue)|0,n=n+Math.imul(L,le)|0;var De=(c+(r=r+Math.imul(D,pe)|0)|0)+((8191&(s=(s=s+Math.imul(D,me)|0)+Math.imul(k,pe)|0))<<13)|0;c=((n=n+Math.imul(k,me)|0)+(s>>>13)|0)+(De>>>26)|0,De&=67108863,r=Math.imul(j,ue),s=(s=Math.imul(j,le))+Math.imul(q,ue)|0,n=Math.imul(q,le);var ke=(c+(r=r+Math.imul(B,pe)|0)|0)+((8191&(s=(s=s+Math.imul(B,me)|0)+Math.imul(L,pe)|0))<<13)|0;c=((n=n+Math.imul(L,me)|0)+(s>>>13)|0)+(ke>>>26)|0,ke&=67108863;var Te=(c+(r=Math.imul(j,pe))|0)+((8191&(s=(s=Math.imul(j,me))+Math.imul(q,pe)|0))<<13)|0;return c=((n=Math.imul(q,me))+(s>>>13)|0)+(Te>>>26)|0,Te&=67108863,h[0]=_e,h[1]=ge,h[2]=ye,h[3]=be,h[4]=ve,h[5]=we,h[6]=Se,h[7]=Ee,h[8]=Ce,h[9]=Ae,h[10]=Ie,h[11]=Pe,h[12]=Oe,h[13]=Re,h[14]=Me,h[15]=xe,h[16]=De,h[17]=ke,h[18]=Te,0!==c&&(h[19]=c,i.length++),i};function p(e,t,i){return(new m).mulp(e,t,i)}function m(e,t){this.x=e,this.y=t}Math.imul||(f=l),n.prototype.mulTo=function(e,t){var i=this.length+e.length;return 10===this.length&&10===e.length?f(this,e,t):i<63?l(this,e,t):i<1024?function(e,t,i){i.negative=t.negative^e.negative,i.length=e.length+t.length;for(var r=0,s=0,n=0;n<i.length-1;n++){var a=s;s=0;for(var o=67108863&r,h=Math.min(n,t.length-1),c=Math.max(0,n-e.length+1);c<=h;c++){var d=n-c,u=(0|e.words[d])*(0|t.words[c]),l=67108863&u;o=67108863&(l=l+o|0),s+=(a=(a=a+(u/67108864|0)|0)+(l>>>26)|0)>>>26,a&=67108863}i.words[n]=o,r=a,a=s}return 0!==r?i.words[n]=r:i.length--,i.strip()}(this,e,t):p(this,e,t)},m.prototype.makeRBT=function(e){for(var t=new Array(e),i=n.prototype._countBits(e)-1,r=0;r<e;r++)t[r]=this.revBin(r,i,e);return t},m.prototype.revBin=function(e,t,i){if(0===e||e===i-1)return e;for(var r=0,s=0;s<t;s++)r|=(1&e)<<t-s-1,e>>=1;return r},m.prototype.permute=function(e,t,i,r,s,n){for(var a=0;a<n;a++)r[a]=t[e[a]],s[a]=i[e[a]]},m.prototype.transform=function(e,t,i,r,s,n){this.permute(n,e,t,i,r,s);for(var a=1;a<s;a<<=1)for(var o=a<<1,h=Math.cos(2*Math.PI/o),c=Math.sin(2*Math.PI/o),d=0;d<s;d+=o)for(var u=h,l=c,f=0;f<a;f++){var p=i[d+f],m=r[d+f],_=i[d+f+a],g=r[d+f+a],y=u*_-l*g;g=u*g+l*_,_=y,i[d+f]=p+_,r[d+f]=m+g,i[d+f+a]=p-_,r[d+f+a]=m-g,f!==o&&(y=h*u-c*l,l=h*l+c*u,u=y)}},m.prototype.guessLen13b=function(e,t){var i=1|Math.max(t,e),r=1&i,s=0;for(i=i/2|0;i;i>>>=1)s++;return 1<<s+1+r},m.prototype.conjugate=function(e,t,i){if(!(i<=1))for(var r=0;r<i/2;r++){var s=e[r];e[r]=e[i-r-1],e[i-r-1]=s,s=t[r],t[r]=-t[i-r-1],t[i-r-1]=-s}},m.prototype.normalize13b=function(e,t){for(var i=0,r=0;r<t/2;r++){var s=8192*Math.round(e[2*r+1]/t)+Math.round(e[2*r]/t)+i;e[r]=67108863&s,i=s<67108864?0:s/67108864|0}return e},m.prototype.convert13b=function(e,t,i,s){for(var n=0,a=0;a<t;a++)n+=0|e[a],i[2*a]=8191&n,n>>>=13,i[2*a+1]=8191&n,n>>>=13;for(a=2*t;a<s;++a)i[a]=0;r(0===n),r(0==(-8192&n))},m.prototype.stub=function(e){for(var t=new Array(e),i=0;i<e;i++)t[i]=0;return t},m.prototype.mulp=function(e,t,i){var r=2*this.guessLen13b(e.length,t.length),s=this.makeRBT(r),n=this.stub(r),a=new Array(r),o=new Array(r),h=new Array(r),c=new Array(r),d=new Array(r),u=new Array(r),l=i.words;l.length=r,this.convert13b(e.words,e.length,a,r),this.convert13b(t.words,t.length,c,r),this.transform(a,n,o,h,r,s),this.transform(c,n,d,u,r,s);for(var f=0;f<r;f++){var p=o[f]*d[f]-h[f]*u[f];h[f]=o[f]*u[f]+h[f]*d[f],o[f]=p}return this.conjugate(o,h,r),this.transform(o,h,l,n,r,s),this.conjugate(l,n,r),this.normalize13b(l,r),i.negative=e.negative^t.negative,i.length=e.length+t.length,i.strip()},n.prototype.mul=function(e){var t=new n(null);return t.words=new Array(this.length+e.length),this.mulTo(e,t)},n.prototype.mulf=function(e){var t=new n(null);return t.words=new Array(this.length+e.length),p(this,e,t)},n.prototype.imul=function(e){return this.clone().mulTo(e,this)},n.prototype.imuln=function(e){r("number"==typeof e),r(e<67108864);for(var t=0,i=0;i<this.length;i++){var s=(0|this.words[i])*e,n=(67108863&s)+(67108863&t);t>>=26,t+=s/67108864|0,t+=n>>>26,this.words[i]=67108863&n}return 0!==t&&(this.words[i]=t,this.length++),this},n.prototype.muln=function(e){return this.clone().imuln(e)},n.prototype.sqr=function(){return this.mul(this)},n.prototype.isqr=function(){return this.imul(this.clone())},n.prototype.pow=function(e){var t=function(e){for(var t=new Array(e.bitLength()),i=0;i<t.length;i++){var r=i/26|0,s=i%26;t[i]=(e.words[r]&1<<s)>>>s}return t}(e);if(0===t.length)return new n(1);for(var i=this,r=0;r<t.length&&0===t[r];r++,i=i.sqr());if(++r<t.length)for(var s=i.sqr();r<t.length;r++,s=s.sqr())0!==t[r]&&(i=i.mul(s));return i},n.prototype.iushln=function(e){r("number"==typeof e&&e>=0);var t,i=e%26,s=(e-i)/26,n=67108863>>>26-i<<26-i;if(0!==i){var a=0;for(t=0;t<this.length;t++){var o=this.words[t]&n,h=(0|this.words[t])-o<<i;this.words[t]=h|a,a=o>>>26-i}a&&(this.words[t]=a,this.length++)}if(0!==s){for(t=this.length-1;t>=0;t--)this.words[t+s]=this.words[t];for(t=0;t<s;t++)this.words[t]=0;this.length+=s}return this.strip()},n.prototype.ishln=function(e){return r(0===this.negative),this.iushln(e)},n.prototype.iushrn=function(e,t,i){var s;r("number"==typeof e&&e>=0),s=t?(t-t%26)/26:0;var n=e%26,a=Math.min((e-n)/26,this.length),o=67108863^67108863>>>n<<n,h=i;if(s-=a,s=Math.max(0,s),h){for(var c=0;c<a;c++)h.words[c]=this.words[c];h.length=a}if(0===a);else if(this.length>a)for(this.length-=a,c=0;c<this.length;c++)this.words[c]=this.words[c+a];else this.words[0]=0,this.length=1;var d=0;for(c=this.length-1;c>=0&&(0!==d||c>=s);c--){var u=0|this.words[c];this.words[c]=d<<26-n|u>>>n,d=u&o}return h&&0!==d&&(h.words[h.length++]=d),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},n.prototype.ishrn=function(e,t,i){return r(0===this.negative),this.iushrn(e,t,i)},n.prototype.shln=function(e){return this.clone().ishln(e)},n.prototype.ushln=function(e){return this.clone().iushln(e)},n.prototype.shrn=function(e){return this.clone().ishrn(e)},n.prototype.ushrn=function(e){return this.clone().iushrn(e)},n.prototype.testn=function(e){r("number"==typeof e&&e>=0);var t=e%26,i=(e-t)/26,s=1<<t;return!(this.length<=i)&&!!(this.words[i]&s)},n.prototype.imaskn=function(e){r("number"==typeof e&&e>=0);var t=e%26,i=(e-t)/26;if(r(0===this.negative,"imaskn works only with positive numbers"),this.length<=i)return this;if(0!==t&&i++,this.length=Math.min(i,this.length),0!==t){var s=67108863^67108863>>>t<<t;this.words[this.length-1]&=s}return this.strip()},n.prototype.maskn=function(e){return this.clone().imaskn(e)},n.prototype.iaddn=function(e){return r("number"==typeof e),r(e<67108864),e<0?this.isubn(-e):0!==this.negative?1===this.length&&(0|this.words[0])<e?(this.words[0]=e-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(e),this.negative=1,this):this._iaddn(e)},n.prototype._iaddn=function(e){this.words[0]+=e;for(var t=0;t<this.length&&this.words[t]>=67108864;t++)this.words[t]-=67108864,t===this.length-1?this.words[t+1]=1:this.words[t+1]++;return this.length=Math.max(this.length,t+1),this},n.prototype.isubn=function(e){if(r("number"==typeof e),r(e<67108864),e<0)return this.iaddn(-e);if(0!==this.negative)return this.negative=0,this.iaddn(e),this.negative=1,this;if(this.words[0]-=e,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var t=0;t<this.length&&this.words[t]<0;t++)this.words[t]+=67108864,this.words[t+1]-=1;return this.strip()},n.prototype.addn=function(e){return this.clone().iaddn(e)},n.prototype.subn=function(e){return this.clone().isubn(e)},n.prototype.iabs=function(){return this.negative=0,this},n.prototype.abs=function(){return this.clone().iabs()},n.prototype._ishlnsubmul=function(e,t,i){var s,n,a=e.length+i;this._expand(a);var o=0;for(s=0;s<e.length;s++){n=(0|this.words[s+i])+o;var h=(0|e.words[s])*t;o=((n-=67108863&h)>>26)-(h/67108864|0),this.words[s+i]=67108863&n}for(;s<this.length-i;s++)o=(n=(0|this.words[s+i])+o)>>26,this.words[s+i]=67108863&n;if(0===o)return this.strip();for(r(-1===o),o=0,s=0;s<this.length;s++)o=(n=-(0|this.words[s])+o)>>26,this.words[s]=67108863&n;return this.negative=1,this.strip()},n.prototype._wordDiv=function(e,t){var i=(this.length,e.length),r=this.clone(),s=e,a=0|s.words[s.length-1];0!==(i=26-this._countBits(a))&&(s=s.ushln(i),r.iushln(i),a=0|s.words[s.length-1]);var o,h=r.length-s.length;if("mod"!==t){(o=new n(null)).length=h+1,o.words=new Array(o.length);for(var c=0;c<o.length;c++)o.words[c]=0}var d=r.clone()._ishlnsubmul(s,1,h);0===d.negative&&(r=d,o&&(o.words[h]=1));for(var u=h-1;u>=0;u--){var l=67108864*(0|r.words[s.length+u])+(0|r.words[s.length+u-1]);for(l=Math.min(l/a|0,67108863),r._ishlnsubmul(s,l,u);0!==r.negative;)l--,r.negative=0,r._ishlnsubmul(s,1,u),r.isZero()||(r.negative^=1);o&&(o.words[u]=l)}return o&&o.strip(),r.strip(),"div"!==t&&0!==i&&r.iushrn(i),{div:o||null,mod:r}},n.prototype.divmod=function(e,t,i){return r(!e.isZero()),this.isZero()?{div:new n(0),mod:new n(0)}:0!==this.negative&&0===e.negative?(o=this.neg().divmod(e,t),"mod"!==t&&(s=o.div.neg()),"div"!==t&&(a=o.mod.neg(),i&&0!==a.negative&&a.iadd(e)),{div:s,mod:a}):0===this.negative&&0!==e.negative?(o=this.divmod(e.neg(),t),"mod"!==t&&(s=o.div.neg()),{div:s,mod:o.mod}):0!=(this.negative&e.negative)?(o=this.neg().divmod(e.neg(),t),"div"!==t&&(a=o.mod.neg(),i&&0!==a.negative&&a.isub(e)),{div:o.div,mod:a}):e.length>this.length||this.cmp(e)<0?{div:new n(0),mod:this}:1===e.length?"div"===t?{div:this.divn(e.words[0]),mod:null}:"mod"===t?{div:null,mod:new n(this.modn(e.words[0]))}:{div:this.divn(e.words[0]),mod:new n(this.modn(e.words[0]))}:this._wordDiv(e,t);var s,a,o},n.prototype.div=function(e){return this.divmod(e,"div",!1).div},n.prototype.mod=function(e){return this.divmod(e,"mod",!1).mod},n.prototype.umod=function(e){return this.divmod(e,"mod",!0).mod},n.prototype.divRound=function(e){var t=this.divmod(e);if(t.mod.isZero())return t.div;var i=0!==t.div.negative?t.mod.isub(e):t.mod,r=e.ushrn(1),s=e.andln(1),n=i.cmp(r);return n<0||1===s&&0===n?t.div:0!==t.div.negative?t.div.isubn(1):t.div.iaddn(1)},n.prototype.modn=function(e){r(e<=67108863);for(var t=(1<<26)%e,i=0,s=this.length-1;s>=0;s--)i=(t*i+(0|this.words[s]))%e;return i},n.prototype.idivn=function(e){r(e<=67108863);for(var t=0,i=this.length-1;i>=0;i--){var s=(0|this.words[i])+67108864*t;this.words[i]=s/e|0,t=s%e}return this.strip()},n.prototype.divn=function(e){return this.clone().idivn(e)},n.prototype.egcd=function(e){r(0===e.negative),r(!e.isZero());var t=this,i=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var s=new n(1),a=new n(0),o=new n(0),h=new n(1),c=0;t.isEven()&&i.isEven();)t.iushrn(1),i.iushrn(1),++c;for(var d=i.clone(),u=t.clone();!t.isZero();){for(var l=0,f=1;0==(t.words[0]&f)&&l<26;++l,f<<=1);if(l>0)for(t.iushrn(l);l-- >0;)(s.isOdd()||a.isOdd())&&(s.iadd(d),a.isub(u)),s.iushrn(1),a.iushrn(1);for(var p=0,m=1;0==(i.words[0]&m)&&p<26;++p,m<<=1);if(p>0)for(i.iushrn(p);p-- >0;)(o.isOdd()||h.isOdd())&&(o.iadd(d),h.isub(u)),o.iushrn(1),h.iushrn(1);t.cmp(i)>=0?(t.isub(i),s.isub(o),a.isub(h)):(i.isub(t),o.isub(s),h.isub(a))}return{a:o,b:h,gcd:i.iushln(c)}},n.prototype._invmp=function(e){r(0===e.negative),r(!e.isZero());var t=this,i=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var s,a=new n(1),o=new n(0),h=i.clone();t.cmpn(1)>0&&i.cmpn(1)>0;){for(var c=0,d=1;0==(t.words[0]&d)&&c<26;++c,d<<=1);if(c>0)for(t.iushrn(c);c-- >0;)a.isOdd()&&a.iadd(h),a.iushrn(1);for(var u=0,l=1;0==(i.words[0]&l)&&u<26;++u,l<<=1);if(u>0)for(i.iushrn(u);u-- >0;)o.isOdd()&&o.iadd(h),o.iushrn(1);t.cmp(i)>=0?(t.isub(i),a.isub(o)):(i.isub(t),o.isub(a))}return(s=0===t.cmpn(1)?a:o).cmpn(0)<0&&s.iadd(e),s},n.prototype.gcd=function(e){if(this.isZero())return e.abs();if(e.isZero())return this.abs();var t=this.clone(),i=e.clone();t.negative=0,i.negative=0;for(var r=0;t.isEven()&&i.isEven();r++)t.iushrn(1),i.iushrn(1);for(;;){for(;t.isEven();)t.iushrn(1);for(;i.isEven();)i.iushrn(1);var s=t.cmp(i);if(s<0){var n=t;t=i,i=n}else if(0===s||0===i.cmpn(1))break;t.isub(i)}return i.iushln(r)},n.prototype.invm=function(e){return this.egcd(e).a.umod(e)},n.prototype.isEven=function(){return 0==(1&this.words[0])},n.prototype.isOdd=function(){return 1==(1&this.words[0])},n.prototype.andln=function(e){return this.words[0]&e},n.prototype.bincn=function(e){r("number"==typeof e);var t=e%26,i=(e-t)/26,s=1<<t;if(this.length<=i)return this._expand(i+1),this.words[i]|=s,this;for(var n=s,a=i;0!==n&&a<this.length;a++){var o=0|this.words[a];n=(o+=n)>>>26,o&=67108863,this.words[a]=o}return 0!==n&&(this.words[a]=n,this.length++),this},n.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},n.prototype.cmpn=function(e){var t,i=e<0;if(0!==this.negative&&!i)return-1;if(0===this.negative&&i)return 1;if(this.strip(),this.length>1)t=1;else{i&&(e=-e),r(e<=67108863,"Number is too big");var s=0|this.words[0];t=s===e?0:s<e?-1:1}return 0!==this.negative?0|-t:t},n.prototype.cmp=function(e){if(0!==this.negative&&0===e.negative)return-1;if(0===this.negative&&0!==e.negative)return 1;var t=this.ucmp(e);return 0!==this.negative?0|-t:t},n.prototype.ucmp=function(e){if(this.length>e.length)return 1;if(this.length<e.length)return-1;for(var t=0,i=this.length-1;i>=0;i--){var r=0|this.words[i],s=0|e.words[i];if(r!==s){r<s?t=-1:r>s&&(t=1);break}}return t},n.prototype.gtn=function(e){return 1===this.cmpn(e)},n.prototype.gt=function(e){return 1===this.cmp(e)},n.prototype.gten=function(e){return this.cmpn(e)>=0},n.prototype.gte=function(e){return this.cmp(e)>=0},n.prototype.ltn=function(e){return-1===this.cmpn(e)},n.prototype.lt=function(e){return-1===this.cmp(e)},n.prototype.lten=function(e){return this.cmpn(e)<=0},n.prototype.lte=function(e){return this.cmp(e)<=0},n.prototype.eqn=function(e){return 0===this.cmpn(e)},n.prototype.eq=function(e){return 0===this.cmp(e)},n.red=function(e){return new S(e)},n.prototype.toRed=function(e){return r(!this.red,"Already a number in reduction context"),r(0===this.negative,"red works only with positives"),e.convertTo(this)._forceRed(e)},n.prototype.fromRed=function(){return r(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},n.prototype._forceRed=function(e){return this.red=e,this},n.prototype.forceRed=function(e){return r(!this.red,"Already a number in reduction context"),this._forceRed(e)},n.prototype.redAdd=function(e){return r(this.red,"redAdd works only with red numbers"),this.red.add(this,e)},n.prototype.redIAdd=function(e){return r(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,e)},n.prototype.redSub=function(e){return r(this.red,"redSub works only with red numbers"),this.red.sub(this,e)},n.prototype.redISub=function(e){return r(this.red,"redISub works only with red numbers"),this.red.isub(this,e)},n.prototype.redShl=function(e){return r(this.red,"redShl works only with red numbers"),this.red.shl(this,e)},n.prototype.redMul=function(e){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.mul(this,e)},n.prototype.redIMul=function(e){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.imul(this,e)},n.prototype.redSqr=function(){return r(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},n.prototype.redISqr=function(){return r(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},n.prototype.redSqrt=function(){return r(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},n.prototype.redInvm=function(){return r(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},n.prototype.redNeg=function(){return r(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},n.prototype.redPow=function(e){return r(this.red&&!e.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,e)};var _={k256:null,p224:null,p192:null,p25519:null};function g(e,t){this.name=e,this.p=new n(t,16),this.n=this.p.bitLength(),this.k=new n(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function y(){g.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function b(){g.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function v(){g.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function w(){g.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function S(e){if("string"==typeof e){var t=n._prime(e);this.m=t.p,this.prime=t}else r(e.gtn(1),"modulus must be greater than 1"),this.m=e,this.prime=null}function E(e){S.call(this,e),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new n(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}g.prototype._tmp=function(){var e=new n(null);return e.words=new Array(Math.ceil(this.n/13)),e},g.prototype.ireduce=function(e){var t,i=e;do{this.split(i,this.tmp),t=(i=(i=this.imulK(i)).iadd(this.tmp)).bitLength()}while(t>this.n);var r=t<this.n?-1:i.ucmp(this.p);return 0===r?(i.words[0]=0,i.length=1):r>0?i.isub(this.p):i.strip(),i},g.prototype.split=function(e,t){e.iushrn(this.n,0,t)},g.prototype.imulK=function(e){return e.imul(this.k)},s(y,g),y.prototype.split=function(e,t){for(var i=Math.min(e.length,9),r=0;r<i;r++)t.words[r]=e.words[r];if(t.length=i,e.length<=9)return e.words[0]=0,void(e.length=1);var s=e.words[9];for(t.words[t.length++]=4194303&s,r=10;r<e.length;r++){var n=0|e.words[r];e.words[r-10]=(4194303&n)<<4|s>>>22,s=n}s>>>=22,e.words[r-10]=s,0===s&&e.length>10?e.length-=10:e.length-=9},y.prototype.imulK=function(e){e.words[e.length]=0,e.words[e.length+1]=0,e.length+=2;for(var t=0,i=0;i<e.length;i++){var r=0|e.words[i];t+=977*r,e.words[i]=67108863&t,t=64*r+(t/67108864|0)}return 0===e.words[e.length-1]&&(e.length--,0===e.words[e.length-1]&&e.length--),e},s(b,g),s(v,g),s(w,g),w.prototype.imulK=function(e){for(var t=0,i=0;i<e.length;i++){var r=19*(0|e.words[i])+t,s=67108863&r;r>>>=26,e.words[i]=s,t=r}return 0!==t&&(e.words[e.length++]=t),e},n._prime=function(e){if(_[e])return _[e];var t;if("k256"===e)t=new y;else if("p224"===e)t=new b;else if("p192"===e)t=new v;else{if("p25519"!==e)throw new Error("Unknown prime "+e);t=new w}return _[e]=t,t},S.prototype._verify1=function(e){r(0===e.negative,"red works only with positives"),r(e.red,"red works only with red numbers")},S.prototype._verify2=function(e,t){r(0==(e.negative|t.negative),"red works only with positives"),r(e.red&&e.red===t.red,"red works only with red numbers")},S.prototype.imod=function(e){return this.prime?this.prime.ireduce(e)._forceRed(this):e.umod(this.m)._forceRed(this)},S.prototype.neg=function(e){return e.isZero()?e.clone():this.m.sub(e)._forceRed(this)},S.prototype.add=function(e,t){this._verify2(e,t);var i=e.add(t);return i.cmp(this.m)>=0&&i.isub(this.m),i._forceRed(this)},S.prototype.iadd=function(e,t){this._verify2(e,t);var i=e.iadd(t);return i.cmp(this.m)>=0&&i.isub(this.m),i},S.prototype.sub=function(e,t){this._verify2(e,t);var i=e.sub(t);return i.cmpn(0)<0&&i.iadd(this.m),i._forceRed(this)},S.prototype.isub=function(e,t){this._verify2(e,t);var i=e.isub(t);return i.cmpn(0)<0&&i.iadd(this.m),i},S.prototype.shl=function(e,t){return this._verify1(e),this.imod(e.ushln(t))},S.prototype.imul=function(e,t){return this._verify2(e,t),this.imod(e.imul(t))},S.prototype.mul=function(e,t){return this._verify2(e,t),this.imod(e.mul(t))},S.prototype.isqr=function(e){return this.imul(e,e.clone())},S.prototype.sqr=function(e){return this.mul(e,e)},S.prototype.sqrt=function(e){if(e.isZero())return e.clone();var t=this.m.andln(3);if(r(t%2==1),3===t){var i=this.m.add(new n(1)).iushrn(2);return this.pow(e,i)}for(var s=this.m.subn(1),a=0;!s.isZero()&&0===s.andln(1);)a++,s.iushrn(1);r(!s.isZero());var o=new n(1).toRed(this),h=o.redNeg(),c=this.m.subn(1).iushrn(1),d=this.m.bitLength();for(d=new n(2*d*d).toRed(this);0!==this.pow(d,c).cmp(h);)d.redIAdd(h);for(var u=this.pow(d,s),l=this.pow(e,s.addn(1).iushrn(1)),f=this.pow(e,s),p=a;0!==f.cmp(o);){for(var m=f,_=0;0!==m.cmp(o);_++)m=m.redSqr();r(_<p);var g=this.pow(u,new n(1).iushln(p-_-1));l=l.redMul(g),u=g.redSqr(),f=f.redMul(u),p=_}return l},S.prototype.invm=function(e){var t=e._invmp(this.m);return 0!==t.negative?(t.negative=0,this.imod(t).redNeg()):this.imod(t)},S.prototype.pow=function(e,t){if(t.isZero())return new n(1).toRed(this);if(0===t.cmpn(1))return e.clone();var i=new Array(16);i[0]=new n(1).toRed(this),i[1]=e;for(var r=2;r<i.length;r++)i[r]=this.mul(i[r-1],e);var s=i[0],a=0,o=0,h=t.bitLength()%26;for(0===h&&(h=26),r=t.length-1;r>=0;r--){for(var c=t.words[r],d=h-1;d>=0;d--){var u=c>>d&1;s!==i[0]&&(s=this.sqr(s)),0!==u||0!==a?(a<<=1,a|=u,(4===++o||0===r&&0===d)&&(s=this.mul(s,i[a]),o=0,a=0)):o=0}h=26}return s},S.prototype.convertTo=function(e){var t=e.umod(this.m);return t===e?t.clone():t},S.prototype.convertFrom=function(e){var t=e.clone();return t.red=null,t},n.mont=function(e){return new E(e)},s(E,S),E.prototype.convertTo=function(e){return this.imod(e.ushln(this.shift))},E.prototype.convertFrom=function(e){var t=this.imod(e.mul(this.rinv));return t.red=null,t},E.prototype.imul=function(e,t){if(e.isZero()||t.isZero())return e.words[0]=0,e.length=1,e;var i=e.imul(t),r=i.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),s=i.isub(r).iushrn(this.shift),n=s;return s.cmp(this.m)>=0?n=s.isub(this.m):s.cmpn(0)<0&&(n=s.iadd(this.m)),n._forceRed(this)},E.prototype.mul=function(e,t){if(e.isZero()||t.isZero())return new n(0)._forceRed(this);var i=e.mul(t),r=i.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),s=i.isub(r).iushrn(this.shift),a=s;return s.cmp(this.m)>=0?a=s.isub(this.m):s.cmpn(0)<0&&(a=s.iadd(this.m)),a._forceRed(this)},E.prototype.invm=function(e){return this.imod(e._invmp(this.m).mul(this.r2))._forceRed(this)}}(e,this)}).call(this,i(167)(e))},function(e,t,i){"use strict";var r,s="object"==typeof Reflect?Reflect:null,n=s&&"function"==typeof s.apply?s.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)};r=s&&"function"==typeof s.ownKeys?s.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var h=10;function c(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function d(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function u(e,t,i,r){var s,n,a,o;if(c(i),void 0===(n=e._events)?(n=e._events=Object.create(null),e._eventsCount=0):(void 0!==n.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),n=e._events),a=n[t]),void 0===a)a=n[t]=i,++e._eventsCount;else if("function"==typeof a?a=n[t]=r?[i,a]:[a,i]:r?a.unshift(i):a.push(i),(s=d(e))>0&&a.length>s&&!a.warned){a.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.emitter=e,h.type=t,h.count=a.length,o=h,console&&console.warn&&console.warn(o)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(e,t,i){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},s=l.bind(r);return s.listener=i,r.wrapFn=s,s}function p(e,t,i){var r=e._events;if(void 0===r)return[];var s=r[t];return void 0===s?[]:"function"==typeof s?i?[s.listener||s]:[s]:i?function(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(s):_(s,s.length)}function m(e){var t=this._events;if(void 0!==t){var i=t[e];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function _(e,t){for(var i=new Array(t),r=0;r<t;++r)i[r]=e[r];return i}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return h},set:function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");h=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return d(this)},o.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var r="error"===e,s=this._events;if(void 0!==s)r=r&&void 0===s.error;else if(!r)return!1;if(r){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var h=s[e];if(void 0===h)return!1;if("function"==typeof h)n(h,this,t);else{var c=h.length,d=_(h,c);for(i=0;i<c;++i)n(d[i],this,t)}return!0},o.prototype.addListener=function(e,t){return u(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return u(this,e,t,!0)},o.prototype.once=function(e,t){return c(t),this.on(e,f(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return c(t),this.prependListener(e,f(this,e,t)),this},o.prototype.removeListener=function(e,t){var i,r,s,n,a;if(c(t),void 0===(r=this._events))return this;if(void 0===(i=r[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(s=-1,n=i.length-1;n>=0;n--)if(i[n]===t||i[n].listener===t){a=i[n].listener,s=n;break}if(s<0)return this;0===s?i.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(i,s),1===i.length&&(r[e]=i[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,i,r;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[e]),this;if(0===arguments.length){var s,n=Object.keys(i);for(r=0;r<n.length;++r)"removeListener"!==(s=n[r])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},o.prototype.listeners=function(e){return p(this,e,!0)},o.prototype.rawListeners=function(e){return p(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},o.prototype.listenerCount=m,o.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(247)),n={};class a{constructor(){this._hw={hw:void 0,firmware:void 0},this.COMMAND_FUNC_ID_ERROR=255,this.ioNotUsed=255}static get schema(){return s.default}static get CommandClasses(){return n}get WSCommandNotFoundError(){return o}static addCommandClass(e,t){n[e]=t}static framed(e,t,i){let r,s=0;if(i&&(s=i.length),s<=63)r=0;else if(s<=16383)r=1;else{if(!(s<=1073741823))throw new Error("too big payload");r=2}let n=0===r?0:1===r?1:3;const a=3+n,o=new Uint8Array(a+s);let h=0;for(o[h++]=127&e,o[h++]=t,o[h++]=r<<6|s>>8*n;n>0;)n--,o[h++]=s>>8*n;return 0===s?o:(o.set(i,a),o)}static dequeueOne(e){if(!e||0===e.byteLength)return null;if(e.byteLength<3)throw new Error("something wrong. buf less than 3");if(128&e[0])throw new Error("reserved bit 1");const t=127&e[0],i=e[1],r=e[2]>>6&3,s=0===r?0:1===r?1:3;if(4===r)throw new Error("invalid length");let n=(63&e[2])<<8*s,a=3,o=s;for(;o>0;)o--,n+=e[a]<<8*o,a++;return{module:t,func:i,payload:e.slice(3+s,3+s+n),next:e.slice(3+s+n)}}static compress(e,t){let i=null;function r(e,t,r){const s=a.framed(e,t,r);if(i){const e=new Uint8Array(i.length+s.length);e.set(i,0),e.set(s,i.length),i=e}else i=s}for(const i of e)i.parsed=r,i.parseFromJson(t);return i}setHw(e){this._hw=e}sendCommand(e,t){this.parsed&&this.parsed(this.module,e,t)}parseFromJson(e){}notifyFromBinary(e,t,i){if(t===this.COMMAND_FUNC_ID_ERROR){e.debug||(e.debug={});const t={module:this.module,_args:[...i]};3===i.byteLength?(t.err0=i[0],t.err1=i[1],t.function=i[2],t.message=`Error module=${this.module} func=${t.function} err0=${t.err0} returned=${t.err1}`):t.message=`Error module=${this.module} with + ${t._args}`,e.debug.error=t}}envelopWarning(e,t,i){e[t]||(e[t]={}),e[t].warning=i}envelopError(e,t,i){e[t]||(e[t]={}),e[t].error=i}isValidIO(e){return"number"==typeof e&&0<=e&&e<=11}getSchema(e){return s.default.getSchema(e)}validateCommandSchema(e,t,i,r){const s={valid:0,invalid:0,results:[],invalidButLike:[]};for(const n of e){const e=this.validate(n.uri,t);if(s.results.push(e),e.valid)s.valid++,n.onValid&&n.onValid.bind(this)(this.filter(n.uri,t),r);else{s.invalid++;const t=this.onlyTypeErrorMessage(e,i);t&&s.invalidButLike.push({uri:n.uri,message:t})}}return s}validate(e,t){const i=this.getSchema(e);return s.default.validateMultiple(t,i)}onlyTypeErrorMessage(e,t){if(e.valid)return!0;if(e.missing&&e.missing.length>0)return!1;const i=[s.default.errorCodes.ANY_OF_MISSING,s.default.errorCodes.ONE_OF_MISSING,s.default.errorCodes.ONE_OF_MULTIPLE,s.default.errorCodes.NOT_PASSED,s.default.errorCodes.OBJECT_REQUIRED,s.default.errorCodes.OBJECT_ADDITIONAL_PROPERTIES,s.default.errorCodes.CIRCULAR_REFERENCE,s.default.errorCodes.FORMAT_CUSTOM,s.default.errorCodes.KEYWORD_CUSTOM,s.default.errorCodes.UNKNOWN_PROPERTY],r=[];for(const n of e.errors){if(n.code===s.default.errorCodes.INVALID_TYPE){if("object"===n.params.type||"object"===n.params.expected)return!1}else if(i.includes(n.code))return!1;const e=t+(n.dataPath||"").replace(/\//g,".");r.push(`[${e}]${n.message}`)}return r.join(";")}filter(e,t){const i=this.getSchema(e);return this._filterSchema(i,t)}_filterSchema(e,t){if(e.$ref){const i=s.default.getSchema(e.$ref);return this._filterSchema(i,t)}if(void 0===t)return e.default;if("string"===e.type||"integer"===e.type||"boolean"===e.type||"number"===e.type||"null"===e.type||"pass_all"===e.filter)return t;if("array"===e.type){const i=[];for(const r in t)i[r]=this._filterSchema(e.items,t[r]);return i}if("object"===e.type){const i={};for(const r in e.properties)i[r]=this._filterSchema(e.properties[r],t[r]);for(const r in e.patternProperties){const s=new RegExp(r);for(const n of Object.keys(t))s.test(n)&&(i[n]=this._filterSchema(e.patternProperties[r],t[n]))}return i}throw Error("unknown json schema type")}}t.default=a;class o extends Error{}},function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e){this.obniz=e}static _keyFilter(e,t){let i={};return"object"!=typeof e?i:(i=Object.keys(e).filter(e=>t.includes(e)).reduce((t,i)=>(t[i]=e[i],t),{}),i)}static _requiredKeys(e,t){if("object"!=typeof e)return t[0];for(const i in t)if(!(t[i]in e))return t[i];return null}static dataArray2string(t){let r=null;try{const s=i(28).StringDecoder;s&&(r=new s("utf8").write(e.from(t)))}catch(e){}return r}static string2dataArray(t){return[...e.from(t)]}static hexToBinary(e,t=!1){const i=[],r=e.toLowerCase().replace(/[^0-9abcdef]/g,"");for(let e=0;e<r.length/2;e++)i[e]=parseInt(r[2*e]+r[2*e+1],16);return t&&i.reverse(),i}createCanvasContext(e,t){if(!this.obniz.isNode){const i=document.createElement("canvas");return i.width=e,i.height=t,i.style["-webkit-font-smoothing"]="none",document.getElementsByTagName("body")[0].appendChild(i),i.getContext("2d")}try{const{createCanvas:e}=i(38);return e(this.width,this.height)}catch(e){throw new Error("obniz.js require node-canvas to draw rich contents. see more detail on docs")}}}}).call(this,i(0).Buffer)},function(e,t){function i(e,t){if(!e)throw new Error(t||"Assertion failed")}e.exports=i,i.equal=function(e,t,i){if(e!=t)throw new Error(i||"Assertion failed: "+e+" != "+t)}},function(e,t,i){"use strict";var r=t,s=i(3),n=i(7),a=i(84);r.assert=n,r.toArray=a.toArray,r.zero2=a.zero2,r.toHex=a.toHex,r.encode=a.encode,r.getNAF=function(e,t,i){var r=new Array(Math.max(e.bitLength(),i)+1);r.fill(0);for(var s=1<<t+1,n=e.clone(),a=0;a<r.length;a++){var o,h=n.andln(s-1);n.isOdd()?(o=h>(s>>1)-1?(s>>1)-h:h,n.isubn(o)):o=0,r[a]=o,n.iushrn(1)}return r},r.getJSF=function(e,t){var i=[[],[]];e=e.clone(),t=t.clone();for(var r=0,s=0;e.cmpn(-r)>0||t.cmpn(-s)>0;){var n,a,o,h=e.andln(3)+r&3,c=t.andln(3)+s&3;if(3===h&&(h=-1),3===c&&(c=-1),0==(1&h))n=0;else n=3!==(o=e.andln(7)+r&7)&&5!==o||2!==c?h:-h;if(i[0].push(n),0==(1&c))a=0;else a=3!==(o=t.andln(7)+s&7)&&5!==o||2!==h?c:-c;i[1].push(a),2*r===n+1&&(r=1-r),2*s===a+1&&(s=1-s),e.iushrn(1),t.iushrn(1)}return i},r.cachedProperty=function(e,t,i){var r="_"+t;e.prototype[t]=function(){return void 0!==this[r]?this[r]:this[r]=i.call(this)}},r.parseBytes=function(e){return"string"==typeof e?r.toArray(e,"hex"):e},r.intFromLE=function(e){return new s(e,"hex","le")}},function(e,t){var i,r,s=e.exports={};function n(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function o(e){if(i===setTimeout)return setTimeout(e,0);if((i===n||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(t){return i.call(this,e,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:n}catch(e){i=n}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var h,c=[],d=!1,u=-1;function l(){d&&h&&(d=!1,h.length?c=h.concat(c):u=-1,c.length&&f())}function f(){if(!d){var e=o(l);d=!0;for(var t=c.length;t;){for(h=c,c=[];++u<t;)h&&h[u].run();u=-1,t=c.length}h=null,d=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}s.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];c.push(new p(e,t)),1!==c.length||d||o(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=m,s.addListener=m,s.once=m,s.off=m,s.removeListener=m,s.removeAllListeners=m,s.emit=m,s.prependListener=m,s.prependOnceListener=m,s.listeners=function(e){return[]},s.binding=function(e){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r={uuidFilter:e=>e.toLowerCase().replace(/[^0-9abcdef]/g,"")};t.default=r},function(e,t,i){"use strict";var r=i(7),s=i(1);function n(e,t){return 55296==(64512&e.charCodeAt(t))&&(!(t<0||t+1>=e.length)&&56320==(64512&e.charCodeAt(t+1)))}function a(e){return(e>>>24|e>>>8&65280|e<<8&16711680|(255&e)<<24)>>>0}function o(e){return 1===e.length?"0"+e:e}function h(e){return 7===e.length?"0"+e:6===e.length?"00"+e:5===e.length?"000"+e:4===e.length?"0000"+e:3===e.length?"00000"+e:2===e.length?"000000"+e:1===e.length?"0000000"+e:e}t.inherits=s,t.toArray=function(e,t){if(Array.isArray(e))return e.slice();if(!e)return[];var i=[];if("string"==typeof e)if(t){if("hex"===t)for((e=e.replace(/[^a-z0-9]+/gi,"")).length%2!=0&&(e="0"+e),s=0;s<e.length;s+=2)i.push(parseInt(e[s]+e[s+1],16))}else for(var r=0,s=0;s<e.length;s++){var a=e.charCodeAt(s);a<128?i[r++]=a:a<2048?(i[r++]=a>>6|192,i[r++]=63&a|128):n(e,s)?(a=65536+((1023&a)<<10)+(1023&e.charCodeAt(++s)),i[r++]=a>>18|240,i[r++]=a>>12&63|128,i[r++]=a>>6&63|128,i[r++]=63&a|128):(i[r++]=a>>12|224,i[r++]=a>>6&63|128,i[r++]=63&a|128)}else for(s=0;s<e.length;s++)i[s]=0|e[s];return i},t.toHex=function(e){for(var t="",i=0;i<e.length;i++)t+=o(e[i].toString(16));return t},t.htonl=a,t.toHex32=function(e,t){for(var i="",r=0;r<e.length;r++){var s=e[r];"little"===t&&(s=a(s)),i+=h(s.toString(16))}return i},t.zero2=o,t.zero8=h,t.join32=function(e,t,i,s){var n=i-t;r(n%4==0);for(var a=new Array(n/4),o=0,h=t;o<a.length;o++,h+=4){var c;c="big"===s?e[h]<<24|e[h+1]<<16|e[h+2]<<8|e[h+3]:e[h+3]<<24|e[h+2]<<16|e[h+1]<<8|e[h],a[o]=c>>>0}return a},t.split32=function(e,t){for(var i=new Array(4*e.length),r=0,s=0;r<e.length;r++,s+=4){var n=e[r];"big"===t?(i[s]=n>>>24,i[s+1]=n>>>16&255,i[s+2]=n>>>8&255,i[s+3]=255&n):(i[s+3]=n>>>24,i[s+2]=n>>>16&255,i[s+1]=n>>>8&255,i[s]=255&n)}return i},t.rotr32=function(e,t){return e>>>t|e<<32-t},t.rotl32=function(e,t){return e<<t|e>>>32-t},t.sum32=function(e,t){return e+t>>>0},t.sum32_3=function(e,t,i){return e+t+i>>>0},t.sum32_4=function(e,t,i,r){return e+t+i+r>>>0},t.sum32_5=function(e,t,i,r,s){return e+t+i+r+s>>>0},t.sum64=function(e,t,i,r){var s=e[t],n=r+e[t+1]>>>0,a=(n<r?1:0)+i+s;e[t]=a>>>0,e[t+1]=n},t.sum64_hi=function(e,t,i,r){return(t+r>>>0<t?1:0)+e+i>>>0},t.sum64_lo=function(e,t,i,r){return t+r>>>0},t.sum64_4_hi=function(e,t,i,r,s,n,a,o){var h=0,c=t;return h+=(c=c+r>>>0)<t?1:0,h+=(c=c+n>>>0)<n?1:0,e+i+s+a+(h+=(c=c+o>>>0)<o?1:0)>>>0},t.sum64_4_lo=function(e,t,i,r,s,n,a,o){return t+r+n+o>>>0},t.sum64_5_hi=function(e,t,i,r,s,n,a,o,h,c){var d=0,u=t;return d+=(u=u+r>>>0)<t?1:0,d+=(u=u+n>>>0)<n?1:0,d+=(u=u+o>>>0)<o?1:0,e+i+s+a+h+(d+=(u=u+c>>>0)<c?1:0)>>>0},t.sum64_5_lo=function(e,t,i,r,s,n,a,o,h,c){return t+r+n+o+c>>>0},t.rotr64_hi=function(e,t,i){return(t<<32-i|e>>>i)>>>0},t.rotr64_lo=function(e,t,i){return(e<<32-i|t>>>i)>>>0},t.shr64_hi=function(e,t,i){return e>>>i},t.shr64_lo=function(e,t,i){return(e<<32-i|t>>>i)>>>0}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.keys=["gnd","vcc","do","ao"],this.requiredKeys=[]}static info(){return{name:"MQGas"}}wired(e){this.obniz=e,this.vcc=this.params.vcc,this.gnd=this.params.gnd,this.obniz.isValidIO(this.params.ao)&&(this.ad=e.getAD(this.params.ao),this.ad.start(e=>{"function"==typeof this.onchangeanalog&&this.onchangeanalog(e),"number"==typeof this.voltageLimit&&this.voltageLimit<=e&&"function"==typeof this.onexceedvoltage&&this.onexceedvoltage(e)})),this.obniz.isValidIO(this.params.do)&&(this.do=e.getIO(this.params.do),this.do.input(e=>{"function"==typeof this.onchangedigital&&this.onchangedigital(e)}))}startHeating(){this.obniz.setVccGnd(this.vcc,this.gnd,"5v")}heatWait(e){return this.startHeating(),"number"==typeof e&&e>0?e*=1e3:e=12e4,new Promise(t=>{setTimeout(t,e)})}}},function(e,t){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(e){"object"==typeof window&&(i=window)}e.exports=i},function(e,t,i){"use strict";var r=Object.prototype.hasOwnProperty,s="~";function n(){}function a(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function o(e,t,i,r,n){if("function"!=typeof i)throw new TypeError("The listener must be a function");var o=new a(i,r||e,n),h=s?s+t:t;return e._events[h]?e._events[h].fn?e._events[h]=[e._events[h],o]:e._events[h].push(o):(e._events[h]=o,e._eventsCount++),e}function h(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function c(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(s=!1)),c.prototype.eventNames=function(){var e,t,i=[];if(0===this._eventsCount)return i;for(t in e=this._events)r.call(e,t)&&i.push(s?t.slice(1):t);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},c.prototype.listeners=function(e){var t=s?s+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var r=0,n=i.length,a=new Array(n);r<n;r++)a[r]=i[r].fn;return a},c.prototype.listenerCount=function(e){var t=s?s+e:e,i=this._events[t];return i?i.fn?1:i.length:0},c.prototype.emit=function(e,t,i,r,n,a){var o=s?s+e:e;if(!this._events[o])return!1;var h,c,d=this._events[o],u=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),u){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,i),!0;case 4:return d.fn.call(d.context,t,i,r),!0;case 5:return d.fn.call(d.context,t,i,r,n),!0;case 6:return d.fn.call(d.context,t,i,r,n,a),!0}for(c=1,h=new Array(u-1);c<u;c++)h[c-1]=arguments[c];d.fn.apply(d.context,h)}else{var l,f=d.length;for(c=0;c<f;c++)switch(d[c].once&&this.removeListener(e,d[c].fn,void 0,!0),u){case 1:d[c].fn.call(d[c].context);break;case 2:d[c].fn.call(d[c].context,t);break;case 3:d[c].fn.call(d[c].context,t,i);break;case 4:d[c].fn.call(d[c].context,t,i,r);break;default:if(!h)for(l=1,h=new Array(u-1);l<u;l++)h[l-1]=arguments[l];d[c].fn.apply(d[c].context,h)}}return!0},c.prototype.on=function(e,t,i){return o(this,e,t,i,!1)},c.prototype.once=function(e,t,i){return o(this,e,t,i,!0)},c.prototype.removeListener=function(e,t,i,r){var n=s?s+e:e;if(!this._events[n])return this;if(!t)return h(this,n),this;var a=this._events[n];if(a.fn)a.fn!==t||r&&!a.once||i&&a.context!==i||h(this,n);else{for(var o=0,c=[],d=a.length;o<d;o++)(a[o].fn!==t||r&&!a[o].once||i&&a[o].context!==i)&&c.push(a[o]);c.length?this._events[n]=1===c.length?c[0]:c:h(this,n)}return this},c.prototype.removeAllListeners=function(e){var t;return e?(t=s?s+e:e,this._events[t]&&h(this,t)):(this._events=new n,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=s,c.EventEmitter=c,e.exports=c},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.temp=0,this.keys=["vcc","gnd","output"],this.requiredKeys=["output"],this.drive="5v"}wired(e){this.obniz=e,e.setVccGnd(this.params.vcc,this.params.gnd,this.drive),this.ad=e.getAD(this.params.output),this.ad.start(e=>{this.temp=this.calc(e),this.onchange(this.temp)})}getWait(){return r(this,void 0,void 0,(function*(){const e=yield this.ad.getWait();return this.temp=this.calc(e),this.temp}))}onchange(e){}calc(e){return 0}}},function(e,t,i){var r=i(2).Buffer,s=i(41).Transform,n=i(28).StringDecoder;function a(e){s.call(this),this.hashMode="string"==typeof e,this.hashMode?this[e]=this._finalOrDigest:this.final=this._finalOrDigest,this._final&&(this.__final=this._final,this._final=null),this._decoder=null,this._encoding=null}i(1)(a,s),a.prototype.update=function(e,t,i){"string"==typeof e&&(e=r.from(e,t));var s=this._update(e);return this.hashMode?this:(i&&(s=this._toString(s,i)),s)},a.prototype.setAutoPadding=function(){},a.prototype.getAuthTag=function(){throw new Error("trying to get auth tag in unsupported state")},a.prototype.setAuthTag=function(){throw new Error("trying to set auth tag in unsupported state")},a.prototype.setAAD=function(){throw new Error("trying to set aad in unsupported state")},a.prototype._transform=function(e,t,i){var r;try{this.hashMode?this._update(e):this.push(this._update(e))}catch(e){r=e}finally{i(r)}},a.prototype._flush=function(e){var t;try{this.push(this.__final())}catch(e){t=e}e(t)},a.prototype._finalOrDigest=function(e){var t=this.__final()||r.alloc(0);return e&&(t=this._toString(t,e,!0)),t},a.prototype._toString=function(e,t,i){if(this._decoder||(this._decoder=new n(t),this._encoding=t),this._encoding!==t)throw new Error("can't switch encodings");var r=this._decoder.write(e);return i&&(r+=this._decoder.end()),r},e.exports=a},function(e,t,i){(function(i){var r;t=e.exports=H,r="object"==typeof i&&i.env&&i.env.NODE_DEBUG&&/\bsemver\b/i.test(i.env.NODE_DEBUG)?function(){var e=Array.prototype.slice.call(arguments,0);e.unshift("SEMVER"),console.log.apply(console,e)}:function(){},t.SEMVER_SPEC_VERSION="2.0.0";var s=Number.MAX_SAFE_INTEGER||9007199254740991,n=t.re=[],a=t.src=[],o=0,h=o++;a[h]="0|[1-9]\\d*";var c=o++;a[c]="[0-9]+";var d=o++;a[d]="\\d*[a-zA-Z-][a-zA-Z0-9-]*";var u=o++;a[u]="("+a[h]+")\\.("+a[h]+")\\.("+a[h]+")";var l=o++;a[l]="("+a[c]+")\\.("+a[c]+")\\.("+a[c]+")";var f=o++;a[f]="(?:"+a[h]+"|"+a[d]+")";var p=o++;a[p]="(?:"+a[c]+"|"+a[d]+")";var m=o++;a[m]="(?:-("+a[f]+"(?:\\."+a[f]+")*))";var _=o++;a[_]="(?:-?("+a[p]+"(?:\\."+a[p]+")*))";var g=o++;a[g]="[0-9A-Za-z-]+";var y=o++;a[y]="(?:\\+("+a[g]+"(?:\\."+a[g]+")*))";var b=o++,v="v?"+a[u]+a[m]+"?"+a[y]+"?";a[b]="^"+v+"$";var w="[v=\\s]*"+a[l]+a[_]+"?"+a[y]+"?",S=o++;a[S]="^"+w+"$";var E=o++;a[E]="((?:<|>)?=?)";var C=o++;a[C]=a[c]+"|x|X|\\*";var A=o++;a[A]=a[h]+"|x|X|\\*";var I=o++;a[I]="[v=\\s]*("+a[A]+")(?:\\.("+a[A]+")(?:\\.("+a[A]+")(?:"+a[m]+")?"+a[y]+"?)?)?";var P=o++;a[P]="[v=\\s]*("+a[C]+")(?:\\.("+a[C]+")(?:\\.("+a[C]+")(?:"+a[_]+")?"+a[y]+"?)?)?";var O=o++;a[O]="^"+a[E]+"\\s*"+a[I]+"$";var R=o++;a[R]="^"+a[E]+"\\s*"+a[P]+"$";var M=o++;a[M]="(?:^|[^\\d])(\\d{1,16})(?:\\.(\\d{1,16}))?(?:\\.(\\d{1,16}))?(?:$|[^\\d])";var x=o++;a[x]="(?:~>?)";var D=o++;a[D]="(\\s*)"+a[x]+"\\s+",n[D]=new RegExp(a[D],"g");var k=o++;a[k]="^"+a[x]+a[I]+"$";var T=o++;a[T]="^"+a[x]+a[P]+"$";var B=o++;a[B]="(?:\\^)";var L=o++;a[L]="(\\s*)"+a[B]+"\\s+",n[L]=new RegExp(a[L],"g");var N=o++;a[N]="^"+a[B]+a[I]+"$";var j=o++;a[j]="^"+a[B]+a[P]+"$";var q=o++;a[q]="^"+a[E]+"\\s*("+w+")$|^$";var U=o++;a[U]="^"+a[E]+"\\s*("+v+")$|^$";var F=o++;a[F]="(\\s*)"+a[E]+"\\s*("+w+"|"+a[I]+")",n[F]=new RegExp(a[F],"g");var z=o++;a[z]="^\\s*("+a[I]+")\\s+-\\s+("+a[I]+")\\s*$";var W=o++;a[W]="^\\s*("+a[P]+")\\s+-\\s+("+a[P]+")\\s*$";var $=o++;a[$]="(<|>)?=?\\s*\\*";for(var V=0;V<35;V++)r(V,a[V]),n[V]||(n[V]=new RegExp(a[V]));function G(e,t){if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof H)return e;if("string"!=typeof e)return null;if(e.length>256)return null;if(!(t.loose?n[S]:n[b]).test(e))return null;try{return new H(e,t)}catch(e){return null}}function H(e,t){if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof H){if(e.loose===t.loose)return e;e=e.version}else if("string"!=typeof e)throw new TypeError("Invalid Version: "+e);if(e.length>256)throw new TypeError("version is longer than 256 characters");if(!(this instanceof H))return new H(e,t);r("SemVer",e,t),this.options=t,this.loose=!!t.loose;var i=e.trim().match(t.loose?n[S]:n[b]);if(!i)throw new TypeError("Invalid Version: "+e);if(this.raw=e,this.major=+i[1],this.minor=+i[2],this.patch=+i[3],this.major>s||this.major<0)throw new TypeError("Invalid major version");if(this.minor>s||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>s||this.patch<0)throw new TypeError("Invalid patch version");i[4]?this.prerelease=i[4].split(".").map((function(e){if(/^[0-9]+$/.test(e)){var t=+e;if(t>=0&&t<s)return t}return e})):this.prerelease=[],this.build=i[5]?i[5].split("."):[],this.format()}t.parse=G,t.valid=function(e,t){var i=G(e,t);return i?i.version:null},t.clean=function(e,t){var i=G(e.trim().replace(/^[=v]+/,""),t);return i?i.version:null},t.SemVer=H,H.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version},H.prototype.toString=function(){return this.version},H.prototype.compare=function(e){return r("SemVer.compare",this.version,this.options,e),e instanceof H||(e=new H(e,this.options)),this.compareMain(e)||this.comparePre(e)},H.prototype.compareMain=function(e){return e instanceof H||(e=new H(e,this.options)),Y(this.major,e.major)||Y(this.minor,e.minor)||Y(this.patch,e.patch)},H.prototype.comparePre=function(e){if(e instanceof H||(e=new H(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;var t=0;do{var i=this.prerelease[t],s=e.prerelease[t];if(r("prerelease compare",t,i,s),void 0===i&&void 0===s)return 0;if(void 0===s)return 1;if(void 0===i)return-1;if(i!==s)return Y(i,s)}while(++t)},H.prototype.inc=function(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{for(var i=this.prerelease.length;--i>=0;)"number"==typeof this.prerelease[i]&&(this.prerelease[i]++,i=-2);-1===i&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error("invalid increment argument: "+e)}return this.format(),this.raw=this.version,this},t.inc=function(e,t,i,r){"string"==typeof i&&(r=i,i=void 0);try{return new H(e,i).inc(t,r).version}catch(e){return null}},t.diff=function(e,t){if(Z(e,t))return null;var i=G(e),r=G(t),s="";if(i.prerelease.length||r.prerelease.length){s="pre";var n="prerelease"}for(var a in i)if(("major"===a||"minor"===a||"patch"===a)&&i[a]!==r[a])return s+a;return n},t.compareIdentifiers=Y;var K=/^[0-9]+$/;function Y(e,t){var i=K.test(e),r=K.test(t);return i&&r&&(e=+e,t=+t),e===t?0:i&&!r?-1:r&&!i?1:e<t?-1:1}function J(e,t,i){return new H(e,i).compare(new H(t,i))}function Q(e,t,i){return J(e,t,i)>0}function X(e,t,i){return J(e,t,i)<0}function Z(e,t,i){return 0===J(e,t,i)}function ee(e,t,i){return 0!==J(e,t,i)}function te(e,t,i){return J(e,t,i)>=0}function ie(e,t,i){return J(e,t,i)<=0}function re(e,t,i,r){switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof i&&(i=i.version),e===i;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof i&&(i=i.version),e!==i;case"":case"=":case"==":return Z(e,i,r);case"!=":return ee(e,i,r);case">":return Q(e,i,r);case">=":return te(e,i,r);case"<":return X(e,i,r);case"<=":return ie(e,i,r);default:throw new TypeError("Invalid operator: "+t)}}function se(e,t){if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof se){if(e.loose===!!t.loose)return e;e=e.value}if(!(this instanceof se))return new se(e,t);r("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===ne?this.value="":this.value=this.operator+this.semver.version,r("comp",this)}t.rcompareIdentifiers=function(e,t){return Y(t,e)},t.major=function(e,t){return new H(e,t).major},t.minor=function(e,t){return new H(e,t).minor},t.patch=function(e,t){return new H(e,t).patch},t.compare=J,t.compareLoose=function(e,t){return J(e,t,!0)},t.rcompare=function(e,t,i){return J(t,e,i)},t.sort=function(e,i){return e.sort((function(e,r){return t.compare(e,r,i)}))},t.rsort=function(e,i){return e.sort((function(e,r){return t.rcompare(e,r,i)}))},t.gt=Q,t.lt=X,t.eq=Z,t.neq=ee,t.gte=te,t.lte=ie,t.cmp=re,t.Comparator=se;var ne={};function ae(e,t){if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof ae)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new ae(e.raw,t);if(e instanceof se)return new ae(e.value,t);if(!(this instanceof ae))return new ae(e,t);if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map((function(e){return this.parseRange(e.trim())}),this).filter((function(e){return e.length})),!this.set.length)throw new TypeError("Invalid SemVer Range: "+e);this.format()}function oe(e){return!e||"x"===e.toLowerCase()||"*"===e}function he(e,t,i,r,s,n,a,o,h,c,d,u,l){return((t=oe(i)?"":oe(r)?">="+i+".0.0":oe(s)?">="+i+"."+r+".0":">="+t)+" "+(o=oe(h)?"":oe(c)?"<"+(+h+1)+".0.0":oe(d)?"<"+h+"."+(+c+1)+".0":u?"<="+h+"."+c+"."+d+"-"+u:"<="+o)).trim()}function ce(e,t,i){for(var s=0;s<e.length;s++)if(!e[s].test(t))return!1;if(t.prerelease.length&&!i.includePrerelease){for(s=0;s<e.length;s++)if(r(e[s].semver),e[s].semver!==ne&&e[s].semver.prerelease.length>0){var n=e[s].semver;if(n.major===t.major&&n.minor===t.minor&&n.patch===t.patch)return!0}return!1}return!0}function de(e,t,i){try{t=new ae(t,i)}catch(e){return!1}return t.test(e)}function ue(e,t,i,r){var s,n,a,o,h;switch(e=new H(e,r),t=new ae(t,r),i){case">":s=Q,n=ie,a=X,o=">",h=">=";break;case"<":s=X,n=te,a=Q,o="<",h="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(de(e,t,r))return!1;for(var c=0;c<t.set.length;++c){var d=t.set[c],u=null,l=null;if(d.forEach((function(e){e.semver===ne&&(e=new se(">=0.0.0")),u=u||e,l=l||e,s(e.semver,u.semver,r)?u=e:a(e.semver,l.semver,r)&&(l=e)})),u.operator===o||u.operator===h)return!1;if((!l.operator||l.operator===o)&&n(e,l.semver))return!1;if(l.operator===h&&a(e,l.semver))return!1}return!0}se.prototype.parse=function(e){var t=this.options.loose?n[q]:n[U],i=e.match(t);if(!i)throw new TypeError("Invalid comparator: "+e);this.operator=i[1],"="===this.operator&&(this.operator=""),i[2]?this.semver=new H(i[2],this.options.loose):this.semver=ne},se.prototype.toString=function(){return this.value},se.prototype.test=function(e){return r("Comparator.test",e,this.options.loose),this.semver===ne||("string"==typeof e&&(e=new H(e,this.options)),re(e,this.operator,this.semver,this.options))},se.prototype.intersects=function(e,t){if(!(e instanceof se))throw new TypeError("a Comparator is required");var i;if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),""===this.operator)return i=new ae(e.value,t),de(this.value,i,t);if(""===e.operator)return i=new ae(this.value,t),de(e.semver,i,t);var r=!(">="!==this.operator&&">"!==this.operator||">="!==e.operator&&">"!==e.operator),s=!("<="!==this.operator&&"<"!==this.operator||"<="!==e.operator&&"<"!==e.operator),n=this.semver.version===e.semver.version,a=!(">="!==this.operator&&"<="!==this.operator||">="!==e.operator&&"<="!==e.operator),o=re(this.semver,"<",e.semver,t)&&(">="===this.operator||">"===this.operator)&&("<="===e.operator||"<"===e.operator),h=re(this.semver,">",e.semver,t)&&("<="===this.operator||"<"===this.operator)&&(">="===e.operator||">"===e.operator);return r||s||n&&a||o||h},t.Range=ae,ae.prototype.format=function(){return this.range=this.set.map((function(e){return e.join(" ").trim()})).join("||").trim(),this.range},ae.prototype.toString=function(){return this.range},ae.prototype.parseRange=function(e){var t=this.options.loose;e=e.trim();var i=t?n[W]:n[z];e=e.replace(i,he),r("hyphen replace",e),e=e.replace(n[F],"$1$2$3"),r("comparator trim",e,n[F]),e=(e=(e=e.replace(n[D],"$1~")).replace(n[L],"$1^")).split(/\s+/).join(" ");var s=t?n[q]:n[U],a=e.split(" ").map((function(e){return function(e,t){return r("comp",e,t),e=function(e,t){return e.trim().split(/\s+/).map((function(e){return function(e,t){r("caret",e,t);var i=t.loose?n[j]:n[N];return e.replace(i,(function(t,i,s,n,a){var o;return r("caret",e,t,i,s,n,a),oe(i)?o="":oe(s)?o=">="+i+".0.0 <"+(+i+1)+".0.0":oe(n)?o="0"===i?">="+i+"."+s+".0 <"+i+"."+(+s+1)+".0":">="+i+"."+s+".0 <"+(+i+1)+".0.0":a?(r("replaceCaret pr",a),o="0"===i?"0"===s?">="+i+"."+s+"."+n+"-"+a+" <"+i+"."+s+"."+(+n+1):">="+i+"."+s+"."+n+"-"+a+" <"+i+"."+(+s+1)+".0":">="+i+"."+s+"."+n+"-"+a+" <"+(+i+1)+".0.0"):(r("no pr"),o="0"===i?"0"===s?">="+i+"."+s+"."+n+" <"+i+"."+s+"."+(+n+1):">="+i+"."+s+"."+n+" <"+i+"."+(+s+1)+".0":">="+i+"."+s+"."+n+" <"+(+i+1)+".0.0"),r("caret return",o),o}))}(e,t)})).join(" ")}(e,t),r("caret",e),e=function(e,t){return e.trim().split(/\s+/).map((function(e){return function(e,t){var i=t.loose?n[T]:n[k];return e.replace(i,(function(t,i,s,n,a){var o;return r("tilde",e,t,i,s,n,a),oe(i)?o="":oe(s)?o=">="+i+".0.0 <"+(+i+1)+".0.0":oe(n)?o=">="+i+"."+s+".0 <"+i+"."+(+s+1)+".0":a?(r("replaceTilde pr",a),o=">="+i+"."+s+"."+n+"-"+a+" <"+i+"."+(+s+1)+".0"):o=">="+i+"."+s+"."+n+" <"+i+"."+(+s+1)+".0",r("tilde return",o),o}))}(e,t)})).join(" ")}(e,t),r("tildes",e),e=function(e,t){return r("replaceXRanges",e,t),e.split(/\s+/).map((function(e){return function(e,t){e=e.trim();var i=t.loose?n[R]:n[O];return e.replace(i,(function(t,i,s,n,a,o){r("xRange",e,t,i,s,n,a,o);var h=oe(s),c=h||oe(n),d=c||oe(a);return"="===i&&d&&(i=""),h?t=">"===i||"<"===i?"<0.0.0":"*":i&&d?(c&&(n=0),a=0,">"===i?(i=">=",c?(s=+s+1,n=0,a=0):(n=+n+1,a=0)):"<="===i&&(i="<",c?s=+s+1:n=+n+1),t=i+s+"."+n+"."+a):c?t=">="+s+".0.0 <"+(+s+1)+".0.0":d&&(t=">="+s+"."+n+".0 <"+s+"."+(+n+1)+".0"),r("xRange return",t),t}))}(e,t)})).join(" ")}(e,t),r("xrange",e),e=function(e,t){return r("replaceStars",e,t),e.trim().replace(n[$],"")}(e,t),r("stars",e),e}(e,this.options)}),this).join(" ").split(/\s+/);return this.options.loose&&(a=a.filter((function(e){return!!e.match(s)}))),a=a.map((function(e){return new se(e,this.options)}),this)},ae.prototype.intersects=function(e,t){if(!(e instanceof ae))throw new TypeError("a Range is required");return this.set.some((function(i){return i.every((function(i){return e.set.some((function(e){return e.every((function(e){return i.intersects(e,t)}))}))}))}))},t.toComparators=function(e,t){return new ae(e,t).set.map((function(e){return e.map((function(e){return e.value})).join(" ").trim().split(" ")}))},ae.prototype.test=function(e){if(!e)return!1;"string"==typeof e&&(e=new H(e,this.options));for(var t=0;t<this.set.length;t++)if(ce(this.set[t],e,this.options))return!0;return!1},t.satisfies=de,t.maxSatisfying=function(e,t,i){var r=null,s=null;try{var n=new ae(t,i)}catch(e){return null}return e.forEach((function(e){n.test(e)&&(r&&-1!==s.compare(e)||(s=new H(r=e,i)))})),r},t.minSatisfying=function(e,t,i){var r=null,s=null;try{var n=new ae(t,i)}catch(e){return null}return e.forEach((function(e){n.test(e)&&(r&&1!==s.compare(e)||(s=new H(r=e,i)))})),r},t.minVersion=function(e,t){e=new ae(e,t);var i=new H("0.0.0");if(e.test(i))return i;if(i=new H("0.0.0-0"),e.test(i))return i;i=null;for(var r=0;r<e.set.length;++r){e.set[r].forEach((function(e){var t=new H(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":i&&!Q(i,t)||(i=t);break;case"<":case"<=":break;default:throw new Error("Unexpected operation: "+e.operator)}}))}if(i&&e.test(i))return i;return null},t.validRange=function(e,t){try{return new ae(e,t).range||"*"}catch(e){return null}},t.ltr=function(e,t,i){return ue(e,t,"<",i)},t.gtr=function(e,t,i){return ue(e,t,">",i)},t.outside=ue,t.prerelease=function(e,t){var i=G(e,t);return i&&i.prerelease.length?i.prerelease:null},t.intersects=function(e,t,i){return e=new ae(e,i),t=new ae(t,i),e.intersects(t)},t.coerce=function(e){if(e instanceof H)return e;if("string"!=typeof e)return null;var t=e.match(n[M]);if(null==t)return null;return G(t[1]+"."+(t[2]||"0")+"."+(t[3]||"0"))}}).call(this,i(9))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r={uuidFilter:e=>e.toLowerCase().replace(/[^0-9abcdef]/g,""),toCamelCase:e=>(e=e.charAt(0).toLowerCase()+e.slice(1)).replace(/[-_](.)/g,(e,t)=>t.toUpperCase()),toSnakeCase(e){return this.toCamelCase(e).replace(/[A-Z]/g,e=>"_"+e.charAt(0).toLowerCase())}};t.default=r},function(e,t,i){"use strict";var r=i(31),s=Object.keys||function(e){var t=[];for(var i in e)t.push(i);return t};e.exports=u;var n=Object.create(i(23));n.inherits=i(1);var a=i(62),o=i(43);n.inherits(u,a);for(var h=s(o.prototype),c=0;c<h.length;c++){var d=h[c];u.prototype[d]||(u.prototype[d]=o.prototype[d])}function u(e){if(!(this instanceof u))return new u(e);a.call(this,e),o.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",l)}function l(){this.allowHalfOpen||this._writableState.ended||r.nextTick(f,this)}function f(e){e.end()}Object.defineProperty(u.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(u.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),u.prototype._destroy=function(e,t){this.push(null),this.end(),r.nextTick(t,e)}},function(e,t,i){"use strict";(function(t,r){var s=i(2).Buffer,n=t.crypto||t.msCrypto;n&&n.getRandomValues?e.exports=function(e,t){if(e>4294967295)throw new RangeError("requested too many random bytes");var i=s.allocUnsafe(e);if(e>0)if(e>65536)for(var a=0;a<e;a+=65536)n.getRandomValues(i.slice(a,a+65536));else n.getRandomValues(i);if("function"==typeof t)return r.nextTick((function(){t(null,i)}));return i}:e.exports=function(){throw new Error("Secure random number generation is not supported by this browser.\nUse Chrome, Firefox or Internet Explorer 11")}}).call(this,i(13),i(9))},function(e,t,i){var r=i(2).Buffer;function s(e,t){this._block=r.alloc(e),this._finalSize=t,this._blockSize=e,this._len=0}s.prototype.update=function(e,t){"string"==typeof e&&(t=t||"utf8",e=r.from(e,t));for(var i=this._block,s=this._blockSize,n=e.length,a=this._len,o=0;o<n;){for(var h=a%s,c=Math.min(n-o,s-h),d=0;d<c;d++)i[h+d]=e[o+d];o+=c,(a+=c)%s==0&&this._update(i)}return this._len+=n,this},s.prototype.digest=function(e){var t=this._len%this._blockSize;this._block[t]=128,this._block.fill(0,t+1),t>=this._finalSize&&(this._update(this._block),this._block.fill(0));var i=8*this._len;if(i<=4294967295)this._block.writeUInt32BE(i,this._blockSize-4);else{var r=(4294967295&i)>>>0,s=(i-r)/4294967296;this._block.writeUInt32BE(s,this._blockSize-8),this._block.writeUInt32BE(r,this._blockSize-4)}this._update(this._block);var n=this._hash();return e?n.toString(e):n},s.prototype._update=function(){throw new Error("_update must be implemented by subclass")},e.exports=s},function(e,t,i){"use strict";var r=i(1),s=i(40),n=i(44),a=i(45),o=i(16);function h(e){o.call(this,"digest"),this._hash=e}r(h,o),h.prototype._update=function(e){this._hash.update(e)},h.prototype._final=function(){return this._hash.digest()},e.exports=function(e){return"md5"===(e=e.toLowerCase())?new s:"rmd160"===e||"ripemd160"===e?new n:new h(a(e))}},function(e,t,i){(function(e){function i(e){return Object.prototype.toString.call(e)}t.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===i(e)},t.isBoolean=function(e){return"boolean"==typeof e},t.isNull=function(e){return null===e},t.isNullOrUndefined=function(e){return null==e},t.isNumber=function(e){return"number"==typeof e},t.isString=function(e){return"string"==typeof e},t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=function(e){return void 0===e},t.isRegExp=function(e){return"[object RegExp]"===i(e)},t.isObject=function(e){return"object"==typeof e&&null!==e},t.isDate=function(e){return"[object Date]"===i(e)},t.isError=function(e){return"[object Error]"===i(e)||e instanceof Error},t.isFunction=function(e){return"function"==typeof e},t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=e.isBuffer}).call(this,i(0).Buffer)},function(e,t,i){(function(t){e.exports=function(e,i){for(var r=Math.min(e.length,i.length),s=new t(r),n=0;n<r;++n)s[n]=e[n]^i[n];return s}}).call(this,i(0).Buffer)},function(e,t,i){"use strict";var r=i(11),s=i(7);function n(){this.pending=null,this.pendingTotal=0,this.blockSize=this.constructor.blockSize,this.outSize=this.constructor.outSize,this.hmacStrength=this.constructor.hmacStrength,this.padLength=this.constructor.padLength/8,this.endian="big",this._delta8=this.blockSize/8,this._delta32=this.blockSize/32}t.BlockHash=n,n.prototype.update=function(e,t){if(e=r.toArray(e,t),this.pending?this.pending=this.pending.concat(e):this.pending=e,this.pendingTotal+=e.length,this.pending.length>=this._delta8){var i=(e=this.pending).length%this._delta8;this.pending=e.slice(e.length-i,e.length),0===this.pending.length&&(this.pending=null),e=r.join32(e,0,e.length-i,this.endian);for(var s=0;s<e.length;s+=this._delta32)this._update(e,s,s+this._delta32)}return this},n.prototype.digest=function(e){return this.update(this._pad()),s(null===this.pending),this._digest(e)},n.prototype._pad=function(){var e=this.pendingTotal,t=this._delta8,i=t-(e+this.padLength)%t,r=new Array(i+this.padLength);r[0]=128;for(var s=1;s<i;s++)r[s]=0;if(e<<=3,"big"===this.endian){for(var n=8;n<this.padLength;n++)r[s++]=0;r[s++]=0,r[s++]=0,r[s++]=0,r[s++]=0,r[s++]=e>>>24&255,r[s++]=e>>>16&255,r[s++]=e>>>8&255,r[s++]=255&e}else for(r[s++]=255&e,r[s++]=e>>>8&255,r[s++]=e>>>16&255,r[s++]=e>>>24&255,r[s++]=0,r[s++]=0,r[s++]=0,r[s++]=0,n=8;n<this.padLength;n++)r[s++]=0;return r}},function(e,t,i){var r=t;r.bignum=i(3),r.define=i(193).define,r.base=i(27),r.constants=i(90),r.decoders=i(198),r.encoders=i(200)},function(e,t,i){var r=t;r.Reporter=i(195).Reporter,r.DecoderBuffer=i(89).DecoderBuffer,r.EncoderBuffer=i(89).EncoderBuffer,r.Node=i(196)},function(e,t,i){"use strict";var r=i(2).Buffer,s=r.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function n(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(r.isEncoding===s||!s(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=h,this.end=c,t=4;break;case"utf8":this.fillLast=o,t=4;break;case"base64":this.text=d,this.end=u,t=3;break;default:return this.write=l,void(this.end=f)}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(t)}function a(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function o(e){var t=this.lastTotal-this.lastNeed,i=function(e,t,i){if(128!=(192&t[0]))return e.lastNeed=0,"";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,""}}(this,e);return void 0!==i?i:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function h(e,t){if((e.length-t)%2==0){var i=e.toString("utf16le",t);if(i){var r=i.charCodeAt(i.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],i.slice(0,-1)}return i}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function c(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var i=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,i)}return t}function d(e,t){var i=(e.length-t)%3;return 0===i?e.toString("base64",t):(this.lastNeed=3-i,this.lastTotal=3,1===i?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-i))}function u(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function l(e){return e.toString(this.encoding)}function f(e){return e&&e.length?this.write(e):""}t.StringDecoder=n,n.prototype.write=function(e){if(0===e.length)return"";var t,i;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";i=this.lastNeed,this.lastNeed=0}else i=0;return i<e.length?t?t+this.text(e,i):this.text(e,i):t||""},n.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"":t},n.prototype.text=function(e,t){var i=function(e,t,i){var r=t.length-1;if(r<i)return 0;var s=a(t[r]);if(s>=0)return s>0&&(e.lastNeed=s-1),s;if(--r<i||-2===s)return 0;if((s=a(t[r]))>=0)return s>0&&(e.lastNeed=s-2),s;if(--r<i||-2===s)return 0;if((s=a(t[r]))>=0)return s>0&&(2===s?s=0:e.lastNeed=s-3),s;return 0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=i;var r=e.length-(i-this.lastNeed);return e.copy(this.lastChar,0,r),e.toString("utf8",t,r)},n.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(14),n=r(i(6)),a=r(i(10));t.default=class{constructor(e){if(this.uuid=a.default.uuidFilter(e.uuid),this.parent=null,this.children=[],this.isRemote=!1,this.discoverdOnRemote=!1,this.data=e.data||null,!this.data&&e.text&&(this.data=n.default.string2dataArray(e.text)),!this.data&&e.value&&(this.data=[e.value]),e[this.childrenName])for(const t of e[this.childrenName])this.addChild(t);this.setFunctions(),this.emitter=new s}setFunctions(){let e=this.childrenName;if(e){e=e.charAt(0).toUpperCase()+e.slice(1);const t=e.slice(0,-1);let i="add"+t;this[i]=this.addChild,i="get"+t,this[i]=this.getChild}const t=this.parentName;t&&Object.defineProperty(this,t,{get(){return this.parent},set(e){this.parent=e}})}get childrenClass(){return Object}get childrenName(){return null}get parentName(){return null}addChild(e){if(!(e instanceof this.childrenClass)){e=new(0,this.childrenClass)(e)}return e.parent=this,this.children.push(e),e}getChild(e){return e=a.default.uuidFilter(e),this.children.filter(t=>a.default.uuidFilter(t.uuid)===e).shift()}toJSON(){const e={uuid:a.default.uuidFilter(this.uuid)};if(this.children.length>0){e[this.childrenName]=this.children}return this.data&&(e.data=this.data),e}read(){}write(e,t){}writeNumber(e,t){this.write([e],t)}writeText(e,t){this.write(n.default.string2dataArray(e),t)}readWait(){return new Promise((e,t)=>{this.emitter.once("onread",i=>{"success"===i.result?e(i.data):t(new Error("readWait failed"))}),this.read()})}writeWait(e,t){return new Promise((i,r)=>{this.emitter.once("onwrite",e=>{"success"===e.result?i(!0):r(new Error("writeWait failed"))}),this.write(e,t)})}writeTextWait(e){return new Promise((t,i)=>{this.emitter.once("onwrite",e=>{"success"===e.result?t(!0):i(new Error("writeTextWait failed"))}),this.writeText(e)})}writeNumberWait(e){return new Promise((t,i)=>{this.emitter.once("onwrite",e=>{"success"===e.result?t(!0):i(new Error("writeNumberWait failed"))}),this.writeNumber(e)})}readFromRemoteWait(){return new Promise(e=>{this.emitter.once("onreadfromremote",()=>{e()})})}writeFromRemoteWait(){return new Promise(e=>{this.emitter.once("onreadfromremote",t=>{e(t.data)})})}onwrite(e){}onread(e){}onwritefromremote(e,t){}onreadfromremote(e){}onerror(e){console.error(e.message)}notifyFromServer(e,t){switch(this.emitter.emit(e,t),e){case"onerror":this.onerror(t);break;case"onwrite":this.onwrite(t.result);break;case"onread":this.onread(t.data);break;case"onwritefromremote":this.onwritefromremote(t.address,t.data);break;case"onreadfromremote":this.onreadfromremote(t.address)}}}},function(e,t,i){"use strict";(function(e,r){var s=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=(...e)=>{console.log(...e)},a=i(4);var o;!function(e){e.HCI_COMMAND_PKT=1,e.HCI_ACLDATA_PKT=2,e.HCI_EVENT_PKT=4,e.ACL_START_NO_FLUSH=0,e.ACL_CONT=1,e.ACL_START=2,e.EVT_DISCONN_COMPLETE=5,e.EVT_ENCRYPT_CHANGE=8,e.EVT_CMD_COMPLETE=14,e.EVT_CMD_STATUS=15,e.EVT_NUMBER_OF_COMPLETED_PACKETS=19,e.EVT_LE_META_EVENT=62,e.EVT_LE_CONN_COMPLETE=1,e.EVT_LE_ADVERTISING_REPORT=2,e.EVT_LE_CONN_UPDATE_COMPLETE=3,e.OGF_LINK_CTL=1,e.OCF_DISCONNECT=6,e.OGF_HOST_CTL=3,e.OCF_SET_EVENT_MASK=1,e.OCF_RESET=3,e.OCF_READ_LE_HOST_SUPPORTED=108,e.OCF_WRITE_LE_HOST_SUPPORTED=109,e.OGF_INFO_PARAM=4,e.OCF_READ_LOCAL_VERSION=1,e.OCF_READ_BUFFER_SIZE=5,e.OCF_READ_BD_ADDR=9,e.OGF_STATUS_PARAM=5,e.OCF_READ_RSSI=5,e.OGF_LE_CTL=8,e.OCF_LE_SET_EVENT_MASK=1,e.OCF_LE_READ_BUFFER_SIZE=2,e.OCF_LE_SET_ADVERTISING_PARAMETERS=6,e.OCF_LE_SET_ADVERTISING_DATA=8,e.OCF_LE_SET_SCAN_RESPONSE_DATA=9,e.OCF_LE_SET_ADVERTISE_ENABLE=10,e.OCF_LE_SET_SCAN_PARAMETERS=11,e.OCF_LE_SET_SCAN_ENABLE=12,e.OCF_LE_CREATE_CONN=13,e.OCF_LE_CONN_UPDATE=19,e.OCF_LE_START_ENCRYPTION=25,e.OCF_LE_LTK_NEG_REPLY=27,e.DISCONNECT_CMD=e.OCF_DISCONNECT|e.OGF_LINK_CTL<<10,e.SET_EVENT_MASK_CMD=e.OCF_SET_EVENT_MASK|e.OGF_HOST_CTL<<10,e.RESET_CMD=e.OCF_RESET|e.OGF_HOST_CTL<<10,e.READ_LE_HOST_SUPPORTED_CMD=e.OCF_READ_LE_HOST_SUPPORTED|e.OGF_HOST_CTL<<10,e.WRITE_LE_HOST_SUPPORTED_CMD=e.OCF_WRITE_LE_HOST_SUPPORTED|e.OGF_HOST_CTL<<10,e.READ_LOCAL_VERSION_CMD=e.OCF_READ_LOCAL_VERSION|e.OGF_INFO_PARAM<<10,e.READ_BUFFER_SIZE_CMD=e.OCF_READ_BUFFER_SIZE|e.OGF_INFO_PARAM<<10,e.READ_BD_ADDR_CMD=e.OCF_READ_BD_ADDR|e.OGF_INFO_PARAM<<10,e.READ_RSSI_CMD=e.OCF_READ_RSSI|e.OGF_STATUS_PARAM<<10,e.LE_SET_EVENT_MASK_CMD=e.OCF_LE_SET_EVENT_MASK|e.OGF_LE_CTL<<10,e.LE_READ_BUFFER_SIZE_CMD=e.OCF_LE_READ_BUFFER_SIZE|e.OGF_LE_CTL<<10,e.LE_SET_SCAN_PARAMETERS_CMD=e.OCF_LE_SET_SCAN_PARAMETERS|e.OGF_LE_CTL<<10,e.LE_SET_SCAN_ENABLE_CMD=e.OCF_LE_SET_SCAN_ENABLE|e.OGF_LE_CTL<<10,e.LE_CREATE_CONN_CMD=e.OCF_LE_CREATE_CONN|e.OGF_LE_CTL<<10,e.LE_CONN_UPDATE_CMD=e.OCF_LE_CONN_UPDATE|e.OGF_LE_CTL<<10,e.LE_START_ENCRYPTION_CMD=e.OCF_LE_START_ENCRYPTION|e.OGF_LE_CTL<<10,e.LE_SET_ADVERTISING_PARAMETERS_CMD=e.OCF_LE_SET_ADVERTISING_PARAMETERS|e.OGF_LE_CTL<<10,e.LE_SET_ADVERTISING_DATA_CMD=e.OCF_LE_SET_ADVERTISING_DATA|e.OGF_LE_CTL<<10,e.LE_SET_SCAN_RESPONSE_DATA_CMD=e.OCF_LE_SET_SCAN_RESPONSE_DATA|e.OGF_LE_CTL<<10,e.LE_SET_ADVERTISE_ENABLE_CMD=e.OCF_LE_SET_ADVERTISE_ENABLE|e.OGF_LE_CTL<<10,e.LE_LTK_NEG_REPLY_CMD=e.OCF_LE_LTK_NEG_REPLY|e.OGF_LE_CTL<<10,e.HCI_OE_USER_ENDED_CONNECTION=19}(o||(o={}));const h=i(129);class c extends a.EventEmitter{constructor(e){super(),this._obnizHci=e,this._state=null,this._handleBuffers={},this.on("stateChange",this.onStateChange.bind(this)),this._socket={write:e=>{const t=Array.from(e);this._obnizHci.write(t)}},this._obnizHci.onread=this.onSocketData.bind(this)}initWait(){return s(this,void 0,void 0,(function*(){return this.reset(),new Promise(e=>{this.once("stateChange",()=>{e()})})}))}setEventMask(){const t=e.alloc(12),i=e.from("fffffbff07f8bf3d","hex");t.writeUInt8(o.HCI_COMMAND_PKT,0),t.writeUInt16LE(o.SET_EVENT_MASK_CMD,1),t.writeUInt8(i.length,3),i.copy(t,4),n("set event mask - writing: "+t.toString("hex")),this._socket.write(t)}reset(){const t=e.alloc(4);t.writeUInt8(o.HCI_COMMAND_PKT,0),t.writeUInt16LE(o.OCF_RESET|o.OGF_HOST_CTL<<10,1),t.writeUInt8(0,3),n("reset - writing: "+t.toString("hex")),this._socket.write(t)}resetBuffers(){this._handleAclsInProgress={},this._handleBuffers={},this._aclOutQueue=[]}readLocalVersion(){const t=e.alloc(4);t.writeUInt8(o.HCI_COMMAND_PKT,0),t.writeUInt16LE(o.READ_LOCAL_VERSION_CMD,1),t.writeUInt8(0,3),n("read local version - writing: "+t.toString("hex")),this._socket.write(t)}readBdAddr(){const t=e.alloc(4);t.writeUInt8(o.HCI_COMMAND_PKT,0),t.writeUInt16LE(o.READ_BD_ADDR_CMD,1),t.writeUInt8(0,3),n("read bd addr - writing: "+t.toString("hex")),this._socket.write(t)}setLeEventMask(){const t=e.alloc(12),i=e.from("1f00000000000000","hex");t.writeUInt8(o.HCI_COMMAND_PKT,0),t.writeUInt16LE(o.LE_SET_EVENT_MASK_CMD,1),t.writeUInt8(i.length,3),i.copy(t,4),n("set le event mask - writing: "+t.toString("hex")),this._socket.write(t)}readLeHostSupported(){const t=e.alloc(4);t.writeUInt8(o.HCI_COMMAND_PKT,0),t.writeUInt16LE(o.READ_LE_HOST_SUPPORTED_CMD,1),t.writeUInt8(0,3),n("read LE host supported - writing: "+t.toString("hex")),this._socket.write(t)}writeLeHostSupported(){const t=e.alloc(6);t.writeUInt8(o.HCI_COMMAND_PKT,0),t.writeUInt16LE(o.WRITE_LE_HOST_SUPPORTED_CMD,1),t.writeUInt8(2,3),t.writeUInt8(1,4),t.writeUInt8(0,5),n("write LE host supported - writing: "+t.toString("hex")),this._socket.write(t)}setScanParameters(t){const i=e.alloc(11);i.writeUInt8(o.HCI_COMMAND_PKT,0),i.writeUInt16LE(o.LE_SET_SCAN_PARAMETERS_CMD,1),i.writeUInt8(7,3),i.writeUInt8(t?1:0,4),i.writeUInt16LE(16,5),i.writeUInt16LE(16,7),i.writeUInt8(0,9),i.writeUInt8(0,10),n("set scan parameters - writing: "+i.toString("hex")),this._socket.write(i)}setScanEnabled(t,i){const r=e.alloc(6);r.writeUInt8(o.HCI_COMMAND_PKT,0),r.writeUInt16LE(o.LE_SET_SCAN_ENABLE_CMD,1),r.writeUInt8(2,3),r.writeUInt8(t?1:0,4),r.writeUInt8(i?1:0,5),n("set scan enabled - writing: "+r.toString("hex")),this._socket.write(r)}createLeConn(t,i){const r=e.alloc(29);r.writeUInt8(o.HCI_COMMAND_PKT,0),r.writeUInt16LE(o.LE_CREATE_CONN_CMD,1),r.writeUInt8(25,3),r.writeUInt16LE(96,4),r.writeUInt16LE(48,6),r.writeUInt8(0,8),r.writeUInt8("random"===i?1:0,9),e.from(t.split(":").reverse().join(""),"hex").copy(r,10),r.writeUInt8(0,16),r.writeUInt16LE(6,17),r.writeUInt16LE(12,19),r.writeUInt16LE(0,21),r.writeUInt16LE(200,23),r.writeUInt16LE(4,25),r.writeUInt16LE(6,27),n("create le conn - writing: "+r.toString("hex")),this._socket.write(r)}connUpdateLe(t,i,r,s,a){const h=e.alloc(18);h.writeUInt8(o.HCI_COMMAND_PKT,0),h.writeUInt16LE(o.LE_CONN_UPDATE_CMD,1),h.writeUInt8(14,3),h.writeUInt16LE(t,4),h.writeUInt16LE(Math.floor(i/1.25),6),h.writeUInt16LE(Math.floor(r/1.25),8),h.writeUInt16LE(s,10),h.writeUInt16LE(Math.floor(a/10),12),h.writeUInt16LE(0,14),h.writeUInt16LE(0,16),n("conn update le - writing: "+h.toString("hex")),this._socket.write(h)}startLeEncryption(t,i,r,s){const a=e.alloc(32);a.writeUInt8(o.HCI_COMMAND_PKT,0),a.writeUInt16LE(o.LE_START_ENCRYPTION_CMD,1),a.writeUInt8(28,3),a.writeUInt16LE(t,4),i.copy(a,6),r.copy(a,14),s.copy(a,16),n("start le encryption - writing: "+a.toString("hex")),this._socket.write(a)}disconnect(t,i){const r=e.alloc(7);i=i||o.HCI_OE_USER_ENDED_CONNECTION,r.writeUInt8(o.HCI_COMMAND_PKT,0),r.writeUInt16LE(o.DISCONNECT_CMD,1),r.writeUInt8(3,3),r.writeUInt16LE(t,4),r.writeUInt8(i,6),n("disconnect - writing: "+r.toString("hex")),this._socket.write(r)}readRssi(t){const i=e.alloc(6);i.writeUInt8(o.HCI_COMMAND_PKT,0),i.writeUInt16LE(o.READ_RSSI_CMD,1),i.writeUInt8(2,3),i.writeUInt16LE(t,4),n("read rssi - writing: "+i.toString("hex")),this._socket.write(i)}writeAclDataPkt(t,i,r){const s=e.alloc(9+r.length);s.writeUInt8(o.HCI_ACLDATA_PKT,0),s.writeUInt16LE(t|o.ACL_START_NO_FLUSH<<12,1),s.writeUInt16LE(r.length+4,3),s.writeUInt16LE(r.length,5),s.writeUInt16LE(i,7),r.copy(s,9),n("write acl data pkt - writing: "+s.toString("hex")),this._socket.write(s)}setAdvertisingParameters(){const t=e.alloc(19);t.writeUInt8(o.HCI_COMMAND_PKT,0),t.writeUInt16LE(o.LE_SET_ADVERTISING_PARAMETERS_CMD,1),t.writeUInt8(15,3);const i=Math.floor(1.6*(r.env.BLENO_ADVERTISING_INTERVAL?parseFloat(r.env.BLENO_ADVERTISING_INTERVAL):100));t.writeUInt16LE(i,4),t.writeUInt16LE(i,6),t.writeUInt8(0,8),t.writeUInt8(0,9),t.writeUInt8(0,10),e.from("000000000000","hex").copy(t,11),t.writeUInt8(7,17),t.writeUInt8(0,18),n("set advertisement parameters - writing: "+t.toString("hex")),this._socket.write(t)}setAdvertisingData(t){const i=e.alloc(36);i.fill(0),i.writeUInt8(o.HCI_COMMAND_PKT,0),i.writeUInt16LE(o.LE_SET_ADVERTISING_DATA_CMD,1),i.writeUInt8(32,3),i.writeUInt8(t.length,4),t.copy(i,5),n("set advertisement data - writing: "+i.toString("hex")),this._socket.write(i)}setScanResponseData(t){const i=e.alloc(36);i.fill(0),i.writeUInt8(o.HCI_COMMAND_PKT,0),i.writeUInt16LE(o.LE_SET_SCAN_RESPONSE_DATA_CMD,1),i.writeUInt8(32,3),i.writeUInt8(t.length,4),t.copy(i,5),n("set scan response data - writing: "+i.toString("hex")),this._socket.write(i)}setAdvertiseEnable(t){const i=e.alloc(5);i.writeUInt8(o.HCI_COMMAND_PKT,0),i.writeUInt16LE(o.LE_SET_ADVERTISE_ENABLE_CMD,1),i.writeUInt8(1,3),i.writeUInt8(t?1:0,4),n("set advertise enable - writing: "+i.toString("hex")),this._socket.write(i)}leReadBufferSize(){const t=e.alloc(4);t.writeUInt8(o.HCI_COMMAND_PKT,0),t.writeUInt16LE(o.LE_READ_BUFFER_SIZE_CMD,1),t.writeUInt8(0,3),n("le read buffer size - writing: "+t.toString("hex")),this._socket.write(t)}readBufferSize(){const t=e.alloc(4);t.writeUInt8(o.HCI_COMMAND_PKT,0),t.writeUInt16LE(o.READ_BUFFER_SIZE_CMD,1),t.writeUInt8(0,3),n("read buffer size - writing: "+t.toString("hex")),this._socket.write(t)}queueAclDataPkt(t,i,r){let s=t|o.ACL_START_NO_FLUSH<<12,n=e.alloc(4+r.length);n.writeUInt16LE(r.length,0),n.writeUInt16LE(i,2),r.copy(n,4);let a=0;for(;n.length;){const i=n.slice(0,this._aclMtu);n=n.slice(i.length);const r=e.alloc(5+i.length);r.writeUInt8(o.HCI_ACLDATA_PKT,0),r.writeUInt16LE(s,1),s|=o.ACL_CONT<<12,r.writeUInt16LE(i.length,3),i.copy(r,5),this._aclOutQueue.push({handle:t,pkt:r,fragId:a++})}this.pushAclOutQueue()}pushAclOutQueue(){n("pushAclOutQueue");let e=0;for(const t in this._handleAclsInProgress)e+=this._handleAclsInProgress[t];for(n(e,this._aclMaxInProgress,this._aclOutQueue.length);e<this._aclMaxInProgress&&this._aclOutQueue.length;)e++,this.writeOneAclDataPkt();e>=this._aclMaxInProgress&&this._aclOutQueue.length&&(n("acl out queue congested"),n("\tin progress = "+e),n("\twaiting = "+this._aclOutQueue.length))}writeOneAclDataPkt(){n("writeOneAclDataPkt");const e=this._aclOutQueue.shift();this._handleAclsInProgress[e.handle]++,n("write acl data pkt frag "+e.fragId+" handle "+e.handle+" - writing: "+e.pkt.toString("hex")),this._socket.write(e.pkt)}onSocketData(t){const i=e.from(t);n("onSocketData: "+i.toString("hex"));const r=i.readUInt8(0);if(n("\tevent type = "+r),o.HCI_EVENT_PKT===r){const e=i.readUInt8(1);if(n("\tsub event type = "+e),e===o.EVT_DISCONN_COMPLETE){const e=i.readUInt16LE(4),t=i.readUInt8(6);n("\t\thandle = "+e),n("\t\treason = "+t),delete this._handleAclsInProgress[e];const r=[];let s=0;for(const t in this._aclOutQueue)this._aclOutQueue[t].handle!==e?r.push(this._aclOutQueue[t]):s++;s&&n("\t\tacls discarded = "+s),this._aclOutQueue=r,this.pushAclOutQueue(),this.emit("disconnComplete",e,t)}else if(e===o.EVT_ENCRYPT_CHANGE){const e=i.readUInt16LE(4),t=i.readUInt8(6);n("\t\thandle = "+e),n("\t\tencrypt = "+t),this.emit("encryptChange",e,t)}else if(e===o.EVT_CMD_COMPLETE){const e=i.readUInt8(3),t=i.readUInt16LE(4),r=i.readUInt8(6),s=i.slice(7);n("\t\tncmd = "+e),n("\t\tcmd = "+t),n("\t\tstatus = "+r),n("\t\tresult = "+s.toString("hex")),this.processCmdCompleteEvent(t,r,s)}else if(e===o.EVT_CMD_STATUS){const e=i.readUInt8(3),t=i.readUInt16LE(5);n("\t\tstatus = "+e),n("\t\tcmd = "+t),this.processCmdStatusEvent(t,e)}else if(e===o.EVT_LE_META_EVENT){const e=i.readUInt8(3),t=i.readUInt8(4),r=i.slice(5);n("\t\tLE meta event type = "+e),n("\t\tLE meta event status = "+t),n("\t\tLE meta event data = "+r.toString("hex")),this.processLeMetaEvent(e,t,r)}else if(e===o.EVT_NUMBER_OF_COMPLETED_PACKETS){const e=i.readUInt8(3);for(let t=0;t<e;t++){const e=i.readUInt16LE(4+4*t),r=i.readUInt16LE(6+4*t);n("\thandle = "+e),n("\t\tcompleted = "+r),void 0!==this._handleAclsInProgress[e]?(r>this._handleAclsInProgress[e]?this._handleAclsInProgress[e]=0:this._handleAclsInProgress[e]-=r,n("\t\tin progress = "+this._handleAclsInProgress[e])):n("\t\talready closed")}this.pushAclOutQueue()}}else if(o.HCI_ACLDATA_PKT===r){const t=i.readUInt16LE(1)>>12,r=4095&i.readUInt16LE(1);if(o.ACL_START===t){const e=i.readUInt16LE(7),t=i.readUInt16LE(5),s=i.slice(9);n("\t\tcid = "+e),t===s.length?(n("\t\thandle = "+r),n("\t\tdata = "+s.toString("hex")),this.emit("aclDataPkt",r,e,s)):this._handleBuffers[r]={length:t,cid:e,data:s}}else if(o.ACL_CONT===t){if(!this._handleBuffers[r]||!this._handleBuffers[r].data)return;this._handleBuffers[r].data=e.concat([this._handleBuffers[r].data,i.slice(5)]),this._handleBuffers[r].data.length===this._handleBuffers[r].length&&(this.emit("aclDataPkt",r,this._handleBuffers[r].cid,this._handleBuffers[r].data),delete this._handleBuffers[r])}}else if(o.HCI_COMMAND_PKT===r){const e=i.readUInt16LE(1),t=i.readUInt8(3);if(n("\t\tcmd = "+e),n("\t\tdata len = "+t),e===o.LE_SET_SCAN_ENABLE_CMD){const e=1===i.readUInt8(4),t=1===i.readUInt8(5);n("\t\t\tLE enable scan command"),n("\t\t\tenable scanning = "+e),n("\t\t\tfilter duplicates = "+t),this.emit("leScanEnableSetCmd",e,t)}}}onSocketError(e){n("onSocketError: "+e.message),"Operation not permitted"===e.message?this.emit("stateChange","unauthorized"):e.message}processCmdCompleteEvent(e,t,i){if(e===o.RESET_CMD)this.resetBuffers(),this.setEventMask(),this.setLeEventMask(),this.readLocalVersion(),this.readBdAddr(),this.writeLeHostSupported(),this.readLeHostSupported(),this.leReadBufferSize();else if(e===o.READ_LE_HOST_SUPPORTED_CMD){if(0===t){const e=i.readUInt8(0),t=i.readUInt8(1);n("\t\t\tle = "+e),n("\t\t\tsimul = "+t)}}else if(e===o.READ_LOCAL_VERSION_CMD){const e=i.readUInt8(0),t=i.readUInt16LE(1),r=i.readInt8(3),s=i.readUInt16LE(4),n=i.readUInt16LE(6);e<6?this.emit("stateChange","unsupported"):"poweredOn"!==this._state&&(this.setScanEnabled(!1,!0),this.setScanParameters(!1)),this.emit("readLocalVersion",e,t,r,s,n)}else if(e===o.READ_BD_ADDR_CMD)this.addressType="public",this.address=i.toString("hex").match(/.{1,2}/g).reverse().join(":"),n("address = "+this.address),this.emit("addressChange",this.address);else if(e===o.LE_SET_SCAN_PARAMETERS_CMD)this.emit("stateChange","poweredOn"),this.emit("leScanParametersSet",t);else if(e===o.LE_SET_SCAN_ENABLE_CMD)this.emit("leScanEnableSet",t);else if(e===o.LE_SET_ADVERTISING_PARAMETERS_CMD)this.emit("stateChange","poweredOn"),this.emit("leAdvertisingParametersSet",t);else if(e===o.LE_SET_ADVERTISING_DATA_CMD)this.emit("leAdvertisingDataSet",t);else if(e===o.LE_SET_SCAN_RESPONSE_DATA_CMD)this.emit("leScanResponseDataSet",t);else if(e===o.LE_SET_ADVERTISE_ENABLE_CMD)this.emit("leAdvertiseEnableSet",t);else if(e===o.READ_RSSI_CMD){const e=i.readUInt16LE(0),t=i.readInt8(2);n("\t\t\thandle = "+e),n("\t\t\trssi = "+t),this.emit("rssiRead",e,t)}else if(e===o.LE_LTK_NEG_REPLY_CMD){const e=i.readUInt16LE(0);n("\t\t\thandle = "+e),this.emit("leLtkNegReply",e)}else if(e===o.LE_READ_BUFFER_SIZE_CMD)t||this.processLeReadBufferSize(i);else if(e===o.READ_BUFFER_SIZE_CMD&&!t){const e=i.readUInt16LE(0),t=i.readUInt16LE(3);e&&t&&(n("br/edr acl mtu = "+e),n("br/edr acl max pkts = "+t),this._aclMtu=e,this._aclMaxInProgress=t)}}processLeMetaEvent(e,t,i){e===o.EVT_LE_CONN_COMPLETE?this.processLeConnComplete(t,i):e===o.EVT_LE_ADVERTISING_REPORT?this.processLeAdvertisingReport(t,i):e===o.EVT_LE_CONN_UPDATE_COMPLETE&&this.processLeConnUpdateComplete(t,i)}processLeConnComplete(e,t){const i=t.readUInt16LE(0),r=t.readUInt8(2),s=1===t.readUInt8(3)?"random":"public",a=t.slice(4,10).toString("hex").match(/.{1,2}/g).reverse().join(":"),o=1.25*t.readUInt16LE(10),h=t.readUInt16LE(12),c=10*t.readUInt16LE(14),d=t.readUInt8(16);n("\t\t\thandle = "+i),n("\t\t\trole = "+r),n("\t\t\taddress type = "+s),n("\t\t\taddress = "+a),n("\t\t\tinterval = "+o),n("\t\t\tlatency = "+h),n("\t\t\tsupervision timeout = "+c),n("\t\t\tmaster clock accuracy = "+d),this._handleAclsInProgress[i]=0,this.emit("leConnComplete",e,i,r,s,a,o,h,c,d)}processLeAdvertisingReport(e,t){for(let i=0;i<e;i++){const e=t.readUInt8(0),i=1===t.readUInt8(1)?"random":"public",r=t.slice(2,8).toString("hex").match(/.{1,2}/g).reverse().join(":"),s=t.readUInt8(8),a=t.slice(9,s+9),o=t.readInt8(s+9);n("\t\t\ttype = "+e),n("\t\t\taddress = "+r),n("\t\t\taddress type = "+i),n("\t\t\teir = "+a.toString("hex")),n("\t\t\trssi = "+o),this.emit("leAdvertisingReport",0,e,r,i,a,o),t=t.slice(s+10)}}processLeConnUpdateComplete(e,t){const i=t.readUInt16LE(0),r=1.25*t.readUInt16LE(2),s=t.readUInt16LE(4),a=10*t.readUInt16LE(6);n("\t\t\thandle = "+i),n("\t\t\tinterval = "+r),n("\t\t\tlatency = "+s),n("\t\t\tsupervision timeout = "+a),this.emit("leConnUpdateComplete",e,i,r,s,a)}processCmdStatusEvent(e,t){e===o.LE_CREATE_CONN_CMD&&0!==t&&this.emit("leConnComplete",t)}processLeReadBufferSize(e){const t=e.readUInt16LE(0),i=e.readUInt8(2);t?(n("le acl mtu = "+t),n("le acl max in progress = "+i),this._aclMtu=t,this._aclMaxInProgress=i):(n("falling back to br/edr buffer size"),this.readBufferSize())}onStateChange(e){this._state=e}}c.STATUS_MAPPER=h,t.default=c}).call(this,i(0).Buffer,i(9))},function(e,t,i){"use strict";(function(t){void 0===t||!t.version||0===t.version.indexOf("v0.")||0===t.version.indexOf("v1.")&&0!==t.version.indexOf("v1.8.")?e.exports={nextTick:function(e,i,r,s){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var n,a,o=arguments.length;switch(o){case 0:case 1:return t.nextTick(e);case 2:return t.nextTick((function(){e.call(null,i)}));case 3:return t.nextTick((function(){e.call(null,i,r)}));case 4:return t.nextTick((function(){e.call(null,i,r,s)}));default:for(n=new Array(o-1),a=0;a<n.length;)n[a++]=arguments[a];return t.nextTick((function(){e.apply(null,n)}))}}}:e.exports=t}).call(this,i(9))},function(e,t,i){var r=i(2).Buffer;function s(e){r.isBuffer(e)||(e=r.from(e));for(var t=e.length/4|0,i=new Array(t),s=0;s<t;s++)i[s]=e.readUInt32BE(4*s);return i}function n(e){for(;0<e.length;e++)e[0]=0}function a(e,t,i,r,s){for(var n,a,o,h,c=i[0],d=i[1],u=i[2],l=i[3],f=e[0]^t[0],p=e[1]^t[1],m=e[2]^t[2],_=e[3]^t[3],g=4,y=1;y<s;y++)n=c[f>>>24]^d[p>>>16&255]^u[m>>>8&255]^l[255&_]^t[g++],a=c[p>>>24]^d[m>>>16&255]^u[_>>>8&255]^l[255&f]^t[g++],o=c[m>>>24]^d[_>>>16&255]^u[f>>>8&255]^l[255&p]^t[g++],h=c[_>>>24]^d[f>>>16&255]^u[p>>>8&255]^l[255&m]^t[g++],f=n,p=a,m=o,_=h;return n=(r[f>>>24]<<24|r[p>>>16&255]<<16|r[m>>>8&255]<<8|r[255&_])^t[g++],a=(r[p>>>24]<<24|r[m>>>16&255]<<16|r[_>>>8&255]<<8|r[255&f])^t[g++],o=(r[m>>>24]<<24|r[_>>>16&255]<<16|r[f>>>8&255]<<8|r[255&p])^t[g++],h=(r[_>>>24]<<24|r[f>>>16&255]<<16|r[p>>>8&255]<<8|r[255&m])^t[g++],[n>>>=0,a>>>=0,o>>>=0,h>>>=0]}var o=[0,1,2,4,8,16,32,64,128,27,54],h=function(){for(var e=new Array(256),t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;for(var i=[],r=[],s=[[],[],[],[]],n=[[],[],[],[]],a=0,o=0,h=0;h<256;++h){var c=o^o<<1^o<<2^o<<3^o<<4;c=c>>>8^255&c^99,i[a]=c,r[c]=a;var d=e[a],u=e[d],l=e[u],f=257*e[c]^16843008*c;s[0][a]=f<<24|f>>>8,s[1][a]=f<<16|f>>>16,s[2][a]=f<<8|f>>>24,s[3][a]=f,f=16843009*l^65537*u^257*d^16843008*a,n[0][c]=f<<24|f>>>8,n[1][c]=f<<16|f>>>16,n[2][c]=f<<8|f>>>24,n[3][c]=f,0===a?a=o=1:(a=d^e[e[e[l^d]]],o^=e[e[o]])}return{SBOX:i,INV_SBOX:r,SUB_MIX:s,INV_SUB_MIX:n}}();function c(e){this._key=s(e),this._reset()}c.blockSize=16,c.keySize=32,c.prototype.blockSize=c.blockSize,c.prototype.keySize=c.keySize,c.prototype._reset=function(){for(var e=this._key,t=e.length,i=t+6,r=4*(i+1),s=[],n=0;n<t;n++)s[n]=e[n];for(n=t;n<r;n++){var a=s[n-1];n%t==0?(a=a<<8|a>>>24,a=h.SBOX[a>>>24]<<24|h.SBOX[a>>>16&255]<<16|h.SBOX[a>>>8&255]<<8|h.SBOX[255&a],a^=o[n/t|0]<<24):t>6&&n%t==4&&(a=h.SBOX[a>>>24]<<24|h.SBOX[a>>>16&255]<<16|h.SBOX[a>>>8&255]<<8|h.SBOX[255&a]),s[n]=s[n-t]^a}for(var c=[],d=0;d<r;d++){var u=r-d,l=s[u-(d%4?0:4)];c[d]=d<4||u<=4?l:h.INV_SUB_MIX[0][h.SBOX[l>>>24]]^h.INV_SUB_MIX[1][h.SBOX[l>>>16&255]]^h.INV_SUB_MIX[2][h.SBOX[l>>>8&255]]^h.INV_SUB_MIX[3][h.SBOX[255&l]]}this._nRounds=i,this._keySchedule=s,this._invKeySchedule=c},c.prototype.encryptBlockRaw=function(e){return a(e=s(e),this._keySchedule,h.SUB_MIX,h.SBOX,this._nRounds)},c.prototype.encryptBlock=function(e){var t=this.encryptBlockRaw(e),i=r.allocUnsafe(16);return i.writeUInt32BE(t[0],0),i.writeUInt32BE(t[1],4),i.writeUInt32BE(t[2],8),i.writeUInt32BE(t[3],12),i},c.prototype.decryptBlock=function(e){var t=(e=s(e))[1];e[1]=e[3],e[3]=t;var i=a(e,this._invKeySchedule,h.INV_SUB_MIX,h.INV_SBOX,this._nRounds),n=r.allocUnsafe(16);return n.writeUInt32BE(i[0],0),n.writeUInt32BE(i[3],4),n.writeUInt32BE(i[2],8),n.writeUInt32BE(i[1],12),n},c.prototype.scrub=function(){n(this._keySchedule),n(this._invKeySchedule),n(this._key)},e.exports.AES=c},function(e,t,i){var r=i(2).Buffer,s=i(40);e.exports=function(e,t,i,n){if(r.isBuffer(e)||(e=r.from(e,"binary")),t&&(r.isBuffer(t)||(t=r.from(t,"binary")),8!==t.length))throw new RangeError("salt should be Buffer with 8 byte length");for(var a=i/8,o=r.alloc(a),h=r.alloc(n||0),c=r.alloc(0);a>0||n>0;){var d=new s;d.update(c),d.update(e),t&&d.update(t),c=d.digest();var u=0;if(a>0){var l=o.length-a;u=Math.min(a,c.length),c.copy(o,l,0,u),a-=u}if(u<c.length&&n>0){var f=h.length-n,p=Math.min(n,c.length-u);c.copy(h,f,u,u+p),n-=p}}return c.fill(0),{key:o,iv:h}}},function(e,t,i){"use strict";var r=i(3),s=i(8),n=s.getNAF,a=s.getJSF,o=s.assert;function h(e,t){this.type=e,this.p=new r(t.p,16),this.red=t.prime?r.red(t.prime):r.mont(this.p),this.zero=new r(0).toRed(this.red),this.one=new r(1).toRed(this.red),this.two=new r(2).toRed(this.red),this.n=t.n&&new r(t.n,16),this.g=t.g&&this.pointFromJSON(t.g,t.gRed),this._wnafT1=new Array(4),this._wnafT2=new Array(4),this._wnafT3=new Array(4),this._wnafT4=new Array(4),this._bitLength=this.n?this.n.bitLength():0;var i=this.n&&this.p.div(this.n);!i||i.cmpn(100)>0?this.redN=null:(this._maxwellTrick=!0,this.redN=this.n.toRed(this.red))}function c(e,t){this.curve=e,this.type=t,this.precomputed=null}e.exports=h,h.prototype.point=function(){throw new Error("Not implemented")},h.prototype.validate=function(){throw new Error("Not implemented")},h.prototype._fixedNafMul=function(e,t){o(e.precomputed);var i=e._getDoubles(),r=n(t,1,this._bitLength),s=(1<<i.step+1)-(i.step%2==0?2:1);s/=3;for(var a=[],h=0;h<r.length;h+=i.step){var c=0;for(t=h+i.step-1;t>=h;t--)c=(c<<1)+r[t];a.push(c)}for(var d=this.jpoint(null,null,null),u=this.jpoint(null,null,null),l=s;l>0;l--){for(h=0;h<a.length;h++){(c=a[h])===l?u=u.mixedAdd(i.points[h]):c===-l&&(u=u.mixedAdd(i.points[h].neg()))}d=d.add(u)}return d.toP()},h.prototype._wnafMul=function(e,t){var i=4,r=e._getNAFPoints(i);i=r.wnd;for(var s=r.points,a=n(t,i,this._bitLength),h=this.jpoint(null,null,null),c=a.length-1;c>=0;c--){for(t=0;c>=0&&0===a[c];c--)t++;if(c>=0&&t++,h=h.dblp(t),c<0)break;var d=a[c];o(0!==d),h="affine"===e.type?d>0?h.mixedAdd(s[d-1>>1]):h.mixedAdd(s[-d-1>>1].neg()):d>0?h.add(s[d-1>>1]):h.add(s[-d-1>>1].neg())}return"affine"===e.type?h.toP():h},h.prototype._wnafMulAdd=function(e,t,i,r,s){for(var o=this._wnafT1,h=this._wnafT2,c=this._wnafT3,d=0,u=0;u<r;u++){var l=(A=t[u])._getNAFPoints(e);o[u]=l.wnd,h[u]=l.points}for(u=r-1;u>=1;u-=2){var f=u-1,p=u;if(1===o[f]&&1===o[p]){var m=[t[f],null,null,t[p]];0===t[f].y.cmp(t[p].y)?(m[1]=t[f].add(t[p]),m[2]=t[f].toJ().mixedAdd(t[p].neg())):0===t[f].y.cmp(t[p].y.redNeg())?(m[1]=t[f].toJ().mixedAdd(t[p]),m[2]=t[f].add(t[p].neg())):(m[1]=t[f].toJ().mixedAdd(t[p]),m[2]=t[f].toJ().mixedAdd(t[p].neg()));var _=[-3,-1,-5,-7,0,7,5,1,3],g=a(i[f],i[p]);d=Math.max(g[0].length,d),c[f]=new Array(d),c[p]=new Array(d);for(var y=0;y<d;y++){var b=0|g[0][y],v=0|g[1][y];c[f][y]=_[3*(b+1)+(v+1)],c[p][y]=0,h[f]=m}}else c[f]=n(i[f],o[f],this._bitLength),c[p]=n(i[p],o[p],this._bitLength),d=Math.max(c[f].length,d),d=Math.max(c[p].length,d)}var w=this.jpoint(null,null,null),S=this._wnafT4;for(u=d;u>=0;u--){for(var E=0;u>=0;){var C=!0;for(y=0;y<r;y++)S[y]=0|c[y][u],0!==S[y]&&(C=!1);if(!C)break;E++,u--}if(u>=0&&E++,w=w.dblp(E),u<0)break;for(y=0;y<r;y++){var A,I=S[y];0!==I&&(I>0?A=h[y][I-1>>1]:I<0&&(A=h[y][-I-1>>1].neg()),w="affine"===A.type?w.mixedAdd(A):w.add(A))}}for(u=0;u<r;u++)h[u]=null;return s?w:w.toP()},h.BasePoint=c,c.prototype.eq=function(){throw new Error("Not implemented")},c.prototype.validate=function(){return this.curve.validate(this)},h.prototype.decodePoint=function(e,t){e=s.toArray(e,t);var i=this.p.byteLength();if((4===e[0]||6===e[0]||7===e[0])&&e.length-1==2*i)return 6===e[0]?o(e[e.length-1]%2==0):7===e[0]&&o(e[e.length-1]%2==1),this.point(e.slice(1,1+i),e.slice(1+i,1+2*i));if((2===e[0]||3===e[0])&&e.length-1===i)return this.pointFromX(e.slice(1,1+i),3===e[0]);throw new Error("Unknown point format")},c.prototype.encodeCompressed=function(e){return this.encode(e,!0)},c.prototype._encode=function(e){var t=this.curve.p.byteLength(),i=this.getX().toArray("be",t);return e?[this.getY().isEven()?2:3].concat(i):[4].concat(i,this.getY().toArray("be",t))},c.prototype.encode=function(e,t){return s.encode(this._encode(t),e)},c.prototype.precompute=function(e){if(this.precomputed)return this;var t={doubles:null,naf:null,beta:null};return t.naf=this._getNAFPoints(8),t.doubles=this._getDoubles(4,e),t.beta=this._getBeta(),this.precomputed=t,this},c.prototype._hasDoubles=function(e){if(!this.precomputed)return!1;var t=this.precomputed.doubles;return!!t&&t.points.length>=Math.ceil((e.bitLength()+1)/t.step)},c.prototype._getDoubles=function(e,t){if(this.precomputed&&this.precomputed.doubles)return this.precomputed.doubles;for(var i=[this],r=this,s=0;s<t;s+=e){for(var n=0;n<e;n++)r=r.dbl();i.push(r)}return{step:e,points:i}},c.prototype._getNAFPoints=function(e){if(this.precomputed&&this.precomputed.naf)return this.precomputed.naf;for(var t=[this],i=(1<<e)-1,r=1===i?null:this.dbl(),s=1;s<i;s++)t[s]=t[s-1].add(r);return{wnd:e,points:t}},c.prototype._getBeta=function(){return null},c.prototype.dblp=function(e){for(var t=this,i=0;i<e;i++)t=t.dbl();return t}},function(e,t,i){var r=i(192),s=i(203),n=i(204),a=i(47),o=i(71),h=i(2).Buffer;function c(e){var t;"object"!=typeof e||h.isBuffer(e)||(t=e.passphrase,e=e.key),"string"==typeof e&&(e=h.from(e));var i,c,d=n(e,t),u=d.tag,l=d.data;switch(u){case"CERTIFICATE":c=r.certificate.decode(l,"der").tbsCertificate.subjectPublicKeyInfo;case"PUBLIC KEY":switch(c||(c=r.PublicKey.decode(l,"der")),i=c.algorithm.algorithm.join(".")){case"1.2.840.113549.1.1.1":return r.RSAPublicKey.decode(c.subjectPublicKey.data,"der");case"1.2.840.10045.2.1":return c.subjectPrivateKey=c.subjectPublicKey,{type:"ec",data:c};case"1.2.840.10040.4.1":return c.algorithm.params.pub_key=r.DSAparam.decode(c.subjectPublicKey.data,"der"),{type:"dsa",data:c.algorithm.params};default:throw new Error("unknown key id "+i)}throw new Error("unknown key type "+u);case"ENCRYPTED PRIVATE KEY":l=function(e,t){var i=e.algorithm.decrypt.kde.kdeparams.salt,r=parseInt(e.algorithm.decrypt.kde.kdeparams.iters.toString(),10),n=s[e.algorithm.decrypt.cipher.algo.join(".")],c=e.algorithm.decrypt.cipher.iv,d=e.subjectPrivateKey,u=parseInt(n.split("-")[1],10)/8,l=o.pbkdf2Sync(t,i,r,u,"sha1"),f=a.createDecipheriv(n,l,c),p=[];return p.push(f.update(d)),p.push(f.final()),h.concat(p)}(l=r.EncryptedPrivateKey.decode(l,"der"),t);case"PRIVATE KEY":switch(i=(c=r.PrivateKey.decode(l,"der")).algorithm.algorithm.join(".")){case"1.2.840.113549.1.1.1":return r.RSAPrivateKey.decode(c.subjectPrivateKey,"der");case"1.2.840.10045.2.1":return{curve:c.algorithm.curve,privateKey:r.ECPrivateKey.decode(c.subjectPrivateKey,"der").privateKey};case"1.2.840.10040.4.1":return c.algorithm.params.priv_key=r.DSAparam.decode(c.subjectPrivateKey,"der"),{type:"dsa",params:c.algorithm.params};default:throw new Error("unknown key id "+i)}throw new Error("unknown key type "+u);case"RSA PUBLIC KEY":return r.RSAPublicKey.decode(l,"der");case"RSA PRIVATE KEY":return r.RSAPrivateKey.decode(l,"der");case"DSA PRIVATE KEY":return{type:"dsa",params:r.DSAPrivateKey.decode(l,"der")};case"EC PRIVATE KEY":return{curve:(l=r.ECPrivateKey.decode(l,"der")).parameters.value,privateKey:l.privateKey};default:throw new Error("unknown key type "+u)}}e.exports=c,c.signature=r.signature},function(e,t){function i(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}i.keys=function(){return[]},i.resolve=i,e.exports=i,i.id=36},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.keys=["gnd","vcc","sda","scl","i2c","vcc"],this.requiredKeys=[],this.i2cinfo=this.i2cInfo(),this.address=this.i2cinfo.address}i2cInfo(){throw new Error("abstruct class")}wired(e){this.obniz=e,e.setVccGnd(this.params.vcc,this.params.gnd,this.i2cinfo.voltage),this.params.clock=this.i2cinfo.clock,this.params.pull=this.i2cinfo.voltage,this.params.mode="master",this.i2c=this.obniz.getI2CWithConfig(this.params)}char2short(e,t){const i=new ArrayBuffer(2),r=new DataView(i);return r.setUint8(0,e),r.setUint8(1,t),r.getInt16(0,!1)}readWait(e,t){return r(this,void 0,void 0,(function*(){return this.i2c.write(this.address,[e]),yield this.i2c.readWait(this.address,t)}))}write(e,t){Array.isArray(t)||(t=[t]),this.i2c.write(this.address,[e,...t])}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default="canvas"},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(29));class n extends s.default{constructor(e){super(e),this.isRemote=!1,this.discoverdOnRemote=!1}get wsChildUuidName(){const e=this.childrenName;return e?e.slice(0,-1)+"_uuid":null}discoverChildren(){}discoverChildrenWait(){return new Promise(e=>{this.emitter.once("discoverfinished",()=>{const t=this.children.filter(e=>e.discoverdOnRemote);e(t)}),this.discoverChildren()})}ondiscover(e){}ondiscoverfinished(e){}notifyFromServer(e,t){switch(super.notifyFromServer(e,t),e){case"discover":{const e=t[this.wsChildUuidName];let i=this.getChild(e);i||(i=this.addChild({uuid:e})),i.discoverdOnRemote=!0,i.properties=t.properties||[],this.ondiscover(i);break}case"discoverfinished":{const e=this.children.filter(e=>e.discoverdOnRemote);this.ondiscoverfinished(e);break}}}}t.default=n},function(e,t,i){"use strict";var r=i(1),s=i(61),n=i(2).Buffer,a=new Array(16);function o(){s.call(this,64),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878}function h(e,t){return e<<t|e>>>32-t}function c(e,t,i,r,s,n,a){return h(e+(t&i|~t&r)+s+n|0,a)+t|0}function d(e,t,i,r,s,n,a){return h(e+(t&r|i&~r)+s+n|0,a)+t|0}function u(e,t,i,r,s,n,a){return h(e+(t^i^r)+s+n|0,a)+t|0}function l(e,t,i,r,s,n,a){return h(e+(i^(t|~r))+s+n|0,a)+t|0}r(o,s),o.prototype._update=function(){for(var e=a,t=0;t<16;++t)e[t]=this._block.readInt32LE(4*t);var i=this._a,r=this._b,s=this._c,n=this._d;i=c(i,r,s,n,e[0],3614090360,7),n=c(n,i,r,s,e[1],3905402710,12),s=c(s,n,i,r,e[2],606105819,17),r=c(r,s,n,i,e[3],3250441966,22),i=c(i,r,s,n,e[4],4118548399,7),n=c(n,i,r,s,e[5],1200080426,12),s=c(s,n,i,r,e[6],2821735955,17),r=c(r,s,n,i,e[7],4249261313,22),i=c(i,r,s,n,e[8],1770035416,7),n=c(n,i,r,s,e[9],2336552879,12),s=c(s,n,i,r,e[10],4294925233,17),r=c(r,s,n,i,e[11],2304563134,22),i=c(i,r,s,n,e[12],1804603682,7),n=c(n,i,r,s,e[13],4254626195,12),s=c(s,n,i,r,e[14],2792965006,17),i=d(i,r=c(r,s,n,i,e[15],1236535329,22),s,n,e[1],4129170786,5),n=d(n,i,r,s,e[6],3225465664,9),s=d(s,n,i,r,e[11],643717713,14),r=d(r,s,n,i,e[0],3921069994,20),i=d(i,r,s,n,e[5],3593408605,5),n=d(n,i,r,s,e[10],38016083,9),s=d(s,n,i,r,e[15],3634488961,14),r=d(r,s,n,i,e[4],3889429448,20),i=d(i,r,s,n,e[9],568446438,5),n=d(n,i,r,s,e[14],3275163606,9),s=d(s,n,i,r,e[3],4107603335,14),r=d(r,s,n,i,e[8],1163531501,20),i=d(i,r,s,n,e[13],2850285829,5),n=d(n,i,r,s,e[2],4243563512,9),s=d(s,n,i,r,e[7],1735328473,14),i=u(i,r=d(r,s,n,i,e[12],2368359562,20),s,n,e[5],4294588738,4),n=u(n,i,r,s,e[8],2272392833,11),s=u(s,n,i,r,e[11],1839030562,16),r=u(r,s,n,i,e[14],4259657740,23),i=u(i,r,s,n,e[1],2763975236,4),n=u(n,i,r,s,e[4],1272893353,11),s=u(s,n,i,r,e[7],4139469664,16),r=u(r,s,n,i,e[10],3200236656,23),i=u(i,r,s,n,e[13],681279174,4),n=u(n,i,r,s,e[0],3936430074,11),s=u(s,n,i,r,e[3],3572445317,16),r=u(r,s,n,i,e[6],76029189,23),i=u(i,r,s,n,e[9],3654602809,4),n=u(n,i,r,s,e[12],3873151461,11),s=u(s,n,i,r,e[15],530742520,16),i=l(i,r=u(r,s,n,i,e[2],3299628645,23),s,n,e[0],4096336452,6),n=l(n,i,r,s,e[7],1126891415,10),s=l(s,n,i,r,e[14],2878612391,15),r=l(r,s,n,i,e[5],4237533241,21),i=l(i,r,s,n,e[12],1700485571,6),n=l(n,i,r,s,e[3],2399980690,10),s=l(s,n,i,r,e[10],4293915773,15),r=l(r,s,n,i,e[1],2240044497,21),i=l(i,r,s,n,e[8],1873313359,6),n=l(n,i,r,s,e[15],4264355552,10),s=l(s,n,i,r,e[6],2734768916,15),r=l(r,s,n,i,e[13],1309151649,21),i=l(i,r,s,n,e[4],4149444226,6),n=l(n,i,r,s,e[11],3174756917,10),s=l(s,n,i,r,e[2],718787259,15),r=l(r,s,n,i,e[9],3951481745,21),this._a=this._a+i|0,this._b=this._b+r|0,this._c=this._c+s|0,this._d=this._d+n|0},o.prototype._digest=function(){this._block[this._blockOffset++]=128,this._blockOffset>56&&(this._block.fill(0,this._blockOffset,64),this._update(),this._blockOffset=0),this._block.fill(0,this._blockOffset,56),this._block.writeUInt32LE(this._length[0],56),this._block.writeUInt32LE(this._length[1],60),this._update();var e=n.allocUnsafe(16);return e.writeInt32LE(this._a,0),e.writeInt32LE(this._b,4),e.writeInt32LE(this._c,8),e.writeInt32LE(this._d,12),e},e.exports=o},function(e,t,i){e.exports=s;var r=i(4).EventEmitter;function s(){r.call(this)}i(1)(s,r),s.Readable=i(42),s.Writable=i(140),s.Duplex=i(141),s.Transform=i(142),s.PassThrough=i(143),s.Stream=s,s.prototype.pipe=function(e,t){var i=this;function s(t){e.writable&&!1===e.write(t)&&i.pause&&i.pause()}function n(){i.readable&&i.resume&&i.resume()}i.on("data",s),e.on("drain",n),e._isStdio||t&&!1===t.end||(i.on("end",o),i.on("close",h));var a=!1;function o(){a||(a=!0,e.end())}function h(){a||(a=!0,"function"==typeof e.destroy&&e.destroy())}function c(e){if(d(),0===r.listenerCount(this,"error"))throw e}function d(){i.removeListener("data",s),e.removeListener("drain",n),i.removeListener("end",o),i.removeListener("close",h),i.removeListener("error",c),e.removeListener("error",c),i.removeListener("end",d),i.removeListener("close",d),e.removeListener("close",d)}return i.on("error",c),e.on("error",c),i.on("end",d),i.on("close",d),e.on("close",d),e.emit("pipe",i),e}},function(e,t,i){(t=e.exports=i(62)).Stream=t,t.Readable=t,t.Writable=i(43),t.Duplex=i(19),t.Transform=i(65),t.PassThrough=i(139)},function(e,t,i){"use strict";(function(t,r,s){var n=i(31);function a(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,i){var r=e.entry;e.entry=null;for(;r;){var s=r.callback;t.pendingcb--,s(i),r=r.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}e.exports=y;var o,h=!t.browser&&["v0.10","v0.9."].indexOf(t.version.slice(0,5))>-1?r:n.nextTick;y.WritableState=g;var c=Object.create(i(23));c.inherits=i(1);var d={deprecate:i(138)},u=i(63),l=i(2).Buffer,f=s.Uint8Array||function(){};var p,m=i(64);function _(){}function g(e,t){o=o||i(19),e=e||{};var r=t instanceof o;this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var s=e.highWaterMark,c=e.writableHighWaterMark,d=this.objectMode?16:16384;this.highWaterMark=s||0===s?s:r&&(c||0===c)?c:d,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var u=!1===e.decodeStrings;this.decodeStrings=!u,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var i=e._writableState,r=i.sync,s=i.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(i),t)!function(e,t,i,r,s){--t.pendingcb,i?(n.nextTick(s,r),n.nextTick(C,e,t),e._writableState.errorEmitted=!0,e.emit("error",r)):(s(r),e._writableState.errorEmitted=!0,e.emit("error",r),C(e,t))}(e,i,r,t,s);else{var a=S(i);a||i.corked||i.bufferProcessing||!i.bufferedRequest||w(e,i),r?h(v,e,i,a,s):v(e,i,a,s)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new a(this)}function y(e){if(o=o||i(19),!(p.call(y,this)||this instanceof o))return new y(e);this._writableState=new g(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),u.call(this)}function b(e,t,i,r,s,n,a){t.writelen=r,t.writecb=a,t.writing=!0,t.sync=!0,i?e._writev(s,t.onwrite):e._write(s,n,t.onwrite),t.sync=!1}function v(e,t,i,r){i||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,r(),C(e,t)}function w(e,t){t.bufferProcessing=!0;var i=t.bufferedRequest;if(e._writev&&i&&i.next){var r=t.bufferedRequestCount,s=new Array(r),n=t.corkedRequestsFree;n.entry=i;for(var o=0,h=!0;i;)s[o]=i,i.isBuf||(h=!1),i=i.next,o+=1;s.allBuffers=h,b(e,t,!0,t.length,s,"",n.finish),t.pendingcb++,t.lastBufferedRequest=null,n.next?(t.corkedRequestsFree=n.next,n.next=null):t.corkedRequestsFree=new a(t),t.bufferedRequestCount=0}else{for(;i;){var c=i.chunk,d=i.encoding,u=i.callback;if(b(e,t,!1,t.objectMode?1:c.length,c,d,u),i=i.next,t.bufferedRequestCount--,t.writing)break}null===i&&(t.lastBufferedRequest=null)}t.bufferedRequest=i,t.bufferProcessing=!1}function S(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function E(e,t){e._final((function(i){t.pendingcb--,i&&e.emit("error",i),t.prefinished=!0,e.emit("prefinish"),C(e,t)}))}function C(e,t){var i=S(t);return i&&(!function(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,n.nextTick(E,e,t)):(t.prefinished=!0,e.emit("prefinish")))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),i}c.inherits(y,u),g.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(g.prototype,"buffer",{get:d.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(p=Function.prototype[Symbol.hasInstance],Object.defineProperty(y,Symbol.hasInstance,{value:function(e){return!!p.call(this,e)||this===y&&(e&&e._writableState instanceof g)}})):p=function(e){return e instanceof this},y.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},y.prototype.write=function(e,t,i){var r,s=this._writableState,a=!1,o=!s.objectMode&&(r=e,l.isBuffer(r)||r instanceof f);return o&&!l.isBuffer(e)&&(e=function(e){return l.from(e)}(e)),"function"==typeof t&&(i=t,t=null),o?t="buffer":t||(t=s.defaultEncoding),"function"!=typeof i&&(i=_),s.ended?function(e,t){var i=new Error("write after end");e.emit("error",i),n.nextTick(t,i)}(this,i):(o||function(e,t,i,r){var s=!0,a=!1;return null===i?a=new TypeError("May not write null values to stream"):"string"==typeof i||void 0===i||t.objectMode||(a=new TypeError("Invalid non-string/buffer chunk")),a&&(e.emit("error",a),n.nextTick(r,a),s=!1),s}(this,s,e,i))&&(s.pendingcb++,a=function(e,t,i,r,s,n){if(!i){var a=function(e,t,i){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=l.from(t,i));return t}(t,r,s);r!==a&&(i=!0,s="buffer",r=a)}var o=t.objectMode?1:r.length;t.length+=o;var h=t.length<t.highWaterMark;h||(t.needDrain=!0);if(t.writing||t.corked){var c=t.lastBufferedRequest;t.lastBufferedRequest={chunk:r,encoding:s,isBuf:i,callback:n,next:null},c?c.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else b(e,t,!1,o,r,s,n);return h}(this,s,o,e,t,i)),a},y.prototype.cork=function(){this._writableState.corked++},y.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||w(this,e))},y.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(y.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),y.prototype._write=function(e,t,i){i(new Error("_write() is not implemented"))},y.prototype._writev=null,y.prototype.end=function(e,t,i){var r=this._writableState;"function"==typeof e?(i=e,e=null,t=null):"function"==typeof t&&(i=t,t=null),null!=e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||function(e,t,i){t.ending=!0,C(e,t),i&&(t.finished?n.nextTick(i):e.once("finish",i));t.ended=!0,e.writable=!1}(this,r,i)},Object.defineProperty(y.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),y.prototype.destroy=m.destroy,y.prototype._undestroy=m.undestroy,y.prototype._destroy=function(e,t){this.end(),t(e)}}).call(this,i(9),i(136).setImmediate,i(13))},function(e,t,i){"use strict";var r=i(0).Buffer,s=i(1),n=i(61),a=new Array(16),o=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],h=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],c=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],d=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11],u=[0,1518500249,1859775393,2400959708,2840853838],l=[1352829926,1548603684,1836072691,2053994217,0];function f(){n.call(this,64),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520}function p(e,t){return e<<t|e>>>32-t}function m(e,t,i,r,s,n,a,o){return p(e+(t^i^r)+n+a|0,o)+s|0}function _(e,t,i,r,s,n,a,o){return p(e+(t&i|~t&r)+n+a|0,o)+s|0}function g(e,t,i,r,s,n,a,o){return p(e+((t|~i)^r)+n+a|0,o)+s|0}function y(e,t,i,r,s,n,a,o){return p(e+(t&r|i&~r)+n+a|0,o)+s|0}function b(e,t,i,r,s,n,a,o){return p(e+(t^(i|~r))+n+a|0,o)+s|0}s(f,n),f.prototype._update=function(){for(var e=a,t=0;t<16;++t)e[t]=this._block.readInt32LE(4*t);for(var i=0|this._a,r=0|this._b,s=0|this._c,n=0|this._d,f=0|this._e,v=0|this._a,w=0|this._b,S=0|this._c,E=0|this._d,C=0|this._e,A=0;A<80;A+=1){var I,P;A<16?(I=m(i,r,s,n,f,e[o[A]],u[0],c[A]),P=b(v,w,S,E,C,e[h[A]],l[0],d[A])):A<32?(I=_(i,r,s,n,f,e[o[A]],u[1],c[A]),P=y(v,w,S,E,C,e[h[A]],l[1],d[A])):A<48?(I=g(i,r,s,n,f,e[o[A]],u[2],c[A]),P=g(v,w,S,E,C,e[h[A]],l[2],d[A])):A<64?(I=y(i,r,s,n,f,e[o[A]],u[3],c[A]),P=_(v,w,S,E,C,e[h[A]],l[3],d[A])):(I=b(i,r,s,n,f,e[o[A]],u[4],c[A]),P=m(v,w,S,E,C,e[h[A]],l[4],d[A])),i=f,f=n,n=p(s,10),s=r,r=I,v=C,C=E,E=p(S,10),S=w,w=P}var O=this._b+s+E|0;this._b=this._c+n+C|0,this._c=this._d+f+v|0,this._d=this._e+i+w|0,this._e=this._a+r+S|0,this._a=O},f.prototype._digest=function(){this._block[this._blockOffset++]=128,this._blockOffset>56&&(this._block.fill(0,this._blockOffset,64),this._update(),this._blockOffset=0),this._block.fill(0,this._blockOffset,56),this._block.writeUInt32LE(this._length[0],56),this._block.writeUInt32LE(this._length[1],60),this._update();var e=r.alloc?r.alloc(20):new r(20);return e.writeInt32LE(this._a,0),e.writeInt32LE(this._b,4),e.writeInt32LE(this._c,8),e.writeInt32LE(this._d,12),e.writeInt32LE(this._e,16),e},e.exports=f},function(e,t,i){(t=e.exports=function(e){e=e.toLowerCase();var i=t[e];if(!i)throw new Error(e+" is not supported (we accept pull requests)");return new i}).sha=i(144),t.sha1=i(145),t.sha224=i(146),t.sha256=i(66),t.sha384=i(147),t.sha512=i(67)},function(e,t,i){"use strict";var r=i(7);function s(e){this.options=e,this.type=this.options.type,this.blockSize=8,this._init(),this.buffer=new Array(this.blockSize),this.bufferOff=0}e.exports=s,s.prototype._init=function(){},s.prototype.update=function(e){return 0===e.length?[]:"decrypt"===this.type?this._updateDecrypt(e):this._updateEncrypt(e)},s.prototype._buffer=function(e,t){for(var i=Math.min(this.buffer.length-this.bufferOff,e.length-t),r=0;r<i;r++)this.buffer[this.bufferOff+r]=e[t+r];return this.bufferOff+=i,i},s.prototype._flushBuffer=function(e,t){return this._update(this.buffer,0,e,t),this.bufferOff=0,this.blockSize},s.prototype._updateEncrypt=function(e){var t=0,i=0,r=(this.bufferOff+e.length)/this.blockSize|0,s=new Array(r*this.blockSize);0!==this.bufferOff&&(t+=this._buffer(e,t),this.bufferOff===this.buffer.length&&(i+=this._flushBuffer(s,i)));for(var n=e.length-(e.length-t)%this.blockSize;t<n;t+=this.blockSize)this._update(e,t,s,i),i+=this.blockSize;for(;t<e.length;t++,this.bufferOff++)this.buffer[this.bufferOff]=e[t];return s},s.prototype._updateDecrypt=function(e){for(var t=0,i=0,r=Math.ceil((this.bufferOff+e.length)/this.blockSize)-1,s=new Array(r*this.blockSize);r>0;r--)t+=this._buffer(e,t),i+=this._flushBuffer(s,i);return t+=this._buffer(e,t),s},s.prototype.final=function(e){var t,i;return e&&(t=this.update(e)),i="encrypt"===this.type?this._finalEncrypt():this._finalDecrypt(),t?t.concat(i):i},s.prototype._pad=function(e,t){if(0===t)return!1;for(;t<e.length;)e[t++]=0;return!0},s.prototype._finalEncrypt=function(){if(!this._pad(this.buffer,this.bufferOff))return[];var e=new Array(this.blockSize);return this._update(this.buffer,0,e,0),e},s.prototype._unpad=function(e){return e},s.prototype._finalDecrypt=function(){r.equal(this.bufferOff,this.blockSize,"Not enough data to decrypt");var e=new Array(this.blockSize);return this._flushBuffer(e,0),this._unpad(e)}},function(e,t,i){var r=i(156),s=i(164),n=i(79);t.createCipher=t.Cipher=r.createCipher,t.createCipheriv=t.Cipheriv=r.createCipheriv,t.createDecipher=t.Decipher=s.createDecipher,t.createDecipheriv=t.Decipheriv=s.createDecipheriv,t.listCiphers=t.getCiphers=function(){return Object.keys(n)}},function(e,t,i){var r={ECB:i(157),CBC:i(158),CFB:i(159),CFB8:i(160),CFB1:i(161),OFB:i(162),CTR:i(77),GCM:i(77)},s=i(79);for(var n in s)s[n].module=r[s[n].mode];e.exports=s},function(e,t,i){var r;function s(e){this.rand=e}if(e.exports=function(e){return r||(r=new s(null)),r.generate(e)},e.exports.Rand=s,s.prototype.generate=function(e){return this._rand(e)},s.prototype._rand=function(e){if(this.rand.getBytes)return this.rand.getBytes(e);for(var t=new Uint8Array(e),i=0;i<t.length;i++)t[i]=this.rand.getByte();return t},"object"==typeof self)self.crypto&&self.crypto.getRandomValues?s.prototype._rand=function(e){var t=new Uint8Array(e);return self.crypto.getRandomValues(t),t}:self.msCrypto&&self.msCrypto.getRandomValues?s.prototype._rand=function(e){var t=new Uint8Array(e);return self.msCrypto.getRandomValues(t),t}:"object"==typeof window&&(s.prototype._rand=function(){throw new Error("Not implemented yet")});else try{var n=i(169);if("function"!=typeof n.randomBytes)throw new Error("Not supported");s.prototype._rand=function(e){return n.randomBytes(e)}}catch(e){}},function(e,t,i){(function(t){var r=i(3),s=i(20);function n(e,i){var s=function(e){var t=a(e);return{blinder:t.toRed(r.mont(e.modulus)).redPow(new r(e.publicExponent)).fromRed(),unblinder:t.invm(e.modulus)}}(i),n=i.modulus.byteLength(),o=(r.mont(i.modulus),new r(e).mul(s.blinder).umod(i.modulus)),h=o.toRed(r.mont(i.prime1)),c=o.toRed(r.mont(i.prime2)),d=i.coefficient,u=i.prime1,l=i.prime2,f=h.redPow(i.exponent1),p=c.redPow(i.exponent2);f=f.fromRed(),p=p.fromRed();var m=f.isub(p).imul(d).umod(u);return m.imul(l),p.iadd(m),new t(p.imul(s.unblinder).umod(i.modulus).toArray(!1,n))}function a(e){for(var t=e.modulus.byteLength(),i=new r(s(t));i.cmp(e.modulus)>=0||!i.umod(e.prime1)||!i.umod(e.prime2);)i=new r(s(t));return i}e.exports=n,n.getr=a}).call(this,i(0).Buffer)},function(e,t,i){"use strict";var r=t;r.version=i(174).version,r.utils=i(8),r.rand=i(49),r.curve=i(85),r.curves=i(52),r.ec=i(185),r.eddsa=i(189)},function(e,t,i){"use strict";var r,s=t,n=i(53),a=i(85),o=i(8).assert;function h(e){"short"===e.type?this.curve=new a.short(e):"edwards"===e.type?this.curve=new a.edwards(e):this.curve=new a.mont(e),this.g=this.curve.g,this.n=this.curve.n,this.hash=e.hash,o(this.g.validate(),"Invalid curve"),o(this.g.mul(this.n).isInfinity(),"Invalid curve, G*N != O")}function c(e,t){Object.defineProperty(s,e,{configurable:!0,enumerable:!0,get:function(){var i=new h(t);return Object.defineProperty(s,e,{configurable:!0,enumerable:!0,value:i}),i}})}s.PresetCurve=h,c("p192",{type:"short",prime:"p192",p:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff",a:"ffffffff ffffffff ffffffff fffffffe ffffffff fffffffc",b:"64210519 e59c80e7 0fa7e9ab 72243049 feb8deec c146b9b1",n:"ffffffff ffffffff ffffffff 99def836 146bc9b1 b4d22831",hash:n.sha256,gRed:!1,g:["188da80e b03090f6 7cbf20eb 43a18800 f4ff0afd 82ff1012","07192b95 ffc8da78 631011ed 6b24cdd5 73f977a1 1e794811"]}),c("p224",{type:"short",prime:"p224",p:"ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001",a:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff fffffffe",b:"b4050a85 0c04b3ab f5413256 5044b0b7 d7bfd8ba 270b3943 2355ffb4",n:"ffffffff ffffffff ffffffff ffff16a2 e0b8f03e 13dd2945 5c5c2a3d",hash:n.sha256,gRed:!1,g:["b70e0cbd 6bb4bf7f 321390b9 4a03c1d3 56c21122 343280d6 115c1d21","bd376388 b5f723fb 4c22dfe6 cd4375a0 5a074764 44d58199 85007e34"]}),c("p256",{type:"short",prime:null,p:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff ffffffff",a:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff fffffffc",b:"5ac635d8 aa3a93e7 b3ebbd55 769886bc 651d06b0 cc53b0f6 3bce3c3e 27d2604b",n:"ffffffff 00000000 ffffffff ffffffff bce6faad a7179e84 f3b9cac2 fc632551",hash:n.sha256,gRed:!1,g:["6b17d1f2 e12c4247 f8bce6e5 63a440f2 77037d81 2deb33a0 f4a13945 d898c296","4fe342e2 fe1a7f9b 8ee7eb4a 7c0f9e16 2bce3357 6b315ece cbb64068 37bf51f5"]}),c("p384",{type:"short",prime:null,p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 ffffffff",a:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 fffffffc",b:"b3312fa7 e23ee7e4 988e056b e3f82d19 181d9c6e fe814112 0314088f 5013875a c656398d 8a2ed19d 2a85c8ed d3ec2aef",n:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff c7634d81 f4372ddf 581a0db2 48b0a77a ecec196a ccc52973",hash:n.sha384,gRed:!1,g:["aa87ca22 be8b0537 8eb1c71e f320ad74 6e1d3b62 8ba79b98 59f741e0 82542a38 5502f25d bf55296c 3a545e38 72760ab7","3617de4a 96262c6f 5d9e98bf 9292dc29 f8f41dbd 289a147c e9da3113 b5f0b8c0 0a60b1ce 1d7e819d 7a431d7c 90ea0e5f"]}),c("p521",{type:"short",prime:null,p:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff",a:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffc",b:"00000051 953eb961 8e1c9a1f 929a21a0 b68540ee a2da725b 99b315f3 b8b48991 8ef109e1 56193951 ec7e937b 1652c0bd 3bb1bf07 3573df88 3d2c34f1 ef451fd4 6b503f00",n:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffa 51868783 bf2f966b 7fcc0148 f709a5d0 3bb5c9b8 899c47ae bb6fb71e 91386409",hash:n.sha512,gRed:!1,g:["000000c6 858e06b7 0404e9cd 9e3ecb66 2395b442 9c648139 053fb521 f828af60 6b4d3dba a14b5e77 efe75928 fe1dc127 a2ffa8de 3348b3c1 856a429b f97e7e31 c2e5bd66","00000118 39296a78 9a3bc004 5c8a5fb4 2c7d1bd9 98f54449 579b4468 17afbd17 273e662c 97ee7299 5ef42640 c550b901 3fad0761 353c7086 a272c240 88be9476 9fd16650"]}),c("curve25519",{type:"mont",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"76d06",b:"1",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:n.sha256,gRed:!1,g:["9"]}),c("ed25519",{type:"edwards",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"-1",c:"1",d:"52036cee2b6ffe73 8cc740797779e898 00700a4d4141d8ab 75eb4dca135978a3",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:n.sha256,gRed:!1,g:["216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a","6666666666666666666666666666666666666666666666666666666666666658"]});try{r=i(184)}catch(e){r=void 0}c("secp256k1",{type:"short",prime:"k256",p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f",a:"0",b:"7",n:"ffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141",h:"1",hash:n.sha256,beta:"7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee",lambda:"5363ad4cc05c30e0a5261c028812645a122e22ea20816678df02967c1b23bd72",basis:[{a:"3086d221a7d46bcde86c90e49284eb15",b:"-e4437ed6010e88286f547fa90abfe4c3"},{a:"114ca50f7a8e2f3f657c1108d9d44cfd8",b:"3086d221a7d46bcde86c90e49284eb15"}],gRed:!1,g:["79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798","483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8",r]})},function(e,t,i){var r=t;r.utils=i(11),r.common=i(25),r.sha=i(178),r.ripemd=i(182),r.hmac=i(183),r.sha1=r.sha.sha1,r.sha256=r.sha.sha256,r.sha224=r.sha.sha224,r.sha384=r.sha.sha384,r.sha512=r.sha.sha512,r.ripemd160=r.ripemd.ripemd160},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(i(6)),a=s(i(113));class o extends a.default{constructor(e,t){super(e,t),this.util=new n.default(this)}repeat(e,t){if(this.looper)return this.looper=e,void(this.repeatInterval=t||this.repeatInterval||100);this.looper=e,this.repeatInterval=t||100,this.onConnectCalled&&this.loop()}warning(e){if(this.isNode)console.error(e);else{if(e&&"object"==typeof e&&e.alert)return this.showAlertUI(e),void console.log(e.message);"function"==typeof showObnizDebugError&&showObnizDebugError(new Error(e)),console.log(`Warning: ${e}`)}}error(e){if(this.isNode)console.error(e);else{if(e&&"object"==typeof e&&e.alert&&(this.showAlertUI(e),e=e.message),"function"!=typeof showObnizDebugError)throw new Error(e);showObnizDebugError(new Error(e)),console.error(new Error(e))}}message(e,t){let i=[];"string"==typeof e?i.push(e):i=e,this.send({message:{to:i,data:t}})}loop(){return r(this,void 0,void 0,(function*(){if("function"==typeof this.looper&&this.onConnectCalled){const e=this.looper();e instanceof Promise&&(yield e),setTimeout(this.loop.bind(this),this.repeatInterval||100)}}))}_callOnConnect(){super._callOnConnect(),this.loop()}notifyToModule(e){if(super.notifyToModule(e),"object"==typeof e.message&&this.onmessage&&this.onmessage(e.message.data,e.message.from),"object"==typeof e.debug){if(e.debug.warning){const t="Warning: "+e.debug.warning.message;this.warning({alert:"warning",message:t})}if(e.debug.error){const t="Error: "+e.debug.error.message;this.error({alert:"error",message:t})}this.ondebug&&this.ondebug(e.debug)}}}t.default=o},function(e,t){var i={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==i.call(e)}},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(29)),n=r(i(57)),a=r(i(10));class o extends s.default{constructor(e){super(e),this.addDescriptor=this.addChild,this.getDescriptor=this.getChild,this.properties=e.properties||[],Array.isArray(this.properties)||(this.properties=[this.properties]),this.permissions=e.permissions||[],Array.isArray(this.permissions)||(this.permissions=[this.permissions])}get parentName(){return"service"}get childrenClass(){return n.default}get childrenName(){return"descriptors"}get descriptors(){return this.children}toJSON(){const e=super.toJSON();return this.properties.length>0&&(e.properties=this.properties),this.permissions.length>0&&(e.permissions=this.permissions),e}addProperty(e){this.properties.includes(e)||this.properties.push(e)}removeProperty(e){this.properties=this.properties.filter(t=>t!==e)}addPermission(e){this.permissions.includes(e)||this.permissions.push(e)}removePermission(e){this.permissions=this.permissions.filter(t=>t!==e)}write(e){this.service.peripheral.Obniz.send({ble:{peripheral:{write_characteristic:{service_uuid:a.default.uuidFilter(this.service.uuid),characteristic_uuid:a.default.uuidFilter(this.uuid),data:e}}}})}read(){this.service.peripheral.Obniz.send({ble:{peripheral:{read_characteristic:{service_uuid:a.default.uuidFilter(this.service.uuid),characteristic_uuid:a.default.uuidFilter(this.uuid)}}}})}notify(){this.service.peripheral.Obniz.send({ble:{peripheral:{notify_characteristic:{service_uuid:a.default.uuidFilter(this.service.uuid),characteristic_uuid:a.default.uuidFilter(this.uuid)}}}})}}t.default=o},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(29)),n=r(i(10));class a extends s.default{constructor(e){super(e),this.permissions=e.permissions||[],Array.isArray(this.permissions)||(this.permissions=[this.permissions])}get parentName(){return"characteristic"}addPermission(e){this.permissions.includes(e)||this.permissions.push(e)}removePermission(e){this.permissions=this.permissions.filter(t=>t!==e)}toJSON(){const e=super.toJSON();return this.permissions.length>0&&(e.permissions=this.permissions),e}write(e){this.characteristic.service.peripheral.Obniz.send({ble:{peripheral:{write_descriptor:{service_uuid:n.default.uuidFilter(this.characteristic.service.uuid),characteristic_uuid:n.default.uuidFilter(this.characteristic.uuid),descriptor_uuid:this.uuid,data:e}}}})}read(){this.characteristic.service.peripheral.Obniz.send({ble:{peripheral:{read_descriptor:{service_uuid:n.default.uuidFilter(this.characteristic.service.uuid),characteristic_uuid:n.default.uuidFilter(this.characteristic.uuid),descriptor_uuid:this.uuid}}}})}}t.default=a},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(29)),n=r(i(56)),a=r(i(10));class o extends s.default{constructor(e){super(e),this.addCharacteristic=this.addChild,this.getCharacteristic=this.getChild}get parentName(){return"peripheral"}get childrenName(){return"characteristics"}get childrenClass(){return n.default}get advData(){return{flags:["general_discoverable_mode","br_edr_not_supported"],serviceUuids:[this.uuid]}}end(){this.peripheral.Obniz.send({ble:{peripheral:{stop_service:{service_uuid:a.default.uuidFilter(this.uuid)}}}}),this.peripheral.removeService(this.uuid)}notify(e,t){}}t.default=o},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(i(18)),a=s(i(127)),o=s(i(128)),h=s(i(30)),c=s(i(214)),d=s(i(222)),u=s(i(97)),l=s(i(98)),f=s(i(224)),p=s(i(225)),m=s(i(229)),_=s(i(230)),g=s(i(102));t.default=class{constructor(e){this.Obniz=e,this.hci=new a.default(e),this.hciProtocol=new h.default(this.hci),this.centralBindings=new o.default(this.hciProtocol),this.peripheralBindings=new c.default(this.hciProtocol),this.centralBindings.init(),this.peripheralBindings.init(),this._initialized=!1,this._initializeWarning=!0,this.remotePeripherals=[],this.service=g.default,this.characteristic=u.default,this.descriptor=l.default,this.peripheral=new f.default(this),this.advertisement=new d.default(this),this.scan=new m.default(this),this.security=new _.default(this),this._bind(),this._reset()}static _dataArray2uuidHex(e,t){let i=[];for(let t=0;t<e.length;t++)i.push(("00"+e[t].toString(16).toLowerCase()).slice(-2));t&&(i=i.reverse());let r=i.join("");return i.length>=16&&(r=r.slice(0,8)+"-"+r.slice(8,12)+"-"+r.slice(12,16)+"-"+r.slice(16,20)+"-"+r.slice(20)),r}initWait(){return r(this,void 0,void 0,(function*(){this._initialized||(this._initialized=!0,yield this.hciProtocol.initWait())}))}notified(e){e.hci&&this.hci.notified(e.hci)}_reset(){}directConnect(e,t){let i=this.findPeripheral(e);if(i||(i=new p.default(this,e),this.remotePeripherals.push(i)),!this.centralBindings._addresses[e]){const i=e.match(/.{1,2}/g).join(":");this.centralBindings._addresses[e]=i,this.centralBindings._addresseTypes[e]=t,this.centralBindings._connectable[e]=!0}return i.connect(),i}directConnectWait(e,t){return r(this,void 0,void 0,(function*(){const i=this.directConnect(e,t);return yield i.connectWait(),i}))}warningIfNotInitialize(){!this._initialized&&this._initializeWarning&&(this._initializeWarning=!0,this.Obniz.warning({alert:"warning",message:"BLE is not initialized. Please call 'await obniz.ble.initWait()'"}))}onStateChange(){}findPeripheral(e){for(const t in this.remotePeripherals)if(this.remotePeripherals[t].address===e)return this.remotePeripherals[t];return null}onAddressChange(){}onScanStart(){}onScanStop(){this.scan.notifyFromServer("onfinish",null)}onDiscover(e,t,i,r,s,n){let a=this.findPeripheral(e);a||(a=new p.default(this,e),this.remotePeripherals.push(a)),a.discoverdOnRemote=!0;const o={device_type:"ble",address_type:i,ble_event_type:r?"connectable_advertisemnt":"non_connectable_advertising",rssi:n,adv_data:s.advertisementRaw,scan_resp:s.scanResponseRaw};a.setParams(o),a._adv_data_filtered=s,this.scan.notifyFromServer("onfind",a)}onConnect(e,t){return r(this,void 0,void 0,(function*(){const i=this.findPeripheral(e);t||(yield i.discoverAllHandlesWait()),i.notifyFromServer("statusupdate",{status:t?"disconnected":"connected"})}))}onDisconnect(e){this.findPeripheral(e).notifyFromServer("statusupdate",{status:"disconnected"})}onRssiUpdate(){}onServicesDiscover(e,t){const i=this.findPeripheral(e);for(const e of t)i.notifyFromServer("discover",{service_uuid:e});i.notifyFromServer("discoverfinished",{})}onIncludedServicesDiscover(e,t,i){}onCharacteristicsDiscover(e,t,i){const r=this.findPeripheral(e).findService({service_uuid:t});for(const e of i){const t={properties:e.properties.map(e=>n.default.toSnakeCase(e)),characteristic_uuid:e.uuid};r.notifyFromServer("discover",t)}r.notifyFromServer("discoverfinished",{})}onRead(e,t,i,r,s,n){const a=this.findPeripheral(e).findCharacteristic({service_uuid:t,characteristic_uuid:i});if(s){const e={data:Array.from(r)};a.notifyFromServer("onnotify",e)}else{const e={result:n?"success":"failed",data:Array.from(r)};a.notifyFromServer("onread",e)}}onWrite(e,t,i,r){this.findPeripheral(e).findCharacteristic({service_uuid:t,characteristic_uuid:i}).notifyFromServer("onwrite",{result:r?"success":"failed"})}onBroadcast(e,t,i,r){}onNotify(e,t,i,r){const s=this.findPeripheral(e).findCharacteristic({service_uuid:t,characteristic_uuid:i});r?s.notifyFromServer("onregisternotify",{}):s.notifyFromServer("onunregisternotify",{})}onDescriptorsDiscover(e,t,i,r){const s=this.findPeripheral(e).findCharacteristic({service_uuid:t,characteristic_uuid:i});for(const e of r){const t={descriptor_uuid:e};s.notifyFromServer("discover",t)}s.notifyFromServer("discoverfinished",{})}onValueRead(e,t,i,r,s,n){const a=this.findPeripheral(e).findDescriptor({service_uuid:t,characteristic_uuid:i,descriptor_uuid:r}),o={result:n?"success":"failed",data:Array.from(s)};a.notifyFromServer("onread",o)}onValueWrite(e,t,i,r,s){const n={result:s?"success":"failed"};this.findPeripheral(e).findDescriptor({service_uuid:t,characteristic_uuid:i,descriptor_uuid:r}).notifyFromServer("onwrite",n)}onHandleRead(e,t,i){}onHandleWrite(e,t){}onHandleNotify(e,t,i){}onPeripheralStateChange(e){}onPeripheralAddressChange(e){}onPeripheralPlatform(e){}onPeripheralAdvertisingStart(e){}onPeripheralAdvertisingStop(){}onPeripheralServicesSet(e){}onPeripheralAccept(e){this.peripheral.currentConnectedDeviceAddress=e,this.peripheral.onconnectionupdates&&this.peripheral.onconnectionupdates({address:e,status:"connected"})}onPeripheralMtuChange(e){}onPeripheralDisconnect(e){this.peripheral.currentConnectedDeviceAddress=null,this.peripheral.onconnectionupdates&&this.peripheral.onconnectionupdates({address:e,status:"disconnected"})}onPeripheralRssiUpdate(e){}_bind(){this.centralBindings.on("stateChange",this.onStateChange.bind(this)),this.centralBindings.on("addressChange",this.onAddressChange.bind(this)),this.centralBindings.on("scanStart",this.onScanStart.bind(this)),this.centralBindings.on("scanStop",this.onScanStop.bind(this)),this.centralBindings.on("discover",this.onDiscover.bind(this)),this.centralBindings.on("connect",this.onConnect.bind(this)),this.centralBindings.on("disconnect",this.onDisconnect.bind(this)),this.centralBindings.on("rssiUpdate",this.onRssiUpdate.bind(this)),this.centralBindings.on("servicesDiscover",this.onServicesDiscover.bind(this)),this.centralBindings.on("includedServicesDiscover",this.onIncludedServicesDiscover.bind(this)),this.centralBindings.on("characteristicsDiscover",this.onCharacteristicsDiscover.bind(this)),this.centralBindings.on("read",this.onRead.bind(this)),this.centralBindings.on("write",this.onWrite.bind(this)),this.centralBindings.on("broadcast",this.onBroadcast.bind(this)),this.centralBindings.on("notify",this.onNotify.bind(this)),this.centralBindings.on("descriptorsDiscover",this.onDescriptorsDiscover.bind(this)),this.centralBindings.on("valueRead",this.onValueRead.bind(this)),this.centralBindings.on("valueWrite",this.onValueWrite.bind(this)),this.centralBindings.on("handleRead",this.onHandleRead.bind(this)),this.centralBindings.on("handleWrite",this.onHandleWrite.bind(this)),this.centralBindings.on("handleNotify",this.onHandleNotify.bind(this)),this.peripheralBindings.on("stateChange",this.onPeripheralStateChange.bind(this)),this.peripheralBindings.on("addressChange",this.onPeripheralAddressChange.bind(this)),this.peripheralBindings.on("platform",this.onPeripheralPlatform.bind(this)),this.peripheralBindings.on("advertisingStart",this.onPeripheralAdvertisingStart.bind(this)),this.peripheralBindings.on("advertisingStop",this.onPeripheralAdvertisingStop.bind(this)),this.peripheralBindings.on("servicesSet",this.onPeripheralServicesSet.bind(this)),this.peripheralBindings.on("accept",this.onPeripheralAccept.bind(this)),this.peripheralBindings.on("mtuChange",this.onPeripheralMtuChange.bind(this)),this.peripheralBindings.on("disconnect",this.onPeripheralDisconnect.bind(this)),this.peripheralBindings.on("rssiUpdate",this.onPeripheralRssiUpdate.bind(this))}}},function(e,t,i){"use strict";t.randomBytes=t.rng=t.pseudoRandomBytes=t.prng=i(20),t.createHash=t.Hash=i(22),t.createHmac=t.Hmac=i(68);var r=i(149),s=Object.keys(r),n=["sha1","sha224","sha256","sha384","sha512","md5","rmd160"].concat(s);t.getHashes=function(){return n};var a=i(71);t.pbkdf2=a.pbkdf2,t.pbkdf2Sync=a.pbkdf2Sync;var o=i(151);t.Cipher=o.Cipher,t.createCipher=o.createCipher,t.Cipheriv=o.Cipheriv,t.createCipheriv=o.createCipheriv,t.Decipher=o.Decipher,t.createDecipher=o.createDecipher,t.Decipheriv=o.Decipheriv,t.createDecipheriv=o.createDecipheriv,t.getCiphers=o.getCiphers,t.listCiphers=o.listCiphers;var h=i(166);t.DiffieHellmanGroup=h.DiffieHellmanGroup,t.createDiffieHellmanGroup=h.createDiffieHellmanGroup,t.getDiffieHellman=h.getDiffieHellman,t.createDiffieHellman=h.createDiffieHellman,t.DiffieHellman=h.DiffieHellman;var c=i(172);t.createSign=c.createSign,t.Sign=c.Sign,t.createVerify=c.createVerify,t.Verify=c.Verify,t.createECDH=i(206);var d=i(207);t.publicEncrypt=d.publicEncrypt,t.privateEncrypt=d.privateEncrypt,t.publicDecrypt=d.publicDecrypt,t.privateDecrypt=d.privateDecrypt;var u=i(210);t.randomFill=u.randomFill,t.randomFillSync=u.randomFillSync,t.createCredentials=function(){throw new Error(["sorry, createCredentials is not implemented yet","we accept pull requests","https://github.com/crypto-browserify/crypto-browserify"].join("\n"))},t.constants={DH_CHECK_P_NOT_SAFE_PRIME:2,DH_CHECK_P_NOT_PRIME:1,DH_UNABLE_TO_CHECK_GENERATOR:4,DH_NOT_SUITABLE_GENERATOR:8,NPN_ENABLED:1,ALPN_ENABLED:1,RSA_PKCS1_PADDING:1,RSA_SSLV23_PADDING:2,RSA_NO_PADDING:3,RSA_PKCS1_OAEP_PADDING:4,RSA_X931_PADDING:5,RSA_PKCS1_PSS_PADDING:6,POINT_CONVERSION_COMPRESSED:2,POINT_CONVERSION_UNCOMPRESSED:4,POINT_CONVERSION_HYBRID:6}},function(e,t,i){"use strict";var r=i(2).Buffer,s=i(41).Transform;function n(e){s.call(this),this._block=r.allocUnsafe(e),this._blockSize=e,this._blockOffset=0,this._length=[0,0,0,0],this._finalized=!1}i(1)(n,s),n.prototype._transform=function(e,t,i){var r=null;try{this.update(e,t)}catch(e){r=e}i(r)},n.prototype._flush=function(e){var t=null;try{this.push(this.digest())}catch(e){t=e}e(t)},n.prototype.update=function(e,t){if(function(e,t){if(!r.isBuffer(e)&&"string"!=typeof e)throw new TypeError(t+" must be a string or a buffer")}(e,"Data"),this._finalized)throw new Error("Digest already called");r.isBuffer(e)||(e=r.from(e,t));for(var i=this._block,s=0;this._blockOffset+e.length-s>=this._blockSize;){for(var n=this._blockOffset;n<this._blockSize;)i[n++]=e[s++];this._update(),this._blockOffset=0}for(;s<e.length;)i[this._blockOffset++]=e[s++];for(var a=0,o=8*e.length;o>0;++a)this._length[a]+=o,(o=this._length[a]/4294967296|0)>0&&(this._length[a]-=4294967296*o);return this},n.prototype._update=function(){throw new Error("_update is not implemented")},n.prototype.digest=function(e){if(this._finalized)throw new Error("Digest already called");this._finalized=!0;var t=this._digest();void 0!==e&&(t=t.toString(e)),this._block.fill(0),this._blockOffset=0;for(var i=0;i<4;++i)this._length[i]=0;return t},n.prototype._digest=function(){throw new Error("_digest is not implemented")},e.exports=n},function(e,t,i){"use strict";(function(t,r){var s=i(31);e.exports=b;var n,a=i(55);b.ReadableState=y;i(4).EventEmitter;var o=function(e,t){return e.listeners(t).length},h=i(63),c=i(2).Buffer,d=t.Uint8Array||function(){};var u=Object.create(i(23));u.inherits=i(1);var l=i(133),f=void 0;f=l&&l.debuglog?l.debuglog("stream"):function(){};var p,m=i(134),_=i(64);u.inherits(b,h);var g=["error","close","destroy","pause","resume"];function y(e,t){e=e||{};var r=t instanceof(n=n||i(19));this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var s=e.highWaterMark,a=e.readableHighWaterMark,o=this.objectMode?16:16384;this.highWaterMark=s||0===s?s:r&&(a||0===a)?a:o,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new m,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(p||(p=i(28).StringDecoder),this.decoder=new p(e.encoding),this.encoding=e.encoding)}function b(e){if(n=n||i(19),!(this instanceof b))return new b(e);this._readableState=new y(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),h.call(this)}function v(e,t,i,r,s){var n,a=e._readableState;null===t?(a.reading=!1,function(e,t){if(t.ended)return;if(t.decoder){var i=t.decoder.end();i&&i.length&&(t.buffer.push(i),t.length+=t.objectMode?1:i.length)}t.ended=!0,E(e)}(e,a)):(s||(n=function(e,t){var i;r=t,c.isBuffer(r)||r instanceof d||"string"==typeof t||void 0===t||e.objectMode||(i=new TypeError("Invalid non-string/buffer chunk"));var r;return i}(a,t)),n?e.emit("error",n):a.objectMode||t&&t.length>0?("string"==typeof t||a.objectMode||Object.getPrototypeOf(t)===c.prototype||(t=function(e){return c.from(e)}(t)),r?a.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):w(e,a,t,!0):a.ended?e.emit("error",new Error("stream.push() after EOF")):(a.reading=!1,a.decoder&&!i?(t=a.decoder.write(t),a.objectMode||0!==t.length?w(e,a,t,!1):A(e,a)):w(e,a,t,!1))):r||(a.reading=!1));return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(a)}function w(e,t,i,r){t.flowing&&0===t.length&&!t.sync?(e.emit("data",i),e.read(0)):(t.length+=t.objectMode?1:i.length,r?t.buffer.unshift(i):t.buffer.push(i),t.needReadable&&E(e)),A(e,t)}Object.defineProperty(b.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),b.prototype.destroy=_.destroy,b.prototype._undestroy=_.undestroy,b.prototype._destroy=function(e,t){this.push(null),t(e)},b.prototype.push=function(e,t){var i,r=this._readableState;return r.objectMode?i=!0:"string"==typeof e&&((t=t||r.defaultEncoding)!==r.encoding&&(e=c.from(e,t),t=""),i=!0),v(this,e,t,!1,i)},b.prototype.unshift=function(e){return v(this,e,null,!0,!1)},b.prototype.isPaused=function(){return!1===this._readableState.flowing},b.prototype.setEncoding=function(e){return p||(p=i(28).StringDecoder),this._readableState.decoder=new p(e),this._readableState.encoding=e,this};function S(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=8388608?e=8388608:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function E(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(f("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?s.nextTick(C,e):C(e))}function C(e){f("emit readable"),e.emit("readable"),R(e)}function A(e,t){t.readingMore||(t.readingMore=!0,s.nextTick(I,e,t))}function I(e,t){for(var i=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(f("maybeReadMore read 0"),e.read(0),i!==t.length);)i=t.length;t.readingMore=!1}function P(e){f("readable nexttick read 0"),e.read(0)}function O(e,t){t.reading||(f("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),R(e),t.flowing&&!t.reading&&e.read(0)}function R(e){var t=e._readableState;for(f("flow",t.flowing);t.flowing&&null!==e.read(););}function M(e,t){return 0===t.length?null:(t.objectMode?i=t.buffer.shift():!e||e>=t.length?(i=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):i=function(e,t,i){var r;e<t.head.data.length?(r=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):r=e===t.head.data.length?t.shift():i?function(e,t){var i=t.head,r=1,s=i.data;e-=s.length;for(;i=i.next;){var n=i.data,a=e>n.length?n.length:e;if(a===n.length?s+=n:s+=n.slice(0,e),0===(e-=a)){a===n.length?(++r,i.next?t.head=i.next:t.head=t.tail=null):(t.head=i,i.data=n.slice(a));break}++r}return t.length-=r,s}(e,t):function(e,t){var i=c.allocUnsafe(e),r=t.head,s=1;r.data.copy(i),e-=r.data.length;for(;r=r.next;){var n=r.data,a=e>n.length?n.length:e;if(n.copy(i,i.length-e,0,a),0===(e-=a)){a===n.length?(++s,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=n.slice(a));break}++s}return t.length-=s,i}(e,t);return r}(e,t.buffer,t.decoder),i);var i}function x(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,s.nextTick(D,t,e))}function D(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function k(e,t){for(var i=0,r=e.length;i<r;i++)if(e[i]===t)return i;return-1}b.prototype.read=function(e){f("read",e),e=parseInt(e,10);var t=this._readableState,i=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return f("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?x(this):E(this),null;if(0===(e=S(e,t))&&t.ended)return 0===t.length&&x(this),null;var r,s=t.needReadable;return f("need readable",s),(0===t.length||t.length-e<t.highWaterMark)&&f("length less than watermark",s=!0),t.ended||t.reading?f("reading or ended",s=!1):s&&(f("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=S(i,t))),null===(r=e>0?M(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),i!==e&&t.ended&&x(this)),null!==r&&this.emit("data",r),r},b.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},b.prototype.pipe=function(e,t){var i=this,n=this._readableState;switch(n.pipesCount){case 0:n.pipes=e;break;case 1:n.pipes=[n.pipes,e];break;default:n.pipes.push(e)}n.pipesCount+=1,f("pipe count=%d opts=%j",n.pipesCount,t);var h=(!t||!1!==t.end)&&e!==r.stdout&&e!==r.stderr?d:b;function c(t,r){f("onunpipe"),t===i&&r&&!1===r.hasUnpiped&&(r.hasUnpiped=!0,f("cleanup"),e.removeListener("close",g),e.removeListener("finish",y),e.removeListener("drain",u),e.removeListener("error",_),e.removeListener("unpipe",c),i.removeListener("end",d),i.removeListener("end",b),i.removeListener("data",m),l=!0,!n.awaitDrain||e._writableState&&!e._writableState.needDrain||u())}function d(){f("onend"),e.end()}n.endEmitted?s.nextTick(h):i.once("end",h),e.on("unpipe",c);var u=function(e){return function(){var t=e._readableState;f("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&o(e,"data")&&(t.flowing=!0,R(e))}}(i);e.on("drain",u);var l=!1;var p=!1;function m(t){f("ondata"),p=!1,!1!==e.write(t)||p||((1===n.pipesCount&&n.pipes===e||n.pipesCount>1&&-1!==k(n.pipes,e))&&!l&&(f("false write response, pause",i._readableState.awaitDrain),i._readableState.awaitDrain++,p=!0),i.pause())}function _(t){f("onerror",t),b(),e.removeListener("error",_),0===o(e,"error")&&e.emit("error",t)}function g(){e.removeListener("finish",y),b()}function y(){f("onfinish"),e.removeListener("close",g),b()}function b(){f("unpipe"),i.unpipe(e)}return i.on("data",m),function(e,t,i){if("function"==typeof e.prependListener)return e.prependListener(t,i);e._events&&e._events[t]?a(e._events[t])?e._events[t].unshift(i):e._events[t]=[i,e._events[t]]:e.on(t,i)}(e,"error",_),e.once("close",g),e.once("finish",y),e.emit("pipe",i),n.flowing||(f("pipe resume"),i.resume()),e},b.prototype.unpipe=function(e){var t=this._readableState,i={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,i),this);if(!e){var r=t.pipes,s=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var n=0;n<s;n++)r[n].emit("unpipe",this,i);return this}var a=k(t.pipes,e);return-1===a?this:(t.pipes.splice(a,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,i),this)},b.prototype.on=function(e,t){var i=h.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&E(this):s.nextTick(P,this))}return i},b.prototype.addListener=b.prototype.on,b.prototype.resume=function(){var e=this._readableState;return e.flowing||(f("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,s.nextTick(O,e,t))}(this,e)),this},b.prototype.pause=function(){return f("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(f("pause"),this._readableState.flowing=!1,this.emit("pause")),this},b.prototype.wrap=function(e){var t=this,i=this._readableState,r=!1;for(var s in e.on("end",(function(){if(f("wrapped end"),i.decoder&&!i.ended){var e=i.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(s){(f("wrapped data"),i.decoder&&(s=i.decoder.write(s)),i.objectMode&&null==s)||(i.objectMode||s&&s.length)&&(t.push(s)||(r=!0,e.pause()))})),e)void 0===this[s]&&"function"==typeof e[s]&&(this[s]=function(t){return function(){return e[t].apply(e,arguments)}}(s));for(var n=0;n<g.length;n++)e.on(g[n],this.emit.bind(this,g[n]));return this._read=function(t){f("wrapped _read",t),r&&(r=!1,e.resume())},this},Object.defineProperty(b.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),b._fromList=M}).call(this,i(13),i(9))},function(e,t,i){e.exports=i(4).EventEmitter},function(e,t,i){"use strict";var r=i(31);function s(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var i=this,n=this._readableState&&this._readableState.destroyed,a=this._writableState&&this._writableState.destroyed;return n||a?(t?t(e):!e||this._writableState&&this._writableState.errorEmitted||r.nextTick(s,this,e),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!t&&e?(r.nextTick(s,i,e),i._writableState&&(i._writableState.errorEmitted=!0)):t&&t(e)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(e,t,i){"use strict";e.exports=a;var r=i(19),s=Object.create(i(23));function n(e,t){var i=this._transformState;i.transforming=!1;var r=i.writecb;if(!r)return this.emit("error",new Error("write callback called multiple times"));i.writechunk=null,i.writecb=null,null!=t&&this.push(t),r(e);var s=this._readableState;s.reading=!1,(s.needReadable||s.length<s.highWaterMark)&&this._read(s.highWaterMark)}function a(e){if(!(this instanceof a))return new a(e);r.call(this,e),this._transformState={afterTransform:n.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",o)}function o(){var e=this;"function"==typeof this._flush?this._flush((function(t,i){h(e,t,i)})):h(this,null,null)}function h(e,t,i){if(t)return e.emit("error",t);if(null!=i&&e.push(i),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}s.inherits=i(1),s.inherits(a,r),a.prototype.push=function(e,t){return this._transformState.needTransform=!1,r.prototype.push.call(this,e,t)},a.prototype._transform=function(e,t,i){throw new Error("_transform() is not implemented")},a.prototype._write=function(e,t,i){var r=this._transformState;if(r.writecb=i,r.writechunk=e,r.writeencoding=t,!r.transforming){var s=this._readableState;(r.needTransform||s.needReadable||s.length<s.highWaterMark)&&this._read(s.highWaterMark)}},a.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},a.prototype._destroy=function(e,t){var i=this;r.prototype._destroy.call(this,e,(function(e){t(e),i.emit("close")}))}},function(e,t,i){var r=i(1),s=i(21),n=i(2).Buffer,a=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],o=new Array(64);function h(){this.init(),this._w=o,s.call(this,64,56)}function c(e,t,i){return i^e&(t^i)}function d(e,t,i){return e&t|i&(e|t)}function u(e){return(e>>>2|e<<30)^(e>>>13|e<<19)^(e>>>22|e<<10)}function l(e){return(e>>>6|e<<26)^(e>>>11|e<<21)^(e>>>25|e<<7)}function f(e){return(e>>>7|e<<25)^(e>>>18|e<<14)^e>>>3}r(h,s),h.prototype.init=function(){return this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this},h.prototype._update=function(e){for(var t,i=this._w,r=0|this._a,s=0|this._b,n=0|this._c,o=0|this._d,h=0|this._e,p=0|this._f,m=0|this._g,_=0|this._h,g=0;g<16;++g)i[g]=e.readInt32BE(4*g);for(;g<64;++g)i[g]=0|(((t=i[g-2])>>>17|t<<15)^(t>>>19|t<<13)^t>>>10)+i[g-7]+f(i[g-15])+i[g-16];for(var y=0;y<64;++y){var b=_+l(h)+c(h,p,m)+a[y]+i[y]|0,v=u(r)+d(r,s,n)|0;_=m,m=p,p=h,h=o+b|0,o=n,n=s,s=r,r=b+v|0}this._a=r+this._a|0,this._b=s+this._b|0,this._c=n+this._c|0,this._d=o+this._d|0,this._e=h+this._e|0,this._f=p+this._f|0,this._g=m+this._g|0,this._h=_+this._h|0},h.prototype._hash=function(){var e=n.allocUnsafe(32);return e.writeInt32BE(this._a,0),e.writeInt32BE(this._b,4),e.writeInt32BE(this._c,8),e.writeInt32BE(this._d,12),e.writeInt32BE(this._e,16),e.writeInt32BE(this._f,20),e.writeInt32BE(this._g,24),e.writeInt32BE(this._h,28),e},e.exports=h},function(e,t,i){var r=i(1),s=i(21),n=i(2).Buffer,a=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],o=new Array(160);function h(){this.init(),this._w=o,s.call(this,128,112)}function c(e,t,i){return i^e&(t^i)}function d(e,t,i){return e&t|i&(e|t)}function u(e,t){return(e>>>28|t<<4)^(t>>>2|e<<30)^(t>>>7|e<<25)}function l(e,t){return(e>>>14|t<<18)^(e>>>18|t<<14)^(t>>>9|e<<23)}function f(e,t){return(e>>>1|t<<31)^(e>>>8|t<<24)^e>>>7}function p(e,t){return(e>>>1|t<<31)^(e>>>8|t<<24)^(e>>>7|t<<25)}function m(e,t){return(e>>>19|t<<13)^(t>>>29|e<<3)^e>>>6}function _(e,t){return(e>>>19|t<<13)^(t>>>29|e<<3)^(e>>>6|t<<26)}function g(e,t){return e>>>0<t>>>0?1:0}r(h,s),h.prototype.init=function(){return this._ah=1779033703,this._bh=3144134277,this._ch=1013904242,this._dh=2773480762,this._eh=1359893119,this._fh=2600822924,this._gh=528734635,this._hh=1541459225,this._al=4089235720,this._bl=2227873595,this._cl=4271175723,this._dl=1595750129,this._el=2917565137,this._fl=725511199,this._gl=4215389547,this._hl=327033209,this},h.prototype._update=function(e){for(var t=this._w,i=0|this._ah,r=0|this._bh,s=0|this._ch,n=0|this._dh,o=0|this._eh,h=0|this._fh,y=0|this._gh,b=0|this._hh,v=0|this._al,w=0|this._bl,S=0|this._cl,E=0|this._dl,C=0|this._el,A=0|this._fl,I=0|this._gl,P=0|this._hl,O=0;O<32;O+=2)t[O]=e.readInt32BE(4*O),t[O+1]=e.readInt32BE(4*O+4);for(;O<160;O+=2){var R=t[O-30],M=t[O-30+1],x=f(R,M),D=p(M,R),k=m(R=t[O-4],M=t[O-4+1]),T=_(M,R),B=t[O-14],L=t[O-14+1],N=t[O-32],j=t[O-32+1],q=D+L|0,U=x+B+g(q,D)|0;U=(U=U+k+g(q=q+T|0,T)|0)+N+g(q=q+j|0,j)|0,t[O]=U,t[O+1]=q}for(var F=0;F<160;F+=2){U=t[F],q=t[F+1];var z=d(i,r,s),W=d(v,w,S),$=u(i,v),V=u(v,i),G=l(o,C),H=l(C,o),K=a[F],Y=a[F+1],J=c(o,h,y),Q=c(C,A,I),X=P+H|0,Z=b+G+g(X,P)|0;Z=(Z=(Z=Z+J+g(X=X+Q|0,Q)|0)+K+g(X=X+Y|0,Y)|0)+U+g(X=X+q|0,q)|0;var ee=V+W|0,te=$+z+g(ee,V)|0;b=y,P=I,y=h,I=A,h=o,A=C,o=n+Z+g(C=E+X|0,E)|0,n=s,E=S,s=r,S=w,r=i,w=v,i=Z+te+g(v=X+ee|0,X)|0}this._al=this._al+v|0,this._bl=this._bl+w|0,this._cl=this._cl+S|0,this._dl=this._dl+E|0,this._el=this._el+C|0,this._fl=this._fl+A|0,this._gl=this._gl+I|0,this._hl=this._hl+P|0,this._ah=this._ah+i+g(this._al,v)|0,this._bh=this._bh+r+g(this._bl,w)|0,this._ch=this._ch+s+g(this._cl,S)|0,this._dh=this._dh+n+g(this._dl,E)|0,this._eh=this._eh+o+g(this._el,C)|0,this._fh=this._fh+h+g(this._fl,A)|0,this._gh=this._gh+y+g(this._gl,I)|0,this._hh=this._hh+b+g(this._hl,P)|0},h.prototype._hash=function(){var e=n.allocUnsafe(64);function t(t,i,r){e.writeInt32BE(t,r),e.writeInt32BE(i,r+4)}return t(this._ah,this._al,0),t(this._bh,this._bl,8),t(this._ch,this._cl,16),t(this._dh,this._dl,24),t(this._eh,this._el,32),t(this._fh,this._fl,40),t(this._gh,this._gl,48),t(this._hh,this._hl,56),e},e.exports=h},function(e,t,i){"use strict";var r=i(1),s=i(148),n=i(16),a=i(2).Buffer,o=i(69),h=i(44),c=i(45),d=a.alloc(128);function u(e,t){n.call(this,"digest"),"string"==typeof t&&(t=a.from(t));var i="sha512"===e||"sha384"===e?128:64;(this._alg=e,this._key=t,t.length>i)?t=("rmd160"===e?new h:c(e)).update(t).digest():t.length<i&&(t=a.concat([t,d],i));for(var r=this._ipad=a.allocUnsafe(i),s=this._opad=a.allocUnsafe(i),o=0;o<i;o++)r[o]=54^t[o],s[o]=92^t[o];this._hash="rmd160"===e?new h:c(e),this._hash.update(r)}r(u,n),u.prototype._update=function(e){this._hash.update(e)},u.prototype._final=function(){var e=this._hash.digest();return("rmd160"===this._alg?new h:c(this._alg)).update(this._opad).update(e).digest()},e.exports=function(e,t){return"rmd160"===(e=e.toLowerCase())||"ripemd160"===e?new u("rmd160",t):"md5"===e?new s(o,t):new u(e,t)}},function(e,t,i){var r=i(40);e.exports=function(e){return(new r).update(e).digest()}},function(e){e.exports=JSON.parse('{"sha224WithRSAEncryption":{"sign":"rsa","hash":"sha224","id":"302d300d06096086480165030402040500041c"},"RSA-SHA224":{"sign":"ecdsa/rsa","hash":"sha224","id":"302d300d06096086480165030402040500041c"},"sha256WithRSAEncryption":{"sign":"rsa","hash":"sha256","id":"3031300d060960864801650304020105000420"},"RSA-SHA256":{"sign":"ecdsa/rsa","hash":"sha256","id":"3031300d060960864801650304020105000420"},"sha384WithRSAEncryption":{"sign":"rsa","hash":"sha384","id":"3041300d060960864801650304020205000430"},"RSA-SHA384":{"sign":"ecdsa/rsa","hash":"sha384","id":"3041300d060960864801650304020205000430"},"sha512WithRSAEncryption":{"sign":"rsa","hash":"sha512","id":"3051300d060960864801650304020305000440"},"RSA-SHA512":{"sign":"ecdsa/rsa","hash":"sha512","id":"3051300d060960864801650304020305000440"},"RSA-SHA1":{"sign":"rsa","hash":"sha1","id":"3021300906052b0e03021a05000414"},"ecdsa-with-SHA1":{"sign":"ecdsa","hash":"sha1","id":""},"sha256":{"sign":"ecdsa","hash":"sha256","id":""},"sha224":{"sign":"ecdsa","hash":"sha224","id":""},"sha384":{"sign":"ecdsa","hash":"sha384","id":""},"sha512":{"sign":"ecdsa","hash":"sha512","id":""},"DSA-SHA":{"sign":"dsa","hash":"sha1","id":""},"DSA-SHA1":{"sign":"dsa","hash":"sha1","id":""},"DSA":{"sign":"dsa","hash":"sha1","id":""},"DSA-WITH-SHA224":{"sign":"dsa","hash":"sha224","id":""},"DSA-SHA224":{"sign":"dsa","hash":"sha224","id":""},"DSA-WITH-SHA256":{"sign":"dsa","hash":"sha256","id":""},"DSA-SHA256":{"sign":"dsa","hash":"sha256","id":""},"DSA-WITH-SHA384":{"sign":"dsa","hash":"sha384","id":""},"DSA-SHA384":{"sign":"dsa","hash":"sha384","id":""},"DSA-WITH-SHA512":{"sign":"dsa","hash":"sha512","id":""},"DSA-SHA512":{"sign":"dsa","hash":"sha512","id":""},"DSA-RIPEMD160":{"sign":"dsa","hash":"rmd160","id":""},"ripemd160WithRSA":{"sign":"rsa","hash":"rmd160","id":"3021300906052b2403020105000414"},"RSA-RIPEMD160":{"sign":"rsa","hash":"rmd160","id":"3021300906052b2403020105000414"},"md5WithRSAEncryption":{"sign":"rsa","hash":"md5","id":"3020300c06082a864886f70d020505000410"},"RSA-MD5":{"sign":"rsa","hash":"md5","id":"3020300c06082a864886f70d020505000410"}}')},function(e,t,i){t.pbkdf2=i(150),t.pbkdf2Sync=i(74)},function(e,t,i){(function(t){var i=Math.pow(2,30)-1;function r(e,i){if("string"!=typeof e&&!t.isBuffer(e))throw new TypeError(i+" must be a buffer or string")}e.exports=function(e,t,s,n){if(r(e,"Password"),r(t,"Salt"),"number"!=typeof s)throw new TypeError("Iterations not a number");if(s<0)throw new TypeError("Bad iterations");if("number"!=typeof n)throw new TypeError("Key length not a number");if(n<0||n>i||n!=n)throw new TypeError("Bad key length")}}).call(this,i(0).Buffer)},function(e,t,i){(function(t){var i;t.browser?i="utf-8":i=parseInt(t.version.split(".")[0].slice(1),10)>=6?"utf-8":"binary";e.exports=i}).call(this,i(9))},function(e,t,i){var r=i(69),s=i(44),n=i(45),a=i(72),o=i(73),h=i(2).Buffer,c=h.alloc(128),d={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,rmd160:20,ripemd160:20};function u(e,t,i){var a=function(e){function t(t){return n(e).update(t).digest()}return"rmd160"===e||"ripemd160"===e?function(e){return(new s).update(e).digest()}:"md5"===e?r:t}(e),o="sha512"===e||"sha384"===e?128:64;t.length>o?t=a(t):t.length<o&&(t=h.concat([t,c],o));for(var u=h.allocUnsafe(o+d[e]),l=h.allocUnsafe(o+d[e]),f=0;f<o;f++)u[f]=54^t[f],l[f]=92^t[f];var p=h.allocUnsafe(o+i+4);u.copy(p,0,0,o),this.ipad1=p,this.ipad2=u,this.opad=l,this.alg=e,this.blocksize=o,this.hash=a,this.size=d[e]}u.prototype.run=function(e,t){return e.copy(t,this.blocksize),this.hash(t).copy(this.opad,this.blocksize),this.hash(this.opad)},e.exports=function(e,t,i,r,s){a(e,t,i,r),h.isBuffer(e)||(e=h.from(e,o)),h.isBuffer(t)||(t=h.from(t,o));var n=new u(s=s||"sha1",e,t.length),c=h.allocUnsafe(r),l=h.allocUnsafe(t.length+4);t.copy(l,0,0,t.length);for(var f=0,p=d[s],m=Math.ceil(r/p),_=1;_<=m;_++){l.writeUInt32BE(_,t.length);for(var g=n.run(l,n.ipad1),y=g,b=1;b<i;b++){y=n.run(y,n.ipad2);for(var v=0;v<p;v++)g[v]^=y[v]}g.copy(c,f),f+=p}return c}},function(e,t,i){"use strict";t.readUInt32BE=function(e,t){return(e[0+t]<<24|e[1+t]<<16|e[2+t]<<8|e[3+t])>>>0},t.writeUInt32BE=function(e,t,i){e[0+i]=t>>>24,e[1+i]=t>>>16&255,e[2+i]=t>>>8&255,e[3+i]=255&t},t.ip=function(e,t,i,r){for(var s=0,n=0,a=6;a>=0;a-=2){for(var o=0;o<=24;o+=8)s<<=1,s|=t>>>o+a&1;for(o=0;o<=24;o+=8)s<<=1,s|=e>>>o+a&1}for(a=6;a>=0;a-=2){for(o=1;o<=25;o+=8)n<<=1,n|=t>>>o+a&1;for(o=1;o<=25;o+=8)n<<=1,n|=e>>>o+a&1}i[r+0]=s>>>0,i[r+1]=n>>>0},t.rip=function(e,t,i,r){for(var s=0,n=0,a=0;a<4;a++)for(var o=24;o>=0;o-=8)s<<=1,s|=t>>>o+a&1,s<<=1,s|=e>>>o+a&1;for(a=4;a<8;a++)for(o=24;o>=0;o-=8)n<<=1,n|=t>>>o+a&1,n<<=1,n|=e>>>o+a&1;i[r+0]=s>>>0,i[r+1]=n>>>0},t.pc1=function(e,t,i,r){for(var s=0,n=0,a=7;a>=5;a--){for(var o=0;o<=24;o+=8)s<<=1,s|=t>>o+a&1;for(o=0;o<=24;o+=8)s<<=1,s|=e>>o+a&1}for(o=0;o<=24;o+=8)s<<=1,s|=t>>o+a&1;for(a=1;a<=3;a++){for(o=0;o<=24;o+=8)n<<=1,n|=t>>o+a&1;for(o=0;o<=24;o+=8)n<<=1,n|=e>>o+a&1}for(o=0;o<=24;o+=8)n<<=1,n|=e>>o+a&1;i[r+0]=s>>>0,i[r+1]=n>>>0},t.r28shl=function(e,t){return e<<t&268435455|e>>>28-t};var r=[14,11,17,4,27,23,25,0,13,22,7,18,5,9,16,24,2,20,12,21,1,8,15,26,15,4,25,19,9,1,26,16,5,11,23,8,12,7,17,0,22,3,10,14,6,20,27,24];t.pc2=function(e,t,i,s){for(var n=0,a=0,o=r.length>>>1,h=0;h<o;h++)n<<=1,n|=e>>>r[h]&1;for(h=o;h<r.length;h++)a<<=1,a|=t>>>r[h]&1;i[s+0]=n>>>0,i[s+1]=a>>>0},t.expand=function(e,t,i){var r=0,s=0;r=(1&e)<<5|e>>>27;for(var n=23;n>=15;n-=4)r<<=6,r|=e>>>n&63;for(n=11;n>=3;n-=4)s|=e>>>n&63,s<<=6;s|=(31&e)<<1|e>>>31,t[i+0]=r>>>0,t[i+1]=s>>>0};var s=[14,0,4,15,13,7,1,4,2,14,15,2,11,13,8,1,3,10,10,6,6,12,12,11,5,9,9,5,0,3,7,8,4,15,1,12,14,8,8,2,13,4,6,9,2,1,11,7,15,5,12,11,9,3,7,14,3,10,10,0,5,6,0,13,15,3,1,13,8,4,14,7,6,15,11,2,3,8,4,14,9,12,7,0,2,1,13,10,12,6,0,9,5,11,10,5,0,13,14,8,7,10,11,1,10,3,4,15,13,4,1,2,5,11,8,6,12,7,6,12,9,0,3,5,2,14,15,9,10,13,0,7,9,0,14,9,6,3,3,4,15,6,5,10,1,2,13,8,12,5,7,14,11,12,4,11,2,15,8,1,13,1,6,10,4,13,9,0,8,6,15,9,3,8,0,7,11,4,1,15,2,14,12,3,5,11,10,5,14,2,7,12,7,13,13,8,14,11,3,5,0,6,6,15,9,0,10,3,1,4,2,7,8,2,5,12,11,1,12,10,4,14,15,9,10,3,6,15,9,0,0,6,12,10,11,1,7,13,13,8,15,9,1,4,3,5,14,11,5,12,2,7,8,2,4,14,2,14,12,11,4,2,1,12,7,4,10,7,11,13,6,1,8,5,5,0,3,15,15,10,13,3,0,9,14,8,9,6,4,11,2,8,1,12,11,7,10,1,13,14,7,2,8,13,15,6,9,15,12,0,5,9,6,10,3,4,0,5,14,3,12,10,1,15,10,4,15,2,9,7,2,12,6,9,8,5,0,6,13,1,3,13,4,14,14,0,7,11,5,3,11,8,9,4,14,3,15,2,5,12,2,9,8,5,12,15,3,10,7,11,0,14,4,1,10,7,1,6,13,0,11,8,6,13,4,13,11,0,2,11,14,7,15,4,0,9,8,1,13,10,3,14,12,3,9,5,7,12,5,2,10,15,6,8,1,6,1,6,4,11,11,13,13,8,12,1,3,4,7,10,14,7,10,9,15,5,6,0,8,15,0,14,5,2,9,3,2,12,13,1,2,15,8,13,4,8,6,10,15,3,11,7,1,4,10,12,9,5,3,6,14,11,5,0,0,14,12,9,7,2,7,2,11,1,4,14,1,7,9,4,12,10,14,8,2,13,0,15,6,12,10,9,13,0,15,3,3,5,5,6,8,11];t.substitute=function(e,t){for(var i=0,r=0;r<4;r++){i<<=4,i|=s[64*r+(e>>>18-6*r&63)]}for(r=0;r<4;r++){i<<=4,i|=s[256+64*r+(t>>>18-6*r&63)]}return i>>>0};var n=[16,25,12,11,3,20,4,15,31,17,9,6,27,14,1,22,30,24,8,18,0,5,29,23,13,19,2,26,10,21,28,7];t.permute=function(e){for(var t=0,i=0;i<n.length;i++)t<<=1,t|=e>>>n[i]&1;return t>>>0},t.padSplit=function(e,t,i){for(var r=e.toString(2);r.length<t;)r="0"+r;for(var s=[],n=0;n<t;n+=i)s.push(r.slice(n,n+i));return s.join(" ")}},function(e,t,i){"use strict";var r=i(7),s=i(1),n=i(75),a=i(46);function o(){this.tmp=new Array(2),this.keys=null}function h(e){a.call(this,e);var t=new o;this._desState=t,this.deriveKeys(t,e.key)}s(h,a),e.exports=h,h.create=function(e){return new h(e)};var c=[1,1,2,2,2,2,2,2,1,2,2,2,2,2,2,1];h.prototype.deriveKeys=function(e,t){e.keys=new Array(32),r.equal(t.length,this.blockSize,"Invalid key length");var i=n.readUInt32BE(t,0),s=n.readUInt32BE(t,4);n.pc1(i,s,e.tmp,0),i=e.tmp[0],s=e.tmp[1];for(var a=0;a<e.keys.length;a+=2){var o=c[a>>>1];i=n.r28shl(i,o),s=n.r28shl(s,o),n.pc2(i,s,e.keys,a)}},h.prototype._update=function(e,t,i,r){var s=this._desState,a=n.readUInt32BE(e,t),o=n.readUInt32BE(e,t+4);n.ip(a,o,s.tmp,0),a=s.tmp[0],o=s.tmp[1],"encrypt"===this.type?this._encrypt(s,a,o,s.tmp,0):this._decrypt(s,a,o,s.tmp,0),a=s.tmp[0],o=s.tmp[1],n.writeUInt32BE(i,a,r),n.writeUInt32BE(i,o,r+4)},h.prototype._pad=function(e,t){for(var i=e.length-t,r=t;r<e.length;r++)e[r]=i;return!0},h.prototype._unpad=function(e){for(var t=e[e.length-1],i=e.length-t;i<e.length;i++)r.equal(e[i],t);return e.slice(0,e.length-t)},h.prototype._encrypt=function(e,t,i,r,s){for(var a=t,o=i,h=0;h<e.keys.length;h+=2){var c=e.keys[h],d=e.keys[h+1];n.expand(o,e.tmp,0),c^=e.tmp[0],d^=e.tmp[1];var u=n.substitute(c,d),l=o;o=(a^n.permute(u))>>>0,a=l}n.rip(o,a,r,s)},h.prototype._decrypt=function(e,t,i,r,s){for(var a=i,o=t,h=e.keys.length-2;h>=0;h-=2){var c=e.keys[h],d=e.keys[h+1];n.expand(a,e.tmp,0),c^=e.tmp[0],d^=e.tmp[1];var u=n.substitute(c,d),l=a;a=(o^n.permute(u))>>>0,o=l}n.rip(a,o,r,s)}},function(e,t,i){var r=i(24),s=i(2).Buffer,n=i(78);function a(e){var t=e._cipher.encryptBlockRaw(e._prev);return n(e._prev),t}t.encrypt=function(e,t){var i=Math.ceil(t.length/16),n=e._cache.length;e._cache=s.concat([e._cache,s.allocUnsafe(16*i)]);for(var o=0;o<i;o++){var h=a(e),c=n+16*o;e._cache.writeUInt32BE(h[0],c+0),e._cache.writeUInt32BE(h[1],c+4),e._cache.writeUInt32BE(h[2],c+8),e._cache.writeUInt32BE(h[3],c+12)}var d=e._cache.slice(0,t.length);return e._cache=e._cache.slice(t.length),r(t,d)}},function(e,t){e.exports=function(e){for(var t,i=e.length;i--;){if(255!==(t=e.readUInt8(i))){t++,e.writeUInt8(t,i);break}e.writeUInt8(0,i)}}},function(e){e.exports=JSON.parse('{"aes-128-ecb":{"cipher":"AES","key":128,"iv":0,"mode":"ECB","type":"block"},"aes-192-ecb":{"cipher":"AES","key":192,"iv":0,"mode":"ECB","type":"block"},"aes-256-ecb":{"cipher":"AES","key":256,"iv":0,"mode":"ECB","type":"block"},"aes-128-cbc":{"cipher":"AES","key":128,"iv":16,"mode":"CBC","type":"block"},"aes-192-cbc":{"cipher":"AES","key":192,"iv":16,"mode":"CBC","type":"block"},"aes-256-cbc":{"cipher":"AES","key":256,"iv":16,"mode":"CBC","type":"block"},"aes128":{"cipher":"AES","key":128,"iv":16,"mode":"CBC","type":"block"},"aes192":{"cipher":"AES","key":192,"iv":16,"mode":"CBC","type":"block"},"aes256":{"cipher":"AES","key":256,"iv":16,"mode":"CBC","type":"block"},"aes-128-cfb":{"cipher":"AES","key":128,"iv":16,"mode":"CFB","type":"stream"},"aes-192-cfb":{"cipher":"AES","key":192,"iv":16,"mode":"CFB","type":"stream"},"aes-256-cfb":{"cipher":"AES","key":256,"iv":16,"mode":"CFB","type":"stream"},"aes-128-cfb8":{"cipher":"AES","key":128,"iv":16,"mode":"CFB8","type":"stream"},"aes-192-cfb8":{"cipher":"AES","key":192,"iv":16,"mode":"CFB8","type":"stream"},"aes-256-cfb8":{"cipher":"AES","key":256,"iv":16,"mode":"CFB8","type":"stream"},"aes-128-cfb1":{"cipher":"AES","key":128,"iv":16,"mode":"CFB1","type":"stream"},"aes-192-cfb1":{"cipher":"AES","key":192,"iv":16,"mode":"CFB1","type":"stream"},"aes-256-cfb1":{"cipher":"AES","key":256,"iv":16,"mode":"CFB1","type":"stream"},"aes-128-ofb":{"cipher":"AES","key":128,"iv":16,"mode":"OFB","type":"stream"},"aes-192-ofb":{"cipher":"AES","key":192,"iv":16,"mode":"OFB","type":"stream"},"aes-256-ofb":{"cipher":"AES","key":256,"iv":16,"mode":"OFB","type":"stream"},"aes-128-ctr":{"cipher":"AES","key":128,"iv":16,"mode":"CTR","type":"stream"},"aes-192-ctr":{"cipher":"AES","key":192,"iv":16,"mode":"CTR","type":"stream"},"aes-256-ctr":{"cipher":"AES","key":256,"iv":16,"mode":"CTR","type":"stream"},"aes-128-gcm":{"cipher":"AES","key":128,"iv":12,"mode":"GCM","type":"auth"},"aes-192-gcm":{"cipher":"AES","key":192,"iv":12,"mode":"GCM","type":"auth"},"aes-256-gcm":{"cipher":"AES","key":256,"iv":12,"mode":"GCM","type":"auth"}}')},function(e,t,i){var r=i(32),s=i(2).Buffer,n=i(16),a=i(1),o=i(163),h=i(24),c=i(78);function d(e,t,i,a){n.call(this);var h=s.alloc(4,0);this._cipher=new r.AES(t);var d=this._cipher.encryptBlock(h);this._ghash=new o(d),i=function(e,t,i){if(12===t.length)return e._finID=s.concat([t,s.from([0,0,0,1])]),s.concat([t,s.from([0,0,0,2])]);var r=new o(i),n=t.length,a=n%16;r.update(t),a&&(a=16-a,r.update(s.alloc(a,0))),r.update(s.alloc(8,0));var h=8*n,d=s.alloc(8);d.writeUIntBE(h,0,8),r.update(d),e._finID=r.state;var u=s.from(e._finID);return c(u),u}(this,i,d),this._prev=s.from(i),this._cache=s.allocUnsafe(0),this._secCache=s.allocUnsafe(0),this._decrypt=a,this._alen=0,this._len=0,this._mode=e,this._authTag=null,this._called=!1}a(d,n),d.prototype._update=function(e){if(!this._called&&this._alen){var t=16-this._alen%16;t<16&&(t=s.alloc(t,0),this._ghash.update(t))}this._called=!0;var i=this._mode.encrypt(this,e);return this._decrypt?this._ghash.update(e):this._ghash.update(i),this._len+=e.length,i},d.prototype._final=function(){if(this._decrypt&&!this._authTag)throw new Error("Unsupported state or unable to authenticate data");var e=h(this._ghash.final(8*this._alen,8*this._len),this._cipher.encryptBlock(this._finID));if(this._decrypt&&function(e,t){var i=0;e.length!==t.length&&i++;for(var r=Math.min(e.length,t.length),s=0;s<r;++s)i+=e[s]^t[s];return i}(e,this._authTag))throw new Error("Unsupported state or unable to authenticate data");this._authTag=e,this._cipher.scrub()},d.prototype.getAuthTag=function(){if(this._decrypt||!s.isBuffer(this._authTag))throw new Error("Attempting to get auth tag in unsupported state");return this._authTag},d.prototype.setAuthTag=function(e){if(!this._decrypt)throw new Error("Attempting to set auth tag in unsupported state");this._authTag=e},d.prototype.setAAD=function(e){if(this._called)throw new Error("Attempting to set AAD in unsupported state");this._ghash.update(e),this._alen+=e.length},e.exports=d},function(e,t,i){var r=i(32),s=i(2).Buffer,n=i(16);function a(e,t,i,a){n.call(this),this._cipher=new r.AES(t),this._prev=s.from(i),this._cache=s.allocUnsafe(0),this._secCache=s.allocUnsafe(0),this._decrypt=a,this._mode=e}i(1)(a,n),a.prototype._update=function(e){return this._mode.encrypt(this,e,this._decrypt)},a.prototype._final=function(){this._cipher.scrub()},e.exports=a},function(e,t,i){var r=i(20);e.exports=y,y.simpleSieve=_,y.fermatTest=g;var s=i(3),n=new s(24),a=new(i(83)),o=new s(1),h=new s(2),c=new s(5),d=(new s(16),new s(8),new s(10)),u=new s(3),l=(new s(7),new s(11)),f=new s(4),p=(new s(12),null);function m(){if(null!==p)return p;var e=[];e[0]=2;for(var t=1,i=3;i<1048576;i+=2){for(var r=Math.ceil(Math.sqrt(i)),s=0;s<t&&e[s]<=r&&i%e[s]!=0;s++);t!==s&&e[s]<=r||(e[t++]=i)}return p=e,e}function _(e){for(var t=m(),i=0;i<t.length;i++)if(0===e.modn(t[i]))return 0===e.cmpn(t[i]);return!0}function g(e){var t=s.mont(e);return 0===h.toRed(t).redPow(e.subn(1)).fromRed().cmpn(1)}function y(e,t){if(e<16)return new s(2===t||5===t?[140,123]:[140,39]);var i,p;for(t=new s(t);;){for(i=new s(r(Math.ceil(e/8)));i.bitLength()>e;)i.ishrn(1);if(i.isEven()&&i.iadd(o),i.testn(1)||i.iadd(h),t.cmp(h)){if(!t.cmp(c))for(;i.mod(d).cmp(u);)i.iadd(f)}else for(;i.mod(n).cmp(l);)i.iadd(f);if(_(p=i.shrn(1))&&_(i)&&g(p)&&g(i)&&a.test(p)&&a.test(i))return i}}},function(e,t,i){var r=i(3),s=i(49);function n(e){this.rand=e||new s.Rand}e.exports=n,n.create=function(e){return new n(e)},n.prototype._randbelow=function(e){var t=e.bitLength(),i=Math.ceil(t/8);do{var s=new r(this.rand.generate(i))}while(s.cmp(e)>=0);return s},n.prototype._randrange=function(e,t){var i=t.sub(e);return e.add(this._randbelow(i))},n.prototype.test=function(e,t,i){var s=e.bitLength(),n=r.mont(e),a=new r(1).toRed(n);t||(t=Math.max(1,s/48|0));for(var o=e.subn(1),h=0;!o.testn(h);h++);for(var c=e.shrn(h),d=o.toRed(n);t>0;t--){var u=this._randrange(new r(2),o);i&&i(u);var l=u.toRed(n).redPow(c);if(0!==l.cmp(a)&&0!==l.cmp(d)){for(var f=1;f<h;f++){if(0===(l=l.redSqr()).cmp(a))return!1;if(0===l.cmp(d))break}if(f===h)return!1}}return!0},n.prototype.getDivisor=function(e,t){var i=e.bitLength(),s=r.mont(e),n=new r(1).toRed(s);t||(t=Math.max(1,i/48|0));for(var a=e.subn(1),o=0;!a.testn(o);o++);for(var h=e.shrn(o),c=a.toRed(s);t>0;t--){var d=this._randrange(new r(2),a),u=e.gcd(d);if(0!==u.cmpn(1))return u;var l=d.toRed(s).redPow(h);if(0!==l.cmp(n)&&0!==l.cmp(c)){for(var f=1;f<o;f++){if(0===(l=l.redSqr()).cmp(n))return l.fromRed().subn(1).gcd(e);if(0===l.cmp(c))break}if(f===o)return(l=l.redSqr()).fromRed().subn(1).gcd(e)}}return!1}},function(e,t,i){"use strict";var r=t;function s(e){return 1===e.length?"0"+e:e}function n(e){for(var t="",i=0;i<e.length;i++)t+=s(e[i].toString(16));return t}r.toArray=function(e,t){if(Array.isArray(e))return e.slice();if(!e)return[];var i=[];if("string"!=typeof e){for(var r=0;r<e.length;r++)i[r]=0|e[r];return i}if("hex"===t){(e=e.replace(/[^a-z0-9]+/gi,"")).length%2!=0&&(e="0"+e);for(r=0;r<e.length;r+=2)i.push(parseInt(e[r]+e[r+1],16))}else for(r=0;r<e.length;r++){var s=e.charCodeAt(r),n=s>>8,a=255&s;n?i.push(n,a):i.push(a)}return i},r.zero2=s,r.toHex=n,r.encode=function(e,t){return"hex"===t?n(e):e}},function(e,t,i){"use strict";var r=t;r.base=i(34),r.short=i(175),r.mont=i(176),r.edwards=i(177)},function(e,t,i){"use strict";var r=i(11).rotr32;function s(e,t,i){return e&t^~e&i}function n(e,t,i){return e&t^e&i^t&i}function a(e,t,i){return e^t^i}t.ft_1=function(e,t,i,r){return 0===e?s(t,i,r):1===e||3===e?a(t,i,r):2===e?n(t,i,r):void 0},t.ch32=s,t.maj32=n,t.p32=a,t.s0_256=function(e){return r(e,2)^r(e,13)^r(e,22)},t.s1_256=function(e){return r(e,6)^r(e,11)^r(e,25)},t.g0_256=function(e){return r(e,7)^r(e,18)^e>>>3},t.g1_256=function(e){return r(e,17)^r(e,19)^e>>>10}},function(e,t,i){"use strict";var r=i(11),s=i(25),n=i(86),a=i(7),o=r.sum32,h=r.sum32_4,c=r.sum32_5,d=n.ch32,u=n.maj32,l=n.s0_256,f=n.s1_256,p=n.g0_256,m=n.g1_256,_=s.BlockHash,g=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function y(){if(!(this instanceof y))return new y;_.call(this),this.h=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],this.k=g,this.W=new Array(64)}r.inherits(y,_),e.exports=y,y.blockSize=512,y.outSize=256,y.hmacStrength=192,y.padLength=64,y.prototype._update=function(e,t){for(var i=this.W,r=0;r<16;r++)i[r]=e[t+r];for(;r<i.length;r++)i[r]=h(m(i[r-2]),i[r-7],p(i[r-15]),i[r-16]);var s=this.h[0],n=this.h[1],_=this.h[2],g=this.h[3],y=this.h[4],b=this.h[5],v=this.h[6],w=this.h[7];for(a(this.k.length===i.length),r=0;r<i.length;r++){var S=c(w,f(y),d(y,b,v),this.k[r],i[r]),E=o(l(s),u(s,n,_));w=v,v=b,b=y,y=o(g,S),g=_,_=n,n=s,s=o(S,E)}this.h[0]=o(this.h[0],s),this.h[1]=o(this.h[1],n),this.h[2]=o(this.h[2],_),this.h[3]=o(this.h[3],g),this.h[4]=o(this.h[4],y),this.h[5]=o(this.h[5],b),this.h[6]=o(this.h[6],v),this.h[7]=o(this.h[7],w)},y.prototype._digest=function(e){return"hex"===e?r.toHex32(this.h,"big"):r.split32(this.h,"big")}},function(e,t,i){"use strict";var r=i(11),s=i(25),n=i(7),a=r.rotr64_hi,o=r.rotr64_lo,h=r.shr64_hi,c=r.shr64_lo,d=r.sum64,u=r.sum64_hi,l=r.sum64_lo,f=r.sum64_4_hi,p=r.sum64_4_lo,m=r.sum64_5_hi,_=r.sum64_5_lo,g=s.BlockHash,y=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function b(){if(!(this instanceof b))return new b;g.call(this),this.h=[1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209],this.k=y,this.W=new Array(160)}function v(e,t,i,r,s){var n=e&i^~e&s;return n<0&&(n+=4294967296),n}function w(e,t,i,r,s,n){var a=t&r^~t&n;return a<0&&(a+=4294967296),a}function S(e,t,i,r,s){var n=e&i^e&s^i&s;return n<0&&(n+=4294967296),n}function E(e,t,i,r,s,n){var a=t&r^t&n^r&n;return a<0&&(a+=4294967296),a}function C(e,t){var i=a(e,t,28)^a(t,e,2)^a(t,e,7);return i<0&&(i+=4294967296),i}function A(e,t){var i=o(e,t,28)^o(t,e,2)^o(t,e,7);return i<0&&(i+=4294967296),i}function I(e,t){var i=a(e,t,14)^a(e,t,18)^a(t,e,9);return i<0&&(i+=4294967296),i}function P(e,t){var i=o(e,t,14)^o(e,t,18)^o(t,e,9);return i<0&&(i+=4294967296),i}function O(e,t){var i=a(e,t,1)^a(e,t,8)^h(e,t,7);return i<0&&(i+=4294967296),i}function R(e,t){var i=o(e,t,1)^o(e,t,8)^c(e,t,7);return i<0&&(i+=4294967296),i}function M(e,t){var i=a(e,t,19)^a(t,e,29)^h(e,t,6);return i<0&&(i+=4294967296),i}function x(e,t){var i=o(e,t,19)^o(t,e,29)^c(e,t,6);return i<0&&(i+=4294967296),i}r.inherits(b,g),e.exports=b,b.blockSize=1024,b.outSize=512,b.hmacStrength=192,b.padLength=128,b.prototype._prepareBlock=function(e,t){for(var i=this.W,r=0;r<32;r++)i[r]=e[t+r];for(;r<i.length;r+=2){var s=M(i[r-4],i[r-3]),n=x(i[r-4],i[r-3]),a=i[r-14],o=i[r-13],h=O(i[r-30],i[r-29]),c=R(i[r-30],i[r-29]),d=i[r-32],u=i[r-31];i[r]=f(s,n,a,o,h,c,d,u),i[r+1]=p(s,n,a,o,h,c,d,u)}},b.prototype._update=function(e,t){this._prepareBlock(e,t);var i=this.W,r=this.h[0],s=this.h[1],a=this.h[2],o=this.h[3],h=this.h[4],c=this.h[5],f=this.h[6],p=this.h[7],g=this.h[8],y=this.h[9],b=this.h[10],O=this.h[11],R=this.h[12],M=this.h[13],x=this.h[14],D=this.h[15];n(this.k.length===i.length);for(var k=0;k<i.length;k+=2){var T=x,B=D,L=I(g,y),N=P(g,y),j=v(g,y,b,O,R),q=w(g,y,b,O,R,M),U=this.k[k],F=this.k[k+1],z=i[k],W=i[k+1],$=m(T,B,L,N,j,q,U,F,z,W),V=_(T,B,L,N,j,q,U,F,z,W);T=C(r,s),B=A(r,s),L=S(r,s,a,o,h),N=E(r,s,a,o,h,c);var G=u(T,B,L,N),H=l(T,B,L,N);x=R,D=M,R=b,M=O,b=g,O=y,g=u(f,p,$,V),y=l(p,p,$,V),f=h,p=c,h=a,c=o,a=r,o=s,r=u($,V,G,H),s=l($,V,G,H)}d(this.h,0,r,s),d(this.h,2,a,o),d(this.h,4,h,c),d(this.h,6,f,p),d(this.h,8,g,y),d(this.h,10,b,O),d(this.h,12,R,M),d(this.h,14,x,D)},b.prototype._digest=function(e){return"hex"===e?r.toHex32(this.h,"big"):r.split32(this.h,"big")}},function(e,t,i){var r=i(1),s=i(27).Reporter,n=i(0).Buffer;function a(e,t){s.call(this,t),n.isBuffer(e)?(this.base=e,this.offset=0,this.length=e.length):this.error("Input not Buffer")}function o(e,t){if(Array.isArray(e))this.length=0,this.value=e.map((function(e){return e instanceof o||(e=new o(e,t)),this.length+=e.length,e}),this);else if("number"==typeof e){if(!(0<=e&&e<=255))return t.error("non-byte EncoderBuffer value");this.value=e,this.length=1}else if("string"==typeof e)this.value=e,this.length=n.byteLength(e);else{if(!n.isBuffer(e))return t.error("Unsupported type: "+typeof e);this.value=e,this.length=e.length}}r(a,s),t.DecoderBuffer=a,a.prototype.save=function(){return{offset:this.offset,reporter:s.prototype.save.call(this)}},a.prototype.restore=function(e){var t=new a(this.base);return t.offset=e.offset,t.length=this.offset,this.offset=e.offset,s.prototype.restore.call(this,e.reporter),t},a.prototype.isEmpty=function(){return this.offset===this.length},a.prototype.readUInt8=function(e){return this.offset+1<=this.length?this.base.readUInt8(this.offset++,!0):this.error(e||"DecoderBuffer overrun")},a.prototype.skip=function(e,t){if(!(this.offset+e<=this.length))return this.error(t||"DecoderBuffer overrun");var i=new a(this.base);return i._reporterState=this._reporterState,i.offset=this.offset,i.length=this.offset+e,this.offset+=e,i},a.prototype.raw=function(e){return this.base.slice(e?e.offset:this.offset,this.length)},t.EncoderBuffer=o,o.prototype.join=function(e,t){return e||(e=new n(this.length)),t||(t=0),0===this.length?e:(Array.isArray(this.value)?this.value.forEach((function(i){i.join(e,t),t+=i.length})):("number"==typeof this.value?e[t]=this.value:"string"==typeof this.value?e.write(this.value,t):n.isBuffer(this.value)&&this.value.copy(e,t),t+=this.length),e)}},function(e,t,i){var r=t;r._reverse=function(e){var t={};return Object.keys(e).forEach((function(i){(0|i)==i&&(i|=0);var r=e[i];t[r]=i})),t},r.der=i(197)},function(e,t,i){var r=i(1),s=i(26),n=s.base,a=s.bignum,o=s.constants.der;function h(e){this.enc="der",this.name=e.name,this.entity=e,this.tree=new c,this.tree._init(e.body)}function c(e){n.Node.call(this,"der",e)}function d(e,t){var i=e.readUInt8(t);if(e.isError(i))return i;var r=o.tagClass[i>>6],s=0==(32&i);if(31==(31&i)){var n=i;for(i=0;128==(128&n);){if(n=e.readUInt8(t),e.isError(n))return n;i<<=7,i|=127&n}}else i&=31;return{cls:r,primitive:s,tag:i,tagStr:o.tag[i]}}function u(e,t,i){var r=e.readUInt8(i);if(e.isError(r))return r;if(!t&&128===r)return null;if(0==(128&r))return r;var s=127&r;if(s>4)return e.error("length octect is too long");r=0;for(var n=0;n<s;n++){r<<=8;var a=e.readUInt8(i);if(e.isError(a))return a;r|=a}return r}e.exports=h,h.prototype.decode=function(e,t){return e instanceof n.DecoderBuffer||(e=new n.DecoderBuffer(e,t)),this.tree._decode(e,t)},r(c,n.Node),c.prototype._peekTag=function(e,t,i){if(e.isEmpty())return!1;var r=e.save(),s=d(e,'Failed to peek tag: "'+t+'"');return e.isError(s)?s:(e.restore(r),s.tag===t||s.tagStr===t||s.tagStr+"of"===t||i)},c.prototype._decodeTag=function(e,t,i){var r=d(e,'Failed to decode tag of "'+t+'"');if(e.isError(r))return r;var s=u(e,r.primitive,'Failed to get length of "'+t+'"');if(e.isError(s))return s;if(!i&&r.tag!==t&&r.tagStr!==t&&r.tagStr+"of"!==t)return e.error('Failed to match tag: "'+t+'"');if(r.primitive||null!==s)return e.skip(s,'Failed to match body of: "'+t+'"');var n=e.save(),a=this._skipUntilEnd(e,'Failed to skip indefinite length body: "'+this.tag+'"');return e.isError(a)?a:(s=e.offset-n.offset,e.restore(n),e.skip(s,'Failed to match body of: "'+t+'"'))},c.prototype._skipUntilEnd=function(e,t){for(;;){var i=d(e,t);if(e.isError(i))return i;var r,s=u(e,i.primitive,t);if(e.isError(s))return s;if(r=i.primitive||null!==s?e.skip(s):this._skipUntilEnd(e,t),e.isError(r))return r;if("end"===i.tagStr)break}},c.prototype._decodeList=function(e,t,i,r){for(var s=[];!e.isEmpty();){var n=this._peekTag(e,"end");if(e.isError(n))return n;var a=i.decode(e,"der",r);if(e.isError(a)&&n)break;s.push(a)}return s},c.prototype._decodeStr=function(e,t){if("bitstr"===t){var i=e.readUInt8();return e.isError(i)?i:{unused:i,data:e.raw()}}if("bmpstr"===t){var r=e.raw();if(r.length%2==1)return e.error("Decoding of string type: bmpstr length mismatch");for(var s="",n=0;n<r.length/2;n++)s+=String.fromCharCode(r.readUInt16BE(2*n));return s}if("numstr"===t){var a=e.raw().toString("ascii");return this._isNumstr(a)?a:e.error("Decoding of string type: numstr unsupported characters")}if("octstr"===t)return e.raw();if("objDesc"===t)return e.raw();if("printstr"===t){var o=e.raw().toString("ascii");return this._isPrintstr(o)?o:e.error("Decoding of string type: printstr unsupported characters")}return/str$/.test(t)?e.raw().toString():e.error("Decoding of string type: "+t+" unsupported")},c.prototype._decodeObjid=function(e,t,i){for(var r,s=[],n=0;!e.isEmpty();){var a=e.readUInt8();n<<=7,n|=127&a,0==(128&a)&&(s.push(n),n=0)}128&a&&s.push(n);var o=s[0]/40|0,h=s[0]%40;if(r=i?s:[o,h].concat(s.slice(1)),t){var c=t[r.join(" ")];void 0===c&&(c=t[r.join(".")]),void 0!==c&&(r=c)}return r},c.prototype._decodeTime=function(e,t){var i=e.raw().toString();if("gentime"===t)var r=0|i.slice(0,4),s=0|i.slice(4,6),n=0|i.slice(6,8),a=0|i.slice(8,10),o=0|i.slice(10,12),h=0|i.slice(12,14);else{if("utctime"!==t)return e.error("Decoding "+t+" time is not supported yet");r=0|i.slice(0,2),s=0|i.slice(2,4),n=0|i.slice(4,6),a=0|i.slice(6,8),o=0|i.slice(8,10),h=0|i.slice(10,12);r=r<70?2e3+r:1900+r}return Date.UTC(r,s-1,n,a,o,h,0)},c.prototype._decodeNull=function(e){return null},c.prototype._decodeBool=function(e){var t=e.readUInt8();return e.isError(t)?t:0!==t},c.prototype._decodeInt=function(e,t){var i=e.raw(),r=new a(i);return t&&(r=t[r.toString(10)]||r),r},c.prototype._use=function(e,t){return"function"==typeof e&&(e=e(t)),e._getDecoder("der").tree}},function(e,t,i){var r=i(1),s=i(0).Buffer,n=i(26),a=n.base,o=n.constants.der;function h(e){this.enc="der",this.name=e.name,this.entity=e,this.tree=new c,this.tree._init(e.body)}function c(e){a.Node.call(this,"der",e)}function d(e){return e<10?"0"+e:e}e.exports=h,h.prototype.encode=function(e,t){return this.tree._encode(e,t).join()},r(c,a.Node),c.prototype._encodeComposite=function(e,t,i,r){var n,a=function(e,t,i,r){var s;"seqof"===e?e="seq":"setof"===e&&(e="set");if(o.tagByName.hasOwnProperty(e))s=o.tagByName[e];else{if("number"!=typeof e||(0|e)!==e)return r.error("Unknown tag: "+e);s=e}if(s>=31)return r.error("Multi-octet tag encoding unsupported");t||(s|=32);return s|=o.tagClassByName[i||"universal"]<<6}(e,t,i,this.reporter);if(r.length<128)return(n=new s(2))[0]=a,n[1]=r.length,this._createEncoderBuffer([n,r]);for(var h=1,c=r.length;c>=256;c>>=8)h++;(n=new s(2+h))[0]=a,n[1]=128|h;c=1+h;for(var d=r.length;d>0;c--,d>>=8)n[c]=255&d;return this._createEncoderBuffer([n,r])},c.prototype._encodeStr=function(e,t){if("bitstr"===t)return this._createEncoderBuffer([0|e.unused,e.data]);if("bmpstr"===t){for(var i=new s(2*e.length),r=0;r<e.length;r++)i.writeUInt16BE(e.charCodeAt(r),2*r);return this._createEncoderBuffer(i)}return"numstr"===t?this._isNumstr(e)?this._createEncoderBuffer(e):this.reporter.error("Encoding of string type: numstr supports only digits and space"):"printstr"===t?this._isPrintstr(e)?this._createEncoderBuffer(e):this.reporter.error("Encoding of string type: printstr supports only latin upper and lower case letters, digits, space, apostrophe, left and rigth parenthesis, plus sign, comma, hyphen, dot, slash, colon, equal sign, question mark"):/str$/.test(t)?this._createEncoderBuffer(e):"objDesc"===t?this._createEncoderBuffer(e):this.reporter.error("Encoding of string type: "+t+" unsupported")},c.prototype._encodeObjid=function(e,t,i){if("string"==typeof e){if(!t)return this.reporter.error("string objid given, but no values map found");if(!t.hasOwnProperty(e))return this.reporter.error("objid not found in values map");e=t[e].split(/[\s\.]+/g);for(var r=0;r<e.length;r++)e[r]|=0}else if(Array.isArray(e)){e=e.slice();for(r=0;r<e.length;r++)e[r]|=0}if(!Array.isArray(e))return this.reporter.error("objid() should be either array or string, got: "+JSON.stringify(e));if(!i){if(e[1]>=40)return this.reporter.error("Second objid identifier OOB");e.splice(0,2,40*e[0]+e[1])}var n=0;for(r=0;r<e.length;r++){var a=e[r];for(n++;a>=128;a>>=7)n++}var o=new s(n),h=o.length-1;for(r=e.length-1;r>=0;r--){a=e[r];for(o[h--]=127&a;(a>>=7)>0;)o[h--]=128|127&a}return this._createEncoderBuffer(o)},c.prototype._encodeTime=function(e,t){var i,r=new Date(e);return"gentime"===t?i=[d(r.getFullYear()),d(r.getUTCMonth()+1),d(r.getUTCDate()),d(r.getUTCHours()),d(r.getUTCMinutes()),d(r.getUTCSeconds()),"Z"].join(""):"utctime"===t?i=[d(r.getFullYear()%100),d(r.getUTCMonth()+1),d(r.getUTCDate()),d(r.getUTCHours()),d(r.getUTCMinutes()),d(r.getUTCSeconds()),"Z"].join(""):this.reporter.error("Encoding "+t+" time is not supported yet"),this._encodeStr(i,"octstr")},c.prototype._encodeNull=function(){return this._createEncoderBuffer("")},c.prototype._encodeInt=function(e,t){if("string"==typeof e){if(!t)return this.reporter.error("String int or enum given, but no values map");if(!t.hasOwnProperty(e))return this.reporter.error("Values map doesn't contain: "+JSON.stringify(e));e=t[e]}if("number"!=typeof e&&!s.isBuffer(e)){var i=e.toArray();!e.sign&&128&i[0]&&i.unshift(0),e=new s(i)}if(s.isBuffer(e)){var r=e.length;0===e.length&&r++;var n=new s(r);return e.copy(n),0===e.length&&(n[0]=0),this._createEncoderBuffer(n)}if(e<128)return this._createEncoderBuffer(e);if(e<256)return this._createEncoderBuffer([0,e]);r=1;for(var a=e;a>=256;a>>=8)r++;for(a=(n=new Array(r)).length-1;a>=0;a--)n[a]=255&e,e>>=8;return 128&n[0]&&n.unshift(0),this._createEncoderBuffer(new s(n))},c.prototype._encodeBool=function(e){return this._createEncoderBuffer(e?255:0)},c.prototype._use=function(e,t){return"function"==typeof e&&(e=e(t)),e._getEncoder("der").tree},c.prototype._skipDefault=function(e,t,i){var r,s=this._baseState;if(null===s.default)return!1;var n=e.join();if(void 0===s.defaultBuffer&&(s.defaultBuffer=this._encodeValue(s.default,t,i).join()),n.length!==s.defaultBuffer.length)return!1;for(r=0;r<n.length;r++)if(n[r]!==s.defaultBuffer[r])return!1;return!0}},function(e){e.exports=JSON.parse('{"1.3.132.0.10":"secp256k1","1.3.132.0.33":"p224","1.2.840.10045.3.1.1":"p192","1.2.840.10045.3.1.7":"p256","1.3.132.0.34":"p384","1.3.132.0.35":"p521"}')},function(e,t,i){var r=i(22),s=i(2).Buffer;function n(e){var t=s.allocUnsafe(4);return t.writeUInt32BE(e,0),t}e.exports=function(e,t){for(var i,a=s.alloc(0),o=0;a.length<t;)i=n(o++),a=s.concat([a,r("sha1").update(e).update(i).digest()]);return a.slice(0,t)}},function(e,t){e.exports=function(e,t){for(var i=e.length,r=-1;++r<i;)e[r]^=t[r];return e}},function(e,t,i){var r=i(3),s=i(2).Buffer;e.exports=function(e,t){return s.from(e.toRed(r.mont(t.modulus)).redPow(new r(t.publicExponent)).fromRed().toArray())}},function(e,t,i){"use strict";(function(e){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(98)),n=r(i(99));class a extends n.default{constructor(e){super(e),this._maxValueSize=null,this._updateValueCallback=null,Array.isArray(e.properties)||"string"!=typeof e.properties?this.properties=e.properties||[]:this.properties=[e.properties]}get parentName(){return"service"}get childrenClass(){return s.default}get childrenName(){return"descriptors"}get descriptors(){return this.children}addDescriptor(e){return this.addChild(e)}getDescriptor(e){return this.getChild(e)}toJSON(){const e=super.toJSON();return this.properties.length>0&&(e.properties=this.properties),e}toBufferObj(){const e=super.toBufferObj();return e.properties=this.properties,e.secure=[],e}addProperty(e){this.properties.includes(e)||this.properties.push(e)}removeProperty(e){this.properties=this.properties.filter(t=>t!==e)}emit(e,...t){const i=super.emit(e,...t);if(i)return i;switch(e){case"subscribe":return this._onSubscribe(...t),!0;case"unsubscribe":return this._onUnsubscribe(),!0;case"notify":return this._onNotify(),!0;case"indicate":return this._onIndicate(),!0;default:throw new Error("unknown emit")}}_onSubscribe(e,t){this._maxValueSize=e,this._updateValueCallback=t}_onUnsubscribe(){this._maxValueSize=null,this._updateValueCallback=null}_onNotify(){}_onIndicate(){}notify(){this._updateValueCallback&&this._updateValueCallback(e.from(this.data))}}t.default=a}).call(this,i(0).Buffer)},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(99));class n extends s.default{constructor(e){super(e)}get parentName(){return"characteristic"}toJSON(){return super.toJSON()}}t.default=n},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(100));class n extends s.default{constructor(e){super(e)}write(e){this.data=e,this.notifyFromServer("onwrite",{result:"success"})}read(){this.notifyFromServer("onread",{data:this.data})}writeWait(e){return super.writeWait(e)}readWait(){return super.readWait()}}t.default=n},function(e,t,i){"use strict";(function(e){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(101)),n=r(i(18));var a;!function(e){e[e.SUCCESS=0]="SUCCESS",e[e.INVALID_OFFSET=7]="INVALID_OFFSET",e[e.ATTR_NOT_LONG=11]="ATTR_NOT_LONG",e[e.INVALID_ATTRIBUTE_LENGTH=13]="INVALID_ATTRIBUTE_LENGTH",e[e.UNLIKELY_ERROR=14]="UNLIKELY_ERROR"}(a||(a={}));class o extends s.default{constructor(e){super(e)}toBufferObj(){const e={uuid:n.default.uuidFilter(this.uuid)};if(this.childrenName){e[this.childrenName]=this.children.map(e=>e.toBufferObj())}return e.emit=this.emit.bind(this),e}emit(e,...t){switch(e){case"readRequest":return this._onReadRequest(...t),!0;case"writeRequest":return this._onWriteRequest(...t),!0}return!1}_onReadRequest(t,i){if(this.data.length>=t){i(a.SUCCESS,e.from(this.data.slice(t)));let r=null;"characteristic"===this.parentName?r=this.characteristic.service.peripheral.currentConnectedDeviceAddress:"service"===this.parentName&&(r=this.service.peripheral.currentConnectedDeviceAddress),this.notifyFromServer("onreadfromremote",{address:r})}else i(a.UNLIKELY_ERROR,null)}_onWriteRequest(e,t,i,r){this.data=Array.from(e),r(a.SUCCESS);let s=null;"characteristic"===this.parentName?s=this.characteristic.service.peripheral.currentConnectedDeviceAddress:"service"===this.parentName&&(s=this.service.peripheral.currentConnectedDeviceAddress),this.notifyFromServer("onwritefromremote",{address:s,data:e})}write(e){this.data=e,this.notifyFromServer("onwrite",{result:"success"})}read(){this.notifyFromServer("onread",{data:this.data})}}t.default=o}).call(this,i(0).Buffer)},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(14)),n=r(i(6)),a=r(i(18));t.default=class{constructor(e){if(this.uuid=a.default.uuidFilter(e.uuid),this.parent=null,this.children=[],this.isRemote=!1,this.discoverdOnRemote=!1,this.data=e.data||null,!this.data&&e.text&&(this.data=n.default.string2dataArray(e.text)),!this.data&&e.value&&(this.data=[e.value]),e[this.childrenName])for(const t of e[this.childrenName])this.addChild(t);this.setFunctions(),this.emitter=new s.default}get childrenClass(){return Object}get childrenName(){return null}get parentName(){return null}addChild(e){if(!(e instanceof this.childrenClass)){e=new(0,this.childrenClass)(e)}const t=e;return t.parent=this,this.children.push(t),t}getChild(e){e=a.default.uuidFilter(e);const t=this.children.filter(t=>a.default.uuidFilter(t.uuid)===e).shift();return t||null}toJSON(){const e={uuid:a.default.uuidFilter(this.uuid)};if(this.childrenName){e[this.childrenName]=this.children}return this.data&&(e.data=this.data),e}read(){}write(e,t){}writeNumber(e,t){this.write([e],t)}writeText(e,t){this.write(n.default.string2dataArray(e),t)}readWait(){return new Promise((e,t)=>{this.emitter.once("onread",i=>{"success"===i.result?e(i.data):t(new Error("readWait failed"))}),this.read()})}writeWait(e,t){return new Promise((i,r)=>{this.emitter.once("onwrite",e=>{"success"===e.result?i(!0):r(new Error("writeWait failed"))}),this.write(e,t)})}writeTextWait(e,t){return new Promise((i,r)=>{this.emitter.once("onwrite",e=>{"success"===e.result?i(!0):r(new Error("writeTextWait failed"))}),this.writeText(e,t)})}writeNumberWait(e,t){return new Promise((i,r)=>{this.emitter.once("onwrite",e=>{"success"===e.result?i(!0):r(new Error("writeNumberWait failed"))}),this.writeNumber(e,t)})}readFromRemoteWait(){return new Promise(e=>{this.emitter.once("onreadfromremote",()=>{e()})})}writeFromRemoteWait(){return new Promise(e=>{this.emitter.once("onreadfromremote",t=>{e(t.data)})})}onerror(e){console.error(e.message)}notifyFromServer(e,t){switch(this.emitter.emit(e,t),e){case"onerror":this.onerror(t);break;case"onwrite":this.onwrite&&this.onwrite(t.result);break;case"onread":this.onread&&this.onread(t.data);break;case"onwritefromremote":this.onwritefromremote&&this.onwritefromremote(t.address,t.data);break;case"onreadfromremote":this.onreadfromremote&&this.onreadfromremote(t.address)}}setFunctions(){let e=this.childrenName;if(e){e=e.charAt(0).toUpperCase()+e.slice(1);const t=e.slice(0,-1);let i="add"+t;this[i]=this.addChild,i="get"+t,this[i]=this.getChild}const t=this.parentName;t&&Object.defineProperty(this,t,{get(){return this.parent},set(e){this.parent=e}})}}},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(97)),n=r(i(100));class a extends n.default{constructor(e){super(e),this.addCharacteristic=this.addChild,this.getCharacteristic=this.getChild}addCharacteristic(e){return this.addChild(e)}getCharacteristic(e){return this.getChild(e)}get parentName(){return"peripheral"}get childrenName(){return"characteristics"}get childrenClass(){return s.default}get characteristics(){return this.children}get advData(){return{flags:["general_discoverable_mode","br_edr_not_supported"],serviceUuids:[this.uuid]}}end(){this.peripheral.removeService(this.uuid)}notify(e,t){}}t.default=a},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(101));class n extends s.default{constructor(e){super(e),this.isRemote=!1,this.discoverdOnRemote=!1}get wsChildUuidName(){const e=this.childrenName;return e?e.slice(0,-1)+"_uuid":null}discoverChildren(){}discoverChildrenWait(){return new Promise(e=>{this.emitter.once("discoverfinished",()=>{const t=this.children.filter(e=>e.discoverdOnRemote);e(t)}),this.discoverChildren()})}ondiscover(e){}ondiscoverfinished(e){}notifyFromServer(e,t){switch(super.notifyFromServer(e,t),e){case"discover":{const e=t[this.wsChildUuidName];let i=this.getChild(e);i||(i=this.addChild({uuid:e})),i.discoverdOnRemote=!0,i.properties=t.properties||[],this.ondiscover(i);break}case"discoverfinished":{const e=this.children.filter(e=>e.discoverdOnRemote);this.ondiscoverfinished(e);break}}}}t.default=n},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(103));class n extends s.default{writeNumber(e,t){return super.writeNumber(e,t)}writeText(e,t){return super.writeText(e,t)}readWait(){return super.readWait()}writeWait(e,t){return super.writeWait(e,t)}writeTextWait(e,t){return super.writeTextWait(e,t)}writeNumberWait(e,t){return super.writeNumberWait(e,t)}}t.default=n},function(e,t){e.exports={name:"obniz",version:"3.3.0",description:"obniz sdk for javascript",main:"./dist/src/obniz/index.js",types:"./dist/src/obniz/index.d.ts",files:["dist","!dist/**/*.map","index.js","obniz.js","obniz.min.js"],engines:{node:">=8.17.0"},engineStrict:!0,scripts:{test:"npm run tstest && nyc --reporter=text --reporter=html mocha $NODE_DEBUG_OPTION  ./test/functiontest/index.js -b 1",testOnlyNodejs:"NO_BROWSER_TEST=1 npm test",buildAndtest:"npm run build && npm test",tstest:"mocha --require espower-typescript/guess test/functiontest/**/*.ts",tsExampleTest:"tsc --project ./test/functiontest",realtest:"mocha $NODE_DEBUG_OPTION ./test/realtest/index.js","realtest-debug":"DEBUG=1 mocha $NODE_DEBUG_OPTION -b ./test/realtest/index.js",local:"gulp --gulpfile devtools/_tools/server.js --cwd .",build:"npm run clean && npm run lint && gulp --gulpfile devtools/_tools/server.js --cwd . build && npm run doc",doc:"typedoc --includes ./src/ --theme ./devtools/typedocTheme --stripInternal --readme none --out docs/obnizjs --excludePrivate --excludeProtected  --media ./docs/images","build-ts":"npm run clean && npm run lint-ts && gulp --gulpfile devtools/_tools/server.js --cwd . build",version:"npm run build && git add obniz.js && git add obniz.min.js",lint:"npm run lint-ts && npm run lint-js","lint-js":"eslint --fix . --rulesdir devtools/eslint/rule","lint-ts":"tslint --fix -c tslint.json 'src/**/*.ts' 'test/**/*.ts' ",precommit:"lint-staged && npm run build && git add obniz.js && git add obniz.min.js",clean:"rimraf ./dist ./obniz.js ./obniz.min.js ./obniz.d.ts"},"lint-staged":{"src/**/*.js":["eslint --rulesdir devtools/eslint/rule --fix ","git add"],"src/**/*.ts":["tslint -c tslint.json --fix ","git add"]},keywords:["obniz"],repository:"obniz/obniz",author:"yukisato <yuki@yuki-sato.com>",homepage:"https://obniz.io/",license:"SEE LICENSE IN LICENSE.txt",devDependencies:{"@types/chai":"^4.2.7","@types/chai-like":"^1.1.0","@types/events":"^3.0.0","@types/glob":"^7.1.1","@types/minimatch":"^3.0.3","@types/mocha":"^5.2.7","@types/sinon":"^7.5.1","@types/webpack-env":"^1.15.0","@types/window-or-global":"^1.0.0",chai:"^4.2.0","chai-like":"^1.1.1",child_process:"^1.0.2","concat-with-sourcemaps":"^1.1.0",ejs:"^2.6.2",eslint:"^5.16.0","eslint-config-prettier":"^3.6.0","eslint-plugin-jasmine":"^2.10.1","eslint-plugin-prettier":"^2.7.0","espower-typescript":"^9.0.2",express:"^4.17.1","get-port":"^4.0.0",glob:"^7.1.3",gulp:"^4.0.2","gulp-concat":"^2.6.1","gulp-ejs":"^3.2.0","gulp-filter":"^5.1.0","gulp-plumber":"^1.2.0","gulp-rename":"^1.4.0","gulp-sort":"^2.0.0","gulp-sourcemaps":"^2.6.5","gulp-typescript":"^6.0.0-alpha.1","gulp-yaml":"^2.0.2",husky:"^0.14.3","json-loader":"^0.5.7","lint-staged":"^9.4.1",mocha:"^5.2.0","mocha-chrome":"^2.2.0","mocha-directory":"^2.3.0","mocha-sinon":"^2.1.0",natives:"^1.1.6",ncp:"^2.0.0","node-notifier":"^5.3.0",nyc:"^14.1.1",path:"^0.12.7","plugin-error":"^1.0.1","power-assert":"^1.6.1",prettier:"^1.14.3",sinon:"^7.5.0","text-encoding":"^0.7.0",through2:"^2.0.3",tslint:"^5.20.1",typescript:"^3.7.5",typedoc:"^0.16.9","typedoc-plugin-external-module-name":"^3.0.0",vinyl:"^2.2.0",webpack:"^4.34.0","webpack-cli":"^3.3.4","webpack-node-externals":"^1.7.2","webpack-stream":"^5.2.1","yaml-loader":"^0.5.0"},dependencies:{"@types/eventemitter3":"^1.2.0","@types/js-yaml":"^3.12.1","@types/node":"^13.1.5","@types/node-dir":"0.0.33","@types/node-fetch":"^2.5.4","@types/semver":"^6.2.0","@types/tv4":"^1.2.29","@types/ws":"^6.0.4",eventemitter3:"^3.1.2","js-yaml":"^3.13.1","node-dir":"^0.1.17","node-fetch":"^2.3.0",semver:"^5.7.0",tsc:"^1.20150623.0",tv4:"^1.3.0","typedoc-plugin-internal-external":"^2.1.1",ws:"^6.1.4"},bugs:{url:"https://forum.obniz.io"},private:!1,browser:{fs:!1,ws:"./dist/src/obniz/libs/webpackReplace/ws",canvas:"./dist/src/obniz/libs/webpackReplace/canvas","./dist/src/obniz/libs/webpackReplace/require-context":"./dist/src/obniz/libs/webpackReplace/require-context-browser"}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={}},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(5)),n={0:"unknown error",1:"heavy output. output voltage is too low when driving high",2:"heavy output. output voltage is too high when driving low",3:"output voltage is too low when driving high. io state has changed output to input",4:"output voltage is too high when driving low. io state has changed output to input"},a={1:"io.input",2:"io.output",3:"pwm",4:"uart",5:"i2c",6:"spi",7:"LogicAnalyzer",8:"Measure"};class o extends s.default{constructor(){super(),this.module=2,this._CommandOutput=0,this._CommandInputStream=1,this._CommandInputOnece=2,this._CommandOutputType=3,this._CommandPullResisterType=4,this._CommandEnd=5}output(e,t){const i=new Uint8Array([t,e]);this.sendCommand(this._CommandOutput,i)}outputDetail(e,t){const i=new Uint8Array([t,e.value]);this.sendCommand(this._CommandOutput,i)}input(e,t){const i=new Uint8Array([t]);this.sendCommand(this._CommandInputOnece,i)}inputDetail(e,t){const i=new Uint8Array([t]);this.sendCommand(e.stream?this._CommandInputStream:this._CommandInputOnece,i)}outputType(e,t){const i=new Uint8Array(2);if(i[0]=t,"push-pull5v"===e.output_type)i[1]=0;else if("push-pull3v"===e.output_type)i[1]=2;else{if("open-drain"!==e.output_type)return"io unknown outputtype: "+e.output_type;i[1]=3}this.sendCommand(this._CommandOutputType,i)}pullType(e,t){const i=new Uint8Array(2);if(i[0]=t,"float"===e.pull_type)i[1]=0;else if("pull-up3v"===e.pull_type)i[1]=1;else if("pull-down"===e.pull_type)i[1]=2;else{if("pull-up5v"!==e.pull_type)return"io unknown pull_type: "+e.pull_type;i[1]=3}this.sendCommand(this._CommandPullResisterType,i)}deinit(e,t){const i=new Uint8Array([t]);this.sendCommand(this._CommandEnd,i)}parseFromJson(e){for(let t=0;t<40;t++){const i=e["io"+t];if(void 0===i)continue;const r=[{uri:"/request/io/input",onValid:this.input},{uri:"/request/io/input_detail",onValid:this.inputDetail},{uri:"/request/io/output",onValid:this.output},{uri:"/request/io/output_detail",onValid:this.outputDetail},{uri:"/request/io/output_type",onValid:this.outputType},{uri:"/request/io/pull_type",onValid:this.pullType},{uri:"/request/io/deinit",onValid:this.deinit}],s=this.validateCommandSchema(r,i,"io"+t,t);if(0===s.valid)throw s.invalidButLike.length>0?new Error(s.invalidButLike[0].message):new this.WSCommandNotFoundError(`[io${t}]unknown command`)}}notifyFromBinary(e,t,i){if(t===this._CommandInputStream||t===this._CommandInputOnece)for(let t=0;t<i.byteLength;t+=2)e["io"+i[t]]=i[t+1]>0;else if(t===this.COMMAND_FUNC_ID_ERROR&&i.byteLength>=4){const t=i[1],r=i[3];if(1===t||2===t)this.envelopWarning(e,`io${r}`,{message:n[t]});else if(3===t||4===t)this.envelopError(e,`io${r}`,{message:n[t]});else if(240===t&&i.byteLength>=6){const t=i[4],s=i[5];this.envelopWarning(e,"debug",{message:`io${r} binded "${a[t]}" was stopped. "${a[s]}" have started using this io.`})}}else super.notifyFromBinary(e,t,i)}}t.default=o},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(5));class n extends s.default{constructor(){super(),this.module=3,this.ModuleNum=6,this.resetInternalStatus(),this._CommandInit=0,this._CommandDeinit=1,this._CommandSetFreq=2,this._CommandSetDuty=3,this._CommandAMModulate=4}resetInternalStatus(){this.pwms=[];for(let e=0;e<this.ModuleNum;e++)this.pwms.push({})}init(e,t){const i=new Uint8Array(2);i[0]=t,i[1]=e.io,this.pwms[t].io=e.io,this.sendCommand(this._CommandInit,i)}deinit(e,t){const i=new Uint8Array(1);i[0]=t,this.pwms[t]={},this.sendCommand(this._CommandDeinit,i)}freq(e,t){const i=new Uint8Array(5);i[0]=t,i[1]=e.freq>>24,i[2]=e.freq>>16,i[3]=e.freq>>8,i[4]=e.freq,this.pwms[t].freq=e.freq,this.sendCommand(this._CommandSetFreq,i)}pulse(e,t){const i=new Uint8Array(5),r=1e3*e.pulse;i[0]=t,i[1]=r>>24,i[2]=r>>16,i[3]=r>>8,i[4]=r,this.pwms[t].pulseUSec=r,this.sendCommand(this._CommandSetDuty,i)}amModulate(e,t){const i=e.modulate.data.length,r=Math.floor((i+7)/8),s=new Uint8Array(5+r),n=1e3*e.modulate.symbol_length;s[0]=t,s[1]=n>>24,s[2]=n>>16,s[3]=n>>8,s[4]=n;let a=0;for(let t=0;t<r;t++){s[5+t]=0;for(let i=0;i<8;i++)e.modulate.data[a++]&&(s[5+t]|=128>>>i)}this.sendCommand(this._CommandAMModulate,s)}parseFromJson(e){for(let t=0;t<this.ModuleNum;t++){const i=e["pwm"+t];if(void 0===i)continue;const r=[{uri:"/request/pwm/init",onValid:this.init},{uri:"/request/pwm/freq",onValid:this.freq},{uri:"/request/pwm/pulse",onValid:this.pulse},{uri:"/request/pwm/modulate",onValid:this.amModulate},{uri:"/request/pwm/deinit",onValid:this.deinit}],s=this.validateCommandSchema(r,i,"pwm"+t,t);if(0===s.valid)throw s.invalidButLike.length>0?new Error(s.invalidButLike[0].message):new this.WSCommandNotFoundError(`[pwm${t}]unknown command`)}}}t.default=n},function(e,t,i){"use strict";(function(t){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};const s=i(110),n=r(i(54));class a extends n.default{static get api(){return h.default}}a.M5StickC=s.M5StickC;try{if("undefined"!=typeof window){window&&window.parent&&window.parent.userAppLoaded&&window.parent.userAppLoaded(window)}}catch(e){e instanceof DOMException||console.error(e)}const o=i(106),h=r(i(439));i(441).context=o.default,o.setBaseDir&&o.setBaseDir(t);const c=i(442);for(const e of c.keys()){const t=c(e);t.info?a.PartsRegistrate(t):t.default.info&&a.PartsRegistrate(t.default)}e.exports=a}).call(this,"/")},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(i(54));class a extends n.default{constructor(e,t){super(e,t)}gyroWait(){const e=["MPU6886","SH200Q"];if(!e.includes(this.imu.constructor.name))throw new Error(`gyroWait is supported only on M5stickC with ${e.join()}`);return this.imu.getGyroWait()}accelerationWait(){const e=["MPU6886","SH200Q"];if(!e.includes(this.imu.constructor.name))throw new Error(`accelerationWait is supported only on M5stickC with ${e.join()}`);return this.imu.getAccelWait()}setupIMUWait(e="MPU6886"){const t=this._m5i2c,i=t.onerror;this.imu=this.wired(e,{i2c:t}),this.imu._reset=()=>{};const s=this.imu.whoamiWait(),n=new Promise((e,i)=>{t.onerror=i});return Promise.race([s,n]).then(s=>r(this,void 0,void 0,(function*(){if(t.onerror=i,!s)throw new Error(`Cannot find IMU (${e}) on this M5StickC`);switch(e){case"SH200Q":yield this.imu.initWait();break;case"MPU6886":this.imu.init()}return this.imu})))}_prepareComponents(){super._prepareComponents(),this.ir=this.wired("InfraredLED",{anode:9}),this.led=this.wired("LED",{cathode:10}),this.buttonA=this.wired("Button",{signal:37}),this.buttonB=this.wired("Button",{signal:39});this._m5i2c=this.i2c1,this._m5i2c.start({sda:21,scl:22,clock:1e5,pull:"3v",mode:"master"}),this.axp=this.wired("AXP192",{i2c:this._m5i2c}),this.led.off(),this._addToAllComponentKeys()}_addToAllComponentKeys(){const e=["buttonA","buttonB","ir","led","axp","imu"];for(const t of e)this._allComponentKeys.push(t),this[t]&&!this[t]._reset&&(this[t]._reset=()=>{})}}t.M5StickC=a},function(e,t,i){"use strict";t.byteLength=function(e){var t=c(e),i=t[0],r=t[1];return 3*(i+r)/4-r},t.toByteArray=function(e){var t,i,r=c(e),a=r[0],o=r[1],h=new n(function(e,t,i){return 3*(t+i)/4-i}(0,a,o)),d=0,u=o>0?a-4:a;for(i=0;i<u;i+=4)t=s[e.charCodeAt(i)]<<18|s[e.charCodeAt(i+1)]<<12|s[e.charCodeAt(i+2)]<<6|s[e.charCodeAt(i+3)],h[d++]=t>>16&255,h[d++]=t>>8&255,h[d++]=255&t;2===o&&(t=s[e.charCodeAt(i)]<<2|s[e.charCodeAt(i+1)]>>4,h[d++]=255&t);1===o&&(t=s[e.charCodeAt(i)]<<10|s[e.charCodeAt(i+1)]<<4|s[e.charCodeAt(i+2)]>>2,h[d++]=t>>8&255,h[d++]=255&t);return h},t.fromByteArray=function(e){for(var t,i=e.length,s=i%3,n=[],a=0,o=i-s;a<o;a+=16383)n.push(d(e,a,a+16383>o?o:a+16383));1===s?(t=e[i-1],n.push(r[t>>2]+r[t<<4&63]+"==")):2===s&&(t=(e[i-2]<<8)+e[i-1],n.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"="));return n.join("")};for(var r=[],s=[],n="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,h=a.length;o<h;++o)r[o]=a[o],s[a.charCodeAt(o)]=o;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var i=e.indexOf("=");return-1===i&&(i=t),[i,i===t?0:4-i%4]}function d(e,t,i){for(var s,n,a=[],o=t;o<i;o+=3)s=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),a.push(r[(n=s)>>18&63]+r[n>>12&63]+r[n>>6&63]+r[63&n]);return a.join("")}s["-".charCodeAt(0)]=62,s["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,i,r,s){var n,a,o=8*s-r-1,h=(1<<o)-1,c=h>>1,d=-7,u=i?s-1:0,l=i?-1:1,f=e[t+u];for(u+=l,n=f&(1<<-d)-1,f>>=-d,d+=o;d>0;n=256*n+e[t+u],u+=l,d-=8);for(a=n&(1<<-d)-1,n>>=-d,d+=r;d>0;a=256*a+e[t+u],u+=l,d-=8);if(0===n)n=1-c;else{if(n===h)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,r),n-=c}return(f?-1:1)*a*Math.pow(2,n-r)},t.write=function(e,t,i,r,s,n){var a,o,h,c=8*n-s-1,d=(1<<c)-1,u=d>>1,l=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:n-1,p=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,a=d):(a=Math.floor(Math.log(t)/Math.LN2),t*(h=Math.pow(2,-a))<1&&(a--,h*=2),(t+=a+u>=1?l/h:l*Math.pow(2,1-u))*h>=2&&(a++,h/=2),a+u>=d?(o=0,a=d):a+u>=1?(o=(t*h-1)*Math.pow(2,s),a+=u):(o=t*Math.pow(2,u-1)*Math.pow(2,s),a=0));s>=8;e[i+f]=255&o,f+=p,o/=256,s-=8);for(a=a<<s|o,c+=s;c>0;e[i+f]=255&a,f+=p,a/=256,c-=8);e[i+f-p]|=128*m}},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(114));class n extends s.default{constructor(e,t){super(e,t)}close(){super.close(),this.updateOnlineUI()}isValidObnizId(e){if("string"!=typeof e||e.length<8)return null;e=e.replace("-","");let t=parseInt(e);return isNaN(t)&&(t=null),null!==t}wsconnect(e){if(this.showOffLine(),this.isValidObnizId(this.id))super.wsconnect(e);else if(this.isNode)this.error("invalid obniz id");else{const t=function(e){const t=e+"=",i=document.cookie.split(";");for(let e=0;e<i.length;e++){let r=i[e];for(;" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(t))return r.substring(t.length,r.length)}return null}("obniz-last-used")||"";this.prompt(t,t=>{this.id=t,this.wsconnect(e)})}}showAlertUI(e){if(this.isNode||!document.getElementById(this.options.debug_dom_id))return;const t=`\n    <div style="background-color:${"warning"===e.alert?"#ffee35":"#ff7b34"}">${e.message}</div>`;document.getElementById(this.options.debug_dom_id).insertAdjacentHTML("beforeend",t)}getDebugDoms(){if(this.isNode)return;const e=document.querySelector("#loader"),t=document.querySelector("#"+this.options.debug_dom_id);let i=document.querySelector("#"+this.options.debug_dom_id+" #online-status");return t&&!i&&(i=document.createElement("div"),i.id="online-status",i.style.color="#FFF",i.style.padding="5px",i.style.textAlign="center",t.insertBefore(i,t.firstChild)),{loaderDom:e,debugDom:t,statusDom:i}}_callOnConnect(){this.updateOnlineUI(),super._callOnConnect()}_disconnectLocal(){super._disconnectLocal(),this.updateOnlineUI()}updateOnlineUI(){if(this.isNode)return;const e=this.socket&&1===this.socket.readyState,t=this.socket_local&&1===this.socket_local.readyState;e&&t?this.showOnLine(!0):e?this.showOnLine(!1):this.showOffLine()}showOnLine(e){if(this.isNode)return;const t=this.getDebugDoms();t.loaderDom&&(t.loaderDom.style.display="none"),t.statusDom&&(t.statusDom.style.backgroundColor=e?"#0cd362":"#31965d",t.statusDom.style.color="#FFF",t.statusDom.innerHTML=(this.id?"online : "+this.id:"online")+(e?" via local_connect":" via internet"))}showOffLine(){if(this.isNode)return;const e=this.getDebugDoms();e.loaderDom&&(e.loaderDom.style.display="block"),e.statusDom&&(e.statusDom.style.backgroundColor="#d9534f",e.statusDom.style.color="#FFF",e.statusDom.innerHTML=this.id?"offline : "+this.id:"offline")}}t.default=n},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(115));class n extends s.default{constructor(e,t){super(e,t)}wait(e){return e<0?e=0:e>6e4&&(e=6e4),this.send({system:{wait:e}}),new Promise(t=>setTimeout(t,e))}reset(){this.send({system:{reset:!0}}),this._resetComponents()}reboot(){this.send({system:{reboot:!0}})}selfCheck(){this.send({system:{self_check:!0}})}keepWorkingAtOffline(e){this.send({system:{keep_working_at_offline:e}})}resetOnDisconnect(e){this.send({ws:{reset_obniz_on_ws_disconnection:e}})}sleepSeconds(e){if(e<1)e=1;else if(e>64800)throw new Error("Error max 18h(64800) sleep");this.send({system:{sleep_seconds:e}})}sleepMinute(e){if(e<1)e=1;else if(e>64800)throw new Error("max 45day(64800m) sleep");this.send({system:{sleep_minute:e}})}sleep(e){if(!(e instanceof Date))throw new Error("Date instance argument required");let t=Math.floor((e-new Date)/1e3);if(this.print_debug(`sleep time : ${t}s`),t<=0)throw new Error(`past sleep time : ${t}s`);if(t<=64800)this.sleepSeconds(t);else{if(t=Math.floor(t/60),this.print_debug(`sleep time : ${t}m`),!(t<=64800))throw new Error(`over max sleep time : ${t}m`);this.sleepMinute(t)}}sleepIoTrigger(e){if("boolean"!=typeof e)throw new Error("sleepIoTrigger need boolean arg");this.send({system:{sleep_io_trigger:e}})}pingWait(e,t,i){e=e||(new Date).getTime();const r=Math.floor(e/Math.pow(2,32)),s=e-r*Math.pow(2,32);t=t||Math.floor(Math.random()*Math.pow(2,4));const n=[];n.push(r>>>24&255),n.push(r>>>16&255),n.push(r>>>8&255),n.push(r>>>0&255),n.push(s>>>24&255),n.push(s>>>16&255),n.push(s>>>8&255),n.push(s>>>0&255),n.push(t>>>24&255),n.push(t>>>16&255),n.push(t>>>8&255),n.push(t>>>0&255);const a={system:{ping:{key:n}}};return this.send(a,{local_connect:!i}),new Promise(e=>{const t=i=>{for(let e=0;e<n.length;e++)if(n[e]!==i.pong.key[e])return;this.removePongObserver(t);const r=(i.pong.key[0]<<24>>>0)+(i.pong.key[1]<<16>>>0)+(i.pong.key[2]<<8>>>0)+(i.pong.key[3]<<0>>>0),s=(i.pong.key[4]<<24>>>0)+(i.pong.key[5]<<16>>>0)+(i.pong.key[6]<<8>>>0)+(i.pong.key[7]<<0>>>0),a=r*Math.pow(2,32)+s,o=(new Date).getTime(),h=`ping ${o-a}ms (js --[${i.pong.pingServerTime-a}ms]--\x3e server --[${i.pong.obnizTime-i.pong.pingServerTime}ms]--\x3e obniz --[${i.pong.pongServerTime-i.pong.obnizTime}ms]--\x3e server --[${o-i.pong.pongServerTime}ms]--\x3e js)`;this.print_debug(h),e(h)};this.addPongObserver(t)})}}t.default=n},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(17)),n=i(116),a=r(i(231)),o=r(i(232)),h=r(i(233)),c=r(i(234)),d=r(i(235)),u=r(i(236)),l=r(i(237)),f=r(i(238)),p=r(i(239)),m=r(i(240)),_=r(i(241)),g=r(i(242)),y=r(i(243)),b=r(i(431)),v=r(i(438));class w extends y.default{constructor(e,t){super(e,t),this.pongObservers=[],this._allComponentKeys=[]}close(){super.close(),this.options.reset_obniz_on_ws_disconnection&&this._resetComponents()}setVccGnd(e,t,i){this.isValidIO(e)&&(i&&this.getIO(e).drive(i),this.getIO(e).output(!0)),this.isValidIO(t)&&(i&&this.getIO(t).drive(i),this.getIO(t).output(!1))}getIO(e){if(!this.isValidIO(e))throw new Error("io "+e+" is not valid io");return this["io"+e]}getAD(e){if(!this.isValidIO(e))throw new Error("ad "+e+" is not valid io");return this["ad"+e]}getFreePwm(){return this._getFreePeripheralUnit("pwm")}getFreeI2C(){return this._getFreePeripheralUnit("i2c")}getI2CWithConfig(e){if("object"!=typeof e)throw new Error("getI2CWithConfig need config arg");if(e.i2c)return e.i2c;const t=this.getFreeI2C();return t.start(e),t}getFreeSpi(){return this._getFreePeripheralUnit("spi")}getSpiWithConfig(e){if("object"!=typeof e)throw new Error("getSpiWithConfig need config arg");if(e.spi)return e.spi;const t=this.getFreeSpi();return t.start(e),t}getFreeUart(){return this._getFreePeripheralUnit("uart")}getFreeTcp(){return this._getFreePeripheralUnit("tcp")}_callOnConnect(){this._prepareComponents(),super._callOnConnect()}_prepareComponents(){if(0!==this._allComponentKeys.length)return;const e=b.default.getDefinitionFor(this.hw);if(!e)throw new Error(`unkown hw ${this.hw}`);const t=e.peripherals;this._hw_peripherals=t;const i=e.embeds,r=e.protocol,y={io:c.default,logicAnalyzer:m.default,measure:_.default},w={io:u.default,ad:h.default,uart:p.default,spi:f.default,i2c:d.default,pwm:l.default,grove:v.default};let S=n.ObnizHciBLE.default;s.default.lt(this.firmware_ver,"3.0.0-beta")&&(S=n.ObnizOldBLE.default);const E={display:a.default,switch:o.default,ble:S},C={tcp:g.default};for(const e in y){const t=y[e];this[e]=new t(this),this._allComponentKeys.push(e)}if(t)for(const e in w)if(t[e]){const i=t[e].units,r=w[e];for(const t in i){const s=parseInt(t);this[e+s]=new r(this,s,i[t]),this._allComponentKeys.push(e+s)}}if(i)for(const e in E)if(i[e]){const t=E[e];this[e]=new t(this,i[e]),this._allComponentKeys.push(e)}if(r)for(const e in C)if(r[e]){const t=r[e].units,i=C[e];for(const r in t){const t=parseInt(r);this[e+t]=new i(this,t),this._allComponentKeys.push(e+t)}}}_resetComponents(){this.print_debug("components state resets");for(const e of this._allComponentKeys)this[e]._reset()}notifyToModule(e){super.notifyToModule(e);for(const t of this._allComponentKeys)"logicAnalyzer"!==t?e.hasOwnProperty(t)&&this[t].notified(e[t]):e.hasOwnProperty("logic_analyzer")&&this.logicAnalyzer.notified(e.logic_analyzer)}handleSystemCommand(e){if(super.handleSystemCommand(e),e.pong)for(const t of this.pongObservers)t(e)}addPongObserver(e){e&&this.pongObservers.push(e)}removePongObserver(e){if(this.pongObservers.includes(e)){const t=this.pongObservers.indexOf(e);this.pongObservers.splice(t,1)}}_getFreePeripheralUnit(e){for(const t of this._allComponentKeys)if(0===t.indexOf(e)){const e=this[t];if("object"==typeof e&&!e.isUsed())return e.used=!0,e}throw new Error(`No More ${e} Available.`)}}t.default=w},function(e,t,i){"use strict";var r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(117));t.ObnizOldBLE=s;const n=r(i(59));t.ObnizHciBLE=n},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(i(118)),a=s(i(56)),o=s(i(57)),h=s(i(120)),c=s(i(121)),d=s(i(125)),u=s(i(126)),l=s(i(58));t.default=class{constructor(e){this.Obniz=e,this.remotePeripherals=[],this.service=l.default,this.characteristic=a.default,this.descriptor=o.default,this.peripheral=new h.default(e),this.scanTarget=null,this.advertisement=new n.default(e),this.scan=new d.default(e),this.security=new u.default(e),this._reset()}static _dataArray2uuidHex(e,t){let i=[];for(let t=0;t<e.length;t++)i.push(("00"+e[t].toString(16).toLowerCase()).slice(-2));t&&(i=i.reverse());let r=i.join("");return i.length>=16&&(r=r.slice(0,8)+"-"+r.slice(8,12)+"-"+r.slice(12,16)+"-"+r.slice(16,20)+"-"+r.slice(20)),r}initWait(){return r(this,void 0,void 0,(function*(){}))}_reset(){}directConnect(e,t){throw new Error("directConnect cannot use obnizOS < 3.0.0. Please update obnizOS")}directConnectWait(e,t){return r(this,void 0,void 0,(function*(){throw new Error("directConnectWait cannot use obnizOS < 3.0.0. Please update obnizOS")}))}findPeripheral(e){for(const t in this.remotePeripherals)if(this.remotePeripherals[t].address===e)return this.remotePeripherals[t];return null}notified(e){if(e.scan_result){let t=this.findPeripheral(e.scan_result.address);t||(t=new c.default(this.Obniz,e.scan_result.address),this.remotePeripherals.push(t)),t.discoverdOnRemote=!0,t.setParams(e.scan_result),this.scan.notifyFromServer("onfind",t)}e.scan_result_finish&&this.scan.notifyFromServer("onfinish");const t=(e,t,i)=>{let r=null;if(void 0===e)return;const s=this.findPeripheral(e.address);s&&("peripheral"===i?r=s:"service"===i?r=s.findService(e):"characteristic"===i?r=s.findCharacteristic(e):"descriptor"===i&&(r=s.findDescriptor(e)),r&&t(e,r))},i={status_update:{name:"statusupdate",obj:"peripheral"},get_service_result:{name:"discover",obj:"peripheral"},get_service_result_finish:{name:"discoverfinished",obj:"peripheral"},get_characteristic_result:{name:"discover",obj:"service"},get_characteristic_result_finish:{name:"discoverfinished",obj:"service"},write_characteristic_result:{name:"onwrite",obj:"characteristic"},read_characteristic_result:{name:"onread",obj:"characteristic"},register_notify_characteristic_result:{name:"onregisternotify",obj:"characteristic"},register_nofity_characteristic_result:{name:"onregisternotify",obj:"characteristic"},unregister_notify_characteristic_result:{name:"onunregisternotify",obj:"characteristic"},unregister_nofity_characteristic_result:{name:"onunregisternotify",obj:"characteristic"},notify_characteristic:{name:"onnotify",obj:"characteristic"},nofity_characteristic:{name:"onnotify",obj:"characteristic"},get_descriptor_result:{name:"discover",obj:"characteristic"},get_descriptor_result_finish:{name:"discoverfinished",obj:"characteristic"},write_descriptor_result:{name:"onwrite",obj:"descriptor"},read_descriptor_result:{name:"onread",obj:"descriptor"}};for(const r in i)t(e[r],(e,t)=>{t.notifyFromServer(i[r].name,e)},i[r].obj);const r=(e,t,i)=>{let r=null;void 0!==e&&("peripheral"===i?r=this.peripheral:"service"===i?r=this.peripheral.getService(e):"characteristic"===i?r=this.peripheral.findCharacteristic(e):"descriptor"===i&&(r=this.peripheral.findDescriptor(e)),r&&t(e,r))};if(e.peripheral){r(e.peripheral.connection_status,e=>{this.peripheral.onconnectionupdates(e)},"peripheral");const t={read_characteristic_result:{name:"onread",obj:"characteristic"},write_characteristic_result:{name:"onwrite",obj:"characteristic"},notify_read_characteristic:{name:"onreadfromremote",obj:"characteristic"},notify_write_characteristic:{name:"onwritefromremote",obj:"characteristic"},read_descriptor_result:{name:"onread",obj:"descriptor"},write_descriptor_result:{name:"onwrite",obj:"descriptor"},notify_read_descriptor:{name:"onreadfromremote",obj:"descriptor"},notify_write_descriptor:{name:"onwritefromremote",obj:"descriptor"}};for(const i in t)r(e.peripheral[i],(e,r)=>{r.notifyFromServer(t[i].name,e)},t[i].obj)}if(e.error){const t=e.error;let i,r,s=!1;i=t.address?this.findPeripheral(t.address):this.peripheral,i&&(t.service_uuid&&t.characteristic_uuid&&t.descriptor_uuid?r=i.findDescriptor(t):t.service_uuid&&t.characteristic_uuid?r=i.findCharacteristic(t):t.service_uuid&&(r=i.findService(t)),r?(r.notifyFromServer("onerror",t),s=!0):(i.onerror(t),s=!0)),[35,36,37,38,39].includes(t.function_code)&&(this.security.onerror(t),s=!0),s||this.Obniz.error(`ble ${t.message} service=${t.service_uuid} characteristic_uuid=${t.characteristic_uuid} descriptor_uuid=${t.descriptor_uuid}`)}}}},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(119));t.default=class{constructor(e){this.Obniz=e,this.adv_data=[],this.scan_resp=[]}start(){const e={ble:{}};e.ble.advertisement={adv_data:this.adv_data},this.scan_resp.length>0&&(e.ble.advertisement.scan_resp=this.scan_resp),this.Obniz.send(e)}end(){const e={ble:{}};e.ble.advertisement=null,this.Obniz.send(e)}setAdvDataRaw(e){this.adv_data=e}setAdvData(e){const t=this.advDataBulider(e);this.setAdvDataRaw(t.build())}advDataBulider(e){return new s.default(this.Obniz,e)}scanRespDataBuilder(e){return new s.default(this.Obniz,e)}setScanRespDataRaw(e){this.scan_resp=e}setScanRespData(e){this.setScanRespDataRaw(this.scanRespDataBuilder(e).build())}}},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(10));t.default=class{constructor(e,t){if(this.Obniz=e,this.rows={},t&&(t.localName&&this.setCompleteLocalName(t.localName),t.manufacturerData&&t.manufacturerData.companyCode&&t.manufacturerData.data&&this.setManufacturerSpecificData(t.manufacturerData.companyCode,t.manufacturerData.data),t.serviceUuids))for(const e of t.serviceUuids)this.setUuid(e);"function"==typeof this.extendEvalJson&&this.extendEvalJson(t)}setRow(e,t){this.rows[e]=t}getRow(e){return this.rows[e]||[]}build(){const e=[];for(const t in this.rows)0!==this.rows[t].length&&(e.push(this.rows[t].length+1),e.push(parseInt(t)),Array.prototype.push.apply(e,this.rows[t]));return e.length>31&&this.Obniz.error("Too large data. Advertise/ScanResponse data are must be less than 32 byte."),e}setStringData(e,t){const i=[];for(let e=0;e<t.length;e++)i.push(t.charCodeAt(e));this.setRow(e,i)}setShortenedLocalName(e){this.setStringData(8,e)}setCompleteLocalName(e){this.setStringData(9,e)}setManufacturerSpecificData(e,t){const i=[];i.push(255&e),i.push(e>>8&255),Array.prototype.push.apply(i,t),this.setRow(255,i)}setUuid(e){const t=this.convertUuid(e);let i;16===t.length?i=6:4===t.length?i=4:2===t.length&&(i=2),this.setRow(i,t)}convertUuid(e){const t=s.default.uuidFilter(e);32!==t.length&&8!==t.length&&4!==t.length&&this.Obniz.error("BLE uuid must be 16/32/128 bit . (example: c28f0ad5-a7fd-48be-9fd0-eae9ffd3a8bb for 128bit)");const i=[];for(let e=t.length;e>1;e-=2)i.push(parseInt(t[e-2]+t[e-1],16));return i}setIbeaconData(e,t,i,r){const s=[];s.push(2,21);const n=this.convertUuid(e);Array.prototype.push.apply(s,n),s.push(t>>8&255),s.push(t>>0&255),s.push(i>>8&255),s.push(i>>0&255),s.push(r>>0&255),this.setManufacturerSpecificData(76,s)}extendEvalJson(e){e&&e.flags&&(e.flags.includes("limited_discoverable_mode")&&this.setLeLimitedDiscoverableModeFlag(),e.flags.includes("general_discoverable_mode")&&this.setLeGeneralDiscoverableModeFlag(),e.flags.includes("br_edr_not_supported")&&this.setBrEdrNotSupportedFlag(),e.flags.includes("le_br_edr_controller")&&this.setLeBrEdrControllerFlag(),e.flags.includes("le_br_edr_host")&&this.setLeBrEdrHostFlag())}setFlags(e){const t=this.getRow(1);t[0]=(t[0]||0)|e,this.setRow(1,t)}setLeLimitedDiscoverableModeFlag(){this.setFlags(1)}setLeGeneralDiscoverableModeFlag(){this.setFlags(2)}setBrEdrNotSupportedFlag(){this.setFlags(4)}setLeBrEdrControllerFlag(){this.setFlags(8)}setLeBrEdrHostFlag(){this.setFlags(16)}}},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(10)),n=r(i(58));t.default=class{constructor(e){this.Obniz=e,this._services=[]}get services(){return this._services}addService(e){e instanceof n.default||(e=new n.default(e)),this._services.push(e),e.peripheral=this,this.Obniz.send({ble:{peripheral:{services:[e]}}})}setJson(e){if(e.services)for(const t of e.services)this.addService(t)}getService(e){return e=s.default.uuidFilter(e),this._services.filter(t=>s.default.uuidFilter(t.uuid)===e).shift()}removeService(e){this._services=this._services.filter(t=>s.default.uuidFilter(t.uuid)!==e)}stopAllService(){this.Obniz.send({ble:{peripheral:null}}),this._services=[]}toJSON(){return{services:this._services}}findCharacteristic(e){const t=s.default.uuidFilter(e.service_uuid),i=s.default.uuidFilter(e.characteristic_uuid),r=this.getService(t);return r?r.getCharacteristic(i):null}findDescriptor(e){const t=s.default.uuidFilter(e.descriptor_uuid),i=this.findCharacteristic(e);return i?i.getDescriptor(t):null}end(){this.Obniz.send({ble:{peripheral:null}})}onconnectionupdates(){}onerror(){}}},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(14),a=s(i(10)),o=s(i(122));t.default=class{constructor(e,t){this.Obniz=e,this.address=t,this.connected=!1,this.device_type=null,this.address_type=null,this.ble_event_type=null,this.rssi=null,this.adv_data=null,this.scan_resp=null,this.keys=["device_type","address_type","ble_event_type","rssi","adv_data","scan_resp"],this._services=[],this.emitter=new n}get services(){return this._services}toString(){return JSON.stringify({address:this.address,addressType:this.address_type,advertisement:this.adv_data,scanResponse:this.scan_resp,rssi:this.rssi})}setParams(e){this.advertise_data_rows=null;for(const t in e)e.hasOwnProperty(t)&&this.keys.includes(t)&&(this[t]=e[t]);this.analyseAdvertisement()}analyseAdvertisement(){if(!this.advertise_data_rows){if(this.advertise_data_rows=[],this.adv_data)for(let e=0;e<this.adv_data.length;e++){const t=this.adv_data[e],i=new Array(t);for(let r=0;r<t;r++)i[r]=this.adv_data[e+r+1];this.advertise_data_rows.push(i),e+=t}if(this.scan_resp)for(let e=0;e<this.scan_resp.length;e++){const t=this.scan_resp[e],i=new Array(t);for(let r=0;r<t;r++)i[r]=this.scan_resp[e+r+1];this.advertise_data_rows.push(i),e+=t}this.setLocalName(),this.setIBeacon()}}searchTypeVal(e){this.analyseAdvertisement();for(let t=0;t<this.advertise_data_rows.length;t++)if(this.advertise_data_rows[t][0]===e){const e=[].concat(this.advertise_data_rows[t]);return e.shift(),e}}setLocalName(){let e=this.searchTypeVal(9);e||(e=this.searchTypeVal(8)),this.localName=e?String.fromCharCode.apply(null,e):null}setIBeacon(){const e=this.searchTypeVal(255);if(!e||76!==e[0]||0!==e[1]||2!==e[2]||21!==e[3]||25!==e.length)return void(this.iBeacon=null);const t=e.slice(4,20);let i="";for(let e=0;e<t.length;e++)i+=("00"+t[e].toString(16)).slice(-2),3!==e&&5!==e&&7!==e&&9!==e||(i+="-");const r=(e[20]<<8)+e[21],s=(e[22]<<8)+e[23],n=e[24];this.iBeacon={uuid:i,major:r,minor:s,power:n,rssi:this.rssi}}_addServiceUuids(e,t,i){if(!t)return;const r=i/4;for(let i=0;i<t.length;i+=r){const s=t.slice(i,i+r);e.push(this.Obniz.ble.constructor._dataArray2uuidHex(s,!0))}}advertisementServiceUuids(){const e=[];return this._addServiceUuids(e,this.searchTypeVal(2),16),this._addServiceUuids(e,this.searchTypeVal(3),16),this._addServiceUuids(e,this.searchTypeVal(4),32),this._addServiceUuids(e,this.searchTypeVal(5),32),this._addServiceUuids(e,this.searchTypeVal(6),64),this._addServiceUuids(e,this.searchTypeVal(7),64),e}connect(){this.Obniz.ble.scan.end();const e={ble:{connect:{address:this.address}}};this.Obniz.send(e)}connectWait(){return new Promise((e,t)=>{this.emitter.once("statusupdate",i=>{"connected"===i.status?e(!0):t(new Error("connection not established"))}),this.connect()})}disconnect(){const e={ble:{disconnect:{address:this.address}}};this.Obniz.send(e)}disconnectWait(){return new Promise((e,t)=>{this.emitter.once("statusupdate",i=>{"disconnected"===i.status?e(!0):t(new Error("disconnectWait failed"))}),this.disconnect()})}getService(e){e=a.default.uuidFilter(e);for(const t in this._services)if(this._services[t].uuid===e)return this._services[t]}findService(e){const t=a.default.uuidFilter(e.service_uuid);return this.getService(t)}findCharacteristic(e){const t=a.default.uuidFilter(e.service_uuid),i=a.default.uuidFilter(e.characteristic_uuid),r=this.getService(t);return r?r.getCharacteristic(i):null}findDescriptor(e){const t=a.default.uuidFilter(e.descriptor_uuid),i=this.findCharacteristic(e);return i?i.getDescriptor(t):null}discoverAllServices(){const e={ble:{get_services:{address:this.address}}};this.Obniz.send(e)}discoverAllServicesWait(){return new Promise(e=>{this.emitter.once("discoverfinished",()=>{const t=this._services.filter(e=>e.discoverdOnRemote);e(t)}),this.discoverAllServices()})}discoverAllHandlesWait(){return r(this,void 0,void 0,(function*(){const e=(e,t)=>{const i=[],r=(e,t)=>{for(const s of e)Array.isArray(s)&&t>0?r(s,t-1):i.push(s)};return r(e,Math.floor(t)||1),i},t=yield this.discoverAllServicesWait(),i=e(yield Promise.all(t.map(e=>e.discoverAllCharacteristicsWait())));e(yield Promise.all(i.map(e=>e.discoverAllDescriptorsWait())))}))}onconnect(){}ondisconnect(){}ondiscoverservice(e){}ondiscoverservicefinished(e){}ondiscover(){}ondiscoverfinished(){}notifyFromServer(e,t){return r(this,void 0,void 0,(function*(){switch(this.emitter.emit(e,t),e){case"statusupdate":"connected"===t.status&&(this.connected=!0,yield this.discoverAllHandlesWait(),this.onconnect()),"disconnected"===t.status&&(this.connected=!1,this.ondisconnect());break;case"discover":{const e=t.service_uuid;let i=this.getService(e);if(!i){const t=new o.default({uuid:e});t.parent=this,this._services.push(t),i=t}i.discoverdOnRemote=!0,this.ondiscoverservice(i);break}case"discoverfinished":{const e=this._services.filter(e=>e.discoverdOnRemote);this.ondiscoverservicefinished(e);break}}}))}onerror(){}}},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(10)),n=r(i(39)),a=r(i(123));class o extends n.default{constructor(e){super(e)}get parentName(){return"peripheral"}get childrenClass(){return a.default}get childrenName(){return"characteristics"}get characteristics(){return this.children}addCharacteristic(e){return this.addChild(e)}getCharacteristic(e){return this.getChild(e)}discoverAllCharacteristics(){return this.discoverChildren()}discoverAllCharacteristicsWait(){return this.discoverChildrenWait()}discoverChildren(){const e={ble:{get_characteristics:{address:this.peripheral.address,service_uuid:s.default.uuidFilter(this.uuid)}}};this.parent.Obniz.send(e)}ondiscover(e){this.ondiscovercharacteristic(e)}ondiscoverfinished(e){this.ondiscovercharacteristicfinished(e)}ondiscovercharacteristic(e){}ondiscovercharacteristicfinished(e){}}t.default=o},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(i(10)),a=s(i(39)),o=s(i(124));class h extends a.default{constructor(e){super(e),this.properties=e.properties||[],Array.isArray(this.properties)||(this.properties=[this.properties])}get parentName(){return"service"}get childrenClass(){return o.default}get childrenName(){return"descriptors"}get descriptors(){return this.children}addDescriptor(e){return this.addChild(e)}getDescriptor(e){return this.getChild(e)}registerNotify(e){return r(this,void 0,void 0,(function*(){this.onnotify=e;const t=this.getDescriptor("2902");yield t.writeWait([1,0]);const i={ble:{register_notify_characteristic:{address:this.service.peripheral.address,service_uuid:n.default.uuidFilter(this.service.uuid),characteristic_uuid:n.default.uuidFilter(this.uuid)}}};this.service.peripheral.Obniz.send(i)}))}registerNotifyWait(e){return new Promise(t=>{this.emitter.once("onregisternotify",()=>{t()}),this.registerNotify(e)})}unregisterNotify(){this.onnotify=()=>{};const e={ble:{unregister_notify_characteristic:{address:this.service.peripheral.address,service_uuid:n.default.uuidFilter(this.service.uuid),characteristic_uuid:n.default.uuidFilter(this.uuid)}}};this.service.peripheral.Obniz.send(e)}unregisterNotifyWait(){return new Promise(e=>{this.emitter.once("onunregisternotify",()=>{e()}),this.unregisterNotify()})}read(){const e={ble:{read_characteristic:{address:this.service.peripheral.address,service_uuid:n.default.uuidFilter(this.service.uuid),characteristic_uuid:n.default.uuidFilter(this.uuid)}}};this.service.peripheral.Obniz.send(e)}write(e,t){void 0===t&&(t=!0);const i={ble:{write_characteristic:{address:this.service.peripheral.address,service_uuid:n.default.uuidFilter(this.service.uuid),characteristic_uuid:n.default.uuidFilter(this.uuid),data:e,needResponse:t}}};this.service.peripheral.Obniz.send(i)}discoverChildren(){const e={ble:{get_descriptors:{address:this.service.peripheral.address,service_uuid:n.default.uuidFilter(this.service.uuid),characteristic_uuid:n.default.uuidFilter(this.uuid)}}};this.service.peripheral.Obniz.send(e)}discoverAllDescriptors(){return this.discoverChildren()}discoverAllDescriptorsWait(){return this.discoverChildrenWait()}toJSON(){const e=super.toJSON();return this.properties.length>0&&(e.properties=this.properties),e}canBroadcast(){return this.properties.includes("broadcast")}canNotify(){return this.properties.includes("notify")}canRead(){return this.properties.includes("read")}canWrite(){return this.properties.includes("write")}canWriteWithoutResponse(){return this.properties.includes("write_without_response")}canIndicate(){return this.properties.includes("indicate")}ondiscover(e){this.ondiscoverdescriptor(e)}ondiscoverfinished(e){this.ondiscoverdescriptorfinished(e)}ondiscoverdescriptor(e){}ondiscoverdescriptorfinished(e){}onregisternotify(){}onunregisternotify(){}onnotify(e){}notifyFromServer(e,t){switch(super.notifyFromServer(e,t),e){case"onregisternotify":this.onregisternotify();break;case"onunregisternotify":this.onunregisternotify();break;case"onnotify":this.onnotify(t.data||void 0)}}}t.default=h},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(10)),n=r(i(39));class a extends n.default{constructor(e){super(e)}get parentName(){return"characteristic"}read(){const e={ble:{read_descriptor:{address:this.characteristic.service.peripheral.address,service_uuid:s.default.uuidFilter(this.characteristic.service.uuid),characteristic_uuid:s.default.uuidFilter(this.characteristic.uuid),descriptor_uuid:s.default.uuidFilter(this.uuid)}}};this.characteristic.service.peripheral.Obniz.send(e)}write(e,t){void 0===t&&(t=!0);const i={ble:{write_descriptor:{address:this.characteristic.service.peripheral.address,service_uuid:s.default.uuidFilter(this.characteristic.service.uuid),characteristic_uuid:s.default.uuidFilter(this.characteristic.uuid),descriptor_uuid:s.default.uuidFilter(this.uuid),data:e,needResponse:t}}};this.characteristic.service.peripheral.Obniz.send(i)}}t.default=a},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(14),n=r(i(10));t.default=class{constructor(e){this.scanTarget=null,this.Obniz=e,this.emitter=new s,this.scanedPeripherals=[]}start(e,t){const i={ble:{}};if(i.ble.scan={duration:t&&t.duration?t.duration:30},t&&t.duplicate)throw new Error("duplicate property can only be used with obnizOS3 or later");this.scanTarget=e,this.scanTarget&&this.scanTarget.uuids&&Array.isArray(this.scanTarget.uuids)&&(this.scanTarget.uuids=this.scanTarget.uuids.map(e=>n.default.uuidFilter(e))),this.scanedPeripherals=[],this.Obniz.send(i)}startOneWait(e,t){let i=0;return new Promise(r=>{this.emitter.once("onfind",e=>{0===i&&(i=1,this.end(),r(e))}),this.emitter.once("onfinish",()=>{0===i&&(i=1,r(null))}),this.start(e,t)})}startAllWait(e,t){return new Promise(i=>{this.emitter.once("onfinish",()=>{i(this.scanedPeripherals)}),this.start(e,t)})}end(){const e={ble:{}};e.ble.scan=null,this.Obniz.send(e)}isTarget(e){if(this.scanTarget&&this.scanTarget.localName&&e.localName!==this.scanTarget.localName)return!1;if(this.scanTarget&&this.scanTarget.uuids){const t=e.advertisementServiceUuids().map(e=>n.default.uuidFilter(e));for(const e of this.scanTarget.uuids)if(!t.includes(e))return!1}return!0}onfinish(e){}onfind(e){}setAdvertisementFilter(){throw new Error("setAdvertisementFilter is not support obnizOS < 3.2.0")}setScanMode(e){throw new Error("setScanMode is not support obnizOS < 3.2.0")}notifyFromServer(e,t){switch(e){case"onfind":this.isTarget(t)&&(this.scanedPeripherals.push(t),this.emitter.emit(e,t),this.onfind(t));break;case"onfinish":this.emitter.emit(e,this.scanedPeripherals),this.onfinish(this.scanedPeripherals)}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(14),s=i(17);t.default=class{constructor(e){this.Obniz=e,this.emitter=new r}setModeLevel(e,t){let i,r,s;if(1===e&&(1===t?(i=[],s=0,r=["LTK","IRK"]):2===t&&(i=["bonding"],s=2,r=["LTK","IRK"])),void 0===i||void 0===s||void 0===r){const i=`BLE security mode${e}, level${t} is not available.`;throw this.Obniz.error(i),new Error(i)}this.setAuth(i),this.setIndicateSecurityLevel(s),this.setEnableKeyTypes(r)}checkIntroducedFirmware(e,t){if(s.lt(this.Obniz.firmware_ver,e)){const i=`${t} is available obniz firmware ${e}.( your obniz version is ${this.Obniz.firmware_ver})`;throw this.Obniz.error(i),new Error(i)}}setAuth(e){if(this.checkIntroducedFirmware("1.1.0","setAuth"),Array.isArray(e)||(e=[e]),e.map(e=>e.toLowerCase()).filter(e=>["mitm","secure_connection","bonding"].includes(e)).length!==e.length)throw new Error("unknown auth type");this.Obniz.send({ble:{security:{auth:e}}})}setIndicateSecurityLevel(e){if(this.checkIntroducedFirmware("1.1.0","setIndicateSecurityLevel"),"number"!=typeof e)throw new Error("unknown secrity level : "+e);this.Obniz.send({ble:{security:{indicate_security_level:e}}})}setEnableKeyTypes(e){this.checkIntroducedFirmware("1.1.0","setEnableKeyTypes"),Array.isArray(e)||(e=[e]);const t=e.map(e=>e.toLowerCase()).filter(e=>["ltk","csrk","irk"].includes(e));if(t.length!==e.length)throw new Error("unknown key type");this.Obniz.send({ble:{security:{key:{type:t}}}})}setKeyMaxSize(e){if(this.checkIntroducedFirmware("1.1.0","setKeyMaxSize"),"number"!=typeof e)throw new Error("please provide key size in number");this.Obniz.send({ble:{security:{key:{max_size:e}}}})}clearBondingDevicesList(){this.Obniz.send({ble:{security:{devices:{clear:!0}}}})}onerror(e){}notifyFromServer(e,t){switch(e){case"onerror":this.onerror(t)}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e){this.Obniz=e}write(e){this.Obniz.send({ble:{hci:{write:e}}})}notified(e){e.read&&e.read.data&&this.onread(e.read.data)}onread(e){}}},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(4)),n=r(i(30)),a=r(i(130)),o=r(i(211)),h=r(i(212)),c=r(i(213));class d extends s.default.EventEmitter{constructor(e){super(),this._state=null,this._addresses={},this._addresseTypes={},this._connectable={},this._pendingConnectionUuid=null,this._connectionQueue=[],this._handles={},this._gatts={},this._aclStreams={},this._signalings={},this._hci=e,this._gap=new o.default(this._hci)}startScanning(e,t,i){this._scanServiceUuids=e||[],this._gap.startScanning(t,i)}stopScanning(){this._gap.stopScanning()}connect(e){const t=this._addresses[e],i=this._addresseTypes[e];this._pendingConnectionUuid?this._connectionQueue.push(e):(this._pendingConnectionUuid=e,this._hci.createLeConn(t,i))}disconnect(e){this._hci.disconnect(this._handles[e])}updateRssi(e){this._hci.readRssi(this._handles[e])}init(){this._gap.on("scanStart",this.onScanStart.bind(this)),this._gap.on("scanStop",this.onScanStop.bind(this)),this._gap.on("discover",this.onDiscover.bind(this)),this._hci.on("stateChange",this.onStateChange.bind(this)),this._hci.on("addressChange",this.onAddressChange.bind(this)),this._hci.on("leConnComplete",this.onLeConnComplete.bind(this)),this._hci.on("leConnUpdateComplete",this.onLeConnUpdateComplete.bind(this)),this._hci.on("rssiRead",this.onRssiRead.bind(this)),this._hci.on("disconnComplete",this.onDisconnComplete.bind(this)),this._hci.on("encryptChange",this.onEncryptChange.bind(this)),this._hci.on("aclDataPkt",this.onAclDataPkt.bind(this))}onStateChange(e){this._state!==e&&(this._state=e,"unauthorized"===e?(console.log("noble warning: adapter state unauthorized, please run as root or with sudo"),console.log("               or see README for information on running without root/sudo:"),console.log("               https://github.com/sandeepmistry/noble#running-on-linux")):"unsupported"===e&&(console.log("noble warning: adapter does not support Bluetooth Low Energy (BLE, Bluetooth Smart)."),console.log("               Try to run with environment variable:"),console.log("               [sudo] NOBLE_HCI_DEVICE_ID=x node ...")),this.emit("stateChange",e))}onAddressChange(e){this.emit("addressChange",e)}onScanStart(e){this.emit("scanStart",e)}onScanStop(){this.emit("scanStop")}onDiscover(e,t,i,r,s,n){if(void 0===this._scanServiceUuids)return;let a=s.serviceUuids||[];const o=s.serviceData||[];let h=0===this._scanServiceUuids.length;if(!h){let e;for(e in a=a.slice(),o)a.push(o[e].uuid);for(e in a)if(h=-1!==this._scanServiceUuids.indexOf(a[e]),h)break}if(h){const e=t.split(":").join("");this._addresses[e]=t,this._addresseTypes[e]=i,this._connectable[e]=r,this.emit("discover",e,t,i,r,s,n)}}onLeConnComplete(e,t,i,r,s,o,d,u,l){if(0!==i)return;let f=null,p=null;if(0===e){f=s.split(":").join("").toLowerCase();const e=new a.default(this._hci,t,this._hci.addressType,this._hci.address,r,s),i=new h.default(s,e),n=new c.default(t,e);this._gatts[f]=this._gatts[t]=i,this._signalings[f]=this._signalings[t]=n,this._aclStreams[t]=e,this._handles[f]=t,this._handles[t]=f,this._gatts[t].on("mtu",this.onMtu.bind(this)),this._gatts[t].on("servicesDiscover",this.onServicesDiscovered.bind(this)),this._gatts[t].on("includedServicesDiscover",this.onIncludedServicesDiscovered.bind(this)),this._gatts[t].on("characteristicsDiscover",this.onCharacteristicsDiscovered.bind(this)),this._gatts[t].on("read",this.onRead.bind(this)),this._gatts[t].on("write",this.onWrite.bind(this)),this._gatts[t].on("broadcast",this.onBroadcast.bind(this)),this._gatts[t].on("notify",this.onNotify.bind(this)),this._gatts[t].on("notification",this.onNotification.bind(this)),this._gatts[t].on("descriptorsDiscover",this.onDescriptorsDiscovered.bind(this)),this._gatts[t].on("valueRead",this.onValueRead.bind(this)),this._gatts[t].on("valueWrite",this.onValueWrite.bind(this)),this._gatts[t].on("handleRead",this.onHandleRead.bind(this)),this._gatts[t].on("handleWrite",this.onHandleWrite.bind(this)),this._gatts[t].on("handleNotify",this.onHandleNotify.bind(this)),this._signalings[t].on("connectionParameterUpdateRequest",this.onConnectionParameterUpdateRequest.bind(this)),this._gatts[t].exchangeMtu(256)}else{f=this._pendingConnectionUuid;let t=n.default.STATUS_MAPPER[e]||"HCI Error: Unknown";t+=" (0x"+e.toString(16)+")",p=new Error(t)}if(this.emit("connect",f,p),this._connectionQueue.length>0){const e=this._connectionQueue.shift();s=this._addresses[e],r=this._addresseTypes[e],this._pendingConnectionUuid=e,this._hci.createLeConn(s,r)}else this._pendingConnectionUuid=null}onLeConnUpdateComplete(e,t,i,r){}onDisconnComplete(e,t){const i=this._handles[e];i&&(this._aclStreams[e].push(null,null),this._gatts[e].removeAllListeners(),this._signalings[e].removeAllListeners(),delete this._gatts[i],delete this._gatts[e],delete this._signalings[i],delete this._signalings[e],delete this._aclStreams[e],delete this._handles[i],delete this._handles[e],this.emit("disconnect",i))}onEncryptChange(e,t){const i=this._aclStreams[e];i&&i.pushEncrypt(t)}onMtu(e,t){}onRssiRead(e,t){this.emit("rssiUpdate",this._handles[e],t)}onAclDataPkt(e,t,i){const r=this._aclStreams[e];r&&r.push(t,i)}discoverServices(e,t){const i=this._handles[e],r=this._gatts[i];r?r.discoverServices(t||[]):console.warn("noble warning: unknown peripheral "+e)}onServicesDiscovered(e,t){const i=e.split(":").join("").toLowerCase();this.emit("servicesDiscover",i,t)}discoverIncludedServices(e,t,i){const r=this._handles[e],s=this._gatts[r];s?s.discoverIncludedServices(t,i||[]):console.warn("noble warning: unknown peripheral "+e)}onIncludedServicesDiscovered(e,t,i){const r=e.split(":").join("").toLowerCase();this.emit("includedServicesDiscover",r,t,i)}discoverCharacteristics(e,t,i){const r=this._handles[e],s=this._gatts[r];s?s.discoverCharacteristics(t,i||[]):console.warn("noble warning: unknown peripheral "+e)}onCharacteristicsDiscovered(e,t,i){const r=e.split(":").join("").toLowerCase();this.emit("characteristicsDiscover",r,t,i)}read(e,t,i){const r=this._handles[e],s=this._gatts[r];s?s.read(t,i):console.warn("noble warning: unknown peripheral "+e)}onRead(e,t,i,r,s){const n=e.split(":").join("").toLowerCase();this.emit("read",n,t,i,r,!1,s)}write(e,t,i,r,s){const n=this._handles[e],a=this._gatts[n];a?a.write(t,i,r,s):console.warn("noble warning: unknown peripheral "+e)}onWrite(e,t,i,r){const s=e.split(":").join("").toLowerCase();this.emit("write",s,t,i,r)}broadcast(e,t,i,r){const s=this._handles[e],n=this._gatts[s];n?n.broadcast(t,i,r):console.warn("noble warning: unknown peripheral "+e)}onBroadcast(e,t,i,r){const s=e.split(":").join("").toLowerCase();this.emit("broadcast",s,t,i,r)}notify(e,t,i,r){const s=this._handles[e],n=this._gatts[s];n?n.notify(t,i,r):console.warn("noble warning: unknown peripheral "+e)}onNotify(e,t,i,r){const s=e.split(":").join("").toLowerCase();this.emit("notify",s,t,i,r)}onNotification(e,t,i,r){const s=e.split(":").join("").toLowerCase();this.emit("read",s,t,i,r,!0,!0)}discoverDescriptors(e,t,i){const r=this._handles[e],s=this._gatts[r];s?s.discoverDescriptors(t,i):console.warn("noble warning: unknown peripheral "+e)}onDescriptorsDiscovered(e,t,i,r){const s=e.split(":").join("").toLowerCase();this.emit("descriptorsDiscover",s,t,i,r)}readValue(e,t,i,r){const s=this._handles[e],n=this._gatts[s];n?n.readValue(t,i,r):console.warn("noble warning: unknown peripheral "+e)}onValueRead(e,t,i,r,s,n){const a=e.split(":").join("").toLowerCase();this.emit("valueRead",a,t,i,r,s,n)}writeValue(e,t,i,r,s){const n=this._handles[e],a=this._gatts[n];a?a.writeValue(t,i,r,s):console.warn("noble warning: unknown peripheral "+e)}onValueWrite(e,t,i,r,s){const n=e.split(":").join("").toLowerCase();this.emit("valueWrite",n,t,i,r,s)}readHandle(e,t){const i=this._handles[e],r=this._gatts[i];r?r.readHandle(t):console.warn("noble warning: unknown peripheral "+e)}onHandleRead(e,t,i){const r=e.split(":").join("").toLowerCase();this.emit("handleRead",r,t,i)}writeHandle(e,t,i,r){const s=this._handles[e],n=this._gatts[s];n?n.writeHandle(t,i,r):console.warn("noble warning: unknown peripheral "+e)}onHandleWrite(e,t){const i=e.split(":").join("").toLowerCase();this.emit("handleWrite",i,t)}onHandleNotify(e,t,i){const r=e.split(":").join("").toLowerCase();this.emit("handleNotify",r,t,i)}onConnectionParameterUpdateRequest(e,t,i,r,s){this._hci.connUpdateLe(e,t,i,r,s)}}t.default=d},function(e){e.exports=JSON.parse('["Success","Unknown HCI Command","Unknown Connection Identifier","Hardware Failure","Page Timeout","Authentication Failure","PIN or Key Missing","Memory Capacity Exceeded","Connection Timeout","Connection Limit Exceeded","Synchronous Connection Limit to a Device Exceeded","ACL Connection Already Exists","Command Disallowed","Connection Rejected due to Limited Resources","Connection Rejected due to Security Reasons","Connection Rejected due to Unacceptable BD_ADDR","Connection Accept Timeout Exceeded","Unsupported Feature or Parameter Value","Invalid HCI Command Parameters","Remote User Terminated Connection","Remote Device Terminated due to Low Resources","Remote Device Terminated due to Power Off","Connection Terminated By Local Host","Repeated Attempts","Pairing Not Allowed","Unknown LMP PDU","Unsupported Remote Feature / Unsupported LMP Feature","SCO Offset Rejected","SCO Interval Rejected","SCO Air Mode Rejected","Invalid LMP Parameters / Invalid LL Parameters","Unspecified Error","Unsupported LMP Parameter Value / Unsupported LL Parameter Value","Role Change Not Allowed","LMP Response Timeout / LL Response Timeout","LMP Error Transaction Collision","LMP PDU Not Allowed","Encryption Mode Not Acceptable","Link Key cannot be Changed","Requested QoS Not Supported","Instant Passed","Pairing With Unit Key Not Supported","Different Transaction Collision","Reserved","QoS Unacceptable Parameter","QoS Rejected","Channel Classification Not Supported","Insufficient Security","Parameter Out Of Manadatory Range","Reserved","Role Switch Pending","Reserved","Reserved Slot Violation","Role Switch Failed","Extended Inquiry Response Too Large","Secure Simple Pairing Not Supported By Host","Host Busy - Pairing","Connection Rejected due to No Suitable Channel Found","Controller Busy","Unacceptable Connection Parameters","Directed Advertising Timeout","Connection Terminated due to MIC Failure","Connection Failed to be Established","MAC Connection Failed","Coarse Clock Adjustment Rejected but Will Try to Adjust Using Clock Dragging"]')},function(e,t,i){"use strict";(function(e){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(4)),n=r(i(131));class a extends s.default.EventEmitter{constructor(e,t,i,r,s,a){super(),this._hci=e,this._handle=t,this._smp=new n.default(this,i,r,s,a),this.onSmpStkBinded=this.onSmpStk.bind(this),this.onSmpFailBinded=this.onSmpFail.bind(this),this.onSmpEndBinded=this.onSmpEnd.bind(this),this._smp.on("stk",this.onSmpStkBinded),this._smp.on("fail",this.onSmpFailBinded),this._smp.on("end",this.onSmpEndBinded)}encrypt(){this._smp.sendPairingRequest()}write(e,t){this._hci.writeAclDataPkt(this._handle,e,t)}push(e,t){t?this.emit("data",e,t):this.emit("end")}pushEncrypt(e){this.emit("encrypt",e)}onSmpStk(t){const i=e.from("0000000000000000","hex"),r=e.from("0000","hex");this._hci.startLeEncryption(this._handle,i,r,t)}onSmpFail(){this.emit("encryptFail")}onSmpEnd(){this._smp.removeListener("stk",this.onSmpStkBinded),this._smp.removeListener("fail",this.onSmpFailBinded),this._smp.removeListener("end",this.onSmpEndBinded)}}t.default=a}).call(this,i(0).Buffer)},function(e,t,i){"use strict";(function(e){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(4)),n=r(i(132));var a;!function(e){e.CID=6,e.PAIRING_REQUEST=1,e.PAIRING_RESPONSE=2,e.PAIRING_CONFIRM=3,e.PAIRING_RANDOM=4,e.PAIRING_FAILED=5,e.ENCRYPT_INFO=6,e.MASTER_IDENT=7}(a||(a={}));class o extends s.default.EventEmitter{constructor(t,i,r,s,n){super(),this._aclStream=t,this._iat=e.from(["random"===i?1:0]),this._ia=e.from(r.split(":").reverse().join(""),"hex"),this._rat=e.from(["random"===s?1:0]),this._ra=e.from(n.split(":").reverse().join(""),"hex"),this.onAclStreamDataBinded=this.onAclStreamData.bind(this),this.onAclStreamEndBinded=this.onAclStreamEnd.bind(this),this._aclStream.on("data",this.onAclStreamDataBinded),this._aclStream.on("end",this.onAclStreamEndBinded)}sendPairingRequest(){this._preq=e.from([a.PAIRING_REQUEST,3,0,1,16,0,1]),this.write(this._preq)}onAclStreamData(e,t){if(e!==a.CID)return;const i=t.readUInt8(0);a.PAIRING_RESPONSE===i?this.handlePairingResponse(t):a.PAIRING_CONFIRM===i?this.handlePairingConfirm(t):a.PAIRING_RANDOM===i?this.handlePairingRandom(t):a.PAIRING_FAILED===i?this.handlePairingFailed(t):a.ENCRYPT_INFO===i?this.handleEncryptInfo(t):a.MASTER_IDENT===i&&this.handleMasterIdent(t)}onAclStreamEnd(){this._aclStream.removeListener("data",this.onAclStreamDataBinded),this._aclStream.removeListener("end",this.onAclStreamEndBinded),this.emit("end")}handlePairingResponse(t){this._pres=t,this._tk=e.from("00000000000000000000000000000000","hex"),this._r=n.default.r(),this.write(e.concat([e.from([a.PAIRING_CONFIRM]),n.default.c1(this._tk,this._r,this._pres,this._preq,this._iat,this._ia,this._rat,this._ra)]))}handlePairingConfirm(t){this._pcnf=t,this.write(e.concat([e.from([a.PAIRING_RANDOM]),this._r]))}handlePairingRandom(t){const i=t.slice(1),r=e.concat([e.from([a.PAIRING_CONFIRM]),n.default.c1(this._tk,i,this._pres,this._preq,this._iat,this._ia,this._rat,this._ra)]);if(this._pcnf.toString("hex")===r.toString("hex")){const e=n.default.s1(this._tk,i,this._r);this.emit("stk",e)}else this.write(e.from([a.PAIRING_RANDOM,a.PAIRING_CONFIRM])),this.emit("fail")}handlePairingFailed(e){this.emit("fail")}handleEncryptInfo(e){const t=e.slice(1);this.emit("ltk",t)}handleMasterIdent(e){const t=e.slice(1,3),i=e.slice(3);this.emit("masterIdent",t,i)}write(e){this._aclStream.write(a.CID,e)}}t.default=o}).call(this,i(0).Buffer)},function(e,t,i){"use strict";(function(e){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(60));function n(t,i){t=o(t),i=o(i);const r=s.default.createCipheriv("aes-128-ecb",t,"");return r.setAutoPadding(!1),o(e.concat([r.update(i),r.final()]))}function a(t,i){const r=e.alloc(t.length);for(let e=0;e<t.length;e++)r[e]=t[e]^i[e];return r}function o(t){const i=e.alloc(t.length);for(let e=0;e<i.length;e++)i[e]=t[t.length-e-1];return i}t.default={r:function(){return s.default.randomBytes(16)},c1:function(t,i,r,s,o,h,c,d){const u=e.concat([o,c,s,r]),l=e.concat([d,h,e.from("00000000","hex")]);let f=a(i,u);return f=n(t,f),f=a(f,l),f=n(t,f),f},s1:function(t,i,r){return n(t,e.concat([r.slice(0,8),i.slice(0,8)]))},e:n}}).call(this,i(0).Buffer)},function(e,t){},function(e,t,i){"use strict";var r=i(2).Buffer,s=i(135);e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,i=""+t.data;t=t.next;)i+=e+t.data;return i},e.prototype.concat=function(e){if(0===this.length)return r.alloc(0);if(1===this.length)return this.head.data;for(var t,i,s,n=r.allocUnsafe(e>>>0),a=this.head,o=0;a;)t=a.data,i=n,s=o,t.copy(i,s),o+=a.data.length,a=a.next;return n},e}(),s&&s.inspect&&s.inspect.custom&&(e.exports.prototype[s.inspect.custom]=function(){var e=s.inspect({length:this.length});return this.constructor.name+" "+e})},function(e,t){},function(e,t,i){(function(e){var r=void 0!==e&&e||"undefined"!=typeof self&&self||window,s=Function.prototype.apply;function n(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new n(s.call(setTimeout,r,arguments),clearTimeout)},t.setInterval=function(){return new n(s.call(setInterval,r,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},n.prototype.unref=n.prototype.ref=function(){},n.prototype.close=function(){this._clearFn.call(r,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},i(137),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,i(13))},function(e,t,i){(function(e,t){!function(e,i){"use strict";if(!e.setImmediate){var r,s,n,a,o,h=1,c={},d=!1,u=e.document,l=Object.getPrototypeOf&&Object.getPrototypeOf(e);l=l&&l.setTimeout?l:e,"[object process]"==={}.toString.call(e.process)?r=function(e){t.nextTick((function(){p(e)}))}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,i=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=i,t}}()?e.MessageChannel?((n=new MessageChannel).port1.onmessage=function(e){p(e.data)},r=function(e){n.port2.postMessage(e)}):u&&"onreadystatechange"in u.createElement("script")?(s=u.documentElement,r=function(e){var t=u.createElement("script");t.onreadystatechange=function(){p(e),t.onreadystatechange=null,s.removeChild(t),t=null},s.appendChild(t)}):r=function(e){setTimeout(p,0,e)}:(a="setImmediate$"+Math.random()+"$",o=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(a)&&p(+t.data.slice(a.length))},e.addEventListener?e.addEventListener("message",o,!1):e.attachEvent("onmessage",o),r=function(t){e.postMessage(a+t,"*")}),l.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),i=0;i<t.length;i++)t[i]=arguments[i+1];var s={callback:e,args:t};return c[h]=s,r(h),h++},l.clearImmediate=f}function f(e){delete c[e]}function p(e){if(d)setTimeout(p,0,e);else{var t=c[e];if(t){d=!0;try{!function(e){var t=e.callback,i=e.args;switch(i.length){case 0:t();break;case 1:t(i[0]);break;case 2:t(i[0],i[1]);break;case 3:t(i[0],i[1],i[2]);break;default:t.apply(void 0,i)}}(t)}finally{f(e),d=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,i(13),i(9))},function(e,t,i){(function(t){function i(e){try{if(!t.localStorage)return!1}catch(e){return!1}var i=t.localStorage[e];return null!=i&&"true"===String(i).toLowerCase()}e.exports=function(e,t){if(i("noDeprecation"))return e;var r=!1;return function(){if(!r){if(i("throwDeprecation"))throw new Error(t);i("traceDeprecation")?console.trace(t):console.warn(t),r=!0}return e.apply(this,arguments)}}}).call(this,i(13))},function(e,t,i){"use strict";e.exports=n;var r=i(65),s=Object.create(i(23));function n(e){if(!(this instanceof n))return new n(e);r.call(this,e)}s.inherits=i(1),s.inherits(n,r),n.prototype._transform=function(e,t,i){i(null,e)}},function(e,t,i){e.exports=i(43)},function(e,t,i){e.exports=i(19)},function(e,t,i){e.exports=i(42).Transform},function(e,t,i){e.exports=i(42).PassThrough},function(e,t,i){var r=i(1),s=i(21),n=i(2).Buffer,a=[1518500249,1859775393,-1894007588,-899497514],o=new Array(80);function h(){this.init(),this._w=o,s.call(this,64,56)}function c(e){return e<<30|e>>>2}function d(e,t,i,r){return 0===e?t&i|~t&r:2===e?t&i|t&r|i&r:t^i^r}r(h,s),h.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},h.prototype._update=function(e){for(var t,i=this._w,r=0|this._a,s=0|this._b,n=0|this._c,o=0|this._d,h=0|this._e,u=0;u<16;++u)i[u]=e.readInt32BE(4*u);for(;u<80;++u)i[u]=i[u-3]^i[u-8]^i[u-14]^i[u-16];for(var l=0;l<80;++l){var f=~~(l/20),p=0|((t=r)<<5|t>>>27)+d(f,s,n,o)+h+i[l]+a[f];h=o,o=n,n=c(s),s=r,r=p}this._a=r+this._a|0,this._b=s+this._b|0,this._c=n+this._c|0,this._d=o+this._d|0,this._e=h+this._e|0},h.prototype._hash=function(){var e=n.allocUnsafe(20);return e.writeInt32BE(0|this._a,0),e.writeInt32BE(0|this._b,4),e.writeInt32BE(0|this._c,8),e.writeInt32BE(0|this._d,12),e.writeInt32BE(0|this._e,16),e},e.exports=h},function(e,t,i){var r=i(1),s=i(21),n=i(2).Buffer,a=[1518500249,1859775393,-1894007588,-899497514],o=new Array(80);function h(){this.init(),this._w=o,s.call(this,64,56)}function c(e){return e<<5|e>>>27}function d(e){return e<<30|e>>>2}function u(e,t,i,r){return 0===e?t&i|~t&r:2===e?t&i|t&r|i&r:t^i^r}r(h,s),h.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},h.prototype._update=function(e){for(var t,i=this._w,r=0|this._a,s=0|this._b,n=0|this._c,o=0|this._d,h=0|this._e,l=0;l<16;++l)i[l]=e.readInt32BE(4*l);for(;l<80;++l)i[l]=(t=i[l-3]^i[l-8]^i[l-14]^i[l-16])<<1|t>>>31;for(var f=0;f<80;++f){var p=~~(f/20),m=c(r)+u(p,s,n,o)+h+i[f]+a[p]|0;h=o,o=n,n=d(s),s=r,r=m}this._a=r+this._a|0,this._b=s+this._b|0,this._c=n+this._c|0,this._d=o+this._d|0,this._e=h+this._e|0},h.prototype._hash=function(){var e=n.allocUnsafe(20);return e.writeInt32BE(0|this._a,0),e.writeInt32BE(0|this._b,4),e.writeInt32BE(0|this._c,8),e.writeInt32BE(0|this._d,12),e.writeInt32BE(0|this._e,16),e},e.exports=h},function(e,t,i){var r=i(1),s=i(66),n=i(21),a=i(2).Buffer,o=new Array(64);function h(){this.init(),this._w=o,n.call(this,64,56)}r(h,s),h.prototype.init=function(){return this._a=3238371032,this._b=914150663,this._c=812702999,this._d=4144912697,this._e=4290775857,this._f=1750603025,this._g=1694076839,this._h=3204075428,this},h.prototype._hash=function(){var e=a.allocUnsafe(28);return e.writeInt32BE(this._a,0),e.writeInt32BE(this._b,4),e.writeInt32BE(this._c,8),e.writeInt32BE(this._d,12),e.writeInt32BE(this._e,16),e.writeInt32BE(this._f,20),e.writeInt32BE(this._g,24),e},e.exports=h},function(e,t,i){var r=i(1),s=i(67),n=i(21),a=i(2).Buffer,o=new Array(160);function h(){this.init(),this._w=o,n.call(this,128,112)}r(h,s),h.prototype.init=function(){return this._ah=3418070365,this._bh=1654270250,this._ch=2438529370,this._dh=355462360,this._eh=1731405415,this._fh=2394180231,this._gh=3675008525,this._hh=1203062813,this._al=3238371032,this._bl=914150663,this._cl=812702999,this._dl=4144912697,this._el=4290775857,this._fl=1750603025,this._gl=1694076839,this._hl=3204075428,this},h.prototype._hash=function(){var e=a.allocUnsafe(48);function t(t,i,r){e.writeInt32BE(t,r),e.writeInt32BE(i,r+4)}return t(this._ah,this._al,0),t(this._bh,this._bl,8),t(this._ch,this._cl,16),t(this._dh,this._dl,24),t(this._eh,this._el,32),t(this._fh,this._fl,40),e},e.exports=h},function(e,t,i){"use strict";var r=i(1),s=i(2).Buffer,n=i(16),a=s.alloc(128);function o(e,t){n.call(this,"digest"),"string"==typeof t&&(t=s.from(t)),this._alg=e,this._key=t,t.length>64?t=e(t):t.length<64&&(t=s.concat([t,a],64));for(var i=this._ipad=s.allocUnsafe(64),r=this._opad=s.allocUnsafe(64),o=0;o<64;o++)i[o]=54^t[o],r[o]=92^t[o];this._hash=[i]}r(o,n),o.prototype._update=function(e){this._hash.push(e)},o.prototype._final=function(){var e=this._alg(s.concat(this._hash));return this._alg(s.concat([this._opad,e]))},e.exports=o},function(e,t,i){e.exports=i(70)},function(e,t,i){(function(t,r){var s,n=i(72),a=i(73),o=i(74),h=i(2).Buffer,c=t.crypto&&t.crypto.subtle,d={sha:"SHA-1","sha-1":"SHA-1",sha1:"SHA-1",sha256:"SHA-256","sha-256":"SHA-256",sha384:"SHA-384","sha-384":"SHA-384","sha-512":"SHA-512",sha512:"SHA-512"},u=[];function l(e,t,i,r,s){return c.importKey("raw",e,{name:"PBKDF2"},!1,["deriveBits"]).then((function(e){return c.deriveBits({name:"PBKDF2",salt:t,iterations:i,hash:{name:s}},e,r<<3)})).then((function(e){return h.from(e)}))}e.exports=function(e,i,f,p,m,_){"function"==typeof m&&(_=m,m=void 0);var g=d[(m=m||"sha1").toLowerCase()];if(!g||"function"!=typeof t.Promise)return r.nextTick((function(){var t;try{t=o(e,i,f,p,m)}catch(e){return _(e)}_(null,t)}));if(n(e,i,f,p),"function"!=typeof _)throw new Error("No callback provided to pbkdf2");h.isBuffer(e)||(e=h.from(e,a)),h.isBuffer(i)||(i=h.from(i,a)),function(e,t){e.then((function(e){r.nextTick((function(){t(null,e)}))}),(function(e){r.nextTick((function(){t(e)}))}))}(function(e){if(t.process&&!t.process.browser)return Promise.resolve(!1);if(!c||!c.importKey||!c.deriveBits)return Promise.resolve(!1);if(void 0!==u[e])return u[e];var i=l(s=s||h.alloc(8),s,10,128,e).then((function(){return!0})).catch((function(){return!1}));return u[e]=i,i}(g).then((function(t){return t?l(e,i,f,p,g):o(e,i,f,p,m)})),_)}}).call(this,i(13),i(9))},function(e,t,i){var r=i(152),s=i(47),n=i(48),a=i(165),o=i(33);function h(e,t,i){if(e=e.toLowerCase(),n[e])return s.createCipheriv(e,t,i);if(a[e])return new r({key:t,iv:i,mode:e});throw new TypeError("invalid suite type")}function c(e,t,i){if(e=e.toLowerCase(),n[e])return s.createDecipheriv(e,t,i);if(a[e])return new r({key:t,iv:i,mode:e,decrypt:!0});throw new TypeError("invalid suite type")}t.createCipher=t.Cipher=function(e,t){var i,r;if(e=e.toLowerCase(),n[e])i=n[e].key,r=n[e].iv;else{if(!a[e])throw new TypeError("invalid suite type");i=8*a[e].key,r=a[e].iv}var s=o(t,!1,i,r);return h(e,s.key,s.iv)},t.createCipheriv=t.Cipheriv=h,t.createDecipher=t.Decipher=function(e,t){var i,r;if(e=e.toLowerCase(),n[e])i=n[e].key,r=n[e].iv;else{if(!a[e])throw new TypeError("invalid suite type");i=8*a[e].key,r=a[e].iv}var s=o(t,!1,i,r);return c(e,s.key,s.iv)},t.createDecipheriv=t.Decipheriv=c,t.listCiphers=t.getCiphers=function(){return Object.keys(a).concat(s.getCiphers())}},function(e,t,i){var r=i(16),s=i(153),n=i(1),a=i(2).Buffer,o={"des-ede3-cbc":s.CBC.instantiate(s.EDE),"des-ede3":s.EDE,"des-ede-cbc":s.CBC.instantiate(s.EDE),"des-ede":s.EDE,"des-cbc":s.CBC.instantiate(s.DES),"des-ecb":s.DES};function h(e){r.call(this);var t,i=e.mode.toLowerCase(),s=o[i];t=e.decrypt?"decrypt":"encrypt";var n=e.key;a.isBuffer(n)||(n=a.from(n)),"des-ede"!==i&&"des-ede-cbc"!==i||(n=a.concat([n,n.slice(0,8)]));var h=e.iv;a.isBuffer(h)||(h=a.from(h)),this._des=s.create({key:n,iv:h,type:t})}o.des=o["des-cbc"],o.des3=o["des-ede3-cbc"],e.exports=h,n(h,r),h.prototype._update=function(e){return a.from(this._des.update(e))},h.prototype._final=function(){return a.from(this._des.final())}},function(e,t,i){"use strict";t.utils=i(75),t.Cipher=i(46),t.DES=i(76),t.CBC=i(154),t.EDE=i(155)},function(e,t,i){"use strict";var r=i(7),s=i(1),n={};function a(e){r.equal(e.length,8,"Invalid IV length"),this.iv=new Array(8);for(var t=0;t<this.iv.length;t++)this.iv[t]=e[t]}t.instantiate=function(e){function t(t){e.call(this,t),this._cbcInit()}s(t,e);for(var i=Object.keys(n),r=0;r<i.length;r++){var a=i[r];t.prototype[a]=n[a]}return t.create=function(e){return new t(e)},t},n._cbcInit=function(){var e=new a(this.options.iv);this._cbcState=e},n._update=function(e,t,i,r){var s=this._cbcState,n=this.constructor.super_.prototype,a=s.iv;if("encrypt"===this.type){for(var o=0;o<this.blockSize;o++)a[o]^=e[t+o];n._update.call(this,a,0,i,r);for(o=0;o<this.blockSize;o++)a[o]=i[r+o]}else{n._update.call(this,e,t,i,r);for(o=0;o<this.blockSize;o++)i[r+o]^=a[o];for(o=0;o<this.blockSize;o++)a[o]=e[t+o]}}},function(e,t,i){"use strict";var r=i(7),s=i(1),n=i(46),a=i(76);function o(e,t){r.equal(t.length,24,"Invalid key length");var i=t.slice(0,8),s=t.slice(8,16),n=t.slice(16,24);this.ciphers="encrypt"===e?[a.create({type:"encrypt",key:i}),a.create({type:"decrypt",key:s}),a.create({type:"encrypt",key:n})]:[a.create({type:"decrypt",key:n}),a.create({type:"encrypt",key:s}),a.create({type:"decrypt",key:i})]}function h(e){n.call(this,e);var t=new o(this.type,this.options.key);this._edeState=t}s(h,n),e.exports=h,h.create=function(e){return new h(e)},h.prototype._update=function(e,t,i,r){var s=this._edeState;s.ciphers[0]._update(e,t,i,r),s.ciphers[1]._update(i,r,i,r),s.ciphers[2]._update(i,r,i,r)},h.prototype._pad=a.prototype._pad,h.prototype._unpad=a.prototype._unpad},function(e,t,i){var r=i(48),s=i(80),n=i(2).Buffer,a=i(81),o=i(16),h=i(32),c=i(33);function d(e,t,i){o.call(this),this._cache=new l,this._cipher=new h.AES(t),this._prev=n.from(i),this._mode=e,this._autopadding=!0}i(1)(d,o),d.prototype._update=function(e){var t,i;this._cache.add(e);for(var r=[];t=this._cache.get();)i=this._mode.encrypt(this,t),r.push(i);return n.concat(r)};var u=n.alloc(16,16);function l(){this.cache=n.allocUnsafe(0)}function f(e,t,i){var o=r[e.toLowerCase()];if(!o)throw new TypeError("invalid suite type");if("string"==typeof t&&(t=n.from(t)),t.length!==o.key/8)throw new TypeError("invalid key length "+t.length);if("string"==typeof i&&(i=n.from(i)),"GCM"!==o.mode&&i.length!==o.iv)throw new TypeError("invalid iv length "+i.length);return"stream"===o.type?new a(o.module,t,i):"auth"===o.type?new s(o.module,t,i):new d(o.module,t,i)}d.prototype._final=function(){var e=this._cache.flush();if(this._autopadding)return e=this._mode.encrypt(this,e),this._cipher.scrub(),e;if(!e.equals(u))throw this._cipher.scrub(),new Error("data not multiple of block length")},d.prototype.setAutoPadding=function(e){return this._autopadding=!!e,this},l.prototype.add=function(e){this.cache=n.concat([this.cache,e])},l.prototype.get=function(){if(this.cache.length>15){var e=this.cache.slice(0,16);return this.cache=this.cache.slice(16),e}return null},l.prototype.flush=function(){for(var e=16-this.cache.length,t=n.allocUnsafe(e),i=-1;++i<e;)t.writeUInt8(e,i);return n.concat([this.cache,t])},t.createCipheriv=f,t.createCipher=function(e,t){var i=r[e.toLowerCase()];if(!i)throw new TypeError("invalid suite type");var s=c(t,!1,i.key,i.iv);return f(e,s.key,s.iv)}},function(e,t){t.encrypt=function(e,t){return e._cipher.encryptBlock(t)},t.decrypt=function(e,t){return e._cipher.decryptBlock(t)}},function(e,t,i){var r=i(24);t.encrypt=function(e,t){var i=r(t,e._prev);return e._prev=e._cipher.encryptBlock(i),e._prev},t.decrypt=function(e,t){var i=e._prev;e._prev=t;var s=e._cipher.decryptBlock(t);return r(s,i)}},function(e,t,i){var r=i(2).Buffer,s=i(24);function n(e,t,i){var n=t.length,a=s(t,e._cache);return e._cache=e._cache.slice(n),e._prev=r.concat([e._prev,i?t:a]),a}t.encrypt=function(e,t,i){for(var s,a=r.allocUnsafe(0);t.length;){if(0===e._cache.length&&(e._cache=e._cipher.encryptBlock(e._prev),e._prev=r.allocUnsafe(0)),!(e._cache.length<=t.length)){a=r.concat([a,n(e,t,i)]);break}s=e._cache.length,a=r.concat([a,n(e,t.slice(0,s),i)]),t=t.slice(s)}return a}},function(e,t,i){var r=i(2).Buffer;function s(e,t,i){var s=e._cipher.encryptBlock(e._prev)[0]^t;return e._prev=r.concat([e._prev.slice(1),r.from([i?t:s])]),s}t.encrypt=function(e,t,i){for(var n=t.length,a=r.allocUnsafe(n),o=-1;++o<n;)a[o]=s(e,t[o],i);return a}},function(e,t,i){var r=i(2).Buffer;function s(e,t,i){for(var r,s,a=-1,o=0;++a<8;)r=t&1<<7-a?128:0,o+=(128&(s=e._cipher.encryptBlock(e._prev)[0]^r))>>a%8,e._prev=n(e._prev,i?r:s);return o}function n(e,t){var i=e.length,s=-1,n=r.allocUnsafe(e.length);for(e=r.concat([e,r.from([t])]);++s<i;)n[s]=e[s]<<1|e[s+1]>>7;return n}t.encrypt=function(e,t,i){for(var n=t.length,a=r.allocUnsafe(n),o=-1;++o<n;)a[o]=s(e,t[o],i);return a}},function(e,t,i){(function(e){var r=i(24);function s(e){return e._prev=e._cipher.encryptBlock(e._prev),e._prev}t.encrypt=function(t,i){for(;t._cache.length<i.length;)t._cache=e.concat([t._cache,s(t)]);var n=t._cache.slice(0,i.length);return t._cache=t._cache.slice(i.length),r(i,n)}}).call(this,i(0).Buffer)},function(e,t,i){var r=i(2).Buffer,s=r.alloc(16,0);function n(e){var t=r.allocUnsafe(16);return t.writeUInt32BE(e[0]>>>0,0),t.writeUInt32BE(e[1]>>>0,4),t.writeUInt32BE(e[2]>>>0,8),t.writeUInt32BE(e[3]>>>0,12),t}function a(e){this.h=e,this.state=r.alloc(16,0),this.cache=r.allocUnsafe(0)}a.prototype.ghash=function(e){for(var t=-1;++t<e.length;)this.state[t]^=e[t];this._multiply()},a.prototype._multiply=function(){for(var e,t,i,r=[(e=this.h).readUInt32BE(0),e.readUInt32BE(4),e.readUInt32BE(8),e.readUInt32BE(12)],s=[0,0,0,0],a=-1;++a<128;){for(0!=(this.state[~~(a/8)]&1<<7-a%8)&&(s[0]^=r[0],s[1]^=r[1],s[2]^=r[2],s[3]^=r[3]),i=0!=(1&r[3]),t=3;t>0;t--)r[t]=r[t]>>>1|(1&r[t-1])<<31;r[0]=r[0]>>>1,i&&(r[0]=r[0]^225<<24)}this.state=n(s)},a.prototype.update=function(e){var t;for(this.cache=r.concat([this.cache,e]);this.cache.length>=16;)t=this.cache.slice(0,16),this.cache=this.cache.slice(16),this.ghash(t)},a.prototype.final=function(e,t){return this.cache.length&&this.ghash(r.concat([this.cache,s],16)),this.ghash(n([0,e,0,t])),this.state},e.exports=a},function(e,t,i){var r=i(80),s=i(2).Buffer,n=i(48),a=i(81),o=i(16),h=i(32),c=i(33);function d(e,t,i){o.call(this),this._cache=new u,this._last=void 0,this._cipher=new h.AES(t),this._prev=s.from(i),this._mode=e,this._autopadding=!0}function u(){this.cache=s.allocUnsafe(0)}function l(e,t,i){var o=n[e.toLowerCase()];if(!o)throw new TypeError("invalid suite type");if("string"==typeof i&&(i=s.from(i)),"GCM"!==o.mode&&i.length!==o.iv)throw new TypeError("invalid iv length "+i.length);if("string"==typeof t&&(t=s.from(t)),t.length!==o.key/8)throw new TypeError("invalid key length "+t.length);return"stream"===o.type?new a(o.module,t,i,!0):"auth"===o.type?new r(o.module,t,i,!0):new d(o.module,t,i)}i(1)(d,o),d.prototype._update=function(e){var t,i;this._cache.add(e);for(var r=[];t=this._cache.get(this._autopadding);)i=this._mode.decrypt(this,t),r.push(i);return s.concat(r)},d.prototype._final=function(){var e=this._cache.flush();if(this._autopadding)return function(e){var t=e[15];if(t<1||t>16)throw new Error("unable to decrypt data");var i=-1;for(;++i<t;)if(e[i+(16-t)]!==t)throw new Error("unable to decrypt data");if(16===t)return;return e.slice(0,16-t)}(this._mode.decrypt(this,e));if(e)throw new Error("data not multiple of block length")},d.prototype.setAutoPadding=function(e){return this._autopadding=!!e,this},u.prototype.add=function(e){this.cache=s.concat([this.cache,e])},u.prototype.get=function(e){var t;if(e){if(this.cache.length>16)return t=this.cache.slice(0,16),this.cache=this.cache.slice(16),t}else if(this.cache.length>=16)return t=this.cache.slice(0,16),this.cache=this.cache.slice(16),t;return null},u.prototype.flush=function(){if(this.cache.length)return this.cache},t.createDecipher=function(e,t){var i=n[e.toLowerCase()];if(!i)throw new TypeError("invalid suite type");var r=c(t,!1,i.key,i.iv);return l(e,r.key,r.iv)},t.createDecipheriv=l},function(e,t){t["des-ecb"]={key:8,iv:0},t["des-cbc"]=t.des={key:8,iv:8},t["des-ede3-cbc"]=t.des3={key:24,iv:8},t["des-ede3"]={key:24,iv:0},t["des-ede-cbc"]={key:16,iv:8},t["des-ede"]={key:16,iv:0}},function(e,t,i){(function(e){var r=i(82),s=i(170),n=i(171);var a={binary:!0,hex:!0,base64:!0};t.DiffieHellmanGroup=t.createDiffieHellmanGroup=t.getDiffieHellman=function(t){var i=new e(s[t].prime,"hex"),r=new e(s[t].gen,"hex");return new n(i,r)},t.createDiffieHellman=t.DiffieHellman=function t(i,s,o,h){return e.isBuffer(s)||void 0===a[s]?t(i,"binary",s,o):(s=s||"binary",h=h||"binary",o=o||new e([2]),e.isBuffer(o)||(o=new e(o,h)),"number"==typeof i?new n(r(i,o),o,!0):(e.isBuffer(i)||(i=new e(i,s)),new n(i,o,!0)))}}).call(this,i(0).Buffer)},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t){},function(e,t){},function(e){e.exports=JSON.parse('{"modp1":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a63a3620ffffffffffffffff"},"modp2":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece65381ffffffffffffffff"},"modp5":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca237327ffffffffffffffff"},"modp14":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aacaa68ffffffffffffffff"},"modp15":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a93ad2caffffffffffffffff"},"modp16":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c934063199ffffffffffffffff"},"modp17":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dcc4024ffffffffffffffff"},"modp18":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dbe115974a3926f12fee5e438777cb6a932df8cd8bec4d073b931ba3bc832b68d9dd300741fa7bf8afc47ed2576f6936ba424663aab639c5ae4f5683423b4742bf1c978238f16cbe39d652de3fdb8befc848ad922222e04a4037c0713eb57a81a23f0c73473fc646cea306b4bcbc8862f8385ddfa9d4b7fa2c087e879683303ed5bdd3a062b3cf5b3a278a66d2a13f83f44f82ddf310ee074ab6a364597e899a0255dc164f31cc50846851df9ab48195ded7ea1b1d510bd7ee74d73faf36bc31ecfa268359046f4eb879f924009438b481c6cd7889a002ed5ee382bc9190da6fc026e479558e4475677e9aa9e3050e2765694dfc81f56e880b96e7160c980dd98edd3dfffffffffffffffff"}}')},function(e,t,i){(function(t){var r=i(3),s=new(i(83)),n=new r(24),a=new r(11),o=new r(10),h=new r(3),c=new r(7),d=i(82),u=i(20);function l(e,i){return i=i||"utf8",t.isBuffer(e)||(e=new t(e,i)),this._pub=new r(e),this}function f(e,i){return i=i||"utf8",t.isBuffer(e)||(e=new t(e,i)),this._priv=new r(e),this}e.exports=m;var p={};function m(e,t,i){this.setGenerator(t),this.__prime=new r(e),this._prime=r.mont(this.__prime),this._primeLen=e.length,this._pub=void 0,this._priv=void 0,this._primeCode=void 0,i?(this.setPublicKey=l,this.setPrivateKey=f):this._primeCode=8}function _(e,i){var r=new t(e.toArray());return i?r.toString(i):r}Object.defineProperty(m.prototype,"verifyError",{enumerable:!0,get:function(){return"number"!=typeof this._primeCode&&(this._primeCode=function(e,t){var i=t.toString("hex"),r=[i,e.toString(16)].join("_");if(r in p)return p[r];var u,l=0;if(e.isEven()||!d.simpleSieve||!d.fermatTest(e)||!s.test(e))return l+=1,l+="02"===i||"05"===i?8:4,p[r]=l,l;switch(s.test(e.shrn(1))||(l+=2),i){case"02":e.mod(n).cmp(a)&&(l+=8);break;case"05":(u=e.mod(o)).cmp(h)&&u.cmp(c)&&(l+=8);break;default:l+=4}return p[r]=l,l}(this.__prime,this.__gen)),this._primeCode}}),m.prototype.generateKeys=function(){return this._priv||(this._priv=new r(u(this._primeLen))),this._pub=this._gen.toRed(this._prime).redPow(this._priv).fromRed(),this.getPublicKey()},m.prototype.computeSecret=function(e){var i=(e=(e=new r(e)).toRed(this._prime)).redPow(this._priv).fromRed(),s=new t(i.toArray()),n=this.getPrime();if(s.length<n.length){var a=new t(n.length-s.length);a.fill(0),s=t.concat([a,s])}return s},m.prototype.getPublicKey=function(e){return _(this._pub,e)},m.prototype.getPrivateKey=function(e){return _(this._priv,e)},m.prototype.getPrime=function(e){return _(this.__prime,e)},m.prototype.getGenerator=function(e){return _(this._gen,e)},m.prototype.setGenerator=function(e,i){return i=i||"utf8",t.isBuffer(e)||(e=new t(e,i)),this.__gen=e,this._gen=new r(e),this}}).call(this,i(0).Buffer)},function(e,t,i){(function(t){var r=i(22),s=i(41),n=i(1),a=i(173),o=i(205),h=i(70);function c(e){s.Writable.call(this);var t=h[e];if(!t)throw new Error("Unknown message digest");this._hashType=t.hash,this._hash=r(t.hash),this._tag=t.id,this._signType=t.sign}function d(e){s.Writable.call(this);var t=h[e];if(!t)throw new Error("Unknown message digest");this._hash=r(t.hash),this._tag=t.id,this._signType=t.sign}function u(e){return new c(e)}function l(e){return new d(e)}Object.keys(h).forEach((function(e){h[e].id=new t(h[e].id,"hex"),h[e.toLowerCase()]=h[e]})),n(c,s.Writable),c.prototype._write=function(e,t,i){this._hash.update(e),i()},c.prototype.update=function(e,i){return"string"==typeof e&&(e=new t(e,i)),this._hash.update(e),this},c.prototype.sign=function(e,t){this.end();var i=this._hash.digest(),r=a(i,e,this._hashType,this._signType,this._tag);return t?r.toString(t):r},n(d,s.Writable),d.prototype._write=function(e,t,i){this._hash.update(e),i()},d.prototype.update=function(e,i){return"string"==typeof e&&(e=new t(e,i)),this._hash.update(e),this},d.prototype.verify=function(e,i,r){"string"==typeof i&&(i=new t(i,r)),this.end();var s=this._hash.digest();return o(i,s,e,this._signType,this._tag)},e.exports={Sign:u,Verify:l,createSign:u,createVerify:l}}).call(this,i(0).Buffer)},function(e,t,i){(function(t){var r=i(68),s=i(50),n=i(51).ec,a=i(3),o=i(35),h=i(93);function c(e,i,s,n){if((e=new t(e.toArray())).length<i.byteLength()){var a=new t(i.byteLength()-e.length);a.fill(0),e=t.concat([a,e])}var o=s.length,h=function(e,i){e=(e=d(e,i)).mod(i);var r=new t(e.toArray());if(r.length<i.byteLength()){var s=new t(i.byteLength()-r.length);s.fill(0),r=t.concat([s,r])}return r}(s,i),c=new t(o);c.fill(1);var u=new t(o);return u.fill(0),u=r(n,u).update(c).update(new t([0])).update(e).update(h).digest(),c=r(n,u).update(c).digest(),{k:u=r(n,u).update(c).update(new t([1])).update(e).update(h).digest(),v:c=r(n,u).update(c).digest()}}function d(e,t){var i=new a(e),r=(e.length<<3)-t.bitLength();return r>0&&i.ishrn(r),i}function u(e,i,s){var n,a;do{for(n=new t(0);8*n.length<e.bitLength();)i.v=r(s,i.k).update(i.v).digest(),n=t.concat([n,i.v]);a=d(n,e),i.k=r(s,i.k).update(i.v).update(new t([0])).digest(),i.v=r(s,i.k).update(i.v).digest()}while(-1!==a.cmp(e));return a}function l(e,t,i,r){return e.toRed(a.mont(i)).redPow(t).fromRed().mod(r)}e.exports=function(e,i,r,f,p){var m=o(i);if(m.curve){if("ecdsa"!==f&&"ecdsa/rsa"!==f)throw new Error("wrong private key type");return function(e,i){var r=h[i.curve.join(".")];if(!r)throw new Error("unknown curve "+i.curve.join("."));var s=new n(r).keyFromPrivate(i.privateKey).sign(e);return new t(s.toDER())}(e,m)}if("dsa"===m.type){if("dsa"!==f)throw new Error("wrong private key type");return function(e,i,r){var s,n=i.params.priv_key,o=i.params.p,h=i.params.q,f=i.params.g,p=new a(0),m=d(e,h).mod(h),_=!1,g=c(n,h,e,r);for(;!1===_;)s=u(h,g,r),p=l(f,s,o,h),0===(_=s.invm(h).imul(m.add(n.mul(p))).mod(h)).cmpn(0)&&(_=!1,p=new a(0));return function(e,i){e=e.toArray(),i=i.toArray(),128&e[0]&&(e=[0].concat(e));128&i[0]&&(i=[0].concat(i));var r=[48,e.length+i.length+4,2,e.length];return r=r.concat(e,[2,i.length],i),new t(r)}(p,_)}(e,m,r)}if("rsa"!==f&&"ecdsa/rsa"!==f)throw new Error("wrong private key type");e=t.concat([p,e]);for(var _=m.modulus.byteLength(),g=[0,1];e.length+g.length+1<_;)g.push(255);g.push(0);for(var y=-1;++y<e.length;)g.push(e[y]);return s(g,m)},e.exports.getKey=c,e.exports.makeKey=u}).call(this,i(0).Buffer)},function(e){e.exports=JSON.parse('{"author":{"name":"Fedor Indutny","email":"fedor@indutny.com"},"bugs":{"url":"https://github.com/indutny/elliptic/issues"},"dependencies":{"bn.js":"^4.4.0","brorand":"^1.0.1","hash.js":"^1.0.0","hmac-drbg":"^1.0.0","inherits":"^2.0.1","minimalistic-assert":"^1.0.0","minimalistic-crypto-utils":"^1.0.0"},"description":"EC cryptography","devDependencies":{"brfs":"^1.4.3","coveralls":"^3.0.8","grunt":"^1.0.4","grunt-browserify":"^5.0.0","grunt-cli":"^1.2.0","grunt-contrib-connect":"^1.0.0","grunt-contrib-copy":"^1.0.0","grunt-contrib-uglify":"^1.0.1","grunt-mocha-istanbul":"^3.0.1","grunt-saucelabs":"^9.0.1","istanbul":"^0.4.2","jscs":"^3.0.7","jshint":"^2.10.3","mocha":"^6.2.2"},"files":["lib"],"homepage":"https://github.com/indutny/elliptic","keywords":["EC","Elliptic","curve","Cryptography"],"license":"MIT","main":"lib/elliptic.js","name":"elliptic","repository":{"type":"git","url":"git+ssh://git@github.com/indutny/elliptic.git"},"scripts":{"jscs":"jscs benchmarks/*.js lib/*.js lib/**/*.js lib/**/**/*.js test/index.js","jshint":"jscs benchmarks/*.js lib/*.js lib/**/*.js lib/**/**/*.js test/index.js","lint":"npm run jscs && npm run jshint","test":"npm run lint && npm run unit","unit":"istanbul test _mocha --reporter=spec test/index.js","version":"grunt dist && git add dist/"},"version":"6.5.2"}')},function(e,t,i){"use strict";var r=i(8),s=i(3),n=i(1),a=i(34),o=r.assert;function h(e){a.call(this,"short",e),this.a=new s(e.a,16).toRed(this.red),this.b=new s(e.b,16).toRed(this.red),this.tinv=this.two.redInvm(),this.zeroA=0===this.a.fromRed().cmpn(0),this.threeA=0===this.a.fromRed().sub(this.p).cmpn(-3),this.endo=this._getEndomorphism(e),this._endoWnafT1=new Array(4),this._endoWnafT2=new Array(4)}function c(e,t,i,r){a.BasePoint.call(this,e,"affine"),null===t&&null===i?(this.x=null,this.y=null,this.inf=!0):(this.x=new s(t,16),this.y=new s(i,16),r&&(this.x.forceRed(this.curve.red),this.y.forceRed(this.curve.red)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.inf=!1)}function d(e,t,i,r){a.BasePoint.call(this,e,"jacobian"),null===t&&null===i&&null===r?(this.x=this.curve.one,this.y=this.curve.one,this.z=new s(0)):(this.x=new s(t,16),this.y=new s(i,16),this.z=new s(r,16)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.zOne=this.z===this.curve.one}n(h,a),e.exports=h,h.prototype._getEndomorphism=function(e){if(this.zeroA&&this.g&&this.n&&1===this.p.modn(3)){var t,i;if(e.beta)t=new s(e.beta,16).toRed(this.red);else{var r=this._getEndoRoots(this.p);t=(t=r[0].cmp(r[1])<0?r[0]:r[1]).toRed(this.red)}if(e.lambda)i=new s(e.lambda,16);else{var n=this._getEndoRoots(this.n);0===this.g.mul(n[0]).x.cmp(this.g.x.redMul(t))?i=n[0]:(i=n[1],o(0===this.g.mul(i).x.cmp(this.g.x.redMul(t))))}return{beta:t,lambda:i,basis:e.basis?e.basis.map((function(e){return{a:new s(e.a,16),b:new s(e.b,16)}})):this._getEndoBasis(i)}}},h.prototype._getEndoRoots=function(e){var t=e===this.p?this.red:s.mont(e),i=new s(2).toRed(t).redInvm(),r=i.redNeg(),n=new s(3).toRed(t).redNeg().redSqrt().redMul(i);return[r.redAdd(n).fromRed(),r.redSub(n).fromRed()]},h.prototype._getEndoBasis=function(e){for(var t,i,r,n,a,o,h,c,d,u=this.n.ushrn(Math.floor(this.n.bitLength()/2)),l=e,f=this.n.clone(),p=new s(1),m=new s(0),_=new s(0),g=new s(1),y=0;0!==l.cmpn(0);){var b=f.div(l);c=f.sub(b.mul(l)),d=_.sub(b.mul(p));var v=g.sub(b.mul(m));if(!r&&c.cmp(u)<0)t=h.neg(),i=p,r=c.neg(),n=d;else if(r&&2==++y)break;h=c,f=l,l=c,_=p,p=d,g=m,m=v}a=c.neg(),o=d;var w=r.sqr().add(n.sqr());return a.sqr().add(o.sqr()).cmp(w)>=0&&(a=t,o=i),r.negative&&(r=r.neg(),n=n.neg()),a.negative&&(a=a.neg(),o=o.neg()),[{a:r,b:n},{a:a,b:o}]},h.prototype._endoSplit=function(e){var t=this.endo.basis,i=t[0],r=t[1],s=r.b.mul(e).divRound(this.n),n=i.b.neg().mul(e).divRound(this.n),a=s.mul(i.a),o=n.mul(r.a),h=s.mul(i.b),c=n.mul(r.b);return{k1:e.sub(a).sub(o),k2:h.add(c).neg()}},h.prototype.pointFromX=function(e,t){(e=new s(e,16)).red||(e=e.toRed(this.red));var i=e.redSqr().redMul(e).redIAdd(e.redMul(this.a)).redIAdd(this.b),r=i.redSqrt();if(0!==r.redSqr().redSub(i).cmp(this.zero))throw new Error("invalid point");var n=r.fromRed().isOdd();return(t&&!n||!t&&n)&&(r=r.redNeg()),this.point(e,r)},h.prototype.validate=function(e){if(e.inf)return!0;var t=e.x,i=e.y,r=this.a.redMul(t),s=t.redSqr().redMul(t).redIAdd(r).redIAdd(this.b);return 0===i.redSqr().redISub(s).cmpn(0)},h.prototype._endoWnafMulAdd=function(e,t,i){for(var r=this._endoWnafT1,s=this._endoWnafT2,n=0;n<e.length;n++){var a=this._endoSplit(t[n]),o=e[n],h=o._getBeta();a.k1.negative&&(a.k1.ineg(),o=o.neg(!0)),a.k2.negative&&(a.k2.ineg(),h=h.neg(!0)),r[2*n]=o,r[2*n+1]=h,s[2*n]=a.k1,s[2*n+1]=a.k2}for(var c=this._wnafMulAdd(1,r,s,2*n,i),d=0;d<2*n;d++)r[d]=null,s[d]=null;return c},n(c,a.BasePoint),h.prototype.point=function(e,t,i){return new c(this,e,t,i)},h.prototype.pointFromJSON=function(e,t){return c.fromJSON(this,e,t)},c.prototype._getBeta=function(){if(this.curve.endo){var e=this.precomputed;if(e&&e.beta)return e.beta;var t=this.curve.point(this.x.redMul(this.curve.endo.beta),this.y);if(e){var i=this.curve,r=function(e){return i.point(e.x.redMul(i.endo.beta),e.y)};e.beta=t,t.precomputed={beta:null,naf:e.naf&&{wnd:e.naf.wnd,points:e.naf.points.map(r)},doubles:e.doubles&&{step:e.doubles.step,points:e.doubles.points.map(r)}}}return t}},c.prototype.toJSON=function(){return this.precomputed?[this.x,this.y,this.precomputed&&{doubles:this.precomputed.doubles&&{step:this.precomputed.doubles.step,points:this.precomputed.doubles.points.slice(1)},naf:this.precomputed.naf&&{wnd:this.precomputed.naf.wnd,points:this.precomputed.naf.points.slice(1)}}]:[this.x,this.y]},c.fromJSON=function(e,t,i){"string"==typeof t&&(t=JSON.parse(t));var r=e.point(t[0],t[1],i);if(!t[2])return r;function s(t){return e.point(t[0],t[1],i)}var n=t[2];return r.precomputed={beta:null,doubles:n.doubles&&{step:n.doubles.step,points:[r].concat(n.doubles.points.map(s))},naf:n.naf&&{wnd:n.naf.wnd,points:[r].concat(n.naf.points.map(s))}},r},c.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+">"},c.prototype.isInfinity=function(){return this.inf},c.prototype.add=function(e){if(this.inf)return e;if(e.inf)return this;if(this.eq(e))return this.dbl();if(this.neg().eq(e))return this.curve.point(null,null);if(0===this.x.cmp(e.x))return this.curve.point(null,null);var t=this.y.redSub(e.y);0!==t.cmpn(0)&&(t=t.redMul(this.x.redSub(e.x).redInvm()));var i=t.redSqr().redISub(this.x).redISub(e.x),r=t.redMul(this.x.redSub(i)).redISub(this.y);return this.curve.point(i,r)},c.prototype.dbl=function(){if(this.inf)return this;var e=this.y.redAdd(this.y);if(0===e.cmpn(0))return this.curve.point(null,null);var t=this.curve.a,i=this.x.redSqr(),r=e.redInvm(),s=i.redAdd(i).redIAdd(i).redIAdd(t).redMul(r),n=s.redSqr().redISub(this.x.redAdd(this.x)),a=s.redMul(this.x.redSub(n)).redISub(this.y);return this.curve.point(n,a)},c.prototype.getX=function(){return this.x.fromRed()},c.prototype.getY=function(){return this.y.fromRed()},c.prototype.mul=function(e){return e=new s(e,16),this.isInfinity()?this:this._hasDoubles(e)?this.curve._fixedNafMul(this,e):this.curve.endo?this.curve._endoWnafMulAdd([this],[e]):this.curve._wnafMul(this,e)},c.prototype.mulAdd=function(e,t,i){var r=[this,t],s=[e,i];return this.curve.endo?this.curve._endoWnafMulAdd(r,s):this.curve._wnafMulAdd(1,r,s,2)},c.prototype.jmulAdd=function(e,t,i){var r=[this,t],s=[e,i];return this.curve.endo?this.curve._endoWnafMulAdd(r,s,!0):this.curve._wnafMulAdd(1,r,s,2,!0)},c.prototype.eq=function(e){return this===e||this.inf===e.inf&&(this.inf||0===this.x.cmp(e.x)&&0===this.y.cmp(e.y))},c.prototype.neg=function(e){if(this.inf)return this;var t=this.curve.point(this.x,this.y.redNeg());if(e&&this.precomputed){var i=this.precomputed,r=function(e){return e.neg()};t.precomputed={naf:i.naf&&{wnd:i.naf.wnd,points:i.naf.points.map(r)},doubles:i.doubles&&{step:i.doubles.step,points:i.doubles.points.map(r)}}}return t},c.prototype.toJ=function(){return this.inf?this.curve.jpoint(null,null,null):this.curve.jpoint(this.x,this.y,this.curve.one)},n(d,a.BasePoint),h.prototype.jpoint=function(e,t,i){return new d(this,e,t,i)},d.prototype.toP=function(){if(this.isInfinity())return this.curve.point(null,null);var e=this.z.redInvm(),t=e.redSqr(),i=this.x.redMul(t),r=this.y.redMul(t).redMul(e);return this.curve.point(i,r)},d.prototype.neg=function(){return this.curve.jpoint(this.x,this.y.redNeg(),this.z)},d.prototype.add=function(e){if(this.isInfinity())return e;if(e.isInfinity())return this;var t=e.z.redSqr(),i=this.z.redSqr(),r=this.x.redMul(t),s=e.x.redMul(i),n=this.y.redMul(t.redMul(e.z)),a=e.y.redMul(i.redMul(this.z)),o=r.redSub(s),h=n.redSub(a);if(0===o.cmpn(0))return 0!==h.cmpn(0)?this.curve.jpoint(null,null,null):this.dbl();var c=o.redSqr(),d=c.redMul(o),u=r.redMul(c),l=h.redSqr().redIAdd(d).redISub(u).redISub(u),f=h.redMul(u.redISub(l)).redISub(n.redMul(d)),p=this.z.redMul(e.z).redMul(o);return this.curve.jpoint(l,f,p)},d.prototype.mixedAdd=function(e){if(this.isInfinity())return e.toJ();if(e.isInfinity())return this;var t=this.z.redSqr(),i=this.x,r=e.x.redMul(t),s=this.y,n=e.y.redMul(t).redMul(this.z),a=i.redSub(r),o=s.redSub(n);if(0===a.cmpn(0))return 0!==o.cmpn(0)?this.curve.jpoint(null,null,null):this.dbl();var h=a.redSqr(),c=h.redMul(a),d=i.redMul(h),u=o.redSqr().redIAdd(c).redISub(d).redISub(d),l=o.redMul(d.redISub(u)).redISub(s.redMul(c)),f=this.z.redMul(a);return this.curve.jpoint(u,l,f)},d.prototype.dblp=function(e){if(0===e)return this;if(this.isInfinity())return this;if(!e)return this.dbl();if(this.curve.zeroA||this.curve.threeA){for(var t=this,i=0;i<e;i++)t=t.dbl();return t}var r=this.curve.a,s=this.curve.tinv,n=this.x,a=this.y,o=this.z,h=o.redSqr().redSqr(),c=a.redAdd(a);for(i=0;i<e;i++){var d=n.redSqr(),u=c.redSqr(),l=u.redSqr(),f=d.redAdd(d).redIAdd(d).redIAdd(r.redMul(h)),p=n.redMul(u),m=f.redSqr().redISub(p.redAdd(p)),_=p.redISub(m),g=f.redMul(_);g=g.redIAdd(g).redISub(l);var y=c.redMul(o);i+1<e&&(h=h.redMul(l)),n=m,o=y,c=g}return this.curve.jpoint(n,c.redMul(s),o)},d.prototype.dbl=function(){return this.isInfinity()?this:this.curve.zeroA?this._zeroDbl():this.curve.threeA?this._threeDbl():this._dbl()},d.prototype._zeroDbl=function(){var e,t,i;if(this.zOne){var r=this.x.redSqr(),s=this.y.redSqr(),n=s.redSqr(),a=this.x.redAdd(s).redSqr().redISub(r).redISub(n);a=a.redIAdd(a);var o=r.redAdd(r).redIAdd(r),h=o.redSqr().redISub(a).redISub(a),c=n.redIAdd(n);c=(c=c.redIAdd(c)).redIAdd(c),e=h,t=o.redMul(a.redISub(h)).redISub(c),i=this.y.redAdd(this.y)}else{var d=this.x.redSqr(),u=this.y.redSqr(),l=u.redSqr(),f=this.x.redAdd(u).redSqr().redISub(d).redISub(l);f=f.redIAdd(f);var p=d.redAdd(d).redIAdd(d),m=p.redSqr(),_=l.redIAdd(l);_=(_=_.redIAdd(_)).redIAdd(_),e=m.redISub(f).redISub(f),t=p.redMul(f.redISub(e)).redISub(_),i=(i=this.y.redMul(this.z)).redIAdd(i)}return this.curve.jpoint(e,t,i)},d.prototype._threeDbl=function(){var e,t,i;if(this.zOne){var r=this.x.redSqr(),s=this.y.redSqr(),n=s.redSqr(),a=this.x.redAdd(s).redSqr().redISub(r).redISub(n);a=a.redIAdd(a);var o=r.redAdd(r).redIAdd(r).redIAdd(this.curve.a),h=o.redSqr().redISub(a).redISub(a);e=h;var c=n.redIAdd(n);c=(c=c.redIAdd(c)).redIAdd(c),t=o.redMul(a.redISub(h)).redISub(c),i=this.y.redAdd(this.y)}else{var d=this.z.redSqr(),u=this.y.redSqr(),l=this.x.redMul(u),f=this.x.redSub(d).redMul(this.x.redAdd(d));f=f.redAdd(f).redIAdd(f);var p=l.redIAdd(l),m=(p=p.redIAdd(p)).redAdd(p);e=f.redSqr().redISub(m),i=this.y.redAdd(this.z).redSqr().redISub(u).redISub(d);var _=u.redSqr();_=(_=(_=_.redIAdd(_)).redIAdd(_)).redIAdd(_),t=f.redMul(p.redISub(e)).redISub(_)}return this.curve.jpoint(e,t,i)},d.prototype._dbl=function(){var e=this.curve.a,t=this.x,i=this.y,r=this.z,s=r.redSqr().redSqr(),n=t.redSqr(),a=i.redSqr(),o=n.redAdd(n).redIAdd(n).redIAdd(e.redMul(s)),h=t.redAdd(t),c=(h=h.redIAdd(h)).redMul(a),d=o.redSqr().redISub(c.redAdd(c)),u=c.redISub(d),l=a.redSqr();l=(l=(l=l.redIAdd(l)).redIAdd(l)).redIAdd(l);var f=o.redMul(u).redISub(l),p=i.redAdd(i).redMul(r);return this.curve.jpoint(d,f,p)},d.prototype.trpl=function(){if(!this.curve.zeroA)return this.dbl().add(this);var e=this.x.redSqr(),t=this.y.redSqr(),i=this.z.redSqr(),r=t.redSqr(),s=e.redAdd(e).redIAdd(e),n=s.redSqr(),a=this.x.redAdd(t).redSqr().redISub(e).redISub(r),o=(a=(a=(a=a.redIAdd(a)).redAdd(a).redIAdd(a)).redISub(n)).redSqr(),h=r.redIAdd(r);h=(h=(h=h.redIAdd(h)).redIAdd(h)).redIAdd(h);var c=s.redIAdd(a).redSqr().redISub(n).redISub(o).redISub(h),d=t.redMul(c);d=(d=d.redIAdd(d)).redIAdd(d);var u=this.x.redMul(o).redISub(d);u=(u=u.redIAdd(u)).redIAdd(u);var l=this.y.redMul(c.redMul(h.redISub(c)).redISub(a.redMul(o)));l=(l=(l=l.redIAdd(l)).redIAdd(l)).redIAdd(l);var f=this.z.redAdd(a).redSqr().redISub(i).redISub(o);return this.curve.jpoint(u,l,f)},d.prototype.mul=function(e,t){return e=new s(e,t),this.curve._wnafMul(this,e)},d.prototype.eq=function(e){if("affine"===e.type)return this.eq(e.toJ());if(this===e)return!0;var t=this.z.redSqr(),i=e.z.redSqr();if(0!==this.x.redMul(i).redISub(e.x.redMul(t)).cmpn(0))return!1;var r=t.redMul(this.z),s=i.redMul(e.z);return 0===this.y.redMul(s).redISub(e.y.redMul(r)).cmpn(0)},d.prototype.eqXToP=function(e){var t=this.z.redSqr(),i=e.toRed(this.curve.red).redMul(t);if(0===this.x.cmp(i))return!0;for(var r=e.clone(),s=this.curve.redN.redMul(t);;){if(r.iadd(this.curve.n),r.cmp(this.curve.p)>=0)return!1;if(i.redIAdd(s),0===this.x.cmp(i))return!0}},d.prototype.inspect=function(){return this.isInfinity()?"<EC JPoint Infinity>":"<EC JPoint x: "+this.x.toString(16,2)+" y: "+this.y.toString(16,2)+" z: "+this.z.toString(16,2)+">"},d.prototype.isInfinity=function(){return 0===this.z.cmpn(0)}},function(e,t,i){"use strict";var r=i(3),s=i(1),n=i(34),a=i(8);function o(e){n.call(this,"mont",e),this.a=new r(e.a,16).toRed(this.red),this.b=new r(e.b,16).toRed(this.red),this.i4=new r(4).toRed(this.red).redInvm(),this.two=new r(2).toRed(this.red),this.a24=this.i4.redMul(this.a.redAdd(this.two))}function h(e,t,i){n.BasePoint.call(this,e,"projective"),null===t&&null===i?(this.x=this.curve.one,this.z=this.curve.zero):(this.x=new r(t,16),this.z=new r(i,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)))}s(o,n),e.exports=o,o.prototype.validate=function(e){var t=e.normalize().x,i=t.redSqr(),r=i.redMul(t).redAdd(i.redMul(this.a)).redAdd(t);return 0===r.redSqrt().redSqr().cmp(r)},s(h,n.BasePoint),o.prototype.decodePoint=function(e,t){return this.point(a.toArray(e,t),1)},o.prototype.point=function(e,t){return new h(this,e,t)},o.prototype.pointFromJSON=function(e){return h.fromJSON(this,e)},h.prototype.precompute=function(){},h.prototype._encode=function(){return this.getX().toArray("be",this.curve.p.byteLength())},h.fromJSON=function(e,t){return new h(e,t[0],t[1]||e.one)},h.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},h.prototype.isInfinity=function(){return 0===this.z.cmpn(0)},h.prototype.dbl=function(){var e=this.x.redAdd(this.z).redSqr(),t=this.x.redSub(this.z).redSqr(),i=e.redSub(t),r=e.redMul(t),s=i.redMul(t.redAdd(this.curve.a24.redMul(i)));return this.curve.point(r,s)},h.prototype.add=function(){throw new Error("Not supported on Montgomery curve")},h.prototype.diffAdd=function(e,t){var i=this.x.redAdd(this.z),r=this.x.redSub(this.z),s=e.x.redAdd(e.z),n=e.x.redSub(e.z).redMul(i),a=s.redMul(r),o=t.z.redMul(n.redAdd(a).redSqr()),h=t.x.redMul(n.redISub(a).redSqr());return this.curve.point(o,h)},h.prototype.mul=function(e){for(var t=e.clone(),i=this,r=this.curve.point(null,null),s=[];0!==t.cmpn(0);t.iushrn(1))s.push(t.andln(1));for(var n=s.length-1;n>=0;n--)0===s[n]?(i=i.diffAdd(r,this),r=r.dbl()):(r=i.diffAdd(r,this),i=i.dbl());return r},h.prototype.mulAdd=function(){throw new Error("Not supported on Montgomery curve")},h.prototype.jumlAdd=function(){throw new Error("Not supported on Montgomery curve")},h.prototype.eq=function(e){return 0===this.getX().cmp(e.getX())},h.prototype.normalize=function(){return this.x=this.x.redMul(this.z.redInvm()),this.z=this.curve.one,this},h.prototype.getX=function(){return this.normalize(),this.x.fromRed()}},function(e,t,i){"use strict";var r=i(8),s=i(3),n=i(1),a=i(34),o=r.assert;function h(e){this.twisted=1!=(0|e.a),this.mOneA=this.twisted&&-1==(0|e.a),this.extended=this.mOneA,a.call(this,"edwards",e),this.a=new s(e.a,16).umod(this.red.m),this.a=this.a.toRed(this.red),this.c=new s(e.c,16).toRed(this.red),this.c2=this.c.redSqr(),this.d=new s(e.d,16).toRed(this.red),this.dd=this.d.redAdd(this.d),o(!this.twisted||0===this.c.fromRed().cmpn(1)),this.oneC=1==(0|e.c)}function c(e,t,i,r,n){a.BasePoint.call(this,e,"projective"),null===t&&null===i&&null===r?(this.x=this.curve.zero,this.y=this.curve.one,this.z=this.curve.one,this.t=this.curve.zero,this.zOne=!0):(this.x=new s(t,16),this.y=new s(i,16),this.z=r?new s(r,16):this.curve.one,this.t=n&&new s(n,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.t&&!this.t.red&&(this.t=this.t.toRed(this.curve.red)),this.zOne=this.z===this.curve.one,this.curve.extended&&!this.t&&(this.t=this.x.redMul(this.y),this.zOne||(this.t=this.t.redMul(this.z.redInvm()))))}n(h,a),e.exports=h,h.prototype._mulA=function(e){return this.mOneA?e.redNeg():this.a.redMul(e)},h.prototype._mulC=function(e){return this.oneC?e:this.c.redMul(e)},h.prototype.jpoint=function(e,t,i,r){return this.point(e,t,i,r)},h.prototype.pointFromX=function(e,t){(e=new s(e,16)).red||(e=e.toRed(this.red));var i=e.redSqr(),r=this.c2.redSub(this.a.redMul(i)),n=this.one.redSub(this.c2.redMul(this.d).redMul(i)),a=r.redMul(n.redInvm()),o=a.redSqrt();if(0!==o.redSqr().redSub(a).cmp(this.zero))throw new Error("invalid point");var h=o.fromRed().isOdd();return(t&&!h||!t&&h)&&(o=o.redNeg()),this.point(e,o)},h.prototype.pointFromY=function(e,t){(e=new s(e,16)).red||(e=e.toRed(this.red));var i=e.redSqr(),r=i.redSub(this.c2),n=i.redMul(this.d).redMul(this.c2).redSub(this.a),a=r.redMul(n.redInvm());if(0===a.cmp(this.zero)){if(t)throw new Error("invalid point");return this.point(this.zero,e)}var o=a.redSqrt();if(0!==o.redSqr().redSub(a).cmp(this.zero))throw new Error("invalid point");return o.fromRed().isOdd()!==t&&(o=o.redNeg()),this.point(o,e)},h.prototype.validate=function(e){if(e.isInfinity())return!0;e.normalize();var t=e.x.redSqr(),i=e.y.redSqr(),r=t.redMul(this.a).redAdd(i),s=this.c2.redMul(this.one.redAdd(this.d.redMul(t).redMul(i)));return 0===r.cmp(s)},n(c,a.BasePoint),h.prototype.pointFromJSON=function(e){return c.fromJSON(this,e)},h.prototype.point=function(e,t,i,r){return new c(this,e,t,i,r)},c.fromJSON=function(e,t){return new c(e,t[0],t[1],t[2])},c.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},c.prototype.isInfinity=function(){return 0===this.x.cmpn(0)&&(0===this.y.cmp(this.z)||this.zOne&&0===this.y.cmp(this.curve.c))},c.prototype._extDbl=function(){var e=this.x.redSqr(),t=this.y.redSqr(),i=this.z.redSqr();i=i.redIAdd(i);var r=this.curve._mulA(e),s=this.x.redAdd(this.y).redSqr().redISub(e).redISub(t),n=r.redAdd(t),a=n.redSub(i),o=r.redSub(t),h=s.redMul(a),c=n.redMul(o),d=s.redMul(o),u=a.redMul(n);return this.curve.point(h,c,u,d)},c.prototype._projDbl=function(){var e,t,i,r=this.x.redAdd(this.y).redSqr(),s=this.x.redSqr(),n=this.y.redSqr();if(this.curve.twisted){var a=(c=this.curve._mulA(s)).redAdd(n);if(this.zOne)e=r.redSub(s).redSub(n).redMul(a.redSub(this.curve.two)),t=a.redMul(c.redSub(n)),i=a.redSqr().redSub(a).redSub(a);else{var o=this.z.redSqr(),h=a.redSub(o).redISub(o);e=r.redSub(s).redISub(n).redMul(h),t=a.redMul(c.redSub(n)),i=a.redMul(h)}}else{var c=s.redAdd(n);o=this.curve._mulC(this.z).redSqr(),h=c.redSub(o).redSub(o);e=this.curve._mulC(r.redISub(c)).redMul(h),t=this.curve._mulC(c).redMul(s.redISub(n)),i=c.redMul(h)}return this.curve.point(e,t,i)},c.prototype.dbl=function(){return this.isInfinity()?this:this.curve.extended?this._extDbl():this._projDbl()},c.prototype._extAdd=function(e){var t=this.y.redSub(this.x).redMul(e.y.redSub(e.x)),i=this.y.redAdd(this.x).redMul(e.y.redAdd(e.x)),r=this.t.redMul(this.curve.dd).redMul(e.t),s=this.z.redMul(e.z.redAdd(e.z)),n=i.redSub(t),a=s.redSub(r),o=s.redAdd(r),h=i.redAdd(t),c=n.redMul(a),d=o.redMul(h),u=n.redMul(h),l=a.redMul(o);return this.curve.point(c,d,l,u)},c.prototype._projAdd=function(e){var t,i,r=this.z.redMul(e.z),s=r.redSqr(),n=this.x.redMul(e.x),a=this.y.redMul(e.y),o=this.curve.d.redMul(n).redMul(a),h=s.redSub(o),c=s.redAdd(o),d=this.x.redAdd(this.y).redMul(e.x.redAdd(e.y)).redISub(n).redISub(a),u=r.redMul(h).redMul(d);return this.curve.twisted?(t=r.redMul(c).redMul(a.redSub(this.curve._mulA(n))),i=h.redMul(c)):(t=r.redMul(c).redMul(a.redSub(n)),i=this.curve._mulC(h).redMul(c)),this.curve.point(u,t,i)},c.prototype.add=function(e){return this.isInfinity()?e:e.isInfinity()?this:this.curve.extended?this._extAdd(e):this._projAdd(e)},c.prototype.mul=function(e){return this._hasDoubles(e)?this.curve._fixedNafMul(this,e):this.curve._wnafMul(this,e)},c.prototype.mulAdd=function(e,t,i){return this.curve._wnafMulAdd(1,[this,t],[e,i],2,!1)},c.prototype.jmulAdd=function(e,t,i){return this.curve._wnafMulAdd(1,[this,t],[e,i],2,!0)},c.prototype.normalize=function(){if(this.zOne)return this;var e=this.z.redInvm();return this.x=this.x.redMul(e),this.y=this.y.redMul(e),this.t&&(this.t=this.t.redMul(e)),this.z=this.curve.one,this.zOne=!0,this},c.prototype.neg=function(){return this.curve.point(this.x.redNeg(),this.y,this.z,this.t&&this.t.redNeg())},c.prototype.getX=function(){return this.normalize(),this.x.fromRed()},c.prototype.getY=function(){return this.normalize(),this.y.fromRed()},c.prototype.eq=function(e){return this===e||0===this.getX().cmp(e.getX())&&0===this.getY().cmp(e.getY())},c.prototype.eqXToP=function(e){var t=e.toRed(this.curve.red).redMul(this.z);if(0===this.x.cmp(t))return!0;for(var i=e.clone(),r=this.curve.redN.redMul(this.z);;){if(i.iadd(this.curve.n),i.cmp(this.curve.p)>=0)return!1;if(t.redIAdd(r),0===this.x.cmp(t))return!0}},c.prototype.toP=c.prototype.normalize,c.prototype.mixedAdd=c.prototype.add},function(e,t,i){"use strict";t.sha1=i(179),t.sha224=i(180),t.sha256=i(87),t.sha384=i(181),t.sha512=i(88)},function(e,t,i){"use strict";var r=i(11),s=i(25),n=i(86),a=r.rotl32,o=r.sum32,h=r.sum32_5,c=n.ft_1,d=s.BlockHash,u=[1518500249,1859775393,2400959708,3395469782];function l(){if(!(this instanceof l))return new l;d.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.W=new Array(80)}r.inherits(l,d),e.exports=l,l.blockSize=512,l.outSize=160,l.hmacStrength=80,l.padLength=64,l.prototype._update=function(e,t){for(var i=this.W,r=0;r<16;r++)i[r]=e[t+r];for(;r<i.length;r++)i[r]=a(i[r-3]^i[r-8]^i[r-14]^i[r-16],1);var s=this.h[0],n=this.h[1],d=this.h[2],l=this.h[3],f=this.h[4];for(r=0;r<i.length;r++){var p=~~(r/20),m=h(a(s,5),c(p,n,d,l),f,i[r],u[p]);f=l,l=d,d=a(n,30),n=s,s=m}this.h[0]=o(this.h[0],s),this.h[1]=o(this.h[1],n),this.h[2]=o(this.h[2],d),this.h[3]=o(this.h[3],l),this.h[4]=o(this.h[4],f)},l.prototype._digest=function(e){return"hex"===e?r.toHex32(this.h,"big"):r.split32(this.h,"big")}},function(e,t,i){"use strict";var r=i(11),s=i(87);function n(){if(!(this instanceof n))return new n;s.call(this),this.h=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]}r.inherits(n,s),e.exports=n,n.blockSize=512,n.outSize=224,n.hmacStrength=192,n.padLength=64,n.prototype._digest=function(e){return"hex"===e?r.toHex32(this.h.slice(0,7),"big"):r.split32(this.h.slice(0,7),"big")}},function(e,t,i){"use strict";var r=i(11),s=i(88);function n(){if(!(this instanceof n))return new n;s.call(this),this.h=[3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]}r.inherits(n,s),e.exports=n,n.blockSize=1024,n.outSize=384,n.hmacStrength=192,n.padLength=128,n.prototype._digest=function(e){return"hex"===e?r.toHex32(this.h.slice(0,12),"big"):r.split32(this.h.slice(0,12),"big")}},function(e,t,i){"use strict";var r=i(11),s=i(25),n=r.rotl32,a=r.sum32,o=r.sum32_3,h=r.sum32_4,c=s.BlockHash;function d(){if(!(this instanceof d))return new d;c.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.endian="little"}function u(e,t,i,r){return e<=15?t^i^r:e<=31?t&i|~t&r:e<=47?(t|~i)^r:e<=63?t&r|i&~r:t^(i|~r)}function l(e){return e<=15?0:e<=31?1518500249:e<=47?1859775393:e<=63?2400959708:2840853838}function f(e){return e<=15?1352829926:e<=31?1548603684:e<=47?1836072691:e<=63?2053994217:0}r.inherits(d,c),t.ripemd160=d,d.blockSize=512,d.outSize=160,d.hmacStrength=192,d.padLength=64,d.prototype._update=function(e,t){for(var i=this.h[0],r=this.h[1],s=this.h[2],c=this.h[3],d=this.h[4],y=i,b=r,v=s,w=c,S=d,E=0;E<80;E++){var C=a(n(h(i,u(E,r,s,c),e[p[E]+t],l(E)),_[E]),d);i=d,d=c,c=n(s,10),s=r,r=C,C=a(n(h(y,u(79-E,b,v,w),e[m[E]+t],f(E)),g[E]),S),y=S,S=w,w=n(v,10),v=b,b=C}C=o(this.h[1],s,w),this.h[1]=o(this.h[2],c,S),this.h[2]=o(this.h[3],d,y),this.h[3]=o(this.h[4],i,b),this.h[4]=o(this.h[0],r,v),this.h[0]=C},d.prototype._digest=function(e){return"hex"===e?r.toHex32(this.h,"little"):r.split32(this.h,"little")};var p=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],m=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],_=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],g=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]},function(e,t,i){"use strict";var r=i(11),s=i(7);function n(e,t,i){if(!(this instanceof n))return new n(e,t,i);this.Hash=e,this.blockSize=e.blockSize/8,this.outSize=e.outSize/8,this.inner=null,this.outer=null,this._init(r.toArray(t,i))}e.exports=n,n.prototype._init=function(e){e.length>this.blockSize&&(e=(new this.Hash).update(e).digest()),s(e.length<=this.blockSize);for(var t=e.length;t<this.blockSize;t++)e.push(0);for(t=0;t<e.length;t++)e[t]^=54;for(this.inner=(new this.Hash).update(e),t=0;t<e.length;t++)e[t]^=106;this.outer=(new this.Hash).update(e)},n.prototype.update=function(e,t){return this.inner.update(e,t),this},n.prototype.digest=function(e){return this.outer.update(this.inner.digest()),this.outer.digest(e)}},function(e,t){e.exports={doubles:{step:4,points:[["e60fce93b59e9ec53011aabc21c23e97b2a31369b87a5ae9c44ee89e2a6dec0a","f7e3507399e595929db99f34f57937101296891e44d23f0be1f32cce69616821"],["8282263212c609d9ea2a6e3e172de238d8c39cabd5ac1ca10646e23fd5f51508","11f8a8098557dfe45e8256e830b60ace62d613ac2f7b17bed31b6eaff6e26caf"],["175e159f728b865a72f99cc6c6fc846de0b93833fd2222ed73fce5b551e5b739","d3506e0d9e3c79eba4ef97a51ff71f5eacb5955add24345c6efa6ffee9fed695"],["363d90d447b00c9c99ceac05b6262ee053441c7e55552ffe526bad8f83ff4640","4e273adfc732221953b445397f3363145b9a89008199ecb62003c7f3bee9de9"],["8b4b5f165df3c2be8c6244b5b745638843e4a781a15bcd1b69f79a55dffdf80c","4aad0a6f68d308b4b3fbd7813ab0da04f9e336546162ee56b3eff0c65fd4fd36"],["723cbaa6e5db996d6bf771c00bd548c7b700dbffa6c0e77bcb6115925232fcda","96e867b5595cc498a921137488824d6e2660a0653779494801dc069d9eb39f5f"],["eebfa4d493bebf98ba5feec812c2d3b50947961237a919839a533eca0e7dd7fa","5d9a8ca3970ef0f269ee7edaf178089d9ae4cdc3a711f712ddfd4fdae1de8999"],["100f44da696e71672791d0a09b7bde459f1215a29b3c03bfefd7835b39a48db0","cdd9e13192a00b772ec8f3300c090666b7ff4a18ff5195ac0fbd5cd62bc65a09"],["e1031be262c7ed1b1dc9227a4a04c017a77f8d4464f3b3852c8acde6e534fd2d","9d7061928940405e6bb6a4176597535af292dd419e1ced79a44f18f29456a00d"],["feea6cae46d55b530ac2839f143bd7ec5cf8b266a41d6af52d5e688d9094696d","e57c6b6c97dce1bab06e4e12bf3ecd5c981c8957cc41442d3155debf18090088"],["da67a91d91049cdcb367be4be6ffca3cfeed657d808583de33fa978bc1ec6cb1","9bacaa35481642bc41f463f7ec9780e5dec7adc508f740a17e9ea8e27a68be1d"],["53904faa0b334cdda6e000935ef22151ec08d0f7bb11069f57545ccc1a37b7c0","5bc087d0bc80106d88c9eccac20d3c1c13999981e14434699dcb096b022771c8"],["8e7bcd0bd35983a7719cca7764ca906779b53a043a9b8bcaeff959f43ad86047","10b7770b2a3da4b3940310420ca9514579e88e2e47fd68b3ea10047e8460372a"],["385eed34c1cdff21e6d0818689b81bde71a7f4f18397e6690a841e1599c43862","283bebc3e8ea23f56701de19e9ebf4576b304eec2086dc8cc0458fe5542e5453"],["6f9d9b803ecf191637c73a4413dfa180fddf84a5947fbc9c606ed86c3fac3a7","7c80c68e603059ba69b8e2a30e45c4d47ea4dd2f5c281002d86890603a842160"],["3322d401243c4e2582a2147c104d6ecbf774d163db0f5e5313b7e0e742d0e6bd","56e70797e9664ef5bfb019bc4ddaf9b72805f63ea2873af624f3a2e96c28b2a0"],["85672c7d2de0b7da2bd1770d89665868741b3f9af7643397721d74d28134ab83","7c481b9b5b43b2eb6374049bfa62c2e5e77f17fcc5298f44c8e3094f790313a6"],["948bf809b1988a46b06c9f1919413b10f9226c60f668832ffd959af60c82a0a","53a562856dcb6646dc6b74c5d1c3418c6d4dff08c97cd2bed4cb7f88d8c8e589"],["6260ce7f461801c34f067ce0f02873a8f1b0e44dfc69752accecd819f38fd8e8","bc2da82b6fa5b571a7f09049776a1ef7ecd292238051c198c1a84e95b2b4ae17"],["e5037de0afc1d8d43d8348414bbf4103043ec8f575bfdc432953cc8d2037fa2d","4571534baa94d3b5f9f98d09fb990bddbd5f5b03ec481f10e0e5dc841d755bda"],["e06372b0f4a207adf5ea905e8f1771b4e7e8dbd1c6a6c5b725866a0ae4fce725","7a908974bce18cfe12a27bb2ad5a488cd7484a7787104870b27034f94eee31dd"],["213c7a715cd5d45358d0bbf9dc0ce02204b10bdde2a3f58540ad6908d0559754","4b6dad0b5ae462507013ad06245ba190bb4850f5f36a7eeddff2c27534b458f2"],["4e7c272a7af4b34e8dbb9352a5419a87e2838c70adc62cddf0cc3a3b08fbd53c","17749c766c9d0b18e16fd09f6def681b530b9614bff7dd33e0b3941817dcaae6"],["fea74e3dbe778b1b10f238ad61686aa5c76e3db2be43057632427e2840fb27b6","6e0568db9b0b13297cf674deccb6af93126b596b973f7b77701d3db7f23cb96f"],["76e64113f677cf0e10a2570d599968d31544e179b760432952c02a4417bdde39","c90ddf8dee4e95cf577066d70681f0d35e2a33d2b56d2032b4b1752d1901ac01"],["c738c56b03b2abe1e8281baa743f8f9a8f7cc643df26cbee3ab150242bcbb891","893fb578951ad2537f718f2eacbfbbbb82314eef7880cfe917e735d9699a84c3"],["d895626548b65b81e264c7637c972877d1d72e5f3a925014372e9f6588f6c14b","febfaa38f2bc7eae728ec60818c340eb03428d632bb067e179363ed75d7d991f"],["b8da94032a957518eb0f6433571e8761ceffc73693e84edd49150a564f676e03","2804dfa44805a1e4d7c99cc9762808b092cc584d95ff3b511488e4e74efdf6e7"],["e80fea14441fb33a7d8adab9475d7fab2019effb5156a792f1a11778e3c0df5d","eed1de7f638e00771e89768ca3ca94472d155e80af322ea9fcb4291b6ac9ec78"],["a301697bdfcd704313ba48e51d567543f2a182031efd6915ddc07bbcc4e16070","7370f91cfb67e4f5081809fa25d40f9b1735dbf7c0a11a130c0d1a041e177ea1"],["90ad85b389d6b936463f9d0512678de208cc330b11307fffab7ac63e3fb04ed4","e507a3620a38261affdcbd9427222b839aefabe1582894d991d4d48cb6ef150"],["8f68b9d2f63b5f339239c1ad981f162ee88c5678723ea3351b7b444c9ec4c0da","662a9f2dba063986de1d90c2b6be215dbbea2cfe95510bfdf23cbf79501fff82"],["e4f3fb0176af85d65ff99ff9198c36091f48e86503681e3e6686fd5053231e11","1e63633ad0ef4f1c1661a6d0ea02b7286cc7e74ec951d1c9822c38576feb73bc"],["8c00fa9b18ebf331eb961537a45a4266c7034f2f0d4e1d0716fb6eae20eae29e","efa47267fea521a1a9dc343a3736c974c2fadafa81e36c54e7d2a4c66702414b"],["e7a26ce69dd4829f3e10cec0a9e98ed3143d084f308b92c0997fddfc60cb3e41","2a758e300fa7984b471b006a1aafbb18d0a6b2c0420e83e20e8a9421cf2cfd51"],["b6459e0ee3662ec8d23540c223bcbdc571cbcb967d79424f3cf29eb3de6b80ef","67c876d06f3e06de1dadf16e5661db3c4b3ae6d48e35b2ff30bf0b61a71ba45"],["d68a80c8280bb840793234aa118f06231d6f1fc67e73c5a5deda0f5b496943e8","db8ba9fff4b586d00c4b1f9177b0e28b5b0e7b8f7845295a294c84266b133120"],["324aed7df65c804252dc0270907a30b09612aeb973449cea4095980fc28d3d5d","648a365774b61f2ff130c0c35aec1f4f19213b0c7e332843967224af96ab7c84"],["4df9c14919cde61f6d51dfdbe5fee5dceec4143ba8d1ca888e8bd373fd054c96","35ec51092d8728050974c23a1d85d4b5d506cdc288490192ebac06cad10d5d"],["9c3919a84a474870faed8a9c1cc66021523489054d7f0308cbfc99c8ac1f98cd","ddb84f0f4a4ddd57584f044bf260e641905326f76c64c8e6be7e5e03d4fc599d"],["6057170b1dd12fdf8de05f281d8e06bb91e1493a8b91d4cc5a21382120a959e5","9a1af0b26a6a4807add9a2daf71df262465152bc3ee24c65e899be932385a2a8"],["a576df8e23a08411421439a4518da31880cef0fba7d4df12b1a6973eecb94266","40a6bf20e76640b2c92b97afe58cd82c432e10a7f514d9f3ee8be11ae1b28ec8"],["7778a78c28dec3e30a05fe9629de8c38bb30d1f5cf9a3a208f763889be58ad71","34626d9ab5a5b22ff7098e12f2ff580087b38411ff24ac563b513fc1fd9f43ac"],["928955ee637a84463729fd30e7afd2ed5f96274e5ad7e5cb09eda9c06d903ac","c25621003d3f42a827b78a13093a95eeac3d26efa8a8d83fc5180e935bcd091f"],["85d0fef3ec6db109399064f3a0e3b2855645b4a907ad354527aae75163d82751","1f03648413a38c0be29d496e582cf5663e8751e96877331582c237a24eb1f962"],["ff2b0dce97eece97c1c9b6041798b85dfdfb6d8882da20308f5404824526087e","493d13fef524ba188af4c4dc54d07936c7b7ed6fb90e2ceb2c951e01f0c29907"],["827fbbe4b1e880ea9ed2b2e6301b212b57f1ee148cd6dd28780e5e2cf856e241","c60f9c923c727b0b71bef2c67d1d12687ff7a63186903166d605b68baec293ec"],["eaa649f21f51bdbae7be4ae34ce6e5217a58fdce7f47f9aa7f3b58fa2120e2b3","be3279ed5bbbb03ac69a80f89879aa5a01a6b965f13f7e59d47a5305ba5ad93d"],["e4a42d43c5cf169d9391df6decf42ee541b6d8f0c9a137401e23632dda34d24f","4d9f92e716d1c73526fc99ccfb8ad34ce886eedfa8d8e4f13a7f7131deba9414"],["1ec80fef360cbdd954160fadab352b6b92b53576a88fea4947173b9d4300bf19","aeefe93756b5340d2f3a4958a7abbf5e0146e77f6295a07b671cdc1cc107cefd"],["146a778c04670c2f91b00af4680dfa8bce3490717d58ba889ddb5928366642be","b318e0ec3354028add669827f9d4b2870aaa971d2f7e5ed1d0b297483d83efd0"],["fa50c0f61d22e5f07e3acebb1aa07b128d0012209a28b9776d76a8793180eef9","6b84c6922397eba9b72cd2872281a68a5e683293a57a213b38cd8d7d3f4f2811"],["da1d61d0ca721a11b1a5bf6b7d88e8421a288ab5d5bba5220e53d32b5f067ec2","8157f55a7c99306c79c0766161c91e2966a73899d279b48a655fba0f1ad836f1"],["a8e282ff0c9706907215ff98e8fd416615311de0446f1e062a73b0610d064e13","7f97355b8db81c09abfb7f3c5b2515888b679a3e50dd6bd6cef7c73111f4cc0c"],["174a53b9c9a285872d39e56e6913cab15d59b1fa512508c022f382de8319497c","ccc9dc37abfc9c1657b4155f2c47f9e6646b3a1d8cb9854383da13ac079afa73"],["959396981943785c3d3e57edf5018cdbe039e730e4918b3d884fdff09475b7ba","2e7e552888c331dd8ba0386a4b9cd6849c653f64c8709385e9b8abf87524f2fd"],["d2a63a50ae401e56d645a1153b109a8fcca0a43d561fba2dbb51340c9d82b151","e82d86fb6443fcb7565aee58b2948220a70f750af484ca52d4142174dcf89405"],["64587e2335471eb890ee7896d7cfdc866bacbdbd3839317b3436f9b45617e073","d99fcdd5bf6902e2ae96dd6447c299a185b90a39133aeab358299e5e9faf6589"],["8481bde0e4e4d885b3a546d3e549de042f0aa6cea250e7fd358d6c86dd45e458","38ee7b8cba5404dd84a25bf39cecb2ca900a79c42b262e556d64b1b59779057e"],["13464a57a78102aa62b6979ae817f4637ffcfed3c4b1ce30bcd6303f6caf666b","69be159004614580ef7e433453ccb0ca48f300a81d0942e13f495a907f6ecc27"],["bc4a9df5b713fe2e9aef430bcc1dc97a0cd9ccede2f28588cada3a0d2d83f366","d3a81ca6e785c06383937adf4b798caa6e8a9fbfa547b16d758d666581f33c1"],["8c28a97bf8298bc0d23d8c749452a32e694b65e30a9472a3954ab30fe5324caa","40a30463a3305193378fedf31f7cc0eb7ae784f0451cb9459e71dc73cbef9482"],["8ea9666139527a8c1dd94ce4f071fd23c8b350c5a4bb33748c4ba111faccae0","620efabbc8ee2782e24e7c0cfb95c5d735b783be9cf0f8e955af34a30e62b945"],["dd3625faef5ba06074669716bbd3788d89bdde815959968092f76cc4eb9a9787","7a188fa3520e30d461da2501045731ca941461982883395937f68d00c644a573"],["f710d79d9eb962297e4f6232b40e8f7feb2bc63814614d692c12de752408221e","ea98e67232d3b3295d3b535532115ccac8612c721851617526ae47a9c77bfc82"]]},naf:{wnd:7,points:[["f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9","388f7b0f632de8140fe337e62a37f3566500a99934c2231b6cb9fd7584b8e672"],["2f8bde4d1a07209355b4a7250a5c5128e88b84bddc619ab7cba8d569b240efe4","d8ac222636e5e3d6d4dba9dda6c9c426f788271bab0d6840dca87d3aa6ac62d6"],["5cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bc","6aebca40ba255960a3178d6d861a54dba813d0b813fde7b5a5082628087264da"],["acd484e2f0c7f65309ad178a9f559abde09796974c57e714c35f110dfc27ccbe","cc338921b0a7d9fd64380971763b61e9add888a4375f8e0f05cc262ac64f9c37"],["774ae7f858a9411e5ef4246b70c65aac5649980be5c17891bbec17895da008cb","d984a032eb6b5e190243dd56d7b7b365372db1e2dff9d6a8301d74c9c953c61b"],["f28773c2d975288bc7d1d205c3748651b075fbc6610e58cddeeddf8f19405aa8","ab0902e8d880a89758212eb65cdaf473a1a06da521fa91f29b5cb52db03ed81"],["d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e","581e2872a86c72a683842ec228cc6defea40af2bd896d3a5c504dc9ff6a26b58"],["defdea4cdb677750a420fee807eacf21eb9898ae79b9768766e4faa04a2d4a34","4211ab0694635168e997b0ead2a93daeced1f4a04a95c0f6cfb199f69e56eb77"],["2b4ea0a797a443d293ef5cff444f4979f06acfebd7e86d277475656138385b6c","85e89bc037945d93b343083b5a1c86131a01f60c50269763b570c854e5c09b7a"],["352bbf4a4cdd12564f93fa332ce333301d9ad40271f8107181340aef25be59d5","321eb4075348f534d59c18259dda3e1f4a1b3b2e71b1039c67bd3d8bcf81998c"],["2fa2104d6b38d11b0230010559879124e42ab8dfeff5ff29dc9cdadd4ecacc3f","2de1068295dd865b64569335bd5dd80181d70ecfc882648423ba76b532b7d67"],["9248279b09b4d68dab21a9b066edda83263c3d84e09572e269ca0cd7f5453714","73016f7bf234aade5d1aa71bdea2b1ff3fc0de2a887912ffe54a32ce97cb3402"],["daed4f2be3a8bf278e70132fb0beb7522f570e144bf615c07e996d443dee8729","a69dce4a7d6c98e8d4a1aca87ef8d7003f83c230f3afa726ab40e52290be1c55"],["c44d12c7065d812e8acf28d7cbb19f9011ecd9e9fdf281b0e6a3b5e87d22e7db","2119a460ce326cdc76c45926c982fdac0e106e861edf61c5a039063f0e0e6482"],["6a245bf6dc698504c89a20cfded60853152b695336c28063b61c65cbd269e6b4","e022cf42c2bd4a708b3f5126f16a24ad8b33ba48d0423b6efd5e6348100d8a82"],["1697ffa6fd9de627c077e3d2fe541084ce13300b0bec1146f95ae57f0d0bd6a5","b9c398f186806f5d27561506e4557433a2cf15009e498ae7adee9d63d01b2396"],["605bdb019981718b986d0f07e834cb0d9deb8360ffb7f61df982345ef27a7479","2972d2de4f8d20681a78d93ec96fe23c26bfae84fb14db43b01e1e9056b8c49"],["62d14dab4150bf497402fdc45a215e10dcb01c354959b10cfe31c7e9d87ff33d","80fc06bd8cc5b01098088a1950eed0db01aa132967ab472235f5642483b25eaf"],["80c60ad0040f27dade5b4b06c408e56b2c50e9f56b9b8b425e555c2f86308b6f","1c38303f1cc5c30f26e66bad7fe72f70a65eed4cbe7024eb1aa01f56430bd57a"],["7a9375ad6167ad54aa74c6348cc54d344cc5dc9487d847049d5eabb0fa03c8fb","d0e3fa9eca8726909559e0d79269046bdc59ea10c70ce2b02d499ec224dc7f7"],["d528ecd9b696b54c907a9ed045447a79bb408ec39b68df504bb51f459bc3ffc9","eecf41253136e5f99966f21881fd656ebc4345405c520dbc063465b521409933"],["49370a4b5f43412ea25f514e8ecdad05266115e4a7ecb1387231808f8b45963","758f3f41afd6ed428b3081b0512fd62a54c3f3afbb5b6764b653052a12949c9a"],["77f230936ee88cbbd73df930d64702ef881d811e0e1498e2f1c13eb1fc345d74","958ef42a7886b6400a08266e9ba1b37896c95330d97077cbbe8eb3c7671c60d6"],["f2dac991cc4ce4b9ea44887e5c7c0bce58c80074ab9d4dbaeb28531b7739f530","e0dedc9b3b2f8dad4da1f32dec2531df9eb5fbeb0598e4fd1a117dba703a3c37"],["463b3d9f662621fb1b4be8fbbe2520125a216cdfc9dae3debcba4850c690d45b","5ed430d78c296c3543114306dd8622d7c622e27c970a1de31cb377b01af7307e"],["f16f804244e46e2a09232d4aff3b59976b98fac14328a2d1a32496b49998f247","cedabd9b82203f7e13d206fcdf4e33d92a6c53c26e5cce26d6579962c4e31df6"],["caf754272dc84563b0352b7a14311af55d245315ace27c65369e15f7151d41d1","cb474660ef35f5f2a41b643fa5e460575f4fa9b7962232a5c32f908318a04476"],["2600ca4b282cb986f85d0f1709979d8b44a09c07cb86d7c124497bc86f082120","4119b88753c15bd6a693b03fcddbb45d5ac6be74ab5f0ef44b0be9475a7e4b40"],["7635ca72d7e8432c338ec53cd12220bc01c48685e24f7dc8c602a7746998e435","91b649609489d613d1d5e590f78e6d74ecfc061d57048bad9e76f302c5b9c61"],["754e3239f325570cdbbf4a87deee8a66b7f2b33479d468fbc1a50743bf56cc18","673fb86e5bda30fb3cd0ed304ea49a023ee33d0197a695d0c5d98093c536683"],["e3e6bd1071a1e96aff57859c82d570f0330800661d1c952f9fe2694691d9b9e8","59c9e0bba394e76f40c0aa58379a3cb6a5a2283993e90c4167002af4920e37f5"],["186b483d056a033826ae73d88f732985c4ccb1f32ba35f4b4cc47fdcf04aa6eb","3b952d32c67cf77e2e17446e204180ab21fb8090895138b4a4a797f86e80888b"],["df9d70a6b9876ce544c98561f4be4f725442e6d2b737d9c91a8321724ce0963f","55eb2dafd84d6ccd5f862b785dc39d4ab157222720ef9da217b8c45cf2ba2417"],["5edd5cc23c51e87a497ca815d5dce0f8ab52554f849ed8995de64c5f34ce7143","efae9c8dbc14130661e8cec030c89ad0c13c66c0d17a2905cdc706ab7399a868"],["290798c2b6476830da12fe02287e9e777aa3fba1c355b17a722d362f84614fba","e38da76dcd440621988d00bcf79af25d5b29c094db2a23146d003afd41943e7a"],["af3c423a95d9f5b3054754efa150ac39cd29552fe360257362dfdecef4053b45","f98a3fd831eb2b749a93b0e6f35cfb40c8cd5aa667a15581bc2feded498fd9c6"],["766dbb24d134e745cccaa28c99bf274906bb66b26dcf98df8d2fed50d884249a","744b1152eacbe5e38dcc887980da38b897584a65fa06cedd2c924f97cbac5996"],["59dbf46f8c94759ba21277c33784f41645f7b44f6c596a58ce92e666191abe3e","c534ad44175fbc300f4ea6ce648309a042ce739a7919798cd85e216c4a307f6e"],["f13ada95103c4537305e691e74e9a4a8dd647e711a95e73cb62dc6018cfd87b8","e13817b44ee14de663bf4bc808341f326949e21a6a75c2570778419bdaf5733d"],["7754b4fa0e8aced06d4167a2c59cca4cda1869c06ebadfb6488550015a88522c","30e93e864e669d82224b967c3020b8fa8d1e4e350b6cbcc537a48b57841163a2"],["948dcadf5990e048aa3874d46abef9d701858f95de8041d2a6828c99e2262519","e491a42537f6e597d5d28a3224b1bc25df9154efbd2ef1d2cbba2cae5347d57e"],["7962414450c76c1689c7b48f8202ec37fb224cf5ac0bfa1570328a8a3d7c77ab","100b610ec4ffb4760d5c1fc133ef6f6b12507a051f04ac5760afa5b29db83437"],["3514087834964b54b15b160644d915485a16977225b8847bb0dd085137ec47ca","ef0afbb2056205448e1652c48e8127fc6039e77c15c2378b7e7d15a0de293311"],["d3cc30ad6b483e4bc79ce2c9dd8bc54993e947eb8df787b442943d3f7b527eaf","8b378a22d827278d89c5e9be8f9508ae3c2ad46290358630afb34db04eede0a4"],["1624d84780732860ce1c78fcbfefe08b2b29823db913f6493975ba0ff4847610","68651cf9b6da903e0914448c6cd9d4ca896878f5282be4c8cc06e2a404078575"],["733ce80da955a8a26902c95633e62a985192474b5af207da6df7b4fd5fc61cd4","f5435a2bd2badf7d485a4d8b8db9fcce3e1ef8e0201e4578c54673bc1dc5ea1d"],["15d9441254945064cf1a1c33bbd3b49f8966c5092171e699ef258dfab81c045c","d56eb30b69463e7234f5137b73b84177434800bacebfc685fc37bbe9efe4070d"],["a1d0fcf2ec9de675b612136e5ce70d271c21417c9d2b8aaaac138599d0717940","edd77f50bcb5a3cab2e90737309667f2641462a54070f3d519212d39c197a629"],["e22fbe15c0af8ccc5780c0735f84dbe9a790badee8245c06c7ca37331cb36980","a855babad5cd60c88b430a69f53a1a7a38289154964799be43d06d77d31da06"],["311091dd9860e8e20ee13473c1155f5f69635e394704eaa74009452246cfa9b3","66db656f87d1f04fffd1f04788c06830871ec5a64feee685bd80f0b1286d8374"],["34c1fd04d301be89b31c0442d3e6ac24883928b45a9340781867d4232ec2dbdf","9414685e97b1b5954bd46f730174136d57f1ceeb487443dc5321857ba73abee"],["f219ea5d6b54701c1c14de5b557eb42a8d13f3abbcd08affcc2a5e6b049b8d63","4cb95957e83d40b0f73af4544cccf6b1f4b08d3c07b27fb8d8c2962a400766d1"],["d7b8740f74a8fbaab1f683db8f45de26543a5490bca627087236912469a0b448","fa77968128d9c92ee1010f337ad4717eff15db5ed3c049b3411e0315eaa4593b"],["32d31c222f8f6f0ef86f7c98d3a3335ead5bcd32abdd94289fe4d3091aa824bf","5f3032f5892156e39ccd3d7915b9e1da2e6dac9e6f26e961118d14b8462e1661"],["7461f371914ab32671045a155d9831ea8793d77cd59592c4340f86cbc18347b5","8ec0ba238b96bec0cbdddcae0aa442542eee1ff50c986ea6b39847b3cc092ff6"],["ee079adb1df1860074356a25aa38206a6d716b2c3e67453d287698bad7b2b2d6","8dc2412aafe3be5c4c5f37e0ecc5f9f6a446989af04c4e25ebaac479ec1c8c1e"],["16ec93e447ec83f0467b18302ee620f7e65de331874c9dc72bfd8616ba9da6b5","5e4631150e62fb40d0e8c2a7ca5804a39d58186a50e497139626778e25b0674d"],["eaa5f980c245f6f038978290afa70b6bd8855897f98b6aa485b96065d537bd99","f65f5d3e292c2e0819a528391c994624d784869d7e6ea67fb18041024edc07dc"],["78c9407544ac132692ee1910a02439958ae04877151342ea96c4b6b35a49f51","f3e0319169eb9b85d5404795539a5e68fa1fbd583c064d2462b675f194a3ddb4"],["494f4be219a1a77016dcd838431aea0001cdc8ae7a6fc688726578d9702857a5","42242a969283a5f339ba7f075e36ba2af925ce30d767ed6e55f4b031880d562c"],["a598a8030da6d86c6bc7f2f5144ea549d28211ea58faa70ebf4c1e665c1fe9b5","204b5d6f84822c307e4b4a7140737aec23fc63b65b35f86a10026dbd2d864e6b"],["c41916365abb2b5d09192f5f2dbeafec208f020f12570a184dbadc3e58595997","4f14351d0087efa49d245b328984989d5caf9450f34bfc0ed16e96b58fa9913"],["841d6063a586fa475a724604da03bc5b92a2e0d2e0a36acfe4c73a5514742881","73867f59c0659e81904f9a1c7543698e62562d6744c169ce7a36de01a8d6154"],["5e95bb399a6971d376026947f89bde2f282b33810928be4ded112ac4d70e20d5","39f23f366809085beebfc71181313775a99c9aed7d8ba38b161384c746012865"],["36e4641a53948fd476c39f8a99fd974e5ec07564b5315d8bf99471bca0ef2f66","d2424b1b1abe4eb8164227b085c9aa9456ea13493fd563e06fd51cf5694c78fc"],["336581ea7bfbbb290c191a2f507a41cf5643842170e914faeab27c2c579f726","ead12168595fe1be99252129b6e56b3391f7ab1410cd1e0ef3dcdcabd2fda224"],["8ab89816dadfd6b6a1f2634fcf00ec8403781025ed6890c4849742706bd43ede","6fdcef09f2f6d0a044e654aef624136f503d459c3e89845858a47a9129cdd24e"],["1e33f1a746c9c5778133344d9299fcaa20b0938e8acff2544bb40284b8c5fb94","60660257dd11b3aa9c8ed618d24edff2306d320f1d03010e33a7d2057f3b3b6"],["85b7c1dcb3cec1b7ee7f30ded79dd20a0ed1f4cc18cbcfcfa410361fd8f08f31","3d98a9cdd026dd43f39048f25a8847f4fcafad1895d7a633c6fed3c35e999511"],["29df9fbd8d9e46509275f4b125d6d45d7fbe9a3b878a7af872a2800661ac5f51","b4c4fe99c775a606e2d8862179139ffda61dc861c019e55cd2876eb2a27d84b"],["a0b1cae06b0a847a3fea6e671aaf8adfdfe58ca2f768105c8082b2e449fce252","ae434102edde0958ec4b19d917a6a28e6b72da1834aff0e650f049503a296cf2"],["4e8ceafb9b3e9a136dc7ff67e840295b499dfb3b2133e4ba113f2e4c0e121e5","cf2174118c8b6d7a4b48f6d534ce5c79422c086a63460502b827ce62a326683c"],["d24a44e047e19b6f5afb81c7ca2f69080a5076689a010919f42725c2b789a33b","6fb8d5591b466f8fc63db50f1c0f1c69013f996887b8244d2cdec417afea8fa3"],["ea01606a7a6c9cdd249fdfcfacb99584001edd28abbab77b5104e98e8e3b35d4","322af4908c7312b0cfbfe369f7a7b3cdb7d4494bc2823700cfd652188a3ea98d"],["af8addbf2b661c8a6c6328655eb96651252007d8c5ea31be4ad196de8ce2131f","6749e67c029b85f52a034eafd096836b2520818680e26ac8f3dfbcdb71749700"],["e3ae1974566ca06cc516d47e0fb165a674a3dabcfca15e722f0e3450f45889","2aeabe7e4531510116217f07bf4d07300de97e4874f81f533420a72eeb0bd6a4"],["591ee355313d99721cf6993ffed1e3e301993ff3ed258802075ea8ced397e246","b0ea558a113c30bea60fc4775460c7901ff0b053d25ca2bdeee98f1a4be5d196"],["11396d55fda54c49f19aa97318d8da61fa8584e47b084945077cf03255b52984","998c74a8cd45ac01289d5833a7beb4744ff536b01b257be4c5767bea93ea57a4"],["3c5d2a1ba39c5a1790000738c9e0c40b8dcdfd5468754b6405540157e017aa7a","b2284279995a34e2f9d4de7396fc18b80f9b8b9fdd270f6661f79ca4c81bd257"],["cc8704b8a60a0defa3a99a7299f2e9c3fbc395afb04ac078425ef8a1793cc030","bdd46039feed17881d1e0862db347f8cf395b74fc4bcdc4e940b74e3ac1f1b13"],["c533e4f7ea8555aacd9777ac5cad29b97dd4defccc53ee7ea204119b2889b197","6f0a256bc5efdf429a2fb6242f1a43a2d9b925bb4a4b3a26bb8e0f45eb596096"],["c14f8f2ccb27d6f109f6d08d03cc96a69ba8c34eec07bbcf566d48e33da6593","c359d6923bb398f7fd4473e16fe1c28475b740dd098075e6c0e8649113dc3a38"],["a6cbc3046bc6a450bac24789fa17115a4c9739ed75f8f21ce441f72e0b90e6ef","21ae7f4680e889bb130619e2c0f95a360ceb573c70603139862afd617fa9b9f"],["347d6d9a02c48927ebfb86c1359b1caf130a3c0267d11ce6344b39f99d43cc38","60ea7f61a353524d1c987f6ecec92f086d565ab687870cb12689ff1e31c74448"],["da6545d2181db8d983f7dcb375ef5866d47c67b1bf31c8cf855ef7437b72656a","49b96715ab6878a79e78f07ce5680c5d6673051b4935bd897fea824b77dc208a"],["c40747cc9d012cb1a13b8148309c6de7ec25d6945d657146b9d5994b8feb1111","5ca560753be2a12fc6de6caf2cb489565db936156b9514e1bb5e83037e0fa2d4"],["4e42c8ec82c99798ccf3a610be870e78338c7f713348bd34c8203ef4037f3502","7571d74ee5e0fb92a7a8b33a07783341a5492144cc54bcc40a94473693606437"],["3775ab7089bc6af823aba2e1af70b236d251cadb0c86743287522a1b3b0dedea","be52d107bcfa09d8bcb9736a828cfa7fac8db17bf7a76a2c42ad961409018cf7"],["cee31cbf7e34ec379d94fb814d3d775ad954595d1314ba8846959e3e82f74e26","8fd64a14c06b589c26b947ae2bcf6bfa0149ef0be14ed4d80f448a01c43b1c6d"],["b4f9eaea09b6917619f6ea6a4eb5464efddb58fd45b1ebefcdc1a01d08b47986","39e5c9925b5a54b07433a4f18c61726f8bb131c012ca542eb24a8ac07200682a"],["d4263dfc3d2df923a0179a48966d30ce84e2515afc3dccc1b77907792ebcc60e","62dfaf07a0f78feb30e30d6295853ce189e127760ad6cf7fae164e122a208d54"],["48457524820fa65a4f8d35eb6930857c0032acc0a4a2de422233eeda897612c4","25a748ab367979d98733c38a1fa1c2e7dc6cc07db2d60a9ae7a76aaa49bd0f77"],["dfeeef1881101f2cb11644f3a2afdfc2045e19919152923f367a1767c11cceda","ecfb7056cf1de042f9420bab396793c0c390bde74b4bbdff16a83ae09a9a7517"],["6d7ef6b17543f8373c573f44e1f389835d89bcbc6062ced36c82df83b8fae859","cd450ec335438986dfefa10c57fea9bcc521a0959b2d80bbf74b190dca712d10"],["e75605d59102a5a2684500d3b991f2e3f3c88b93225547035af25af66e04541f","f5c54754a8f71ee540b9b48728473e314f729ac5308b06938360990e2bfad125"],["eb98660f4c4dfaa06a2be453d5020bc99a0c2e60abe388457dd43fefb1ed620c","6cb9a8876d9cb8520609af3add26cd20a0a7cd8a9411131ce85f44100099223e"],["13e87b027d8514d35939f2e6892b19922154596941888336dc3563e3b8dba942","fef5a3c68059a6dec5d624114bf1e91aac2b9da568d6abeb2570d55646b8adf1"],["ee163026e9fd6fe017c38f06a5be6fc125424b371ce2708e7bf4491691e5764a","1acb250f255dd61c43d94ccc670d0f58f49ae3fa15b96623e5430da0ad6c62b2"],["b268f5ef9ad51e4d78de3a750c2dc89b1e626d43505867999932e5db33af3d80","5f310d4b3c99b9ebb19f77d41c1dee018cf0d34fd4191614003e945a1216e423"],["ff07f3118a9df035e9fad85eb6c7bfe42b02f01ca99ceea3bf7ffdba93c4750d","438136d603e858a3a5c440c38eccbaddc1d2942114e2eddd4740d098ced1f0d8"],["8d8b9855c7c052a34146fd20ffb658bea4b9f69e0d825ebec16e8c3ce2b526a1","cdb559eedc2d79f926baf44fb84ea4d44bcf50fee51d7ceb30e2e7f463036758"],["52db0b5384dfbf05bfa9d472d7ae26dfe4b851ceca91b1eba54263180da32b63","c3b997d050ee5d423ebaf66a6db9f57b3180c902875679de924b69d84a7b375"],["e62f9490d3d51da6395efd24e80919cc7d0f29c3f3fa48c6fff543becbd43352","6d89ad7ba4876b0b22c2ca280c682862f342c8591f1daf5170e07bfd9ccafa7d"],["7f30ea2476b399b4957509c88f77d0191afa2ff5cb7b14fd6d8e7d65aaab1193","ca5ef7d4b231c94c3b15389a5f6311e9daff7bb67b103e9880ef4bff637acaec"],["5098ff1e1d9f14fb46a210fada6c903fef0fb7b4a1dd1d9ac60a0361800b7a00","9731141d81fc8f8084d37c6e7542006b3ee1b40d60dfe5362a5b132fd17ddc0"],["32b78c7de9ee512a72895be6b9cbefa6e2f3c4ccce445c96b9f2c81e2778ad58","ee1849f513df71e32efc3896ee28260c73bb80547ae2275ba497237794c8753c"],["e2cb74fddc8e9fbcd076eef2a7c72b0ce37d50f08269dfc074b581550547a4f7","d3aa2ed71c9dd2247a62df062736eb0baddea9e36122d2be8641abcb005cc4a4"],["8438447566d4d7bedadc299496ab357426009a35f235cb141be0d99cd10ae3a8","c4e1020916980a4da5d01ac5e6ad330734ef0d7906631c4f2390426b2edd791f"],["4162d488b89402039b584c6fc6c308870587d9c46f660b878ab65c82c711d67e","67163e903236289f776f22c25fb8a3afc1732f2b84b4e95dbda47ae5a0852649"],["3fad3fa84caf0f34f0f89bfd2dcf54fc175d767aec3e50684f3ba4a4bf5f683d","cd1bc7cb6cc407bb2f0ca647c718a730cf71872e7d0d2a53fa20efcdfe61826"],["674f2600a3007a00568c1a7ce05d0816c1fb84bf1370798f1c69532faeb1a86b","299d21f9413f33b3edf43b257004580b70db57da0b182259e09eecc69e0d38a5"],["d32f4da54ade74abb81b815ad1fb3b263d82d6c692714bcff87d29bd5ee9f08f","f9429e738b8e53b968e99016c059707782e14f4535359d582fc416910b3eea87"],["30e4e670435385556e593657135845d36fbb6931f72b08cb1ed954f1e3ce3ff6","462f9bce619898638499350113bbc9b10a878d35da70740dc695a559eb88db7b"],["be2062003c51cc3004682904330e4dee7f3dcd10b01e580bf1971b04d4cad297","62188bc49d61e5428573d48a74e1c655b1c61090905682a0d5558ed72dccb9bc"],["93144423ace3451ed29e0fb9ac2af211cb6e84a601df5993c419859fff5df04a","7c10dfb164c3425f5c71a3f9d7992038f1065224f72bb9d1d902a6d13037b47c"],["b015f8044f5fcbdcf21ca26d6c34fb8197829205c7b7d2a7cb66418c157b112c","ab8c1e086d04e813744a655b2df8d5f83b3cdc6faa3088c1d3aea1454e3a1d5f"],["d5e9e1da649d97d89e4868117a465a3a4f8a18de57a140d36b3f2af341a21b52","4cb04437f391ed73111a13cc1d4dd0db1693465c2240480d8955e8592f27447a"],["d3ae41047dd7ca065dbf8ed77b992439983005cd72e16d6f996a5316d36966bb","bd1aeb21ad22ebb22a10f0303417c6d964f8cdd7df0aca614b10dc14d125ac46"],["463e2763d885f958fc66cdd22800f0a487197d0a82e377b49f80af87c897b065","bfefacdb0e5d0fd7df3a311a94de062b26b80c61fbc97508b79992671ef7ca7f"],["7985fdfd127c0567c6f53ec1bb63ec3158e597c40bfe747c83cddfc910641917","603c12daf3d9862ef2b25fe1de289aed24ed291e0ec6708703a5bd567f32ed03"],["74a1ad6b5f76e39db2dd249410eac7f99e74c59cb83d2d0ed5ff1543da7703e9","cc6157ef18c9c63cd6193d83631bbea0093e0968942e8c33d5737fd790e0db08"],["30682a50703375f602d416664ba19b7fc9bab42c72747463a71d0896b22f6da3","553e04f6b018b4fa6c8f39e7f311d3176290d0e0f19ca73f17714d9977a22ff8"],["9e2158f0d7c0d5f26c3791efefa79597654e7a2b2464f52b1ee6c1347769ef57","712fcdd1b9053f09003a3481fa7762e9ffd7c8ef35a38509e2fbf2629008373"],["176e26989a43c9cfeba4029c202538c28172e566e3c4fce7322857f3be327d66","ed8cc9d04b29eb877d270b4878dc43c19aefd31f4eee09ee7b47834c1fa4b1c3"],["75d46efea3771e6e68abb89a13ad747ecf1892393dfc4f1b7004788c50374da8","9852390a99507679fd0b86fd2b39a868d7efc22151346e1a3ca4726586a6bed8"],["809a20c67d64900ffb698c4c825f6d5f2310fb0451c869345b7319f645605721","9e994980d9917e22b76b061927fa04143d096ccc54963e6a5ebfa5f3f8e286c1"],["1b38903a43f7f114ed4500b4eac7083fdefece1cf29c63528d563446f972c180","4036edc931a60ae889353f77fd53de4a2708b26b6f5da72ad3394119daf408f9"]]}}},function(e,t,i){"use strict";var r=i(3),s=i(186),n=i(8),a=i(52),o=i(49),h=n.assert,c=i(187),d=i(188);function u(e){if(!(this instanceof u))return new u(e);"string"==typeof e&&(h(a.hasOwnProperty(e),"Unknown curve "+e),e=a[e]),e instanceof a.PresetCurve&&(e={curve:e}),this.curve=e.curve.curve,this.n=this.curve.n,this.nh=this.n.ushrn(1),this.g=this.curve.g,this.g=e.curve.g,this.g.precompute(e.curve.n.bitLength()+1),this.hash=e.hash||e.curve.hash}e.exports=u,u.prototype.keyPair=function(e){return new c(this,e)},u.prototype.keyFromPrivate=function(e,t){return c.fromPrivate(this,e,t)},u.prototype.keyFromPublic=function(e,t){return c.fromPublic(this,e,t)},u.prototype.genKeyPair=function(e){e||(e={});for(var t=new s({hash:this.hash,pers:e.pers,persEnc:e.persEnc||"utf8",entropy:e.entropy||o(this.hash.hmacStrength),entropyEnc:e.entropy&&e.entropyEnc||"utf8",nonce:this.n.toArray()}),i=this.n.byteLength(),n=this.n.sub(new r(2));;){var a=new r(t.generate(i));if(!(a.cmp(n)>0))return a.iaddn(1),this.keyFromPrivate(a)}},u.prototype._truncateToN=function(e,t){var i=8*e.byteLength()-this.n.bitLength();return i>0&&(e=e.ushrn(i)),!t&&e.cmp(this.n)>=0?e.sub(this.n):e},u.prototype.sign=function(e,t,i,n){"object"==typeof i&&(n=i,i=null),n||(n={}),t=this.keyFromPrivate(t,i),e=this._truncateToN(new r(e,16));for(var a=this.n.byteLength(),o=t.getPrivate().toArray("be",a),h=e.toArray("be",a),c=new s({hash:this.hash,entropy:o,nonce:h,pers:n.pers,persEnc:n.persEnc||"utf8"}),u=this.n.sub(new r(1)),l=0;;l++){var f=n.k?n.k(l):new r(c.generate(this.n.byteLength()));if(!((f=this._truncateToN(f,!0)).cmpn(1)<=0||f.cmp(u)>=0)){var p=this.g.mul(f);if(!p.isInfinity()){var m=p.getX(),_=m.umod(this.n);if(0!==_.cmpn(0)){var g=f.invm(this.n).mul(_.mul(t.getPrivate()).iadd(e));if(0!==(g=g.umod(this.n)).cmpn(0)){var y=(p.getY().isOdd()?1:0)|(0!==m.cmp(_)?2:0);return n.canonical&&g.cmp(this.nh)>0&&(g=this.n.sub(g),y^=1),new d({r:_,s:g,recoveryParam:y})}}}}}},u.prototype.verify=function(e,t,i,s){e=this._truncateToN(new r(e,16)),i=this.keyFromPublic(i,s);var n=(t=new d(t,"hex")).r,a=t.s;if(n.cmpn(1)<0||n.cmp(this.n)>=0)return!1;if(a.cmpn(1)<0||a.cmp(this.n)>=0)return!1;var o,h=a.invm(this.n),c=h.mul(e).umod(this.n),u=h.mul(n).umod(this.n);return this.curve._maxwellTrick?!(o=this.g.jmulAdd(c,i.getPublic(),u)).isInfinity()&&o.eqXToP(n):!(o=this.g.mulAdd(c,i.getPublic(),u)).isInfinity()&&0===o.getX().umod(this.n).cmp(n)},u.prototype.recoverPubKey=function(e,t,i,s){h((3&i)===i,"The recovery param is more than two bits"),t=new d(t,s);var n=this.n,a=new r(e),o=t.r,c=t.s,u=1&i,l=i>>1;if(o.cmp(this.curve.p.umod(this.curve.n))>=0&&l)throw new Error("Unable to find sencond key candinate");o=l?this.curve.pointFromX(o.add(this.curve.n),u):this.curve.pointFromX(o,u);var f=t.r.invm(n),p=n.sub(a).mul(f).umod(n),m=c.mul(f).umod(n);return this.g.mulAdd(p,o,m)},u.prototype.getKeyRecoveryParam=function(e,t,i,r){if(null!==(t=new d(t,r)).recoveryParam)return t.recoveryParam;for(var s=0;s<4;s++){var n;try{n=this.recoverPubKey(e,t,s)}catch(e){continue}if(n.eq(i))return s}throw new Error("Unable to find valid recovery factor")}},function(e,t,i){"use strict";var r=i(53),s=i(84),n=i(7);function a(e){if(!(this instanceof a))return new a(e);this.hash=e.hash,this.predResist=!!e.predResist,this.outLen=this.hash.outSize,this.minEntropy=e.minEntropy||this.hash.hmacStrength,this._reseed=null,this.reseedInterval=null,this.K=null,this.V=null;var t=s.toArray(e.entropy,e.entropyEnc||"hex"),i=s.toArray(e.nonce,e.nonceEnc||"hex"),r=s.toArray(e.pers,e.persEnc||"hex");n(t.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._init(t,i,r)}e.exports=a,a.prototype._init=function(e,t,i){var r=e.concat(t).concat(i);this.K=new Array(this.outLen/8),this.V=new Array(this.outLen/8);for(var s=0;s<this.V.length;s++)this.K[s]=0,this.V[s]=1;this._update(r),this._reseed=1,this.reseedInterval=281474976710656},a.prototype._hmac=function(){return new r.hmac(this.hash,this.K)},a.prototype._update=function(e){var t=this._hmac().update(this.V).update([0]);e&&(t=t.update(e)),this.K=t.digest(),this.V=this._hmac().update(this.V).digest(),e&&(this.K=this._hmac().update(this.V).update([1]).update(e).digest(),this.V=this._hmac().update(this.V).digest())},a.prototype.reseed=function(e,t,i,r){"string"!=typeof t&&(r=i,i=t,t=null),e=s.toArray(e,t),i=s.toArray(i,r),n(e.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._update(e.concat(i||[])),this._reseed=1},a.prototype.generate=function(e,t,i,r){if(this._reseed>this.reseedInterval)throw new Error("Reseed is required");"string"!=typeof t&&(r=i,i=t,t=null),i&&(i=s.toArray(i,r||"hex"),this._update(i));for(var n=[];n.length<e;)this.V=this._hmac().update(this.V).digest(),n=n.concat(this.V);var a=n.slice(0,e);return this._update(i),this._reseed++,s.encode(a,t)}},function(e,t,i){"use strict";var r=i(3),s=i(8).assert;function n(e,t){this.ec=e,this.priv=null,this.pub=null,t.priv&&this._importPrivate(t.priv,t.privEnc),t.pub&&this._importPublic(t.pub,t.pubEnc)}e.exports=n,n.fromPublic=function(e,t,i){return t instanceof n?t:new n(e,{pub:t,pubEnc:i})},n.fromPrivate=function(e,t,i){return t instanceof n?t:new n(e,{priv:t,privEnc:i})},n.prototype.validate=function(){var e=this.getPublic();return e.isInfinity()?{result:!1,reason:"Invalid public key"}:e.validate()?e.mul(this.ec.curve.n).isInfinity()?{result:!0,reason:null}:{result:!1,reason:"Public key * N != O"}:{result:!1,reason:"Public key is not a point"}},n.prototype.getPublic=function(e,t){return"string"==typeof e&&(t=e,e=null),this.pub||(this.pub=this.ec.g.mul(this.priv)),t?this.pub.encode(t,e):this.pub},n.prototype.getPrivate=function(e){return"hex"===e?this.priv.toString(16,2):this.priv},n.prototype._importPrivate=function(e,t){this.priv=new r(e,t||16),this.priv=this.priv.umod(this.ec.curve.n)},n.prototype._importPublic=function(e,t){if(e.x||e.y)return"mont"===this.ec.curve.type?s(e.x,"Need x coordinate"):"short"!==this.ec.curve.type&&"edwards"!==this.ec.curve.type||s(e.x&&e.y,"Need both x and y coordinate"),void(this.pub=this.ec.curve.point(e.x,e.y));this.pub=this.ec.curve.decodePoint(e,t)},n.prototype.derive=function(e){return e.mul(this.priv).getX()},n.prototype.sign=function(e,t,i){return this.ec.sign(e,this,t,i)},n.prototype.verify=function(e,t){return this.ec.verify(e,t,this)},n.prototype.inspect=function(){return"<Key priv: "+(this.priv&&this.priv.toString(16,2))+" pub: "+(this.pub&&this.pub.inspect())+" >"}},function(e,t,i){"use strict";var r=i(3),s=i(8),n=s.assert;function a(e,t){if(e instanceof a)return e;this._importDER(e,t)||(n(e.r&&e.s,"Signature without r or s"),this.r=new r(e.r,16),this.s=new r(e.s,16),void 0===e.recoveryParam?this.recoveryParam=null:this.recoveryParam=e.recoveryParam)}function o(){this.place=0}function h(e,t){var i=e[t.place++];if(!(128&i))return i;for(var r=15&i,s=0,n=0,a=t.place;n<r;n++,a++)s<<=8,s|=e[a];return t.place=a,s}function c(e){for(var t=0,i=e.length-1;!e[t]&&!(128&e[t+1])&&t<i;)t++;return 0===t?e:e.slice(t)}function d(e,t){if(t<128)e.push(t);else{var i=1+(Math.log(t)/Math.LN2>>>3);for(e.push(128|i);--i;)e.push(t>>>(i<<3)&255);e.push(t)}}e.exports=a,a.prototype._importDER=function(e,t){e=s.toArray(e,t);var i=new o;if(48!==e[i.place++])return!1;if(h(e,i)+i.place!==e.length)return!1;if(2!==e[i.place++])return!1;var n=h(e,i),a=e.slice(i.place,n+i.place);if(i.place+=n,2!==e[i.place++])return!1;var c=h(e,i);if(e.length!==c+i.place)return!1;var d=e.slice(i.place,c+i.place);return 0===a[0]&&128&a[1]&&(a=a.slice(1)),0===d[0]&&128&d[1]&&(d=d.slice(1)),this.r=new r(a),this.s=new r(d),this.recoveryParam=null,!0},a.prototype.toDER=function(e){var t=this.r.toArray(),i=this.s.toArray();for(128&t[0]&&(t=[0].concat(t)),128&i[0]&&(i=[0].concat(i)),t=c(t),i=c(i);!(i[0]||128&i[1]);)i=i.slice(1);var r=[2];d(r,t.length),(r=r.concat(t)).push(2),d(r,i.length);var n=r.concat(i),a=[48];return d(a,n.length),a=a.concat(n),s.encode(a,e)}},function(e,t,i){"use strict";var r=i(53),s=i(52),n=i(8),a=n.assert,o=n.parseBytes,h=i(190),c=i(191);function d(e){if(a("ed25519"===e,"only tested with ed25519 so far"),!(this instanceof d))return new d(e);e=s[e].curve;this.curve=e,this.g=e.g,this.g.precompute(e.n.bitLength()+1),this.pointClass=e.point().constructor,this.encodingLength=Math.ceil(e.n.bitLength()/8),this.hash=r.sha512}e.exports=d,d.prototype.sign=function(e,t){e=o(e);var i=this.keyFromSecret(t),r=this.hashInt(i.messagePrefix(),e),s=this.g.mul(r),n=this.encodePoint(s),a=this.hashInt(n,i.pubBytes(),e).mul(i.priv()),h=r.add(a).umod(this.curve.n);return this.makeSignature({R:s,S:h,Rencoded:n})},d.prototype.verify=function(e,t,i){e=o(e),t=this.makeSignature(t);var r=this.keyFromPublic(i),s=this.hashInt(t.Rencoded(),r.pubBytes(),e),n=this.g.mul(t.S());return t.R().add(r.pub().mul(s)).eq(n)},d.prototype.hashInt=function(){for(var e=this.hash(),t=0;t<arguments.length;t++)e.update(arguments[t]);return n.intFromLE(e.digest()).umod(this.curve.n)},d.prototype.keyFromPublic=function(e){return h.fromPublic(this,e)},d.prototype.keyFromSecret=function(e){return h.fromSecret(this,e)},d.prototype.makeSignature=function(e){return e instanceof c?e:new c(this,e)},d.prototype.encodePoint=function(e){var t=e.getY().toArray("le",this.encodingLength);return t[this.encodingLength-1]|=e.getX().isOdd()?128:0,t},d.prototype.decodePoint=function(e){var t=(e=n.parseBytes(e)).length-1,i=e.slice(0,t).concat(-129&e[t]),r=0!=(128&e[t]),s=n.intFromLE(i);return this.curve.pointFromY(s,r)},d.prototype.encodeInt=function(e){return e.toArray("le",this.encodingLength)},d.prototype.decodeInt=function(e){return n.intFromLE(e)},d.prototype.isPoint=function(e){return e instanceof this.pointClass}},function(e,t,i){"use strict";var r=i(8),s=r.assert,n=r.parseBytes,a=r.cachedProperty;function o(e,t){this.eddsa=e,this._secret=n(t.secret),e.isPoint(t.pub)?this._pub=t.pub:this._pubBytes=n(t.pub)}o.fromPublic=function(e,t){return t instanceof o?t:new o(e,{pub:t})},o.fromSecret=function(e,t){return t instanceof o?t:new o(e,{secret:t})},o.prototype.secret=function(){return this._secret},a(o,"pubBytes",(function(){return this.eddsa.encodePoint(this.pub())})),a(o,"pub",(function(){return this._pubBytes?this.eddsa.decodePoint(this._pubBytes):this.eddsa.g.mul(this.priv())})),a(o,"privBytes",(function(){var e=this.eddsa,t=this.hash(),i=e.encodingLength-1,r=t.slice(0,e.encodingLength);return r[0]&=248,r[i]&=127,r[i]|=64,r})),a(o,"priv",(function(){return this.eddsa.decodeInt(this.privBytes())})),a(o,"hash",(function(){return this.eddsa.hash().update(this.secret()).digest()})),a(o,"messagePrefix",(function(){return this.hash().slice(this.eddsa.encodingLength)})),o.prototype.sign=function(e){return s(this._secret,"KeyPair can only verify"),this.eddsa.sign(e,this)},o.prototype.verify=function(e,t){return this.eddsa.verify(e,t,this)},o.prototype.getSecret=function(e){return s(this._secret,"KeyPair is public only"),r.encode(this.secret(),e)},o.prototype.getPublic=function(e){return r.encode(this.pubBytes(),e)},e.exports=o},function(e,t,i){"use strict";var r=i(3),s=i(8),n=s.assert,a=s.cachedProperty,o=s.parseBytes;function h(e,t){this.eddsa=e,"object"!=typeof t&&(t=o(t)),Array.isArray(t)&&(t={R:t.slice(0,e.encodingLength),S:t.slice(e.encodingLength)}),n(t.R&&t.S,"Signature without R or S"),e.isPoint(t.R)&&(this._R=t.R),t.S instanceof r&&(this._S=t.S),this._Rencoded=Array.isArray(t.R)?t.R:t.Rencoded,this._Sencoded=Array.isArray(t.S)?t.S:t.Sencoded}a(h,"S",(function(){return this.eddsa.decodeInt(this.Sencoded())})),a(h,"R",(function(){return this.eddsa.decodePoint(this.Rencoded())})),a(h,"Rencoded",(function(){return this.eddsa.encodePoint(this.R())})),a(h,"Sencoded",(function(){return this.eddsa.encodeInt(this.S())})),h.prototype.toBytes=function(){return this.Rencoded().concat(this.Sencoded())},h.prototype.toHex=function(){return s.encode(this.toBytes(),"hex").toUpperCase()},e.exports=h},function(e,t,i){"use strict";var r=i(26);t.certificate=i(202);var s=r.define("RSAPrivateKey",(function(){this.seq().obj(this.key("version").int(),this.key("modulus").int(),this.key("publicExponent").int(),this.key("privateExponent").int(),this.key("prime1").int(),this.key("prime2").int(),this.key("exponent1").int(),this.key("exponent2").int(),this.key("coefficient").int())}));t.RSAPrivateKey=s;var n=r.define("RSAPublicKey",(function(){this.seq().obj(this.key("modulus").int(),this.key("publicExponent").int())}));t.RSAPublicKey=n;var a=r.define("SubjectPublicKeyInfo",(function(){this.seq().obj(this.key("algorithm").use(o),this.key("subjectPublicKey").bitstr())}));t.PublicKey=a;var o=r.define("AlgorithmIdentifier",(function(){this.seq().obj(this.key("algorithm").objid(),this.key("none").null_().optional(),this.key("curve").objid().optional(),this.key("params").seq().obj(this.key("p").int(),this.key("q").int(),this.key("g").int()).optional())})),h=r.define("PrivateKeyInfo",(function(){this.seq().obj(this.key("version").int(),this.key("algorithm").use(o),this.key("subjectPrivateKey").octstr())}));t.PrivateKey=h;var c=r.define("EncryptedPrivateKeyInfo",(function(){this.seq().obj(this.key("algorithm").seq().obj(this.key("id").objid(),this.key("decrypt").seq().obj(this.key("kde").seq().obj(this.key("id").objid(),this.key("kdeparams").seq().obj(this.key("salt").octstr(),this.key("iters").int())),this.key("cipher").seq().obj(this.key("algo").objid(),this.key("iv").octstr()))),this.key("subjectPrivateKey").octstr())}));t.EncryptedPrivateKey=c;var d=r.define("DSAPrivateKey",(function(){this.seq().obj(this.key("version").int(),this.key("p").int(),this.key("q").int(),this.key("g").int(),this.key("pub_key").int(),this.key("priv_key").int())}));t.DSAPrivateKey=d,t.DSAparam=r.define("DSAparam",(function(){this.int()}));var u=r.define("ECPrivateKey",(function(){this.seq().obj(this.key("version").int(),this.key("privateKey").octstr(),this.key("parameters").optional().explicit(0).use(l),this.key("publicKey").optional().explicit(1).bitstr())}));t.ECPrivateKey=u;var l=r.define("ECParameters",(function(){this.choice({namedCurve:this.objid()})}));t.signature=r.define("signature",(function(){this.seq().obj(this.key("r").int(),this.key("s").int())}))},function(e,t,i){var r=i(26),s=i(1);function n(e,t){this.name=e,this.body=t,this.decoders={},this.encoders={}}t.define=function(e,t){return new n(e,t)},n.prototype._createNamed=function(e){var t;try{t=i(194).runInThisContext("(function "+this.name+"(entity) {\n  this._initNamed(entity);\n})")}catch(e){t=function(e){this._initNamed(e)}}return s(t,e),t.prototype._initNamed=function(t){e.call(this,t)},new t(this)},n.prototype._getDecoder=function(e){return e=e||"der",this.decoders.hasOwnProperty(e)||(this.decoders[e]=this._createNamed(r.decoders[e])),this.decoders[e]},n.prototype.decode=function(e,t,i){return this._getDecoder(t).decode(e,i)},n.prototype._getEncoder=function(e){return e=e||"der",this.encoders.hasOwnProperty(e)||(this.encoders[e]=this._createNamed(r.encoders[e])),this.encoders[e]},n.prototype.encode=function(e,t,i){return this._getEncoder(t).encode(e,i)}},function(module,exports){var indexOf=function(e,t){if(e.indexOf)return e.indexOf(t);for(var i=0;i<e.length;i++)if(e[i]===t)return i;return-1},Object_keys=function(e){if(Object.keys)return Object.keys(e);var t=[];for(var i in e)t.push(i);return t},forEach=function(e,t){if(e.forEach)return e.forEach(t);for(var i=0;i<e.length;i++)t(e[i],i,e)},defineProp=function(){try{return Object.defineProperty({},"_",{}),function(e,t,i){Object.defineProperty(e,t,{writable:!0,enumerable:!1,configurable:!0,value:i})}}catch(e){return function(e,t,i){e[t]=i}}}(),globals=["Array","Boolean","Date","Error","EvalError","Function","Infinity","JSON","Math","NaN","Number","Object","RangeError","ReferenceError","RegExp","String","SyntaxError","TypeError","URIError","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","escape","eval","isFinite","isNaN","parseFloat","parseInt","undefined","unescape"];function Context(){}Context.prototype={};var Script=exports.Script=function(e){if(!(this instanceof Script))return new Script(e);this.code=e};Script.prototype.runInContext=function(e){if(!(e instanceof Context))throw new TypeError("needs a 'context' argument.");var t=document.createElement("iframe");t.style||(t.style={}),t.style.display="none",document.body.appendChild(t);var i=t.contentWindow,r=i.eval,s=i.execScript;!r&&s&&(s.call(i,"null"),r=i.eval),forEach(Object_keys(e),(function(t){i[t]=e[t]})),forEach(globals,(function(t){e[t]&&(i[t]=e[t])}));var n=Object_keys(i),a=r.call(i,this.code);return forEach(Object_keys(i),(function(t){(t in e||-1===indexOf(n,t))&&(e[t]=i[t])})),forEach(globals,(function(t){t in e||defineProp(e,t,i[t])})),document.body.removeChild(t),a},Script.prototype.runInThisContext=function(){return eval(this.code)},Script.prototype.runInNewContext=function(e){var t=Script.createContext(e),i=this.runInContext(t);return e&&forEach(Object_keys(t),(function(i){e[i]=t[i]})),i},forEach(Object_keys(Script.prototype),(function(e){exports[e]=Script[e]=function(t){var i=Script(t);return i[e].apply(i,[].slice.call(arguments,1))}})),exports.isContext=function(e){return e instanceof Context},exports.createScript=function(e){return exports.Script(e)},exports.createContext=Script.createContext=function(e){var t=new Context;return"object"==typeof e&&forEach(Object_keys(e),(function(i){t[i]=e[i]})),t}},function(e,t,i){var r=i(1);function s(e){this._reporterState={obj:null,path:[],options:e||{},errors:[]}}function n(e,t){this.path=e,this.rethrow(t)}t.Reporter=s,s.prototype.isError=function(e){return e instanceof n},s.prototype.save=function(){var e=this._reporterState;return{obj:e.obj,pathLen:e.path.length}},s.prototype.restore=function(e){var t=this._reporterState;t.obj=e.obj,t.path=t.path.slice(0,e.pathLen)},s.prototype.enterKey=function(e){return this._reporterState.path.push(e)},s.prototype.exitKey=function(e){var t=this._reporterState;t.path=t.path.slice(0,e-1)},s.prototype.leaveKey=function(e,t,i){var r=this._reporterState;this.exitKey(e),null!==r.obj&&(r.obj[t]=i)},s.prototype.path=function(){return this._reporterState.path.join("/")},s.prototype.enterObject=function(){var e=this._reporterState,t=e.obj;return e.obj={},t},s.prototype.leaveObject=function(e){var t=this._reporterState,i=t.obj;return t.obj=e,i},s.prototype.error=function(e){var t,i=this._reporterState,r=e instanceof n;if(t=r?e:new n(i.path.map((function(e){return"["+JSON.stringify(e)+"]"})).join(""),e.message||e,e.stack),!i.options.partial)throw t;return r||i.errors.push(t),t},s.prototype.wrapResult=function(e){var t=this._reporterState;return t.options.partial?{result:this.isError(e)?null:e,errors:t.errors}:e},r(n,Error),n.prototype.rethrow=function(e){if(this.message=e+" at: "+(this.path||"(shallow)"),Error.captureStackTrace&&Error.captureStackTrace(this,n),!this.stack)try{throw new Error(this.message)}catch(e){this.stack=e.stack}return this}},function(e,t,i){var r=i(27).Reporter,s=i(27).EncoderBuffer,n=i(27).DecoderBuffer,a=i(7),o=["seq","seqof","set","setof","objid","bool","gentime","utctime","null_","enum","int","objDesc","bitstr","bmpstr","charstr","genstr","graphstr","ia5str","iso646str","numstr","octstr","printstr","t61str","unistr","utf8str","videostr"],h=["key","obj","use","optional","explicit","implicit","def","choice","any","contains"].concat(o);function c(e,t){var i={};this._baseState=i,i.enc=e,i.parent=t||null,i.children=null,i.tag=null,i.args=null,i.reverseArgs=null,i.choice=null,i.optional=!1,i.any=!1,i.obj=!1,i.use=null,i.useDecoder=null,i.key=null,i.default=null,i.explicit=null,i.implicit=null,i.contains=null,i.parent||(i.children=[],this._wrap())}e.exports=c;var d=["enc","parent","children","tag","args","reverseArgs","choice","optional","any","obj","use","alteredUse","key","default","explicit","implicit","contains"];c.prototype.clone=function(){var e=this._baseState,t={};d.forEach((function(i){t[i]=e[i]}));var i=new this.constructor(t.parent);return i._baseState=t,i},c.prototype._wrap=function(){var e=this._baseState;h.forEach((function(t){this[t]=function(){var i=new this.constructor(this);return e.children.push(i),i[t].apply(i,arguments)}}),this)},c.prototype._init=function(e){var t=this._baseState;a(null===t.parent),e.call(this),t.children=t.children.filter((function(e){return e._baseState.parent===this}),this),a.equal(t.children.length,1,"Root node can have only one child")},c.prototype._useArgs=function(e){var t=this._baseState,i=e.filter((function(e){return e instanceof this.constructor}),this);e=e.filter((function(e){return!(e instanceof this.constructor)}),this),0!==i.length&&(a(null===t.children),t.children=i,i.forEach((function(e){e._baseState.parent=this}),this)),0!==e.length&&(a(null===t.args),t.args=e,t.reverseArgs=e.map((function(e){if("object"!=typeof e||e.constructor!==Object)return e;var t={};return Object.keys(e).forEach((function(i){i==(0|i)&&(i|=0);var r=e[i];t[r]=i})),t})))},["_peekTag","_decodeTag","_use","_decodeStr","_decodeObjid","_decodeTime","_decodeNull","_decodeInt","_decodeBool","_decodeList","_encodeComposite","_encodeStr","_encodeObjid","_encodeTime","_encodeNull","_encodeInt","_encodeBool"].forEach((function(e){c.prototype[e]=function(){var t=this._baseState;throw new Error(e+" not implemented for encoding: "+t.enc)}})),o.forEach((function(e){c.prototype[e]=function(){var t=this._baseState,i=Array.prototype.slice.call(arguments);return a(null===t.tag),t.tag=e,this._useArgs(i),this}})),c.prototype.use=function(e){a(e);var t=this._baseState;return a(null===t.use),t.use=e,this},c.prototype.optional=function(){return this._baseState.optional=!0,this},c.prototype.def=function(e){var t=this._baseState;return a(null===t.default),t.default=e,t.optional=!0,this},c.prototype.explicit=function(e){var t=this._baseState;return a(null===t.explicit&&null===t.implicit),t.explicit=e,this},c.prototype.implicit=function(e){var t=this._baseState;return a(null===t.explicit&&null===t.implicit),t.implicit=e,this},c.prototype.obj=function(){var e=this._baseState,t=Array.prototype.slice.call(arguments);return e.obj=!0,0!==t.length&&this._useArgs(t),this},c.prototype.key=function(e){var t=this._baseState;return a(null===t.key),t.key=e,this},c.prototype.any=function(){return this._baseState.any=!0,this},c.prototype.choice=function(e){var t=this._baseState;return a(null===t.choice),t.choice=e,this._useArgs(Object.keys(e).map((function(t){return e[t]}))),this},c.prototype.contains=function(e){var t=this._baseState;return a(null===t.use),t.contains=e,this},c.prototype._decode=function(e,t){var i=this._baseState;if(null===i.parent)return e.wrapResult(i.children[0]._decode(e,t));var r,s=i.default,a=!0,o=null;if(null!==i.key&&(o=e.enterKey(i.key)),i.optional){var h=null;if(null!==i.explicit?h=i.explicit:null!==i.implicit?h=i.implicit:null!==i.tag&&(h=i.tag),null!==h||i.any){if(a=this._peekTag(e,h,i.any),e.isError(a))return a}else{var c=e.save();try{null===i.choice?this._decodeGeneric(i.tag,e,t):this._decodeChoice(e,t),a=!0}catch(e){a=!1}e.restore(c)}}if(i.obj&&a&&(r=e.enterObject()),a){if(null!==i.explicit){var d=this._decodeTag(e,i.explicit);if(e.isError(d))return d;e=d}var u=e.offset;if(null===i.use&&null===i.choice){if(i.any)c=e.save();var l=this._decodeTag(e,null!==i.implicit?i.implicit:i.tag,i.any);if(e.isError(l))return l;i.any?s=e.raw(c):e=l}if(t&&t.track&&null!==i.tag&&t.track(e.path(),u,e.length,"tagged"),t&&t.track&&null!==i.tag&&t.track(e.path(),e.offset,e.length,"content"),s=i.any?s:null===i.choice?this._decodeGeneric(i.tag,e,t):this._decodeChoice(e,t),e.isError(s))return s;if(i.any||null!==i.choice||null===i.children||i.children.forEach((function(i){i._decode(e,t)})),i.contains&&("octstr"===i.tag||"bitstr"===i.tag)){var f=new n(s);s=this._getUse(i.contains,e._reporterState.obj)._decode(f,t)}}return i.obj&&a&&(s=e.leaveObject(r)),null===i.key||null===s&&!0!==a?null!==o&&e.exitKey(o):e.leaveKey(o,i.key,s),s},c.prototype._decodeGeneric=function(e,t,i){var r=this._baseState;return"seq"===e||"set"===e?null:"seqof"===e||"setof"===e?this._decodeList(t,e,r.args[0],i):/str$/.test(e)?this._decodeStr(t,e,i):"objid"===e&&r.args?this._decodeObjid(t,r.args[0],r.args[1],i):"objid"===e?this._decodeObjid(t,null,null,i):"gentime"===e||"utctime"===e?this._decodeTime(t,e,i):"null_"===e?this._decodeNull(t,i):"bool"===e?this._decodeBool(t,i):"objDesc"===e?this._decodeStr(t,e,i):"int"===e||"enum"===e?this._decodeInt(t,r.args&&r.args[0],i):null!==r.use?this._getUse(r.use,t._reporterState.obj)._decode(t,i):t.error("unknown tag: "+e)},c.prototype._getUse=function(e,t){var i=this._baseState;return i.useDecoder=this._use(e,t),a(null===i.useDecoder._baseState.parent),i.useDecoder=i.useDecoder._baseState.children[0],i.implicit!==i.useDecoder._baseState.implicit&&(i.useDecoder=i.useDecoder.clone(),i.useDecoder._baseState.implicit=i.implicit),i.useDecoder},c.prototype._decodeChoice=function(e,t){var i=this._baseState,r=null,s=!1;return Object.keys(i.choice).some((function(n){var a=e.save(),o=i.choice[n];try{var h=o._decode(e,t);if(e.isError(h))return!1;r={type:n,value:h},s=!0}catch(t){return e.restore(a),!1}return!0}),this),s?r:e.error("Choice not matched")},c.prototype._createEncoderBuffer=function(e){return new s(e,this.reporter)},c.prototype._encode=function(e,t,i){var r=this._baseState;if(null===r.default||r.default!==e){var s=this._encodeValue(e,t,i);if(void 0!==s&&!this._skipDefault(s,t,i))return s}},c.prototype._encodeValue=function(e,t,i){var s=this._baseState;if(null===s.parent)return s.children[0]._encode(e,t||new r);var n=null;if(this.reporter=t,s.optional&&void 0===e){if(null===s.default)return;e=s.default}var a=null,o=!1;if(s.any)n=this._createEncoderBuffer(e);else if(s.choice)n=this._encodeChoice(e,t);else if(s.contains)a=this._getUse(s.contains,i)._encode(e,t),o=!0;else if(s.children)a=s.children.map((function(i){if("null_"===i._baseState.tag)return i._encode(null,t,e);if(null===i._baseState.key)return t.error("Child should have a key");var r=t.enterKey(i._baseState.key);if("object"!=typeof e)return t.error("Child expected, but input is not object");var s=i._encode(e[i._baseState.key],t,e);return t.leaveKey(r),s}),this).filter((function(e){return e})),a=this._createEncoderBuffer(a);else if("seqof"===s.tag||"setof"===s.tag){if(!s.args||1!==s.args.length)return t.error("Too many args for : "+s.tag);if(!Array.isArray(e))return t.error("seqof/setof, but data is not Array");var h=this.clone();h._baseState.implicit=null,a=this._createEncoderBuffer(e.map((function(i){var r=this._baseState;return this._getUse(r.args[0],e)._encode(i,t)}),h))}else null!==s.use?n=this._getUse(s.use,i)._encode(e,t):(a=this._encodePrimitive(s.tag,e),o=!0);if(!s.any&&null===s.choice){var c=null!==s.implicit?s.implicit:s.tag,d=null===s.implicit?"universal":"context";null===c?null===s.use&&t.error("Tag could be omitted only for .use()"):null===s.use&&(n=this._encodeComposite(c,o,d,a))}return null!==s.explicit&&(n=this._encodeComposite(s.explicit,!1,"context",n)),n},c.prototype._encodeChoice=function(e,t){var i=this._baseState,r=i.choice[e.type];return r||a(!1,e.type+" not found in "+JSON.stringify(Object.keys(i.choice))),r._encode(e.value,t)},c.prototype._encodePrimitive=function(e,t){var i=this._baseState;if(/str$/.test(e))return this._encodeStr(t,e);if("objid"===e&&i.args)return this._encodeObjid(t,i.reverseArgs[0],i.args[1]);if("objid"===e)return this._encodeObjid(t,null,null);if("gentime"===e||"utctime"===e)return this._encodeTime(t,e);if("null_"===e)return this._encodeNull();if("int"===e||"enum"===e)return this._encodeInt(t,i.args&&i.reverseArgs[0]);if("bool"===e)return this._encodeBool(t);if("objDesc"===e)return this._encodeStr(t,e);throw new Error("Unsupported tag: "+e)},c.prototype._isNumstr=function(e){return/^[0-9 ]*$/.test(e)},c.prototype._isPrintstr=function(e){return/^[A-Za-z0-9 '\(\)\+,\-\.\/:=\?]*$/.test(e)}},function(e,t,i){var r=i(90);t.tagClass={0:"universal",1:"application",2:"context",3:"private"},t.tagClassByName=r._reverse(t.tagClass),t.tag={0:"end",1:"bool",2:"int",3:"bitstr",4:"octstr",5:"null_",6:"objid",7:"objDesc",8:"external",9:"real",10:"enum",11:"embed",12:"utf8str",13:"relativeOid",16:"seq",17:"set",18:"numstr",19:"printstr",20:"t61str",21:"videostr",22:"ia5str",23:"utctime",24:"gentime",25:"graphstr",26:"iso646str",27:"genstr",28:"unistr",29:"charstr",30:"bmpstr"},t.tagByName=r._reverse(t.tag)},function(e,t,i){var r=t;r.der=i(91),r.pem=i(199)},function(e,t,i){var r=i(1),s=i(0).Buffer,n=i(91);function a(e){n.call(this,e),this.enc="pem"}r(a,n),e.exports=a,a.prototype.decode=function(e,t){for(var i=e.toString().split(/[\r\n]+/g),r=t.label.toUpperCase(),a=/^-----(BEGIN|END) ([^-]+)-----$/,o=-1,h=-1,c=0;c<i.length;c++){var d=i[c].match(a);if(null!==d&&d[2]===r){if(-1!==o){if("END"!==d[1])break;h=c;break}if("BEGIN"!==d[1])break;o=c}}if(-1===o||-1===h)throw new Error("PEM section not found for: "+r);var u=i.slice(o+1,h).join("");u.replace(/[^a-z0-9\+\/=]+/gi,"");var l=new s(u,"base64");return n.prototype.decode.call(this,l,t)}},function(e,t,i){var r=t;r.der=i(92),r.pem=i(201)},function(e,t,i){var r=i(1),s=i(92);function n(e){s.call(this,e),this.enc="pem"}r(n,s),e.exports=n,n.prototype.encode=function(e,t){for(var i=s.prototype.encode.call(this,e).toString("base64"),r=["-----BEGIN "+t.label+"-----"],n=0;n<i.length;n+=64)r.push(i.slice(n,n+64));return r.push("-----END "+t.label+"-----"),r.join("\n")}},function(e,t,i){"use strict";var r=i(26),s=r.define("Time",(function(){this.choice({utcTime:this.utctime(),generalTime:this.gentime()})})),n=r.define("AttributeTypeValue",(function(){this.seq().obj(this.key("type").objid(),this.key("value").any())})),a=r.define("AlgorithmIdentifier",(function(){this.seq().obj(this.key("algorithm").objid(),this.key("parameters").optional(),this.key("curve").objid().optional())})),o=r.define("SubjectPublicKeyInfo",(function(){this.seq().obj(this.key("algorithm").use(a),this.key("subjectPublicKey").bitstr())})),h=r.define("RelativeDistinguishedName",(function(){this.setof(n)})),c=r.define("RDNSequence",(function(){this.seqof(h)})),d=r.define("Name",(function(){this.choice({rdnSequence:this.use(c)})})),u=r.define("Validity",(function(){this.seq().obj(this.key("notBefore").use(s),this.key("notAfter").use(s))})),l=r.define("Extension",(function(){this.seq().obj(this.key("extnID").objid(),this.key("critical").bool().def(!1),this.key("extnValue").octstr())})),f=r.define("TBSCertificate",(function(){this.seq().obj(this.key("version").explicit(0).int().optional(),this.key("serialNumber").int(),this.key("signature").use(a),this.key("issuer").use(d),this.key("validity").use(u),this.key("subject").use(d),this.key("subjectPublicKeyInfo").use(o),this.key("issuerUniqueID").implicit(1).bitstr().optional(),this.key("subjectUniqueID").implicit(2).bitstr().optional(),this.key("extensions").explicit(3).seqof(l).optional())})),p=r.define("X509Certificate",(function(){this.seq().obj(this.key("tbsCertificate").use(f),this.key("signatureAlgorithm").use(a),this.key("signatureValue").bitstr())}));e.exports=p},function(e){e.exports=JSON.parse('{"2.16.840.1.101.3.4.1.1":"aes-128-ecb","2.16.840.1.101.3.4.1.2":"aes-128-cbc","2.16.840.1.101.3.4.1.3":"aes-128-ofb","2.16.840.1.101.3.4.1.4":"aes-128-cfb","2.16.840.1.101.3.4.1.21":"aes-192-ecb","2.16.840.1.101.3.4.1.22":"aes-192-cbc","2.16.840.1.101.3.4.1.23":"aes-192-ofb","2.16.840.1.101.3.4.1.24":"aes-192-cfb","2.16.840.1.101.3.4.1.41":"aes-256-ecb","2.16.840.1.101.3.4.1.42":"aes-256-cbc","2.16.840.1.101.3.4.1.43":"aes-256-ofb","2.16.840.1.101.3.4.1.44":"aes-256-cfb"}')},function(e,t,i){var r=/Proc-Type: 4,ENCRYPTED[\n\r]+DEK-Info: AES-((?:128)|(?:192)|(?:256))-CBC,([0-9A-H]+)[\n\r]+([0-9A-z\n\r\+\/\=]+)[\n\r]+/m,s=/^-----BEGIN ((?:.*? KEY)|CERTIFICATE)-----/m,n=/^-----BEGIN ((?:.*? KEY)|CERTIFICATE)-----([0-9A-z\n\r\+\/\=]+)-----END \1-----$/m,a=i(33),o=i(47),h=i(2).Buffer;e.exports=function(e,t){var i,c=e.toString(),d=c.match(r);if(d){var u="aes"+d[1],l=h.from(d[2],"hex"),f=h.from(d[3].replace(/[\r\n]/g,""),"base64"),p=a(t,l.slice(0,8),parseInt(d[1],10)).key,m=[],_=o.createDecipheriv(u,p,l);m.push(_.update(f)),m.push(_.final()),i=h.concat(m)}else{var g=c.match(n);i=new h(g[2].replace(/[\r\n]/g,""),"base64")}return{tag:c.match(s)[1],data:i}}},function(e,t,i){(function(t){var r=i(3),s=i(51).ec,n=i(35),a=i(93);function o(e,t){if(e.cmpn(0)<=0)throw new Error("invalid sig");if(e.cmp(t)>=t)throw new Error("invalid sig")}e.exports=function(e,i,h,c,d){var u=n(h);if("ec"===u.type){if("ecdsa"!==c&&"ecdsa/rsa"!==c)throw new Error("wrong public key type");return function(e,t,i){var r=a[i.data.algorithm.curve.join(".")];if(!r)throw new Error("unknown curve "+i.data.algorithm.curve.join("."));var n=new s(r),o=i.data.subjectPrivateKey.data;return n.verify(t,e,o)}(e,i,u)}if("dsa"===u.type){if("dsa"!==c)throw new Error("wrong public key type");return function(e,t,i){var s=i.data.p,a=i.data.q,h=i.data.g,c=i.data.pub_key,d=n.signature.decode(e,"der"),u=d.s,l=d.r;o(u,a),o(l,a);var f=r.mont(s),p=u.invm(a);return 0===h.toRed(f).redPow(new r(t).mul(p).mod(a)).fromRed().mul(c.toRed(f).redPow(l.mul(p).mod(a)).fromRed()).mod(s).mod(a).cmp(l)}(e,i,u)}if("rsa"!==c&&"ecdsa/rsa"!==c)throw new Error("wrong public key type");i=t.concat([d,i]);for(var l=u.modulus.byteLength(),f=[1],p=0;i.length+f.length+2<l;)f.push(255),p++;f.push(0);for(var m=-1;++m<i.length;)f.push(i[m]);f=new t(f);var _=r.mont(u.modulus);e=(e=new r(e).toRed(_)).redPow(new r(u.publicExponent)),e=new t(e.fromRed().toArray());var g=p<8?1:0;for(l=Math.min(e.length,f.length),e.length!==f.length&&(g=1),m=-1;++m<l;)g|=e[m]^f[m];return 0===g}}).call(this,i(0).Buffer)},function(e,t,i){(function(t){var r=i(51),s=i(3);e.exports=function(e){return new a(e)};var n={secp256k1:{name:"secp256k1",byteLength:32},secp224r1:{name:"p224",byteLength:28},prime256v1:{name:"p256",byteLength:32},prime192v1:{name:"p192",byteLength:24},ed25519:{name:"ed25519",byteLength:32},secp384r1:{name:"p384",byteLength:48},secp521r1:{name:"p521",byteLength:66}};function a(e){this.curveType=n[e],this.curveType||(this.curveType={name:e}),this.curve=new r.ec(this.curveType.name),this.keys=void 0}function o(e,i,r){Array.isArray(e)||(e=e.toArray());var s=new t(e);if(r&&s.length<r){var n=new t(r-s.length);n.fill(0),s=t.concat([n,s])}return i?s.toString(i):s}n.p224=n.secp224r1,n.p256=n.secp256r1=n.prime256v1,n.p192=n.secp192r1=n.prime192v1,n.p384=n.secp384r1,n.p521=n.secp521r1,a.prototype.generateKeys=function(e,t){return this.keys=this.curve.genKeyPair(),this.getPublicKey(e,t)},a.prototype.computeSecret=function(e,i,r){return i=i||"utf8",t.isBuffer(e)||(e=new t(e,i)),o(this.curve.keyFromPublic(e).getPublic().mul(this.keys.getPrivate()).getX(),r,this.curveType.byteLength)},a.prototype.getPublicKey=function(e,t){var i=this.keys.getPublic("compressed"===t,!0);return"hybrid"===t&&(i[i.length-1]%2?i[0]=7:i[0]=6),o(i,e)},a.prototype.getPrivateKey=function(e){return o(this.keys.getPrivate(),e)},a.prototype.setPublicKey=function(e,i){return i=i||"utf8",t.isBuffer(e)||(e=new t(e,i)),this.keys._importPublic(e),this},a.prototype.setPrivateKey=function(e,i){i=i||"utf8",t.isBuffer(e)||(e=new t(e,i));var r=new s(e);return r=r.toString(16),this.keys=this.curve.genKeyPair(),this.keys._importPrivate(r),this}}).call(this,i(0).Buffer)},function(e,t,i){t.publicEncrypt=i(208),t.privateDecrypt=i(209),t.privateEncrypt=function(e,i){return t.publicEncrypt(e,i,!0)},t.publicDecrypt=function(e,i){return t.privateDecrypt(e,i,!0)}},function(e,t,i){var r=i(35),s=i(20),n=i(22),a=i(94),o=i(95),h=i(3),c=i(96),d=i(50),u=i(2).Buffer;e.exports=function(e,t,i){var l;l=e.padding?e.padding:i?1:4;var f,p=r(e);if(4===l)f=function(e,t){var i=e.modulus.byteLength(),r=t.length,c=n("sha1").update(u.alloc(0)).digest(),d=c.length,l=2*d;if(r>i-l-2)throw new Error("message too long");var f=u.alloc(i-r-l-2),p=i-d-1,m=s(d),_=o(u.concat([c,f,u.alloc(1,1),t],p),a(m,p)),g=o(m,a(_,d));return new h(u.concat([u.alloc(1),g,_],i))}(p,t);else if(1===l)f=function(e,t,i){var r,n=t.length,a=e.modulus.byteLength();if(n>a-11)throw new Error("message too long");r=i?u.alloc(a-n-3,255):function(e){var t,i=u.allocUnsafe(e),r=0,n=s(2*e),a=0;for(;r<e;)a===n.length&&(n=s(2*e),a=0),(t=n[a++])&&(i[r++]=t);return i}(a-n-3);return new h(u.concat([u.from([0,i?1:2]),r,u.alloc(1),t],a))}(p,t,i);else{if(3!==l)throw new Error("unknown padding");if((f=new h(t)).cmp(p.modulus)>=0)throw new Error("data too long for modulus")}return i?d(f,p):c(f,p)}},function(e,t,i){var r=i(35),s=i(94),n=i(95),a=i(3),o=i(50),h=i(22),c=i(96),d=i(2).Buffer;e.exports=function(e,t,i){var u;u=e.padding?e.padding:i?1:4;var l,f=r(e),p=f.modulus.byteLength();if(t.length>p||new a(t).cmp(f.modulus)>=0)throw new Error("decryption error");l=i?c(new a(t),f):o(t,f);var m=d.alloc(p-l.length);if(l=d.concat([m,l],p),4===u)return function(e,t){var i=e.modulus.byteLength(),r=h("sha1").update(d.alloc(0)).digest(),a=r.length;if(0!==t[0])throw new Error("decryption error");var o=t.slice(1,a+1),c=t.slice(a+1),u=n(o,s(c,a)),l=n(c,s(u,i-a-1));if(function(e,t){e=d.from(e),t=d.from(t);var i=0,r=e.length;e.length!==t.length&&(i++,r=Math.min(e.length,t.length));var s=-1;for(;++s<r;)i+=e[s]^t[s];return i}(r,l.slice(0,a)))throw new Error("decryption error");var f=a;for(;0===l[f];)f++;if(1!==l[f++])throw new Error("decryption error");return l.slice(f)}(f,l);if(1===u)return function(e,t,i){var r=t.slice(0,2),s=2,n=0;for(;0!==t[s++];)if(s>=t.length){n++;break}var a=t.slice(2,s-1);("0002"!==r.toString("hex")&&!i||"0001"!==r.toString("hex")&&i)&&n++;a.length<8&&n++;if(n)throw new Error("decryption error");return t.slice(s)}(0,l,i);if(3===u)return l;throw new Error("unknown padding")}},function(e,t,i){"use strict";(function(e,r){function s(){throw new Error("secure random number generation not supported by this browser\nuse chrome, FireFox or Internet Explorer 11")}var n=i(2),a=i(20),o=n.Buffer,h=n.kMaxLength,c=e.crypto||e.msCrypto,d=Math.pow(2,32)-1;function u(e,t){if("number"!=typeof e||e!=e)throw new TypeError("offset must be a number");if(e>d||e<0)throw new TypeError("offset must be a uint32");if(e>h||e>t)throw new RangeError("offset out of range")}function l(e,t,i){if("number"!=typeof e||e!=e)throw new TypeError("size must be a number");if(e>d||e<0)throw new TypeError("size must be a uint32");if(e+t>i||e>h)throw new RangeError("buffer too small")}function f(e,t,i,s){if(r.browser){var n=e.buffer,o=new Uint8Array(n,t,i);return c.getRandomValues(o),s?void r.nextTick((function(){s(null,e)})):e}if(!s)return a(i).copy(e,t),e;a(i,(function(i,r){if(i)return s(i);r.copy(e,t),s(null,e)}))}c&&c.getRandomValues||!r.browser?(t.randomFill=function(t,i,r,s){if(!(o.isBuffer(t)||t instanceof e.Uint8Array))throw new TypeError('"buf" argument must be a Buffer or Uint8Array');if("function"==typeof i)s=i,i=0,r=t.length;else if("function"==typeof r)s=r,r=t.length-i;else if("function"!=typeof s)throw new TypeError('"cb" argument must be a function');return u(i,t.length),l(r,i,t.length),f(t,i,r,s)},t.randomFillSync=function(t,i,r){void 0===i&&(i=0);if(!(o.isBuffer(t)||t instanceof e.Uint8Array))throw new TypeError('"buf" argument must be a Buffer or Uint8Array');u(i,t.length),void 0===r&&(r=t.length-i);return l(r,i,t.length),f(t,i,r)}):(t.randomFill=s,t.randomFillSync=s)}).call(this,i(13),i(9))},function(e,t,i){"use strict";(function(e){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(4)),n=r(i(30));class a extends s.default.EventEmitter{constructor(e){super(),this._hci=e,this._scanState=null,this._scanFilterDuplicates=null,this._discoveries={},this._hci.on("error",this.onHciError.bind(this)),this._hci.on("leScanParametersSet",this.onHciLeScanParametersSet.bind(this)),this._hci.on("leScanEnableSet",this.onHciLeScanEnableSet.bind(this)),this._hci.on("leAdvertisingReport",this.onHciLeAdvertisingReport.bind(this)),this._hci.on("leScanEnableSetCmd",this.onLeScanEnableSetCmd.bind(this)),this._hci.on("leAdvertisingParametersSet",this.onHciLeAdvertisingParametersSet.bind(this)),this._hci.on("leAdvertisingDataSet",this.onHciLeAdvertisingDataSet.bind(this)),this._hci.on("leScanResponseDataSet",this.onHciLeScanResponseDataSet.bind(this)),this._hci.on("leAdvertiseEnableSet",this.onHciLeAdvertiseEnableSet.bind(this))}startScanning(e,t){this._scanState="starting",this._scanFilterDuplicates=!e,this._discoveries={},this._hci.setScanEnabled(!1,!0),console.log("scan enable false"),this._hci.once("leScanEnableSet",e=>{console.log("setScanParameters"),this._hci.setScanParameters(t),this._hci.once("leScanParametersSet",e=>{console.log("setScanParameters finished"),setTimeout(()=>{this._hci.setScanEnabled(!0,this._scanFilterDuplicates)},1e3)})})}stopScanning(){this._scanState="stopping",this._hci.setScanEnabled(!1,!0)}onHciLeScanParametersSet(){}onHciLeScanEnableSet(e){0===e&&("starting"===this._scanState?(this._scanState="started",this.emit("scanStart",this._scanFilterDuplicates)):"stopping"===this._scanState&&(this._scanState="stopped",this.emit("scanStop")))}onLeScanEnableSetCmd(e,t){"starting"===this._scanState||"started"===this._scanState?e?this._scanFilterDuplicates!==t&&(this._scanFilterDuplicates=t,this.emit("scanStart",this._scanFilterDuplicates)):this.emit("scanStop"):"stopping"!==this._scanState&&"stopped"!==this._scanState||!e||this.emit("scanStart",this._scanFilterDuplicates)}onHciLeAdvertisingReport(e,t,i,r,s,n){const a=!!this._discoveries[i],o=a?this._discoveries[i].advertisement:{localName:void 0,txPowerLevel:void 0,manufacturerData:void 0,serviceData:[],serviceUuids:[],solicitationServiceUuids:[],advertisementRaw:[],scanResponseRaw:[],raw:[]};let h=a?this._discoveries[i].count:0,c=!!a&&this._discoveries[i].hasScanResponse;4===t?(c=!0,s.length>0&&(o.scanResponseRaw=Array.from(s))):(o.serviceData=[],o.serviceUuids=[],o.serviceSolicitationUuids=[],s.length>0&&(o.advertisementRaw=Array.from(s))),h++;let d=0,u=0,l=null,f=null;for(;d+1<s.length;){const e=s.readUInt8(d);if(e<1)break;const t=s.readUInt8(d+1);if(d+e+1>s.length)break;const i=s.slice(d+2).slice(0,e-1);switch(t){case 2:case 3:for(u=0;u<i.length;u+=2)l=i.readUInt16LE(u).toString(16),-1===o.serviceUuids.indexOf(l)&&o.serviceUuids.push(l);break;case 6:case 7:for(u=0;u<i.length;u+=16)l=i.slice(u,u+16).toString("hex").match(/.{1,2}/g).reverse().join(""),-1===o.serviceUuids.indexOf(l)&&o.serviceUuids.push(l);break;case 8:case 9:o.localName=i.toString("utf8");break;case 10:o.txPowerLevel=i.readInt8(0);break;case 20:for(u=0;u<i.length;u+=2)f=i.readUInt16LE(u).toString(16),-1===o.serviceSolicitationUuids.indexOf(f)&&o.serviceSolicitationUuids.push(f);break;case 21:for(u=0;u<i.length;u+=16)f=i.slice(u,u+16).toString("hex").match(/.{1,2}/g).reverse().join(""),-1===o.serviceSolicitationUuids.indexOf(f)&&o.serviceSolicitationUuids.push(f);break;case 22:{const e=i.slice(0,2).toString("hex").match(/.{1,2}/g).reverse().join(""),t=i.slice(2,i.length);o.serviceData.push({uuid:e,data:t});break}case 32:{const e=i.slice(0,4).toString("hex").match(/.{1,2}/g).reverse().join(""),t=i.slice(4,i.length);o.serviceData.push({uuid:e,data:t});break}case 33:{const e=i.slice(0,16).toString("hex").match(/.{1,2}/g).reverse().join(""),t=i.slice(16,i.length);o.serviceData.push({uuid:e,data:t});break}case 31:for(u=0;u<i.length;u+=4)f=i.readUInt32LE(u).toString(16),-1===o.serviceSolicitationUuids.indexOf(f)&&o.serviceSolicitationUuids.push(f);break;case 255:o.manufacturerData=i}d+=e+1}JSON.stringify(o,null,0);const p=4===t&&a?this._discoveries[i].connectable:3!==t;this._discoveries[i]={address:i,addressType:r,connectable:p,advertisement:o,rssi:n,count:h,hasScanResponse:c},this.emit("discover",e,i,r,p,o,n)}startAdvertising(t,i){JSON.stringify(i,null,2);let r=3,s=0;const n=[],a=[];let o=0;if(t&&t.length&&(s+=2+t.length),i&&i.length)for(o=0;o<i.length;o++){const t=e.from(i[o].match(/.{1,2}/g).reverse().join(""),"hex");2===t.length?n.push(t):16===t.length&&a.push(t)}n.length&&(r+=2+2*n.length),a.length&&(r+=2+16*a.length);const h=e.alloc(r),c=e.alloc(s);h.writeUInt8(2,0),h.writeUInt8(1,1),h.writeUInt8(6,2);let d=3;if(n.length)for(h.writeUInt8(1+2*n.length,d),d++,h.writeUInt8(3,d),d++,o=0;o<n.length;o++)n[o].copy(h,d),d+=n[o].length;if(a.length)for(h.writeUInt8(1+16*a.length,d),d++,h.writeUInt8(6,d),d++,o=0;o<a.length;o++)a[o].copy(h,d),d+=a[o].length;if(t&&t.length){const i=e.from(t);c.writeUInt8(1+i.length,0),c.writeUInt8(8,1),i.copy(c,2)}this.startAdvertisingWithEIRData(h,c)}startAdvertisingIBeacon(t){t.toString("hex");const i=t.length,r=4+i,s=5+r,n=e.alloc(s),a=e.alloc(0);n.writeUInt8(2,0),n.writeUInt8(1,1),n.writeUInt8(6,2),n.writeUInt8(r+1,3),n.writeUInt8(255,4),n.writeUInt16LE(76,5),n.writeUInt8(2,7),n.writeUInt8(i,8),t.copy(n,9),this.startAdvertisingWithEIRData(n,a)}startAdvertisingWithEIRData(t,i){t=t||e.alloc(0),i=i||e.alloc(0),t.toString("hex"),i.toString("hex");let r=null;t.length>31?r=new Error("Advertisement data is over maximum limit of 31 bytes"):i.length>31&&(r=new Error("Scan data is over maximum limit of 31 bytes")),r?this.emit("advertisingStart",r):(this._advertiseState="starting",this._hci.setScanResponseData(i),this._hci.setAdvertisingData(t),this._hci.setAdvertiseEnable(!0),this._hci.setScanResponseData(i),this._hci.setAdvertisingData(t))}restartAdvertising(){this._advertiseState="restarting",this._hci.setAdvertiseEnable(!0)}stopAdvertising(){this._advertiseState="stopping",this._hci.setAdvertiseEnable(!1)}onHciError(e){}onHciLeAdvertisingParametersSet(e){}onHciLeAdvertisingDataSet(e){}onHciLeScanResponseDataSet(e){}onHciLeAdvertiseEnableSet(e){if("starting"===this._advertiseState){this._advertiseState="started";let t=null;e&&(t=new Error(n.default.STATUS_MAPPER[e]||"Unknown ("+e+")")),this.emit("advertisingStart",t)}else"stopping"===this._advertiseState&&(this._advertiseState="stopped",this.emit("advertisingStop"))}}t.default=a}).call(this,i(0).Buffer)},function(e,t,i){"use strict";(function(e,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(i(4));var a,o;!function(e){e.OP_ERROR=1,e.OP_MTU_REQ=2,e.OP_MTU_RESP=3,e.OP_FIND_INFO_REQ=4,e.OP_FIND_INFO_RESP=5,e.OP_READ_BY_TYPE_REQ=8,e.OP_READ_BY_TYPE_RESP=9,e.OP_READ_REQ=10,e.OP_READ_RESP=11,e.OP_READ_BLOB_REQ=12,e.OP_READ_BLOB_RESP=13,e.OP_READ_BY_GROUP_REQ=16,e.OP_READ_BY_GROUP_RESP=17,e.OP_WRITE_REQ=18,e.OP_WRITE_RESP=19,e.OP_PREPARE_WRITE_REQ=22,e.OP_PREPARE_WRITE_RESP=23,e.OP_EXECUTE_WRITE_REQ=24,e.OP_EXECUTE_WRITE_RESP=25,e.OP_HANDLE_NOTIFY=27,e.OP_HANDLE_IND=29,e.OP_HANDLE_CNF=30,e.OP_WRITE_CMD=82,e.ECODE_SUCCESS=0,e.ECODE_INVALID_HANDLE=1,e.ECODE_READ_NOT_PERM=2,e.ECODE_WRITE_NOT_PERM=3,e.ECODE_INVALID_PDU=4,e.ECODE_AUTHENTICATION=5,e.ECODE_REQ_NOT_SUPP=6,e.ECODE_INVALID_OFFSET=7,e.ECODE_AUTHORIZATION=8,e.ECODE_PREP_QUEUE_FULL=9,e.ECODE_ATTR_NOT_FOUND=10,e.ECODE_ATTR_NOT_LONG=11,e.ECODE_INSUFF_ENCR_KEY_SIZE=12,e.ECODE_INVAL_ATTR_VALUE_LEN=13,e.ECODE_UNLIKELY=14,e.ECODE_INSUFF_ENC=15,e.ECODE_UNSUPP_GRP_TYPE=16,e.ECODE_INSUFF_RESOURCES=17,e.CID=4}(a||(a={})),function(e){e.PRIM_SVC_UUID=10240,e.INCLUDE_UUID=10242,e.CHARAC_UUID=10243,e.CLIENT_CHARAC_CFG_UUID=10498,e.SERVER_CHARAC_CFG_UUID=10499}(o||(o={}));class h extends n.default.EventEmitter{constructor(e,t){super(),this._address=e,this._aclStream=t,this._services={},this._characteristics={},this._descriptors={},this._currentCommand=null,this._commandQueue=[],this._mtu=23,this._security="low",this.onAclStreamDataBinded=this.onAclStreamData.bind(this),this.onAclStreamEncryptBinded=this.onAclStreamEncrypt.bind(this),this.onAclStreamEncryptFailBinded=this.onAclStreamEncryptFail.bind(this),this.onAclStreamEndBinded=this.onAclStreamEnd.bind(this),this._aclStream.on("data",this.onAclStreamDataBinded),this._aclStream.on("encrypt",this.onAclStreamEncryptBinded),this._aclStream.on("encryptFail",this.onAclStreamEncryptFailBinded),this._aclStream.on("end",this.onAclStreamEndBinded)}onAclStreamData(t,i){if(t===a.CID)if(this._currentCommand&&i.toString("hex")===this._currentCommand.buffer.toString("hex"))this._address;else if(i[0]%2==0)if(e.env.NOBLE_MULTI_ROLE)this._address;else{const e=i[0];this._address,e.toString(16),this.writeAtt(this.errorResponse(e,0,a.ECODE_REQ_NOT_SUPP))}else if(i[0]===a.OP_HANDLE_NOTIFY||i[0]===a.OP_HANDLE_IND){const e=i.readUInt16LE(1),t=i.slice(3);this.emit("handleNotify",this._address,e,t),i[0]===a.OP_HANDLE_IND&&this._queueCommand(this.handleConfirmation(),null,()=>{this.emit("handleConfirmation",this._address,e)});for(const i in this._services)for(const r in this._characteristics[i])this._characteristics[i][r].valueHandle===e&&this.emit("notification",this._address,i,r,t)}else if(this._currentCommand){if(i[0]===a.OP_ERROR&&(i[4]===a.ECODE_AUTHENTICATION||i[4]===a.ECODE_AUTHORIZATION||i[4]===a.ECODE_INSUFF_ENC)&&"medium"!==this._security)return void this._aclStream.encrypt();for(this._address,i.toString("hex"),this._currentCommand.callback(i),this._currentCommand=null;this._commandQueue.length&&(this._currentCommand=this._commandQueue.shift(),this.writeAtt(this._currentCommand.buffer),!this._currentCommand.callback);)this._currentCommand.writeCallback&&(this._currentCommand.writeCallback(),this._currentCommand=null)}else this._address}onAclStreamEncrypt(e){e&&(this._security="medium",this.writeAtt(this._currentCommand.buffer))}onAclStreamEncryptFail(){}onAclStreamEnd(){this._aclStream.removeListener("data",this.onAclStreamDataBinded),this._aclStream.removeListener("encrypt",this.onAclStreamEncryptBinded),this._aclStream.removeListener("encryptFail",this.onAclStreamEncryptFailBinded),this._aclStream.removeListener("end",this.onAclStreamEndBinded)}writeAtt(e){this._address,e.toString("hex"),this._aclStream.write(a.CID,e)}errorResponse(e,t,i){const s=r.alloc(5);return s.writeUInt8(a.OP_ERROR,0),s.writeUInt8(e,1),s.writeUInt16LE(t,2),s.writeUInt8(i,4),s}_queueCommand(e,t,i){if(this._commandQueue.push({buffer:e,callback:t,writeCallback:i}),null===this._currentCommand)for(;this._commandQueue.length&&(this._currentCommand=this._commandQueue.shift(),this.writeAtt(this._currentCommand.buffer),!this._currentCommand.callback);)this._currentCommand.writeCallback&&(this._currentCommand.writeCallback(),this._currentCommand=null)}mtuRequest(e){const t=r.alloc(3);return t.writeUInt8(a.OP_MTU_REQ,0),t.writeUInt16LE(e,1),t}readByGroupRequest(e,t,i){const s=r.alloc(7);return s.writeUInt8(a.OP_READ_BY_GROUP_REQ,0),s.writeUInt16LE(e,1),s.writeUInt16LE(t,3),s.writeUInt16LE(i,5),s}readByTypeRequest(e,t,i){const s=r.alloc(7);return s.writeUInt8(a.OP_READ_BY_TYPE_REQ,0),s.writeUInt16LE(e,1),s.writeUInt16LE(t,3),s.writeUInt16LE(i,5),s}readRequest(e){const t=r.alloc(3);return t.writeUInt8(a.OP_READ_REQ,0),t.writeUInt16LE(e,1),t}readBlobRequest(e,t){const i=r.alloc(5);return i.writeUInt8(a.OP_READ_BLOB_REQ,0),i.writeUInt16LE(e,1),i.writeUInt16LE(t,3),i}findInfoRequest(e,t){const i=r.alloc(5);return i.writeUInt8(a.OP_FIND_INFO_REQ,0),i.writeUInt16LE(e,1),i.writeUInt16LE(t,3),i}writeRequest(e,t,i){const s=r.alloc(3+t.length);s.writeUInt8(i?a.OP_WRITE_CMD:a.OP_WRITE_REQ,0),s.writeUInt16LE(e,1);for(let e=0;e<t.length;e++)s.writeUInt8(t.readUInt8(e),e+3);return s}prepareWriteRequest(e,t,i){const s=r.alloc(5+i.length);s.writeUInt8(a.OP_PREPARE_WRITE_REQ,0),s.writeUInt16LE(e,1),s.writeUInt16LE(t,3);for(let e=0;e<i.length;e++)s.writeUInt8(i.readUInt8(e),e+5);return s}executeWriteRequest(e,t){const i=r.alloc(2);return i.writeUInt8(a.OP_EXECUTE_WRITE_REQ,0),i.writeUInt8(t?0:1,1),i}handleConfirmation(){const e=r.alloc(1);return e.writeUInt8(a.OP_HANDLE_CNF,0),e}exchangeMtu(e){this._queueCommand(this.mtuRequest(e),e=>{if(e[0]===a.OP_MTU_RESP){const t=e.readUInt16LE(1);this._address,this._mtu=t}this.emit("mtu",this._address,this._mtu)})}discoverServices(e){const t=[],i=r=>{const s=r[0];let n=0;if(s===a.OP_READ_BY_GROUP_RESP){const e=r[1],i=(r.length-2)/e;for(n=0;n<i;n++)t.push({startHandle:r.readUInt16LE(2+n*e+0),endHandle:r.readUInt16LE(2+n*e+2),uuid:6===e?r.readUInt16LE(2+n*e+4).toString(16):r.slice(2+n*e+4).slice(0,16).toString("hex").match(/.{1,2}/g).reverse().join("")})}if(s!==a.OP_READ_BY_GROUP_RESP||65535===t[t.length-1].endHandle){const i=[];for(n=0;n<t.length;n++)0!==e.length&&-1===e.indexOf(t[n].uuid)||i.push(t[n].uuid),this._services[t[n].uuid]=t[n];this.emit("servicesDiscover",this._address,i)}else this._queueCommand(this.readByGroupRequest(t[t.length-1].endHandle+1,65535,o.PRIM_SVC_UUID),i)};this._queueCommand(this.readByGroupRequest(1,65535,o.PRIM_SVC_UUID),i)}discoverIncludedServices(e,t){const i=this._services[e],r=[],s=e=>{const n=e[0];let h=0;if(n===a.OP_READ_BY_TYPE_RESP){const t=e[1],i=(e.length-2)/t;for(h=0;h<i;h++)r.push({endHandle:e.readUInt16LE(2+h*t+0),startHandle:e.readUInt16LE(2+h*t+2),uuid:8===t?e.readUInt16LE(2+h*t+6).toString(16):e.slice(2+h*t+6).slice(0,16).toString("hex").match(/.{1,2}/g).reverse().join("")})}if(n!==a.OP_READ_BY_TYPE_RESP||r[r.length-1].endHandle===i.endHandle){const e=[];for(h=0;h<r.length;h++)0!==t.length&&-1===t.indexOf(r[h].uuid)||e.push(r[h].uuid);this.emit("includedServicesDiscover",this._address,i.uuid,e)}else this._queueCommand(this.readByTypeRequest(r[r.length-1].endHandle+1,i.endHandle,o.INCLUDE_UUID),s)};this._queueCommand(this.readByTypeRequest(i.startHandle,i.endHandle,o.INCLUDE_UUID),s)}discoverCharacteristics(e,t){const i=this._services[e],r=[];this._characteristics[e]=this._characteristics[e]||{},this._descriptors[e]=this._descriptors[e]||{};const s=n=>{const h=n[0];let c=0;if(h===a.OP_READ_BY_TYPE_RESP){const e=n[1],t=(n.length-2)/e;for(c=0;c<t;c++)r.push({startHandle:n.readUInt16LE(2+c*e+0),properties:n.readUInt8(2+c*e+2),valueHandle:n.readUInt16LE(2+c*e+3),uuid:7===e?n.readUInt16LE(2+c*e+5).toString(16):n.slice(2+c*e+5).slice(0,16).toString("hex").match(/.{1,2}/g).reverse().join("")})}if(h!==a.OP_READ_BY_TYPE_RESP||r[r.length-1].valueHandle===i.endHandle){const s=[];for(c=0;c<r.length;c++){const n=r[c].properties,a={properties:[],uuid:r[c].uuid};0!==c&&(r[c-1].endHandle=r[c].startHandle-1),c===r.length-1&&(r[c].endHandle=i.endHandle),this._characteristics[e][r[c].uuid]=r[c],1&n&&a.properties.push("broadcast"),2&n&&a.properties.push("read"),4&n&&a.properties.push("writeWithoutResponse"),8&n&&a.properties.push("write"),16&n&&a.properties.push("notify"),32&n&&a.properties.push("indicate"),64&n&&a.properties.push("authenticatedSignedWrites"),128&n&&a.properties.push("extendedProperties"),0!==t.length&&-1===t.indexOf(a.uuid)||s.push(a)}this.emit("characteristicsDiscover",this._address,e,s)}else this._queueCommand(this.readByTypeRequest(r[r.length-1].valueHandle+1,i.endHandle,o.CHARAC_UUID),s)};this._queueCommand(this.readByTypeRequest(i.startHandle,i.endHandle,o.CHARAC_UUID),s)}read(e,t){if(!this._characteristics[e]||!this._characteristics[e][t])return void this.emit("read",this._address,e,t,r.alloc(0),!1);const i=this._characteristics[e][t];let s=r.alloc(0);const n=o=>{const h=o[0];h===a.OP_READ_RESP||h===a.OP_READ_BLOB_RESP?(s=r.from(s.toString("hex")+o.slice(1).toString("hex"),"hex"),o.length===this._mtu?this._queueCommand(this.readBlobRequest(i.valueHandle,s.length),n):this.emit("read",this._address,e,t,s,!0)):h===a.OP_ERROR?this.emit("read",this._address,e,t,r.alloc(0),!1):this.emit("read",this._address,e,t,s,!0)};this._queueCommand(this.readRequest(i.valueHandle),n)}write(e,t,i,r){if(!this._characteristics[e]||!this._characteristics[e][t])return void this.emit("write",this._address,e,t,!1);const s=this._characteristics[e][t];if(r)this._queueCommand(this.writeRequest(s.valueHandle,i,!0),null,()=>{this.emit("write",this._address,e,t)});else{if(i.length+3>this._mtu)return this.longWrite(e,t,i,r);this._queueCommand(this.writeRequest(s.valueHandle,i,!1),i=>{const r=i[0];r!==a.OP_WRITE_RESP&&r!==a.OP_ERROR||this.emit("write",this._address,e,t,r===a.OP_WRITE_RESP)})}}longWrite(e,t,i,r){const s=this._characteristics[e][t],n=this._mtu-5,o=e=>t=>{const i=t[0];if(i!==a.OP_PREPARE_WRITE_RESP)this._address;else{const i=e.length+5;t.length!==i&&(this._address,t.length)}};let h=0;for(;h<i.length;){const e=h+n,t=i.slice(h,e);this._queueCommand(this.prepareWriteRequest(s.valueHandle,h,t),o(t)),h=e}this._queueCommand(this.executeWriteRequest(s.valueHandle),i=>{i[0]!==a.OP_EXECUTE_WRITE_RESP||r||this.emit("write",this._address,e,t)})}broadcast(e,t,i){const s=this._characteristics[e][t];this._queueCommand(this.readByTypeRequest(s.startHandle,s.endHandle,o.SERVER_CHARAC_CFG_UUID),s=>{if(s[0]===a.OP_READ_BY_TYPE_RESP){const n=s.readUInt16LE(2);let o=s.readUInt16LE(4);i?o|=1:o&=65534;const h=r.alloc(2);h.writeUInt16LE(o,0),this._queueCommand(this.writeRequest(n,h,!1),r=>{r[0]===a.OP_WRITE_RESP&&this.emit("broadcast",this._address,e,t,i)})}})}notify(e,t,i){const s=this._characteristics[e][t];this._queueCommand(this.readByTypeRequest(s.startHandle,s.endHandle,o.CLIENT_CHARAC_CFG_UUID),n=>{if(n[0]===a.OP_READ_BY_TYPE_RESP){const o=n.readUInt16LE(2);let h=n.readUInt16LE(4);const c=16&s.properties,d=32&s.properties;i?c?h|=1:d&&(h|=2):c?h&=65534:d&&(h&=65533);const u=r.alloc(2);u.writeUInt16LE(h,0),this._queueCommand(this.writeRequest(o,u,!1),r=>{r[0];a.OP_WRITE_RESP,this.emit("notify",this._address,e,t,i)})}})}discoverDescriptors(e,t){const i=this._characteristics[e][t],r=[];this._descriptors[e][t]={};const s=n=>{const o=n[0];let h=0;if(o===a.OP_FIND_INFO_RESP){const e=n[1];for(h=0;h<e;h++)r.push({handle:n.readUInt16LE(2+4*h+0),uuid:n.readUInt16LE(2+4*h+2).toString(16)})}if(o!==a.OP_FIND_INFO_RESP||r[r.length-1].handle===i.endHandle){const i=[];for(h=0;h<r.length;h++)i.push(r[h].uuid),this._descriptors[e][t][r[h].uuid]=r[h];this.emit("descriptorsDiscover",this._address,e,t,i)}else this._queueCommand(this.findInfoRequest(r[r.length-1].handle+1,i.endHandle),s)};this._queueCommand(this.findInfoRequest(i.valueHandle+1,i.endHandle),s)}readValue(e,t,i){if(!this._descriptors[e]||!this._descriptors[e][t]||!this._descriptors[e][t][i])return void this.emit("valueRead",this._address,e,t,i,r.alloc(0),!1);const s=this._descriptors[e][t][i];this._queueCommand(this.readRequest(s.handle),r=>{const s=r[0];s!==a.OP_READ_RESP&&s!==a.OP_ERROR||this.emit("valueRead",this._address,e,t,i,r.slice(1),s===a.OP_READ_RESP)})}writeValue(e,t,i,r){if(!this._descriptors[e]||!this._descriptors[e][t]||!this._descriptors[e][t][i])return void this.emit("valueWrite",this._address,e,t,i,!1);const s=this._descriptors[e][t][i];this._queueCommand(this.writeRequest(s.handle,r,!1),r=>{const s=r[0];s!==a.OP_WRITE_RESP&&s!==a.OP_ERROR||this.emit("valueWrite",this._address,e,t,i,s===a.OP_WRITE_RESP)})}readHandle(e){this._queueCommand(this.readRequest(e),t=>{t[0]===a.OP_READ_RESP&&this.emit("handleRead",this._address,e,t.slice(1))})}writeHandle(e,t,i){i?this._queueCommand(this.writeRequest(e,t,!0),null,()=>{this.emit("handleWrite",this._address,e)}):this._queueCommand(this.writeRequest(e,t,!1),t=>{t[0]===a.OP_WRITE_RESP&&this.emit("handleWrite",this._address,e)})}}t.default=h}).call(this,i(9),i(0).Buffer)},function(e,t,i){"use strict";(function(e){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(4));class n extends s.default.EventEmitter{constructor(e,t){super(),this._handle=e,this._aclStream=t,this.onAclStreamDataBinded=this.onAclStreamData.bind(this),this.onAclStreamEndBinded=this.onAclStreamEnd.bind(this),this._aclStream.on("data",this.onAclStreamDataBinded),this._aclStream.on("end",this.onAclStreamEndBinded)}onAclStreamData(e,t){if(5!==e)return;t.toString("hex");const i=t.readUInt8(0),r=t.readUInt8(1),s=(t.readUInt16LE(2),t.slice(4));18===i&&this.processConnectionParameterUpdateRequest(r,s)}onAclStreamEnd(){this._aclStream.removeListener("data",this.onAclStreamDataBinded),this._aclStream.removeListener("end",this.onAclStreamEndBinded)}processConnectionParameterUpdateRequest(t,i){const r=1.25*i.readUInt16LE(0),s=1.25*i.readUInt16LE(2),n=i.readUInt16LE(4),a=10*i.readUInt16LE(6),o=e.alloc(6);o.writeUInt8(19,0),o.writeUInt8(t,1),o.writeUInt16LE(2,2),o.writeUInt16LE(0,4),this._aclStream.write(5,o),this.emit("connectionParameterUpdateRequest",this._handle,r,s,n,a)}}t.default=n}).call(this,i(0).Buffer)},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(4)),n=r(i(215)),a=r(i(216)),o=r(i(220)),h=r(i(221));class c extends s.default.EventEmitter{constructor(e){super(),this._state=null,this._advertising=!1,this._hci=e,this._gap=new o.default(this._hci),this._gatt=new h.default,this._address=null,this._handle=null,this._aclStream=null}startAdvertising(e,t){this._advertising=!0,this._gap.startAdvertising(e,t)}startAdvertisingIBeacon(e){this._advertising=!0,this._gap.startAdvertisingIBeacon(e)}startAdvertisingWithEIRData(e,t){this._advertising=!0,this._gap.startAdvertisingWithEIRData(e,t)}stopAdvertising(){this._advertising=!1,this._gap.stopAdvertising()}setServices(e){this._gatt.setServices(e),this.emit("servicesSet")}disconnect(){this._handle&&this._hci.disconnect(this._handle)}updateRssi(){this._handle&&this._hci.readRssi(this._handle)}init(){this._gap.on("advertisingStart",this.onAdvertisingStart.bind(this)),this._gap.on("advertisingStop",this.onAdvertisingStop.bind(this)),this._gatt.on("mtuChange",this.onMtuChange.bind(this)),this._hci.on("stateChange",this.onStateChange.bind(this)),this._hci.on("addressChange",this.onAddressChange.bind(this)),this._hci.on("readLocalVersion",this.onReadLocalVersion.bind(this)),this._hci.on("leConnComplete",this.onLeConnComplete.bind(this)),this._hci.on("leConnUpdateComplete",this.onLeConnUpdateComplete.bind(this)),this._hci.on("rssiRead",this.onRssiRead.bind(this)),this._hci.on("disconnComplete",this.onDisconnComplete.bind(this)),this._hci.on("encryptChange",this.onEncryptChange.bind(this)),this._hci.on("leLtkNegReply",this.onLeLtkNegReply.bind(this)),this._hci.on("aclDataPkt",this.onAclDataPkt.bind(this)),this.emit("platform",n.default.platform())}onStateChange(e){this._state!==e&&(this._state=e,"unauthorized"===e?(console.log("bleno warning: adapter state unauthorized, please run as root or with sudo"),console.log("               or see README for information on running without root/sudo:"),console.log("               https://github.com/sandeepmistry/bleno#running-on-linux")):"unsupported"===e&&(console.log("bleno warning: adapter does not support Bluetooth Low Energy (BLE, Bluetooth Smart)."),console.log("               Try to run with environment variable:"),console.log("               [sudo] BLENO_HCI_DEVICE_ID=x node ...")),this.emit("stateChange",e))}onAddressChange(e){this.emit("addressChange",e)}onReadLocalVersion(e,t,i,r,s){}onAdvertisingStart(e){this.emit("advertisingStart",e)}onAdvertisingStop(){this.emit("advertisingStop")}onLeConnComplete(e,t,i,r,s,n,o,h,c){1===i&&(this._address=s,this._handle=t,this._aclStream=new a.default(this._hci,t,this._hci.addressType,this._hci.address,r,s),this._gatt.setAclStream(this._aclStream),this.emit("accept",s))}onLeConnUpdateComplete(e,t,i,r){}onDisconnComplete(e,t){if(this._handle!==e)return;this._aclStream&&this._aclStream.push(null,null);const i=this._address;this._address=null,this._handle=null,this._aclStream=null,i&&this.emit("disconnect",i),this._advertising&&this._gap.restartAdvertising()}onEncryptChange(e,t){this._handle===e&&this._aclStream&&this._aclStream.pushEncrypt(t)}onLeLtkNegReply(e){this._handle===e&&this._aclStream&&this._aclStream.pushLtkNegReply()}onMtuChange(e){this.emit("mtuChange",e)}onRssiRead(e,t){this.emit("rssiUpdate",t)}onAclDataPkt(e,t,i){this._handle===e&&this._aclStream&&this._aclStream.push(t,i)}}t.default=c},function(e,t){t.endianness=function(){return"LE"},t.hostname=function(){return"undefined"!=typeof location?location.hostname:""},t.loadavg=function(){return[]},t.uptime=function(){return 0},t.freemem=function(){return Number.MAX_VALUE},t.totalmem=function(){return Number.MAX_VALUE},t.cpus=function(){return[]},t.type=function(){return"Browser"},t.release=function(){return"undefined"!=typeof navigator?navigator.appVersion:""},t.networkInterfaces=t.getNetworkInterfaces=function(){return{}},t.arch=function(){return"javascript"},t.platform=function(){return"browser"},t.tmpdir=t.tmpDir=function(){return"/tmp"},t.EOL="\n",t.homedir=function(){return"/"}},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(4)),n=r(i(217));class a extends s.default.EventEmitter{constructor(e,t,i,r,s,a){super(),this._hci=e,this._handle=t,this.encypted=!1,this._smp=new n.default(this,i,r,s,a,this._hci)}write(e,t){this._hci.queueAclDataPkt(this._handle,e,t)}push(e,t){t?this.emit("data",e,t):this.emit("end")}pushEncrypt(e){this.encrypted=!!e,this.emit("encryptChange",this.encrypted)}pushLtkNegReply(){this.emit("ltkNegReply")}}t.default=a},function(e,t,i){"use strict";(function(e){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(4),n=r(i(218)),a=r(i(219));var o;!function(e){e.CID=6,e.PAIRING_REQUEST=1,e.PAIRING_RESPONSE=2,e.PAIRING_CONFIRM=3,e.PAIRING_RANDOM=4,e.PAIRING_FAILED=5,e.ENCRYPT_INFO=6,e.MASTER_IDENT=7,e.UNSPECIFIED=8}(o||(o={}));class h extends s.EventEmitter{constructor(t,i,r,s,n,o){super(),this._aclStream=t,this._mgmt=new a.default(o),this._iat=e.from(["random"===s?1:0]),this._ia=e.from(n.split(":").reverse().join(""),"hex"),this._rat=e.from(["random"===i?1:0]),this._ra=e.from(r.split(":").reverse().join(""),"hex"),this._stk=null,this._random=null,this._diversifier=null,this.onAclStreamDataBinded=this.onAclStreamData.bind(this),this.onAclStreamEncryptChangeBinded=this.onAclStreamEncryptChange.bind(this),this.onAclStreamLtkNegReplyBinded=this.onAclStreamLtkNegReply.bind(this),this.onAclStreamEndBinded=this.onAclStreamEnd.bind(this),this._aclStream.on("data",this.onAclStreamDataBinded),this._aclStream.on("encryptChange",this.onAclStreamEncryptChangeBinded),this._aclStream.on("ltkNegReply",this.onAclStreamLtkNegReplyBinded),this._aclStream.on("end",this.onAclStreamEndBinded)}onAclStreamData(e,t){if(e!==o.CID)return;const i=t.readUInt8(0);o.PAIRING_REQUEST===i?this.handlePairingRequest(t):o.PAIRING_CONFIRM===i?this.handlePairingConfirm(t):o.PAIRING_RANDOM===i?this.handlePairingRandom(t):o.PAIRING_FAILED===i&&this.handlePairingFailed(t)}onAclStreamEncryptChange(t){t&&this._stk&&this._diversifier&&this._random&&(this.write(e.concat([e.from([o.ENCRYPT_INFO]),this._stk])),this.write(e.concat([e.from([o.MASTER_IDENT]),this._diversifier,this._random])))}onAclStreamLtkNegReply(){this.write(e.from([o.PAIRING_FAILED,o.UNSPECIFIED])),this.emit("fail")}onAclStreamEnd(){this._aclStream.removeListener("data",this.onAclStreamDataBinded),this._aclStream.removeListener("encryptChange",this.onAclStreamEncryptChangeBinded),this._aclStream.removeListener("ltkNegReply",this.onAclStreamLtkNegReplyBinded),this._aclStream.removeListener("end",this.onAclStreamEndBinded)}handlePairingRequest(t){this._preq=t,this._pres=e.from([o.PAIRING_RESPONSE,3,0,1,16,0,1]),this.write(this._pres)}handlePairingConfirm(t){this._pcnf=t,this._tk=e.from("00000000000000000000000000000000","hex"),this._r=n.default.r(),this.write(e.concat([e.from([o.PAIRING_CONFIRM]),n.default.c1(this._tk,this._r,this._pres,this._preq,this._iat,this._ia,this._rat,this._ra)]))}handlePairingRandom(t){const i=t.slice(1),r=e.concat([e.from([o.PAIRING_CONFIRM]),n.default.c1(this._tk,i,this._pres,this._preq,this._iat,this._ia,this._rat,this._ra)]);this._pcnf.toString("hex")===r.toString("hex")?(this._diversifier=e.from("0000","hex"),this._random=e.from("0000000000000000","hex"),this._stk=n.default.s1(this._tk,this._r,i),this._mgmt.addLongTermKey(this._ia,this._iat,0,0,this._diversifier,this._random,this._stk),this.write(e.concat([e.from([o.PAIRING_RANDOM]),this._r]))):(this.write(e.from([o.PAIRING_FAILED,o.PAIRING_CONFIRM])),this.emit("fail"))}handlePairingFailed(e){this.emit("fail")}write(e){this._aclStream.write(o.CID,e)}}t.default=h}).call(this,i(0).Buffer)},function(e,t,i){"use strict";(function(e){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(60));function n(t,i){t=o(t),i=o(i);const r=s.default.createCipheriv("aes-128-ecb",t,"");return r.setAutoPadding(!1),o(e.concat([r.update(i),r.final()]))}function a(t,i){const r=e.alloc(t.length);for(let e=0;e<t.length;e++)r[e]=t[e]^i[e];return r}function o(t){const i=e.alloc(t.length);for(let e=0;e<i.length;e++)i[e]=t[t.length-e-1];return i}t.default={r:function(){return s.default.randomBytes(16)},c1:function(t,i,r,s,o,h,c,d){const u=e.concat([o,c,s,r]),l=e.concat([d,h,e.from("00000000","hex")]);let f=a(i,u);return f=n(t,f),f=a(f,l),f=n(t,f),f},s1:function(t,i,r){return n(t,e.concat([r.slice(0,8),i.slice(0,8)]))},e:n}}).call(this,i(0).Buffer)},function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e){this._ltkInfos=[],this._hci=e}nSocketData(e){e.toString("hex")}nSocketError(e){e.message}ddLongTermKey(t,i,r,s,n,a,o){const h=e.alloc(36);t.copy(h,0),h.writeUInt8(i.readUInt8(0)+1,6),h.writeUInt8(r,7),h.writeUInt8(s,8),h.writeUInt8(o.length,9),n.copy(h,10),a.copy(h,12),o.copy(h,20),this._ltkInfos.push(h),this.loadLongTermKeys()}learLongTermKeys(){this._ltkInfos=[],this.loadLongTermKeys()}oadLongTermKeys(){const t=this._ltkInfos.length,i=e.alloc(2+36*t);i.writeUInt16LE(t,0);for(let e=0;e<t;e++)this._ltkInfos[e].copy(i,2+36*e);this.write(19,0,i)}rite(t,i,r){let s=0;r&&(s=r.length);const n=e.alloc(6+s);n.writeUInt16LE(t,0),n.writeUInt16LE(i,2),n.writeUInt16LE(s,4),s&&r.copy(n,6),n.toString("hex"),this._hci._socket.write(n)}}}).call(this,i(0).Buffer)},function(e,t,i){"use strict";(function(e){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(4)),n=r(i(30));class a extends s.default.EventEmitter{constructor(e){super(),this._hci=e,this._advertiseState=null,this._hci.on("error",this.onHciError.bind(this)),this._hci.on("leAdvertisingParametersSet",this.onHciLeAdvertisingParametersSet.bind(this)),this._hci.on("leAdvertisingDataSet",this.onHciLeAdvertisingDataSet.bind(this)),this._hci.on("leScanResponseDataSet",this.onHciLeScanResponseDataSet.bind(this)),this._hci.on("leAdvertiseEnableSet",this.onHciLeAdvertiseEnableSet.bind(this))}startAdvertising(t,i){JSON.stringify(i,null,2);let r=3,s=0;const n=[],a=[];let o=0;if(t&&t.length&&(s+=2+t.length),i&&i.length)for(o=0;o<i.length;o++){const t=e.from(i[o].match(/.{1,2}/g).reverse().join(""),"hex");2===t.length?n.push(t):16===t.length&&a.push(t)}n.length&&(r+=2+2*n.length),a.length&&(r+=2+16*a.length);const h=e.alloc(r),c=e.alloc(s);h.writeUInt8(2,0),h.writeUInt8(1,1),h.writeUInt8(6,2);let d=3;if(n.length)for(h.writeUInt8(1+2*n.length,d),d++,h.writeUInt8(3,d),d++,o=0;o<n.length;o++)n[o].copy(h,d),d+=n[o].length;if(a.length)for(h.writeUInt8(1+16*a.length,d),d++,h.writeUInt8(6,d),d++,o=0;o<a.length;o++)a[o].copy(h,d),d+=a[o].length;if(t&&t.length){const i=e.alloc(t);c.writeUInt8(1+i.length,0),c.writeUInt8(8,1),i.copy(c,2)}this.startAdvertisingWithEIRData(h,c)}startAdvertisingIBeacon(t){t.toString("hex");const i=t.length,r=4+i,s=5+r,n=e.alloc(s),a=e.alloc(0);n.writeUInt8(2,0),n.writeUInt8(1,1),n.writeUInt8(6,2),n.writeUInt8(r+1,3),n.writeUInt8(255,4),n.writeUInt16LE(76,5),n.writeUInt8(2,7),n.writeUInt8(i,8),t.copy(n,9),this.startAdvertisingWithEIRData(n,a)}startAdvertisingWithEIRData(t,i){t=t||e.alloc(0),i=i||e.alloc(0),t.toString("hex"),i.toString("hex");let r=null;t.length>31?r=new Error("Advertisement data is over maximum limit of 31 bytes"):i.length>31&&(r=new Error("Scan data is over maximum limit of 31 bytes")),r?this.emit("advertisingStart",r):(this._advertiseState="starting",this._hci.setScanResponseData(i),this._hci.setAdvertisingData(t),this._hci.setAdvertiseEnable(!0),this._hci.setScanResponseData(i),this._hci.setAdvertisingData(t))}restartAdvertising(){this._advertiseState="restarting",this._hci.setAdvertiseEnable(!0)}stopAdvertising(){this._advertiseState="stopping",this._hci.setAdvertiseEnable(!1)}onHciError(e){}onHciLeAdvertisingParametersSet(e){}onHciLeAdvertisingDataSet(e){}onHciLeScanResponseDataSet(e){}onHciLeAdvertiseEnableSet(e){if("starting"===this._advertiseState){this._advertiseState="started";let t=null;e&&(t=new Error(n.default.STATUS_MAPPER[e]||"Unknown ("+e+")")),this.emit("advertisingStart",t)}else"stopping"===this._advertiseState&&(this._advertiseState="stopped",this.emit("advertisingStop"))}}t.default=a}).call(this,i(0).Buffer)},function(e,t,i){"use strict";(function(e){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(4));var n,a;!function(e){e.OP_ERROR=1,e.OP_MTU_REQ=2,e.OP_MTU_RESP=3,e.OP_FIND_INFO_REQ=4,e.OP_FIND_INFO_RESP=5,e.OP_FIND_BY_TYPE_REQ=6,e.OP_FIND_BY_TYPE_RESP=7,e.OP_READ_BY_TYPE_REQ=8,e.OP_READ_BY_TYPE_RESP=9,e.OP_READ_REQ=10,e.OP_READ_RESP=11,e.OP_READ_BLOB_REQ=12,e.OP_READ_BLOB_RESP=13,e.OP_READ_MULTI_REQ=14,e.OP_READ_MULTI_RESP=15,e.OP_READ_BY_GROUP_REQ=16,e.OP_READ_BY_GROUP_RESP=17,e.OP_WRITE_REQ=18,e.OP_WRITE_RESP=19,e.OP_WRITE_CMD=82,e.OP_PREP_WRITE_REQ=22,e.OP_PREP_WRITE_RESP=23,e.OP_EXEC_WRITE_REQ=24,e.OP_EXEC_WRITE_RESP=25,e.OP_HANDLE_NOTIFY=27,e.OP_HANDLE_IND=29,e.OP_HANDLE_CNF=30,e.OP_SIGNED_WRITE_CMD=210,e.ECODE_SUCCESS=0,e.ECODE_INVALID_HANDLE=1,e.ECODE_READ_NOT_PERM=2,e.ECODE_WRITE_NOT_PERM=3,e.ECODE_INVALID_PDU=4,e.ECODE_AUTHENTICATION=5,e.ECODE_REQ_NOT_SUPP=6,e.ECODE_INVALID_OFFSET=7,e.ECODE_AUTHORIZATION=8,e.ECODE_PREP_QUEUE_FULL=9,e.ECODE_ATTR_NOT_FOUND=10,e.ECODE_ATTR_NOT_LONG=11,e.ECODE_INSUFF_ENCR_KEY_SIZE=12,e.ECODE_INVAL_ATTR_VALUE_LEN=13,e.ECODE_UNLIKELY=14,e.ECODE_INSUFF_ENC=15,e.ECODE_UNSUPP_GRP_TYPE=16,e.ECODE_INSUFF_RESOURCES=17,e.CID=4}(n||(n={})),function(e){e.PRIM_SVC_UUID=10240,e.INCLUDE_UUID=10242,e.CHARAC_UUID=10243,e.CLIENT_CHARAC_CFG_UUID=10498,e.SERVER_CHARAC_CFG_UUID=10499}(a||(a={}));class o extends s.default.EventEmitter{constructor(){super(),this.maxMtu=256,this._mtu=23,this._preparedWriteRequest=null,this.setServices([]),this.onAclStreamDataBinded=this.onAclStreamData.bind(this),this.onAclStreamEndBinded=this.onAclStreamEnd.bind(this)}setServices(t){const i=[].concat(t);this._handles=[];let r,s,n=0;for(r=0;r<i.length;r++){const t=i[r];n++;const a=n;for(this._handles[a]={type:"service",uuid:t.uuid,attribute:t,startHandle:a},s=0;s<t.characteristics.length;s++){const i=t.characteristics[s];let r=0,a=0;-1!==i.properties.indexOf("read")&&(r|=2,-1!==i.secure.indexOf("read")&&(a|=2)),-1!==i.properties.indexOf("writeWithoutResponse")&&(r|=4,-1!==i.secure.indexOf("writeWithoutResponse")&&(a|=4)),-1!==i.properties.indexOf("write")&&(r|=8,-1!==i.secure.indexOf("write")&&(a|=8)),-1!==i.properties.indexOf("notify")&&(r|=16,-1!==i.secure.indexOf("notify")&&(a|=16)),-1!==i.properties.indexOf("indicate")&&(r|=32,-1!==i.secure.indexOf("indicate")&&(a|=32)),n++;const o=n;n++;const h=n;if(this._handles[o]={type:"characteristic",uuid:i.uuid,properties:r,secure:a,attribute:i,startHandle:o,valueHandle:h},this._handles[h]={type:"characteristicValue",handle:h,value:i.value},i.descriptors.find(e=>"2902"===e.uuid)||48&r){n++;const t=n;this._handles[t]={type:"descriptor",handle:t,uuid:"2902",attribute:i,properties:14,secure:16&a?14:0,value:e.from([0,0])}}for(let e=0;e<i.descriptors.length;e++){const t=i.descriptors[e];if("2902"===t.uuid)continue;n++;const r=n;this._handles[r]={type:"descriptor",handle:r,uuid:t.uuid,attribute:t,properties:2,secure:0,value:t.value}}}this._handles[a].endHandle=n}const a=[];for(r=0;r<this._handles.length;r++)for(s in n=this._handles[r],a[r]={},n)e.isBuffer(n[s])?a[r][s]=n[s]?"Buffer('"+n[s].toString("hex")+"', 'hex')":null:"attribute"!==s&&(a[r][s]=n[s]);JSON.stringify(a,null,2)}setAclStream(e){this._mtu=23,this._preparedWriteRequest=null,this._aclStream=e,this._aclStream.on("data",this.onAclStreamDataBinded),this._aclStream.on("end",this.onAclStreamEndBinded)}onAclStreamData(e,t){e===n.CID&&this.handleRequest(t)}onAclStreamEnd(){this._aclStream.removeListener("data",this.onAclStreamDataBinded),this._aclStream.removeListener("end",this.onAclStreamEndBinded);for(let t=0;t<this._handles.length;t++)this._handles[t]&&"descriptor"===this._handles[t].type&&"2902"===this._handles[t].uuid&&0!==this._handles[t].value.readUInt16LE(0)&&(this._handles[t].value=e.from([0,0]),this._handles[t].attribute&&this._handles[t].attribute.emit&&this._handles[t].attribute.emit("unsubscribe"))}send(e){e.toString("hex"),this._aclStream.write(n.CID,e)}errorResponse(t,i,r){const s=e.alloc(5);return s.writeUInt8(n.OP_ERROR,0),s.writeUInt8(t,1),s.writeUInt16LE(i,2),s.writeUInt8(r,4),s}handleRequest(e){e.toString("hex");const t=e[0];let i=null;switch(t){case n.OP_MTU_REQ:i=this.handleMtuRequest(e);break;case n.OP_FIND_INFO_REQ:i=this.handleFindInfoRequest(e);break;case n.OP_FIND_BY_TYPE_REQ:i=this.handleFindByTypeRequest(e);break;case n.OP_READ_BY_TYPE_REQ:i=this.handleReadByTypeRequest(e);break;case n.OP_READ_REQ:case n.OP_READ_BLOB_REQ:i=this.handleReadOrReadBlobRequest(e);break;case n.OP_READ_BY_GROUP_REQ:i=this.handleReadByGroupRequest(e);break;case n.OP_WRITE_REQ:case n.OP_WRITE_CMD:i=this.handleWriteRequestOrCommand(e);break;case n.OP_PREP_WRITE_REQ:i=this.handlePrepareWriteRequest(e);break;case n.OP_EXEC_WRITE_REQ:i=this.handleExecuteWriteRequest(e);break;case n.OP_HANDLE_CNF:i=this.handleConfirmation(e);break;default:case n.OP_READ_MULTI_REQ:case n.OP_SIGNED_WRITE_CMD:i=this.errorResponse(t,0,n.ECODE_REQ_NOT_SUPP)}i&&(i.toString("hex"),this.send(i))}handleMtuRequest(t){let i=t.readUInt16LE(1);i<23?i=23:i>this.maxMtu&&(i=this.maxMtu),this._mtu=i,this.emit("mtuChange",this._mtu);const r=e.alloc(3);return r.writeUInt8(n.OP_MTU_RESP,0),r.writeUInt16LE(i,1),r}handleFindInfoRequest(t){let i=null;const r=t.readUInt16LE(1),s=t.readUInt16LE(3),a=[];let o,h=null;for(o=r;o<=s;o++){const e=this._handles[o];if(!e)break;h=null,"service"===e.type?h="2800":"includedService"===e.type?h="2802":"characteristic"===e.type?h="2803":"characteristicValue"===e.type?h=this._handles[o-1].uuid:"descriptor"===e.type&&(h=e.uuid),h&&a.push({handle:o,uuid:h})}if(a.length){const t=a[0].uuid.length/2;let r=1;for(o=1;o<a.length&&a[0].uuid.length===a[o].uuid.length;o++)r++;const s=2===t?4:18,c=Math.floor((this._mtu-2)/s);for(r=Math.min(r,c),i=e.alloc(2+r*s),i[0]=n.OP_FIND_INFO_RESP,i[1]=2===t?1:2,o=0;o<r;o++){const t=a[o];i.writeUInt16LE(t.handle,2+o*s),h=e.from(t.uuid.match(/.{1,2}/g).reverse().join(""),"hex");for(let e=0;e<h.length;e++)i[2+o*s+2+e]=h[e]}}else i=this.errorResponse(n.OP_FIND_INFO_REQ,r,n.ECODE_ATTR_NOT_FOUND);return i}handleFindByTypeRequest(t){let i=null;const r=t.readUInt16LE(1),s=t.readUInt16LE(3),a=t.slice(5,7).toString("hex").match(/.{1,2}/g).reverse().join(""),o=t.slice(7).toString("hex").match(/.{1,2}/g).reverse().join(""),h=[];let c;for(let e=r;e<=s&&(c=this._handles[e],c);e++)"2800"===a&&"service"===c.type&&c.uuid===o&&h.push({start:c.startHandle,end:c.endHandle});if(h.length){const t=4;let r=h.length;const s=Math.floor((this._mtu-1)/t);r=Math.min(r,s),i=e.alloc(1+r*t),i[0]=n.OP_FIND_BY_TYPE_RESP;for(let e=0;e<r;e++)c=h[e],i.writeUInt16LE(c.start,1+e*t),i.writeUInt16LE(c.end,1+e*t+2)}else i=this.errorResponse(n.OP_FIND_BY_TYPE_REQ,r,n.ECODE_ATTR_NOT_FOUND);return i}handleReadByGroupRequest(t){let i=null;const r=t.readUInt16LE(1),s=t.readUInt16LE(3),a=t.slice(5).toString("hex").match(/.{1,2}/g).reverse().join("");if(r.toString(16),s.toString(16),a.toString(16),"2800"===a||"2802"===a){const t=[],o="2800"===a?"service":"includedService";let h;for(h=r;h<=s;h++){const e=this._handles[h];if(!e)break;e.type===o&&t.push(e)}if(t.length){const r=t[0].uuid.length/2;let s=1;for(h=1;h<t.length&&t[0].uuid.length===t[h].uuid.length;h++)s++;const a=2===r?6:20,o=Math.floor((this._mtu-2)/a);for(s=Math.min(s,o),i=e.alloc(2+s*a),i[0]=n.OP_READ_BY_GROUP_RESP,i[1]=a,h=0;h<s;h++){const r=t[h];i.writeUInt16LE(r.startHandle,2+h*a),i.writeUInt16LE(r.endHandle,2+h*a+2);const s=e.from(r.uuid.match(/.{1,2}/g).reverse().join(""),"hex");for(let e=0;e<s.length;e++)i[2+h*a+4+e]=s[e]}}else i=this.errorResponse(n.OP_READ_BY_GROUP_REQ,r,n.ECODE_ATTR_NOT_FOUND)}else i=this.errorResponse(n.OP_READ_BY_GROUP_REQ,r,n.ECODE_UNSUPP_GRP_TYPE);return i}handleReadByTypeRequest(t){let i=null;const r=t[0],s=t.readUInt16LE(1),a=t.readUInt16LE(3),o=t.slice(5).toString("hex").match(/.{1,2}/g).reverse().join("");let h,c;if(s.toString(16),a.toString(16),o.toString(16),"2803"===o){const t=[];for(h=s;h<=a&&(c=this._handles[h],c);h++)"characteristic"===c.type&&t.push(c);if(t.length){const r=t[0].uuid.length/2;let s=1;for(h=1;h<t.length&&t[0].uuid.length===t[h].uuid.length;h++)s++;const a=2===r?7:21,o=Math.floor((this._mtu-2)/a);for(s=Math.min(s,o),i=e.alloc(2+s*a),i[0]=n.OP_READ_BY_TYPE_RESP,i[1]=a,h=0;h<s;h++){const r=t[h];i.writeUInt16LE(r.startHandle,2+h*a),i.writeUInt8(r.properties,2+h*a+2),i.writeUInt16LE(r.valueHandle,2+h*a+3);const s=e.from(r.uuid.match(/.{1,2}/g).reverse().join(""),"hex");for(let e=0;e<s.length;e++)i[2+h*a+5+e]=s[e]}}else i=this.errorResponse(n.OP_READ_BY_TYPE_REQ,s,n.ECODE_ATTR_NOT_FOUND)}else{let t=null,d=null,u=!1;for(h=s;h<=a&&(c=this._handles[h],c);h++){if("characteristic"===c.type&&c.uuid===o){t=c.attribute,d=c.valueHandle,u=2&c.secure;break}if("descriptor"===c.type&&c.uuid===o){d=h,u=2&c.secure;break}}if(u&&!this._aclStream.encrypted)i=this.errorResponse(n.OP_READ_BY_TYPE_REQ,s,n.ECODE_AUTHENTICATION);else if(d){const i=(t=>(i,s)=>{let a=null;if(n.ECODE_SUCCESS===i){const i=Math.min(s.length,this._mtu-4);for(a=e.alloc(4+i),a[0]=n.OP_READ_BY_TYPE_RESP,a[1]=i+2,a.writeUInt16LE(t,2),h=0;h<i;h++)a[4+h]=s[h]}else a=this.errorResponse(r,t,i);a.toString("hex"),this.send(a)})(d),s=this._handles[d].value;s?i(n.ECODE_SUCCESS,s):t?t.emit("readRequest",0,i):i(n.ECODE_UNLIKELY)}else i=this.errorResponse(n.OP_READ_BY_TYPE_REQ,s,n.ECODE_ATTR_NOT_FOUND)}return i}handleReadOrReadBlobRequest(t){let i=null;const r=t[0],s=t.readUInt16LE(1),a=r===n.OP_READ_BLOB_REQ?t.readUInt16LE(3):0,o=this._handles[s];let h;if(o){let t=null,i=null;const c=o.type,d=((t,i)=>(r,s)=>{let a=null;if(n.ECODE_SUCCESS===r){const i=Math.min(s.length,this._mtu-1);for(a=e.alloc(1+i),a[0]=t===n.OP_READ_BLOB_REQ?n.OP_READ_BLOB_RESP:n.OP_READ_RESP,h=0;h<i;h++)a[1+h]=s[h]}else a=this.errorResponse(t,i,r);a.toString("hex"),this.send(a)})(r,s);if("service"===c||"includedService"===c)t=n.ECODE_SUCCESS,i=e.from(o.uuid.match(/.{1,2}/g).reverse().join(""),"hex");else if("characteristic"===c){const r=e.from(o.uuid.match(/.{1,2}/g).reverse().join(""),"hex");for(t=n.ECODE_SUCCESS,i=e.alloc(3+r.length),i.writeUInt8(o.properties,0),i.writeUInt16LE(o.valueHandle,1),h=0;h<r.length;h++)i[h+3]=r[h]}else if("characteristicValue"===c||"descriptor"===c){let e=o.properties,r=o.secure,h=o.attribute;"characteristicValue"===c&&(e=this._handles[s-1].properties,r=this._handles[s-1].secure,h=this._handles[s-1].attribute),2&e?2&r&&!this._aclStream.encrypted?t=n.ECODE_AUTHENTICATION:(i=o.value,i?t=n.ECODE_SUCCESS:h.emit("readRequest",a,d)):t=n.ECODE_READ_NOT_PERM}i&&"string"==typeof i&&(i=e.from(i)),t===n.ECODE_SUCCESS&&i&&a&&(i.length<a?(t=n.ECODE_INVALID_OFFSET,i=null):i=i.slice(a)),null!==t&&d(t,i)}else i=this.errorResponse(r,s,n.ECODE_INVALID_HANDLE);return i}handleWriteRequestOrCommand(t){let i=null;const r=t[0],s=r===n.OP_WRITE_CMD,a=t.readUInt16LE(1),o=t.slice(3);let h=this._handles[a];if(h){"characteristicValue"===h.type&&(h=this._handles[a-1]);const t=h.properties,c=h.secure;if(t&&(s?4&t:8&t)){const t=((t,i,r)=>s=>{if(!r){let r=null;r=n.ECODE_SUCCESS===s?e.from([n.OP_WRITE_RESP]):this.errorResponse(t,i,s),r.toString("hex"),this.send(r)}})(r,a,s);if(c&(s?4:8)&&!this._aclStream.encrypted)i=this.errorResponse(r,a,n.ECODE_AUTHENTICATION);else if("descriptor"===h.type||"2902"===h.uuid){let i=null;if(2!==o.length)i=n.ECODE_INVAL_ATTR_VALUE_LEN;else{const t=o.readUInt16LE(0),r=h.attribute;if(h.value=o,3&t){const t=((t,i)=>r=>{const s=Math.min(r.length,this._mtu-3),a=-1!==i.properties.indexOf("notify"),o=-1!==i.properties.indexOf("indicate");let h;if(a){const a=e.alloc(3+s);for(a.writeUInt8(n.OP_HANDLE_NOTIFY,0),a.writeUInt16LE(t,1),h=0;h<s;h++)a[3+h]=r[h];a.toString("hex"),this.send(a),i.emit("notify")}else if(o){const a=e.alloc(3+s);for(a.writeUInt8(n.OP_HANDLE_IND,0),a.writeUInt16LE(t,1),h=0;h<s;h++)a[3+h]=r[h];this._lastIndicatedAttribute=i,a.toString("hex"),this.send(a)}})(a-1,r);r.emit&&r.emit("subscribe",this._mtu-3,t)}else r.emit("unsubscribe");i=n.ECODE_SUCCESS}t(i)}else h.attribute.emit("writeRequest",o,0,s,t)}else i=this.errorResponse(r,a,n.ECODE_WRITE_NOT_PERM)}else i=this.errorResponse(r,a,n.ECODE_INVALID_HANDLE);return i}handlePrepareWriteRequest(t){let i=null;const r=t[0],s=t.readUInt16LE(1),a=t.readUInt16LE(3),o=t.slice(5);let h=this._handles[s];if(h)if("characteristicValue"===h.type){h=this._handles[s-1];const c=h.properties,d=h.secure;c&&8&c?8&d&&!this._aclStream.encrypted?i=this.errorResponse(r,s,n.ECODE_AUTHENTICATION):this._preparedWriteRequest?this._preparedWriteRequest.handle!==h?i=this.errorResponse(r,s,n.ECODE_UNLIKELY):a===this._preparedWriteRequest.offset+this._preparedWriteRequest.data.length?(this._preparedWriteRequest.data=e.concat([this._preparedWriteRequest.data,o]),i=e.alloc(t.length),t.copy(i),i[0]=n.OP_PREP_WRITE_RESP):i=this.errorResponse(r,s,n.ECODE_INVALID_OFFSET):(this._preparedWriteRequest={handle:h,valueHandle:s,offset:a,data:o},i=e.alloc(t.length),t.copy(i),i[0]=n.OP_PREP_WRITE_RESP):i=this.errorResponse(r,s,n.ECODE_WRITE_NOT_PERM)}else i=this.errorResponse(r,s,n.ECODE_ATTR_NOT_LONG);else i=this.errorResponse(r,s,n.ECODE_INVALID_HANDLE);return i}handleExecuteWriteRequest(t){let i=null;const r=t[0],s=t[1];if(this._preparedWriteRequest){if(0===s)i=e.from([n.OP_EXEC_WRITE_RESP]);else if(1===s){const t=((t,i)=>r=>{let s=null;s=n.ECODE_SUCCESS===r?e.from([n.OP_EXEC_WRITE_RESP]):this.errorResponse(t,i,r),s.toString("hex"),this.send(s)})(r,this._preparedWriteRequest.valueHandle);this._preparedWriteRequest.handle.attribute.emit("writeRequest",this._preparedWriteRequest.data,this._preparedWriteRequest.offset,!1,t)}else i=this.errorResponse(r,0,n.ECODE_UNLIKELY);this._preparedWriteRequest=null}else i=this.errorResponse(r,0,n.ECODE_UNLIKELY);return i}handleConfirmation(e){this._lastIndicatedAttribute&&(this._lastIndicatedAttribute.emit&&this._lastIndicatedAttribute.emit("indicate"),this._lastIndicatedAttribute=null)}}t.default=o}).call(this,i(0).Buffer)},function(e,t,i){"use strict";(function(e){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(223));t.default=class{constructor(e){this.obnizBle=e,this.adv_data=[],this.scan_resp=[]}start(){this.obnizBle.warningIfNotInitialize(),this.obnizBle.peripheralBindings.startAdvertisingWithEIRData(e.from(this.adv_data),e.from(this.scan_resp))}end(){this.obnizBle.peripheralBindings.stopAdvertising()}setAdvDataRaw(e){this.adv_data=e}setAdvData(e){const t=this.advDataBulider(e);this.setAdvDataRaw(t.build())}setScanRespDataRaw(e){this.scan_resp=e}setScanRespData(e){this.setScanRespDataRaw(this.scanRespDataBuilder(e).build())}advDataBulider(e){return new s.default(e)}scanRespDataBuilder(e){return new s.default(e)}}}).call(this,i(0).Buffer)},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(18));t.default=class{constructor(e){if(this.rows={},e&&(e.localName&&this.setCompleteLocalName(e.localName),e.manufacturerData&&e.manufacturerData.companyCode&&e.manufacturerData.data&&this.setManufacturerSpecificData(e.manufacturerData.companyCode,e.manufacturerData.data),e.serviceUuids))for(const t of e.serviceUuids)this.setUuid(t);"function"==typeof this.extendEvalJson&&this.extendEvalJson(e)}setRow(e,t){this.rows[e]=t}getRow(e){return this.rows[e]||[]}build(){const e=[];for(const t in this.rows)0!==this.rows[t].length&&(e.push(this.rows[t].length+1),e.push(parseInt(t)),Array.prototype.push.apply(e,this.rows[t]));if(e.length>31)throw new Error("Too large data. Advertise/ScanResponse data are must be less than 32 byte.");return e}setStringData(e,t){const i=[];for(let e=0;e<t.length;e++)i.push(t.charCodeAt(e));this.setRow(e,i)}setShortenedLocalName(e){this.setStringData(8,e)}setCompleteLocalName(e){this.setStringData(9,e)}setManufacturerSpecificData(e,t){const i=[];i.push(255&e),i.push(e>>8&255),Array.prototype.push.apply(i,t),this.setRow(255,i)}setUuid(e){const t=this.convertUuid(e),i={16:6,4:4,2:2}[t.length];this.setRow(i,t)}convertUuid(e){const t=s.default.uuidFilter(e);if(32!==t.length&&8!==t.length&&4!==t.length)throw new Error("BLE uuid must be 16/32/128 bit . (example: c28f0ad5-a7fd-48be-9fd0-eae9ffd3a8bb for 128bit)");const i=[];for(let e=t.length;e>1;e-=2)i.push(parseInt(t[e-2]+t[e-1],16));return i}setIbeaconData(e,t,i,r){const s=[];s.push(2,21);const n=this.convertUuid(e);Array.prototype.push.apply(s,n),s.push(t>>8&255),s.push(t>>0&255),s.push(i>>8&255),s.push(i>>0&255),s.push(r>>0&255),this.setManufacturerSpecificData(76,s)}setLeLimitedDiscoverableModeFlag(){this.setFlags(1)}setLeGeneralDiscoverableModeFlag(){this.setFlags(2)}setBrEdrNotSupportedFlag(){this.setFlags(4)}setLeBrEdrControllerFlag(){this.setFlags(8)}setLeBrEdrHostFlag(){this.setFlags(16)}extendEvalJson(e){e&&e.flags&&(e.flags.includes("limited_discoverable_mode")&&this.setLeLimitedDiscoverableModeFlag(),e.flags.includes("general_discoverable_mode")&&this.setLeGeneralDiscoverableModeFlag(),e.flags.includes("br_edr_not_supported")&&this.setBrEdrNotSupportedFlag(),e.flags.includes("le_br_edr_controller")&&this.setLeBrEdrControllerFlag(),e.flags.includes("le_br_edr_host")&&this.setLeBrEdrHostFlag())}setFlags(e){const t=this.getRow(1);t[0]=(t[0]||0)|e,this.setRow(1,t)}}},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(18)),n=r(i(102));t.default=class{constructor(e){this.obnizBle=e,this._services=[],this.currentConnectedDeviceAddress=null}_updateServices(){const e=this._services.map(e=>e.toBufferObj());this.obnizBle.peripheralBindings.setServices(e)}addService(e){this.obnizBle.warningIfNotInitialize(),e instanceof n.default||(e=new n.default(e)),this._services.push(e),e.peripheral=this,this._updateServices()}setJson(e){if(e.services)for(const t of e.services)this.addService(t)}getService(e){e=s.default.uuidFilter(e);const t=this._services.filter(t=>s.default.uuidFilter(t.uuid)===e).shift();return t||null}removeService(e){this._services=this._services.filter(t=>s.default.uuidFilter(t.uuid)!==e),this._updateServices()}stopAllService(){this._services=[],this._updateServices()}toJSON(){return{services:this._services}}findCharacteristic(e){const t=s.default.uuidFilter(e.service_uuid),i=s.default.uuidFilter(e.characteristic_uuid),r=this.getService(t);return r?r.getCharacteristic(i):null}findDescriptor(e){const t=s.default.uuidFilter(e.descriptor_uuid),i=this.findCharacteristic(e);return i?i.getDescriptor(t):null}end(){this.stopAllService()}onerror(e){}}},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(i(14)),a=s(i(59)),o=s(i(18)),h=s(i(226));t.default=class{constructor(e,t){this.obnizBle=e,this.address=t,this.connected=!1,this.device_type=null,this.address_type=null,this.ble_event_type=null,this.rssi=null,this.adv_data=null,this.scan_resp=null,this.localName=null,this.iBeacon=null,this.keys=["device_type","address_type","ble_event_type","rssi","adv_data","scan_resp"],this._services=[],this.emitter=new n.default}get services(){return this._services}toString(){return JSON.stringify({address:this.address,addressType:this.address_type,advertisement:this.adv_data,scanResponse:this.scan_resp,rssi:this.rssi})}setParams(e){this.advertise_data_rows=null;for(const t in e)e.hasOwnProperty(t)&&this.keys.includes(t)&&(this[t]=e[t]);this.analyseAdvertisement()}connect(){this.obnizBle.scan.end(),this.obnizBle.centralBindings.connect(this.address)}connectWait(){return new Promise((e,t)=>{this.emitter.once("statusupdate",i=>{"connected"===i.status?e(!0):t(new Error(`connection to peripheral name=${this.localName} address=${this.address} can't be established`))}),this.connect()})}disconnect(){this.obnizBle.centralBindings.disconnect(this.address)}disconnectWait(){return new Promise((e,t)=>{this.emitter.once("statusupdate",i=>{"disconnected"===i.status?e(!0):t(new Error(`cutting connection to peripheral name=${this.localName} address=${this.address} was failed`))}),this.disconnect()})}getService(e){e=o.default.uuidFilter(e);for(const t in this._services)if(this._services[t].uuid===e)return this._services[t];return null}findService(e){const t=o.default.uuidFilter(e.service_uuid);return this.getService(t)}findCharacteristic(e){const t=o.default.uuidFilter(e.service_uuid),i=o.default.uuidFilter(e.characteristic_uuid),r=this.getService(t);return r?r.getCharacteristic(i):null}findDescriptor(e){const t=o.default.uuidFilter(e.descriptor_uuid),i=this.findCharacteristic(e);return i?i.getDescriptor(t):null}discoverAllServices(){this.obnizBle.centralBindings.discoverServices(this.address)}discoverAllServicesWait(){return new Promise(e=>{this.emitter.once("discoverfinished",()=>{const t=this._services.filter(e=>e.discoverdOnRemote);e(t)}),this.discoverAllServices()})}discoverAllHandlesWait(){return r(this,void 0,void 0,(function*(){const e=(e,t)=>{const i=[];return function e(t,r){for(const s of t)Array.isArray(s)&&r>0?e(s,r-1):i.push(s)}(e,Math.floor(t)||1),i},t=yield this.discoverAllServicesWait(),i=e(yield Promise.all(t.map(e=>e.discoverAllCharacteristicsWait())));e(yield Promise.all(i.map(e=>e.discoverAllDescriptorsWait())))}))}notifyFromServer(e,t){switch(this.emitter.emit(e,t),e){case"statusupdate":"connected"===t.status&&(this.connected=!0,this.onconnect&&this.onconnect()),"disconnected"===t.status&&(this.connected=!1,this.ondisconnect&&this.ondisconnect());break;case"discover":{const e=t.service_uuid;let i=this.getService(e);if(!i){const t=new h.default({uuid:e});t.parent=this,this._services.push(t),i=t}i.discoverdOnRemote=!0,this.ondiscoverservice&&this.ondiscoverservice(i);break}case"discoverfinished":{const e=this._services.filter(e=>e.discoverdOnRemote);this.ondiscoverservicefinished&&this.ondiscoverservicefinished(e);break}}}advertisementServiceUuids(){const e=[];return this._addServiceUuids(e,this.searchTypeVal(2),16),this._addServiceUuids(e,this.searchTypeVal(3),16),this._addServiceUuids(e,this.searchTypeVal(4),32),this._addServiceUuids(e,this.searchTypeVal(5),32),this._addServiceUuids(e,this.searchTypeVal(6),64),this._addServiceUuids(e,this.searchTypeVal(7),64),e}analyseAdvertisement(){if(!this.advertise_data_rows){if(this.advertise_data_rows=[],this.adv_data)for(let e=0;e<this.adv_data.length;e++){const t=this.adv_data[e],i=new Array(t);for(let r=0;r<t;r++)i[r]=this.adv_data[e+r+1];this.advertise_data_rows.push(i),e+=t}if(this.scan_resp)for(let e=0;e<this.scan_resp.length;e++){const t=this.scan_resp[e],i=new Array(t);for(let r=0;r<t;r++)i[r]=this.scan_resp[e+r+1];this.advertise_data_rows.push(i),e+=t}this.setLocalName(),this.setIBeacon()}}searchTypeVal(e){this.analyseAdvertisement();for(let t=0;t<this.advertise_data_rows.length;t++)if(this.advertise_data_rows[t][0]===e){const e=[].concat(this.advertise_data_rows[t]);return e.shift(),e}}setLocalName(){let e=this.searchTypeVal(9);e||(e=this.searchTypeVal(8)),this.localName=e?String.fromCharCode.apply(null,e):null}setIBeacon(){const e=this.searchTypeVal(255);if(!e||76!==e[0]||0!==e[1]||2!==e[2]||21!==e[3]||25!==e.length)return void(this.iBeacon=null);const t=e.slice(4,20);let i="";for(let e=0;e<t.length;e++)i+=("00"+t[e].toString(16)).slice(-2),3!==e&&5!==e&&7!==e&&9!==e||(i+="-");const r=(e[20]<<8)+e[21],s=(e[22]<<8)+e[23],n=e[24];this.iBeacon={uuid:i,major:r,minor:s,power:n,rssi:this.rssi}}_addServiceUuids(e,t,i){if(!t)return;const r=i/8;for(let i=0;i<t.length;i+=r){const s=t.slice(i,i+r);e.push(a.default._dataArray2uuidHex(s,!0))}}}},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(103)),n=r(i(227));class a extends s.default{constructor(e){super(e)}get parentName(){return"peripheral"}get childrenClass(){return n.default}get childrenName(){return"characteristics"}get characteristics(){return this.children}addCharacteristic(e){return this.addChild(e)}getCharacteristic(e){return this.getChild(e)}discoverAllCharacteristics(){return this.discoverChildren()}discoverAllCharacteristicsWait(){return this.discoverChildrenWait()}discoverChildren(){this.parent.obnizBle.centralBindings.discoverCharacteristics(this.peripheral.address,this.uuid)}ondiscover(e){this.ondiscovercharacteristic(e)}ondiscoverfinished(e){this.ondiscovercharacteristicfinished(e)}ondiscovercharacteristic(e){}ondiscovercharacteristicfinished(e){}}t.default=a},function(e,t,i){"use strict";(function(e){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(228)),n=r(i(104));class a extends n.default{constructor(e){super(e),this.properties=e.properties||[],Array.isArray(this.properties)||(this.properties=[this.properties])}get parentName(){return"service"}get childrenClass(){return s.default}get childrenName(){return"descriptors"}get descriptors(){return this.children}addDescriptor(e){return this.addChild(e)}getDescriptor(e){return this.getChild(e)}registerNotify(e){this.onnotify=e,this.service.peripheral.obnizBle.centralBindings.notify(this.service.peripheral.address,this.service.uuid,this.uuid,!0)}registerNotifyWait(e){return new Promise(t=>{this.emitter.once("onregisternotify",()=>{t()}),this.registerNotify(e)})}unregisterNotify(){this.onnotify=()=>{},this.service.peripheral.obnizBle.centralBindings.notify(this.service.peripheral.address,this.service.uuid,this.uuid,!1)}unregisterNotifyWait(){return new Promise(e=>{this.emitter.once("onunregisternotify",()=>{e()}),this.unregisterNotify()})}read(){this.service.peripheral.obnizBle.centralBindings.read(this.service.peripheral.address,this.service.uuid,this.uuid)}write(t,i){void 0===i&&(i=!0),this.service.peripheral.obnizBle.centralBindings.write(this.service.peripheral.address,this.service.uuid,this.uuid,e.from(t),!i)}writeWait(e,t){return super.writeWait(e,t)}readWait(){return super.readWait()}discoverChildren(){this.service.peripheral.obnizBle.centralBindings.discoverDescriptors(this.service.peripheral.address,this.service.uuid,this.uuid)}discoverAllDescriptors(){return this.discoverChildren()}discoverAllDescriptorsWait(){return this.discoverChildrenWait()}toJSON(){const e=super.toJSON();return this.properties.length>0&&(e.properties=this.properties),e}canBroadcast(){return this.properties.includes("broadcast")}canNotify(){return this.properties.includes("notify")}canRead(){return this.properties.includes("read")}canWrite(){return this.properties.includes("write")}canWriteWithoutResponse(){return this.properties.includes("write_without_response")}canIndicate(){return this.properties.includes("indicate")}ondiscover(e){this.ondiscoverdescriptor&&this.ondiscoverdescriptor(e)}ondiscoverfinished(e){this.ondiscoverdescriptorfinished&&this.ondiscoverdescriptorfinished(e)}notifyFromServer(e,t){switch(super.notifyFromServer(e,t),e){case"onregisternotify":this.onregisternotify&&this.onregisternotify();break;case"onunregisternotify":this.onunregisternotify&&this.onunregisternotify();break;case"onnotify":this.onnotify&&this.onnotify(t.data||void 0)}}}t.default=a}).call(this,i(0).Buffer)},function(e,t,i){"use strict";(function(e){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(104));class n extends s.default{constructor(e){super(e)}get parentName(){return"characteristic"}read(){this.characteristic.service.peripheral.obnizBle.centralBindings.readValue(this.characteristic.service.peripheral.address,this.characteristic.service.uuid,this.characteristic.uuid,this.uuid)}readWait(){return super.readWait()}write(t){this.characteristic.service.peripheral.obnizBle.centralBindings.writeValue(this.characteristic.service.peripheral.address,this.characteristic.service.uuid,this.characteristic.uuid,this.uuid,e.from(t))}writeWait(e,t){return super.writeWait(e,t)}}t.default=n}).call(this,i(0).Buffer)},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(14)),n=r(i(17)),a=r(i(6)),o=r(i(18));t.default=class{constructor(e){this.scanTarget={},this.scanSettings={},this.obnizBle=e,this.emitter=new s.default,this.scanedPeripherals=[],this._timeoutTimer=void 0}start(e={},t={}){this.obnizBle.warningIfNotInitialize();const i=void 0===t.duration?30:t.duration;t.duplicate=!!t.duplicate,t.activeScan=!1!==t.activeScan,this.scanSettings=t,this.scanTarget=e,this.scanTarget.uuids&&(this.scanTarget.uuids=this.scanTarget.uuids.map(e=>o.default.uuidFilter(e))),this.scanedPeripherals=[],this._setTargetFilterOnDevice(),this.obnizBle.centralBindings.startScanning(null,!1,t.activeScan),this.clearTimeoutTimer(),null!==i&&(this._timeoutTimer=setTimeout(()=>{this._timeoutTimer=void 0,this.end()},1e3*i))}startOneWait(e,t){let i=0;return new Promise(r=>{this.emitter.once("onfind",e=>{0===i&&(i=1,this.end(),r(e))}),this.emitter.once("onfinish",()=>{0===i&&(i=1,r(null))}),this.start(e,t)})}startAllWait(e,t){return new Promise(i=>{this.emitter.once("onfinish",()=>{i(this.scanedPeripherals)}),this.start(e,t)})}end(){this.clearTimeoutTimer(),this.obnizBle.centralBindings.stopScanning()}notifyFromServer(e,t){switch(e){case"onfind":if(!1===this.scanSettings.duplicate&&this.scanedPeripherals.find(e=>e.address===t.address))break;this.isTarget(t)&&(this.scanedPeripherals.push(t),this.emitter.emit(e,t),this.onfind&&this.onfind(t));break;case"onfinish":this.clearTimeoutTimer(),this.emitter.emit(e,this.scanedPeripherals),this.onfinish&&this.onfinish(this.scanedPeripherals)}}clearAdvertisementFilter(){this.obnizBle.Obniz.send({ble:{hci:{advertisement_filter:[]}}})}_setAdvertisementFilter(e){if(n.default.lt(this.obnizBle.Obniz.firmware_ver,"3.2.0"))return;const t=[];e.forEach(e=>{if(e.localNamePrefix&&(t.push({range:{index:9,length:255},value:[8,...a.default.string2dataArray(e.localNamePrefix)]}),t.push({range:{index:9,length:255},value:[9,...a.default.string2dataArray(e.localNamePrefix)]})),e.deviceAddress&&t.push({range:{index:2,length:6},value:a.default.hexToBinary(e.deviceAddress,!0)}),e.uuid){const i=a.default.hexToBinary(e.uuid,!0);t.push({range:{index:9,length:255},value:i})}e.binary&&t.push({range:{index:0,length:255},value:e.binary})}),this.obnizBle.Obniz.send({ble:{hci:{advertisement_filter:t}}})}_arrayWrapper(e){return Array.isArray(e)?e:[e]}_setTargetFilterOnDevice(){if(n.default.lt(this.obnizBle.Obniz.firmware_ver,"3.2.0"))return;const e=[];this.scanTarget.uuids&&this.scanTarget.uuids.map(t=>{e.push({uuid:o.default.uuidFilter(t)})}),this.scanTarget.localName&&this._arrayWrapper(this.scanTarget.localName).forEach(t=>{e.push({localNamePrefix:t})}),this.scanTarget.deviceAddress&&this._arrayWrapper(this.scanTarget.deviceAddress).forEach(t=>{e.push({deviceAddress:t})}),this.scanTarget.localNamePrefix&&this._arrayWrapper(this.scanTarget.localNamePrefix).forEach(t=>{e.push({localNamePrefix:t})}),this.scanTarget.binary&&(Array.isArray(this.scanTarget.binary[0])?this.scanTarget.binary.forEach(t=>{e.push({binary:t})}):e.push({binary:this.scanTarget.binary})),this._setAdvertisementFilter(e)}isTarget(e){return!!(0===Object.keys(this.scanTarget).length||this.isLocalNamePrefixTarget(e)||this.isLocalNameTarget(e)||this.isUuidTarget(e)||this.isDeviceAddressTarget(e)||this.isBinaryTarget(e))}clearTimeoutTimer(){this._timeoutTimer&&(clearTimeout(this._timeoutTimer),this._timeoutTimer=void 0)}isLocalNameTarget(e){if(this.scanTarget&&this.scanTarget.localName)for(const t of this._arrayWrapper(this.scanTarget.localName))if(t===e.localName)return!0;return!1}isLocalNamePrefixTarget(e){if(this.scanTarget&&this.scanTarget.localNamePrefix)for(const t of this._arrayWrapper(this.scanTarget.localNamePrefix))if(e.localName&&e.localName.startsWith(t))return!0;return!1}isBinaryTarget(e){return!(!this.scanTarget||!this.scanTarget.binary)}isUuidTarget(e){if(this.scanTarget&&this.scanTarget.uuids){const t=e.advertisementServiceUuids().map(e=>o.default.uuidFilter(e));for(const e of this.scanTarget.uuids)if(t.includes(e))return!0}return!1}isDeviceAddressTarget(e){return!(!this.scanTarget||!this.scanTarget.deviceAddress||this.scanTarget.deviceAddress!==e.address)}}},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(14));t.default=class{constructor(e){this.Obniz=e,this.emitter=new s.default}setModeLevel(e,t){throw new Error("setModeLevel is deprecated method")}checkIntroducedFirmware(e,t){throw new Error("checkIntroducedFirmware is deprecated method")}setAuth(e){throw new Error("setAuth is deprecated method")}setIndicateSecurityLevel(e){throw new Error("setIndicateSecurityLevel is deprecated method")}setEnableKeyTypes(e){throw new Error("setEnableKeyTypes is deprecated method")}setKeyMaxSize(e){throw new Error("setKeyMaxSize is deprecated method")}clearBondingDevicesList(){throw new Error("clearBondingDevicesList is deprecated method")}onerror(e){}notifyFromServer(e,t){switch(e){case"onerror":this.onerror(t)}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e,t){this.autoFlush=!0,this.fontSize=16,this._pos={x:0,y:0},this._colorDepthCapabilities=[1],this._colorDepth=1,this._color="#000",this._paper_white=!0,this._raw_alternate=!1,this.Obniz=e,this.width=t.width,this.height=t.height,this._colorDepthCapabilities=t.color_depth,this._paper_white=t.paper_white,this._raw_alternate=t.raw_alternate,this._canvas=void 0,this._reset()}font(e,t){const i=this._ctx();"number"!=typeof t&&(t=16),"string"!=typeof e&&(e="Arial"),this.fontSize=t,i.font="0"+t+"px "+e}setColor(e){this._color=e;const t=this._ctx();t.fillStyle=this._color,t.strokeStyle=this._color}getColor(){return this._color}clear(){const e=this._ctx();if(this._pos.x=0,this._pos.y=0,e){const t=e.fillStyle;e.fillStyle=this._paper_white?"#FFF":"#000",e.fillRect(0,0,this.width,this.height),e.fillStyle=t,this.draw(e)}else{const e={display:{clear:!0}};this.Obniz.send(e)}}pos(e,t){return this._ctx(),"number"==typeof e&&(this._pos.x=e),"number"==typeof t&&(this._pos.y=t),this._pos}print(e){const t=this._ctx();if(t)t.fillText(e,this._pos.x,this._pos.y+this.fontSize),this.draw(t),this._pos.y+=this.fontSize;else{const t={};t.display={text:""+e},this.Obniz.send(t)}}line(e,t,i,r){const s=this._ctx();s?(s.beginPath(),s.moveTo(e,t),s.lineTo(i,r),s.stroke(),this.draw(s)):this.warnCanvasAvailability()}rect(e,t,i,r,s){const n=this._ctx();n?(s?n.fillRect(e,t,i,r):n.strokeRect(e,t,i,r),this.draw(n)):this.warnCanvasAvailability()}circle(e,t,i,r){const s=this._ctx();s?(s.beginPath(),s.arc(e,t,i,0,2*Math.PI),r?s.fill():s.stroke(),this.draw(s)):this.warnCanvasAvailability()}qr(e,t){const i={};i.display={qr:{text:e}},t&&(i.display.qr.correction=t),this.Obniz.send(i)}raw(e){const t={};t.display={raw:e},this._colorDepth>1&&(t.display.color_depth=this._colorDepth),this.Obniz.send(t)}setColorDepth(e){if(!this._colorDepthCapabilities.find(t=>t===e))throw new Error(`This device can't accept depth ${e}. availables are ${JSON.stringify(this._colorDepthCapabilities)}`);this._colorDepth=e}getColorDepth(){return this._colorDepth}setPinName(e,t,i){const r={display:{}};r.display.pin_assign={},r.display.pin_assign[e]={module_name:t,pin_name:i},this.Obniz.send(r)}setPinNames(e,t){const i={display:{}};i.display.pin_assign={};let r=!0;for(const s in t)r=!1,i.display.pin_assign[s]={module_name:e,pin_name:t[s]};r||this.Obniz.send(i)}draw(e){this.autoFlush&&this._draw(e)}drawing(e){this.autoFlush=!!e;const t=this._ctx();t&&this.draw(t)}warnCanvasAvailability(){throw this.Obniz.isNode?new Error("obniz.js require node-canvas to draw rich contents. see more detail on docs"):new Error("obniz.js cant create canvas element to body")}_reset_canvas(){if(this._canvas){const e=this._canvas.getContext("2d");e.fillStyle=this._paper_white?"#FFF":"#000",e.fillRect(0,0,this.width,this.height),e.fillStyle=this._color,e.strokeStyle=this._color,e.font=`${this.fontSize}px Arial`}}_reset(){this.autoFlush=!0,this._pos={x:0,y:0},this._color=this._paper_white?"#000":"#FFF",this.fontSize=this.height>200?32:16,this._colorDepth=this._colorDepthCapabilities[this._colorDepthCapabilities.length-1],this._reset_canvas()}_preparedCanvas(){if(this._canvas)return this._canvas;if(this.Obniz.isNode)try{const{createCanvas:e}=i(38);this._canvas=e(this.width,this.height)}catch(e){return null}else{const e="obnizcanvas-"+this.Obniz.id;let t=document.getElementById(e);if(t)this._canvas=t;else{t=document.createElement("canvas"),t.setAttribute("id",e),t.style.visibility="hidden",t.width=this.width,t.height=this.height,1===this._colorDepthCapabilities.length&&(t.style["-webkit-font-smoothing"]="none"),document.getElementsByTagName("body")[0].appendChild(t),this._canvas=t,this._reset_canvas()}}return this._canvas}_ctx(){const e=this._preparedCanvas();if(e)return e.getContext("2d")}_draw(e){const t=new Array(this.width*this.height*this._colorDepth/8),i=e.getImageData(0,0,this.width,this.height).data;if(16===this._colorDepth)for(let e=0;e<this.width*this.height;e++){const r=(i[4*e]>>3&31)<<11|(i[4*e+1]>>2&63)<<5|(i[4*e+2]>>3&31)<<0;t[2*e]=r>>8&255,t[2*e+1]=255&r}else if(4===this._colorDepth){const e=this.width/2;for(let r=0;r<this.width*this.height;r++){const s=i[4*r],n=i[4*r+1],a=i[4*r+2],o=.34*s+.5*n+.16*a,h=Math.floor(r/this.width),c=Math.floor((r-h*this.width)/2),d=Math.floor(r-h*this.width)%2;let u=0;s>127&&(u|=8),n>127&&(u|=4),a>127&&(u|=2),o>127&&(u|=1),0===d?t[h*e+c]=u<<4:t[h*e+c]|=u}}else{const e=this.width/8;for(let r=0;r<this.width*this.height;r++){const s=.34*i[4*r]+.5*i[4*r+1]+.16*i[4*r+2],n=Math.floor(r/this.width),a=Math.floor((r-n*this.width)/8),o=Math.floor(r-n*this.width)%8;0===o&&(t[n*e+a]=0),s>127&&(t[n*e+a]|=128>>o)}}if(this._raw_alternate)for(let e=0;e<t.length;e++)t[e]=255&~t[e];this.raw(t)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e,t){this.Obniz=e,this._reset()}getWait(){const e=this;return new Promise((t,i)=>{const r={switch:"get"};e.Obniz.send(r),e.addObserver(t)})}stateWait(e){const t=this;return new Promise((i,r)=>{t.onChangeForStateWait=r=>{e===r&&(t.onChangeForStateWait=()=>{},i())}})}notified(e){this.state=e.state,this.onchange&&this.onchange(this.state),this.onChangeForStateWait(this.state);const t=this.observers.shift();t&&t(this.state)}_reset(){this.state="none",this.observers=[],this.onChangeForStateWait=()=>{}}addObserver(e){e&&this.observers.push(e)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e,t){this.Obniz=e,this.id=t,this._reset()}_reset(){this.value=0,this.observers=[]}start(e){this.onchange=e;const t={};return t["ad"+this.id]={stream:!0},this.Obniz.send(t),this.value}getWait(){const e=this;return new Promise((t,i)=>{e.addObserver(t);const r={};r["ad"+e.id]={stream:!1},e.Obniz.send(r)})}end(){this.onchange=void 0;const e={};e["ad"+this.id]=null,this.Obniz.send(e)}notified(e){this.value=e,this.onchange&&this.onchange(e);const t=this.observers.shift();t&&t(e)}addObserver(e){e&&this.observers.push(e)}}},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(17));t.default=class{constructor(e,t){this.Obniz=e,this.observers=[],this._animationIdentifier=0,this._reset()}_reset(){for(let e=0;e<this.observers.length;e++)this.observers[e].reject(new Error("reset called"));this.observers=[],this._animationIdentifier=0}animation(e,t,i,r){if(("number"==typeof r||"registrate"===t)&&s.default.lt(this.Obniz.firmware_ver,"2.0.0"))throw new Error("Please update obniz firmware >= 2.0.0");const n={};n.io={animation:{name:e,status:t}},"number"==typeof r&&(n.io.animation.repeat=r),i||(i=[]);const a=[];for(let e=0;e<i.length;e++){const t=i[e],r=t.duration,s=t.state;this.Obniz.sendPool=[],s(e);const n=this.Obniz.sendPool;this.Obniz.sendPool=null,a.push({duration:r,state:n})}"loop"!==t&&"registrate"!==t||(n.io.animation.states=a),this.Obniz.send(n)}repeatWait(e,t){if(s.default.lt(this.Obniz.firmware_ver,"2.0.0"))throw new Error("Please update obniz firmware >= 2.0.0");if("number"!=typeof t||t<1)throw new Error("please specify repeat count > 0");if(Math.floor(t)!==t)throw new Error("please provide integer number like 1, 2, 3,,,");return new Promise((i,r)=>{const s="_repeatwait"+Date.now()+this._animationIdentifier;++this._animationIdentifier>1e3&&(this._animationIdentifier=0),this.animation(s,"loop",e,t),this.addObserver(s,i,r)})}notified(e){if("finish"===e.animation.status)for(let t=this.observers.length-1;t>=0;t--)e.animation.name===this.observers[t].name&&(this.observers[t].resolve(),this.observers.splice(t,1))}addObserver(e,t,i){e&&t&&i&&this.observers.push({name:e,resolve:t,reject:i})}}},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(6));t.default=class{constructor(e,t){this.Obniz=e,this.id=t,this._reset(),this.onerror=void 0}_reset(){this.observers=[],this.used=!1,this.onwritten=void 0}start(e){const t=s.default._requiredKeys(e,["mode","sda","scl"]);if(t)throw new Error("I2C start param '"+t+"' required, but not found ");this.state=s.default._keyFilter(e,["mode","sda","scl","pull","gnd"]);const i=["sda","scl","gnd"];for(const e of i)if(this.state[e]&&!this.Obniz.isValidIO(this.state[e]))throw new Error("i2c start param '"+e+"' are to be valid io no");const r=this.state.mode,n="number"==typeof e.clock?Math.floor(e.clock):null,a="number"==typeof e.slave_address?Math.floor(e.slave_address):null,o="number"==typeof e.slave_address_length?Math.floor(e.slave_address_length):null;if("master"!==r&&"slave"!==r)throw new Error("i2c: invalid mode "+r);if("master"===r){if(null===n)throw new Error("i2c: please specify clock when master mode");if(n<=0||n>1e6)throw new Error("i2c: invalid clock "+n);if("5v"===e.pull&&n>4e5)throw new Error("i2c: please use under 400khz when internal 5v internal pull-up");if("3v"===e.pull&&n>1e5)throw new Error("i2c: please use under 100khz when internal 3v internal pull-up")}else{if(null===a)throw new Error("i2c: please specify slave_address");if(a<0||a>127)throw new Error("i2c: invalid slave_address");if(a<0||a>127)throw new Error("i2c: invalid slave_address");if(null!==o&&7!==o)throw new Error("i2c: invalid slave_address_length. please specify 7")}if(this.Obniz.getIO(this.state.sda).drive("open-drain"),this.Obniz.getIO(this.state.scl).drive("open-drain"),this.state.pull?(this.Obniz.getIO(this.state.sda).pull(this.state.pull),this.Obniz.getIO(this.state.scl).pull(this.state.pull)):(this.Obniz.getIO(this.state.sda).pull(null),this.Obniz.getIO(this.state.scl).pull(null)),void 0!==this.state.gnd){this.Obniz.getIO(this.state.gnd).output(!1);const e={};e[this.state.gnd]="gnd",this.Obniz.display&&this.Obniz.display.setPinNames("i2c"+this.id,e)}const h=s.default._keyFilter(this.state,["mode","sda","scl"]);"master"===r?h.clock=n:(h.slave_address=a,o&&(h.slave_address_length=o));const c={};c["i2c"+this.id]=h,this.used=!0,this.Obniz.send(c)}write(e,t){if(!this.used)throw new Error(`i2c${this.id} is not started`);if(e=parseInt(e),isNaN(e))throw new Error("i2c: please specify address");if(e<0||e>127)throw new Error("i2c: invalid address");if(!t)throw new Error("i2c: please provide data");if(t.length>1024)throw new Error("i2c: data should be under 1024 bytes");const i={};i["i2c"+this.id]={address:e,data:t},this.Obniz.send(i)}readWait(e,t){if(!this.used)throw new Error(`i2c${this.id} is not started`);if(e=parseInt(e),isNaN(e))throw new Error("i2c: please specify address");if(e<0||e>127)throw new Error("i2c: invalid address");if(t=parseInt(t),isNaN(t)||t<0)throw new Error("i2c: invalid length to read");if(t>1024)throw new Error("i2c: data length should be under 1024 bytes");const i=this;return new Promise((r,s)=>{i.addObserver(r);const n={};n["i2c"+i.id]={address:e,read:t},i.Obniz.send(n)})}notified(e){if(e&&"object"==typeof e){if(e.data)if("slave"===e.mode&&"function"==typeof this.onwritten)this.onwritten(e.data,e.address);else{const t=this.observers.shift();t&&t(e.data)}if(e.warning&&this.Obniz.warning({alert:"warning",message:`i2c${this.id}: ${e.warning.message}`}),e.error){const t=`i2c${this.id}: ${e.error.message}`;"function"==typeof this.onerror?this.onerror(new Error(t)):this.Obniz.error({alert:"error",message:t})}}}isUsed(){return this.used}end(){const e={};e["i2c"+this.id]=null,this.Obniz.send(e),this.used=!1}addObserver(e){e&&this.observers.push(e)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e,t){this.Obniz=e,this.id=t,this._reset()}_reset(){this.value=!1,this.observers=[]}output(e){e=!!e;const t={};t["io"+this.id]=e,this.value=e,this.Obniz.send(t)}drive(e){if("string"!=typeof e)throw new Error("please specify drive methods in string");let t="";switch(e){case"5v":t="push-pull5v";break;case"3v":t="push-pull3v";break;case"open-drain":t="open-drain";break;default:throw new Error("unknown drive method")}const i={};i["io"+this.id]={output_type:t},this.Obniz.send(i)}pull(e){if("string"!=typeof e&&null!==e)throw new Error("please specify pull methods in string");let t="";switch(e){case"5v":t="pull-up5v";break;case"3v":t="pull-up3v";break;case"0v":t="pull-down";break;case null:t="float";break;default:throw new Error("unknown pull_type method")}const i={};i["io"+this.id]={pull_type:t},this.Obniz.send(i)}input(e){this.onchange=e;const t={};return t["io"+this.id]={direction:"input",stream:!0},this.Obniz.send(t),this.value}inputWait(){const e=this;return new Promise((t,i)=>{e.addObserver(t);const r={};r["io"+e.id]={direction:"input",stream:!1},e.Obniz.send(r)})}end(){const e={};e["io"+this.id]=null,this.Obniz.send(e)}notified(e){if("boolean"==typeof e){this.value=e;const t=this.observers.shift();t&&t(e),"function"==typeof this.onchange&&this.onchange(e)}else e&&"object"==typeof e&&(e.warning&&this.Obniz.warning({alert:"warning",message:`io${this.id}: ${e.warning.message}`}),e.error&&this.Obniz.error({alert:"error",message:`io${this.id}: ${e.error.message}`}))}addObserver(e){e&&this.observers.push(e)}}},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(6));t.default=class{constructor(e,t){this.Obniz=e,this.id=t,this._reset()}start(e){const t=s.default._requiredKeys(e,["io"]);if(t)throw new Error("pwm start param '"+t+"' required, but not found ");this.params=s.default._keyFilter(e,["io","drive","pull"]);const i=this.params.io,r=this.Obniz.getIO(i);r.drive(this.params.drive||"5v"),r.pull(this.params.pull||null),this.state={io:i,freq:1e3},this.sendWS({io:i}),this.used=!0}freq(e){if(!this.used)throw new Error(`pwm${this.id} is not started`);if("number"!=typeof(e*=1))throw new Error("please provide freq in number");this.state.freq=e,this.sendWS({freq:e}),"number"==typeof this.state.duty&&this.duty(this.state.duty)}pulse(e){if(!this.used)throw new Error(`pwm${this.id} is not started`);this.state.pulse=e,delete this.state.duty,this.sendWS({pulse:e})}duty(e){if(!this.used)throw new Error(`pwm${this.id} is not started`);if(e*=1,"number"!=typeof this.state.freq||this.state.freq<=0)throw new Error("please provide freq first.");if("number"!=typeof e)throw new Error("please provide duty in number");e<0&&(e=0),e>100&&(e=100);const t=1/this.state.freq*1e3*e*.01;this.state.duty=e,this.sendWS({pulse:t})}isUsed(){return this.used}end(){this.state={},this.sendWS(null),this.used=!1}modulate(e,t,i){if(!this.used)throw new Error(`pwm${this.id} is not started`);this.sendWS({modulate:{type:e,symbol_length:t,data:i}})}_reset(){this.state={},this.used=!1}sendWS(e){const t={};t["pwm"+this.id]=e,this.Obniz.send(t)}}},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(17)),n=r(i(6));t.default=class{constructor(e,t){this.Obniz=e,this.id=t,this._reset()}start(e){const t=n.default._requiredKeys(e,["mode","frequency"]);if(t)throw new Error("spi start param '"+t+"' required, but not found ");this.params=n.default._keyFilter(e,["mode","clk","mosi","miso","frequency","drive","pull","gnd"]);const i={},r=["clk","mosi","miso","gnd"];for(const e of r)if(this.params[e]&&!this.Obniz.isValidIO(this.params[e]))throw new Error("spi start param '"+e+"' are to be valid io no");if(i["spi"+this.id]={mode:this.params.mode,clock:this.params.frequency},void 0!==this.params.clk&&(i["spi"+this.id].clk=this.params.clk),void 0!==this.params.mosi&&(i["spi"+this.id].mosi=this.params.mosi),void 0!==this.params.miso&&(i["spi"+this.id].miso=this.params.miso),this.params.drive?(void 0!==this.params.clk&&this.Obniz.getIO(this.params.clk).drive(this.params.drive),void 0!==this.params.mosi&&this.Obniz.getIO(this.params.mosi).drive(this.params.drive),void 0!==this.params.miso&&this.Obniz.getIO(this.params.miso).drive(this.params.drive)):(void 0!==this.params.clk&&this.Obniz.getIO(this.params.clk).drive("5v"),void 0!==this.params.mosi&&this.Obniz.getIO(this.params.mosi).drive("5v"),void 0!==this.params.miso&&this.Obniz.getIO(this.params.miso).drive("5v")),this.params.pull?(void 0!==this.params.clk&&this.Obniz.getIO(this.params.clk).pull(this.params.pull),void 0!==this.params.mosi&&this.Obniz.getIO(this.params.mosi).pull(this.params.pull),void 0!==this.params.miso&&this.Obniz.getIO(this.params.miso).pull(this.params.pull)):(void 0!==this.params.clk&&this.Obniz.getIO(this.params.clk).pull(null),void 0!==this.params.mosi&&this.Obniz.getIO(this.params.mosi).pull(null),void 0!==this.params.miso&&this.Obniz.getIO(this.params.miso).pull(null)),void 0!==this.params.gnd){this.Obniz.getIO(this.params.gnd).output(!1);const e={};e[this.params.gnd]="gnd",this.Obniz.display&&this.Obniz.display.setPinNames("spi"+this.id,e)}this.used=!0,this.Obniz.send(i)}writeWait(e){if(!this.used)throw new Error(`spi${this.id} is not started`);if(s.default.lte(this.Obniz.firmware_ver,"1.0.2")&&e.length>32)throw new Error(`with your obniz ${this.Obniz.firmware_ver}. spi max length=32byte but yours ${e.length}. Please update obniz firmware`);const t=this;return new Promise((i,r)=>{t.addObserver(i);const s={};s["spi"+t.id]={data:e,read:!0},t.Obniz.send(s)})}write(e){if(!this.used)throw new Error(`spi${this.id} is not started`);if(s.default.lte(this.Obniz.firmware_ver,"1.0.2")&&e.length>32)throw new Error(`with your obniz ${this.Obniz.firmware_ver}. spi max length=32byte but yours ${e.length}. Please update obniz firmware`);const t={};t["spi"+this.id]={data:e,read:!1},this.Obniz.send(t)}notified(e){const t=this.observers.shift();t&&t(e.data)}isUsed(){return this.used}end(e){const t={};t["spi"+this.id]=null,this.params=null,this.Obniz.send(t),e||(this.used=!1)}_reset(){this.observers=[],this.used=!1,this.params=null}addObserver(e){e&&this.observers.push(e)}}},function(e,t,i){"use strict";(function(e){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(6));t.default=class{constructor(e,t){this.Obniz=e,this.id=t,this._reset()}_reset(){this.received=new Uint8Array([]),this.used=!1}start(e){const t=s.default._requiredKeys(e,["tx","rx"]);if(t)throw new Error("uart start param '"+t+"' required, but not found ");this.params=s.default._keyFilter(e,["tx","rx","baud","stop","bits","parity","flowcontrol","rts","cts","drive","pull","gnd"]);const i=["rx","tx","rts","cts","gnd"];for(const e of i)if(this.params[e]&&!this.Obniz.isValidIO(this.params[e]))throw new Error("uart start param '"+e+"' are to be valid io no");if(this.params.hasOwnProperty("drive")?(this.Obniz.getIO(this.params.rx).drive(this.params.drive),this.Obniz.getIO(this.params.tx).drive(this.params.drive)):(this.Obniz.getIO(this.params.rx).drive("5v"),this.Obniz.getIO(this.params.tx).drive("5v")),this.params.hasOwnProperty("pull")?(this.Obniz.getIO(this.params.rx).pull(this.params.pull),this.Obniz.getIO(this.params.tx).pull(this.params.pull)):(this.Obniz.getIO(this.params.rx).pull(null),this.Obniz.getIO(this.params.tx).pull(null)),this.params.hasOwnProperty("gnd")){this.Obniz.getIO(this.params.gnd).output(!1);const e={};e[this.params.gnd]="gnd",this.Obniz.display&&this.Obniz.display.setPinNames("uart"+this.id,e)}const r={},n=s.default._keyFilter(this.params,["tx","rx","baud","stop","bits","parity","flowcontrol","rts","cts"]);r["uart"+this.id]=n,this.Obniz.send(r),this.received=[],this.used=!0}send(t){if(!this.used)throw new Error(`uart${this.id} is not started`);let i=null;if(void 0===t)return;if("number"==typeof t&&(t=[t]),this.Obniz.isNode&&t instanceof e)i=[...t];else if(t.constructor===Array)i=t;else if("string"==typeof t){i=[...e.from(t)]}const r={};r["uart"+this.id]={},r["uart"+this.id].data=i,this.Obniz.send(r)}isDataExists(){return this.received&&this.received.length>0}readBytes(){const e=[];if(this.isDataExists())for(let t=0;t<this.received.length;t++)e.push(this.received[t]);return this.received=[],e}readByte(){const e=[];return this.isDataExists()?e.unshift():null}readText(){let e=null;if(this.isDataExists()){const t=this.readBytes();e=this.tryConvertString(t)}return this.received=[],e}notified(e){if(this.onreceive){const t=this.tryConvertString(e.data);this.onreceive(e.data,t)}else this.received||(this.received=[]),this.received.push.apply(this.received,e.data)}isUsed(){return this.used}end(){const e={};e["uart"+this.id]=null,this.params=null,this.Obniz.send(e),this.used=!1}tryConvertString(e){return s.default.dataArray2string(e)}}}).call(this,i(0).Buffer)},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(6));t.default=class{constructor(e){this.obniz=e,this._reset()}_reset(){this.onmeasured=void 0}start(e){const t=s.default._requiredKeys(e,["io","interval","duration"]);if(t)throw new Error("LogicAnalyzer start param '"+t+"' required, but not found ");this.params=s.default._keyFilter(e,["io","interval","duration","triggerValue","triggerValueSamples"]);const i={};i.logic_analyzer={io:[this.params.io],interval:this.params.interval,duration:this.params.duration},this.params.triggerValueSamples>0&&(i.logic_analyzer.trigger={value:!!this.params.triggerValue,samples:this.params.triggerValueSamples}),this.obniz.send(i)}end(){const e={logic_analyzer:null};this.obniz.send(e)}notified(e){this.onmeasured?this.onmeasured(e.data):(this.measured||(this.measured=[]),this.measured.push(e.data))}}},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(6));t.default=class{constructor(e){this.obniz=e,this._reset()}_reset(){this.observers=[]}echo(e){const t=s.default._requiredKeys(e,["io_pulse","pulse","pulse_width","io_echo","measure_edges"]);if(t)throw new Error("Measure start param '"+t+"' required, but not found ");this.params=s.default._keyFilter(e,["io_pulse","pulse","pulse_width","io_echo","measure_edges","timeout","callback"]);const i={};i.io_pulse=this.params.io_pulse,i.pulse=this.params.pulse,i.pulse_width=this.params.pulse_width,i.io_echo=this.params.io_echo,i.measure_edges=this.params.measure_edges,"number"==typeof this.params.timeout&&(i.timeout=this.params.timeout),this.obniz.send({measure:{echo:i}}),this.params.callback&&this.observers.push(this.params.callback)}notified(e){const t=this.observers.shift();t&&t(e.echo)}}},function(e,t,i){"use strict";(function(e){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(17));t.default=class{constructor(e,t){this.Obniz=e,this.id=t,this._reset()}connectWait(e,t){if(s.default.lt(this.Obniz.firmware_ver,"2.1.0"))throw new Error("Please update obniz firmware >= 2.1.0");if(e<0||e>65535)throw new Error(`tcp${this.id} is invalid port`);if(t.length>30)throw new Error(`tcp${this.id} is domain length over`);return this.connectObservers=[],this.used=!0,new Promise((i,r)=>{this._addConnectObserver(i);const s={};s["tcp"+this.id]={connect:{port:e,domain:t}},this.Obniz.send(s)})}write(t){if(!this.used)throw new Error(`tcp${this.id} is not started`);if(void 0===t)return;"number"==typeof t&&(t=[t]);let i=null;if(this.Obniz.isNode&&t instanceof e)i=[...t];else if(t.constructor===Array)i=t;else if("string"==typeof t){i=[...e.from(t)]}const r={};r["tcp"+this.id]={write:{data:i}},this.Obniz.send(r)}readWait(){if(!this.used)throw new Error(`tcp${this.id} is not started`);return new Promise((e,t)=>{this._addReadObserver(e)})}end(){this.close()}notified(e){if(e.connection)this.onconnection&&this.onconnection(e.connection.connected),e.connection.connected||this._reset();else if(e.read){this.onreceive&&this.onreceive(e.read.data);const t=this.readObservers.shift();t&&t(e.read.data)}else if(e.connect){0!==e.connect.code&&this.onerror&&this.onerror(e.connect);const t=this.connectObservers.shift();t&&t(e.connect.code)}}isUsed(){return this.used}close(){if(!this.used)throw new Error(`tcp${this.id} is not used`);const e={};e["tcp"+this.id]={disconnect:!0},this.Obniz.send(e)}_reset(){this.connectObservers=[],this.readObservers=[],this.used=!1}_addConnectObserver(e){e&&this.connectObservers.push(e)}_addReadObserver(e){e&&this.readObservers.push(e)}}}).call(this,i(0).Buffer)},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(6)),n=r(i(244)),a={};class o extends n.default{static _parts(){return a}static PartsRegistrate(e,t){e&&"function"==typeof e.info&&"string"==typeof e.info().name?a[e.info().name]=e:"string"==typeof e&&"object"==typeof t&&(a[e]=t)}static Parts(e){if(!a[e])throw new Error(`unknown parts [${e}]`);return new a[e]}constructor(e,t){super(e,t)}isValidIO(e){return"number"==typeof e&&null!==this["io"+e]}isValidAD(e){return"number"==typeof e&&null!==this["ad"+e]}wired(e,t){const i=o.Parts(e);if(!i)throw new Error("No such a parts ["+e+"] found");const r=Array.from(arguments);if(r.shift(),r.unshift(this),i.keys){if(i.requiredKeys){const t=s.default._requiredKeys(r[1],i.requiredKeys);if(t)throw new Error(e+" wired param '"+t+"' required, but not found ")}i.params=s.default._keyFilter(r[1],i.keys)}if(i.obniz=this,i.wired.apply(i,r),i.keys||i.ioKeys){const t=i.ioKeys||i.keys,s=i.displayName||e,n={};for(const e in t){let s=t[e];const a=r[1][s];this.isValidIO(a)&&(i.displayIoNames&&i.displayIoNames[s]&&(s=i.displayIoNames[s]),n[a]=s)}const a=this.display;a&&a.setPinNames(s,n)}return i}}t.default=o},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(14)),n=r(i(245)),a=r(i(105)),o=r(i(246));t.default=class{constructor(e,t){if(this.isNode="undefined"==typeof window,this.id=e,this.socket=null,this.socket_local=null,this.debugprint=!1,this.debugprintBinary=!1,this.debugs=[],this.onConnectCalled=!1,this.hw=void 0,this.firmware_ver=void 0,this.connectionState="closed",this.bufferdAmoundWarnBytes=1e7,this.emitter=new s.default,this._connectionRetryCount=0,t||(t={}),this.options={binary:!1!==t.binary,local_connect:!1!==t.local_connect,debug_dom_id:t.debug_dom_id||"obniz-debug",auto_connect:!1!==t.auto_connect,access_token:t.access_token||null,obniz_server:t.obniz_server||"wss://obniz.io",reset_obniz_on_ws_disconnection:!1!==t.reset_obniz_on_ws_disconnection},this.options.binary){this.wscommand=this.constructor.WSCommand;const e=this.constructor.WSCommand.CommandClasses;this.wscommands=[];for(const t in e)this.wscommands.push(new e[t]({hw:{firmware:void 0,model:"obniz_board"},delegate:void 0}))}this.options.auto_connect&&this.wsconnect()}static get version(){return a.default.version}static get WSCommand(){return o.default}connectWait(e){const t=(e=e||{}).timeout||null;return new Promise((e,i)=>{this.onConnectCalled?e(!0):(this.emitter.once("connected",()=>{e(!0)}),this.options.auto_connect||this.emitter.once("closed",()=>{e(!1)}),t&&setTimeout(()=>{e(!1)},1e3*t),this.connect())})}connect(){this.socket&&this.socket.readyState<=1||this.wsconnect()}close(){this._drainQueued(),this._disconnectLocal(),this.socket&&(this.socket.readyState<=1&&(this.connectionState="closing",this.socket.close(1e3,"close")),this.clearSocket(this.socket),delete this.socket),this.connectionState="closed"}send(e,t){try{if(!e||"object"!=typeof e)return void console.log("obnizjs. didnt send ",e);if(Array.isArray(e)){for(let t=0;t<e.length;t++)this.send(e[t]);return}if(this.sendPool)return void this.sendPool.push(e);let i=JSON.stringify([e]);if(this.debugprint&&this.print_debug("send: "+i),this.wscommand&&("object"!=typeof t||!1!==t.local_connect)){let e;try{e=this.wscommand.compress(this.wscommands,JSON.parse(i)[0]),e&&(i=e,this.debugprintBinary&&console.log("Obniz: binalized: "+new Uint8Array(e).toString()))}catch(e){throw this.error("------ errored json -------"),this.error(i),e}}"string"==typeof i?(this._drainQueued(),this._sendRouted(i)):this._sendQueue?this._sendQueue.push(i):(this._sendQueue=[i],this._sendQueueTimer=setTimeout(this._drainQueued.bind(this),0))}catch(e){console.log(e)}}warning(e){console.log("warning:"+e)}error(e){console.error("error:"+e)}prompt(e,t){const i=prompt("Please enter obniz id",e);i&&t(i)}wsOnOpen(){this.print_debug("ws connected"),this._connectionRetryCount=0,"function"==typeof this.onopen&&this.onopen(this)}wsOnMessage(e){let t;if("string"==typeof e?t=JSON.parse(e):this.wscommands&&(this.debugprintBinary&&console.log("Obniz: binalized: "+new Uint8Array(e).toString()),t=this.binary2Json(e)),Array.isArray(t))for(const e in t)this.notifyToModule(t[e])}wsOnClose(e){this.print_debug("closed"),this.close(),this.emitter.emit("closed"),"function"==typeof this.onclose&&!0===this.onConnectCalled&&this.onclose(this),this.onConnectCalled=!1,this._reconnect()}_reconnect(){this._connectionRetryCount++;let e=1e3;if(this._connectionRetryCount>15){e=1e3*(this._connectionRetryCount-15);const t=this.isNode?6e4:1e4;e>t&&(e=t)}this.options.auto_connect&&setTimeout(()=>{this.wsconnect()},e)}wsOnError(e){}wsOnUnexpectedResponse(e,t){t&&404===t.statusCode?this.print_debug("obniz not online"):this.print_debug(t.statusCode),this.clearSocket(this.socket),delete this.socket,this._reconnect()}wsconnect(e){let t=this.options.obniz_server;e&&(t=""+e),this.socket&&this.socket.readyState<=1&&this.close();let i=t+"/obniz/"+this.id+"/ws/1";const r=[];let s;this.constructor.version&&r.push("obnizjs="+this.constructor.version),this.options.access_token&&r.push("access_token="+this.options.access_token),this.wscommand&&r.push("accept_binary=true"),r.length>0&&(i+="?"+r.join("&")),this.print_debug("connecting to "+i),this.isNode?(s=new n.default(i),s.on("open",this.wsOnOpen.bind(this)),s.on("message",this.wsOnMessage.bind(this)),s.on("close",this.wsOnClose.bind(this)),s.on("error",this.wsOnError.bind(this)),s.on("unexpected-response",this.wsOnUnexpectedResponse.bind(this))):(s=new WebSocket(i),s.binaryType="arraybuffer",s.onopen=this.wsOnOpen.bind(this),s.onmessage=e=>{this.wsOnMessage(e.data)},s.onclose=this.wsOnClose.bind(this),s.onerror=this.wsOnError.bind(this)),this.socket=s,this.connectionState="connecting"}_connectLocal(e){const t="ws://"+e;let i;this.print_debug("local connect to "+t),this.isNode?(i=new n.default(t),i.on("open",()=>{this.print_debug("connected to "+t),this._callOnConnect()}),i.on("message",e=>{this.print_debug("recvd via local"),this.wsOnMessage(e)}),i.on("close",e=>{console.log("local websocket closed"),this._disconnectLocal()}),i.on("error",e=>{console.error("local websocket error.",e),this._disconnectLocal()}),i.on("unexpected-response",e=>{console.log("local websocket closed"),this._disconnectLocal()})):(i=new WebSocket(t),i.binaryType="arraybuffer",i.onopen=()=>{this.print_debug("connected to "+t),this._callOnConnect()},i.onmessage=e=>{this.print_debug("recvd via local"),this.wsOnMessage(e.data)},i.onclose=e=>{console.log("local websocket closed"),this._disconnectLocal()},i.onerror=e=>{console.log("local websocket error.",e),this._disconnectLocal()}),this.socket_local=i}_disconnectLocal(){this.socket_local&&(this.socket.readyState<=1&&this.socket_local.close(),this.clearSocket(this.socket_local),delete this.socket_local),this._waitForLocalConnectReadyTimer&&(clearTimeout(this._waitForLocalConnectReadyTimer),this._waitForLocalConnectReadyTimer=null,this._callOnConnect())}clearSocket(e){if(e)if(this._sendQueueTimer&&(delete this._sendQueue,clearTimeout(this._sendQueueTimer),this._sendQueueTimer=null),this.isNode){const t=["open","message","close","error","unexpected-response"];for(let i=0;i<t.length;i++)e.removeAllListeners(t[i])}else e.onopen=null,e.onmessage=null,e.onclose=null,e.onerror=null}_callOnConnect(){let e=!0;if(this._waitForLocalConnectReadyTimer?(clearTimeout(this._waitForLocalConnectReadyTimer),this._waitForLocalConnectReadyTimer=null):this.socket_local&&1===this.socket_local.readyState&&(e=!1),this.emitter.emit("connected"),e){if(this.connectionState="connected","function"==typeof this.onconnect){const e=this.onconnect(this);e instanceof Promise&&e.catch(e=>{console.error(e)})}this.onConnectCalled=!0}}print_debug(e){this.debugprint&&console.log("Obniz: "+e)}_sendRouted(e){return this.socket_local&&1===this.socket_local.readyState&&"string"!=typeof e?(this.print_debug("send via local"),this.socket_local.send(e),void(this.socket_local.bufferedAmount>this.bufferdAmoundWarnBytes&&this.warning("over "+this.socket_local.bufferedAmount+" bytes queued"))):this.socket&&1===this.socket.readyState?(this.socket.send(e),void(this.socket.bufferedAmount>this.bufferdAmoundWarnBytes&&this.warning("over "+this.socket.bufferedAmount+" bytes queued"))):void 0}_drainQueued(){if(!this._sendQueue)return;let e=0;for(let t=0;t<this._sendQueue.length;t++)e+=this._sendQueue[t].length;let t=0;const i=new Uint8Array(e);for(let e=0;e<this._sendQueue.length;e++)i.set(this._sendQueue[e],t),t+=this._sendQueue[e].length;this._sendRouted(i),delete this._sendQueue,clearTimeout(this._sendQueueTimer),this._sendQueueTimer=null}notifyToModule(e){this.debugprint&&this.print_debug(JSON.stringify(e)),e.ws?this.handleWSCommand(e.ws):e.system&&this.handleSystemCommand(e.system)}_canConnectToInsecure(){return!!this.isNode||"https:"!==location.protocol}handleWSCommand(e){if(e.ready){if(this.firmware_ver=e.obniz.firmware,this.hw=e.obniz.hw,this.hw||(this.hw="obnizb1"),this.wscommands)for(let e=0;e<this.wscommands.length;e++){this.wscommands[e].setHw({hw:this.hw,firmware:this.firmware_ver})}this.options.reset_obniz_on_ws_disconnection&&this.resetOnDisconnect(!0),e.local_connect&&e.local_connect.ip&&this.wscommand&&this.options.local_connect&&this._canConnectToInsecure()?(this._connectLocal(e.local_connect.ip),this._waitForLocalConnectReadyTimer=setTimeout(()=>{this._callOnConnect()},3e3)):this._callOnConnect()}if(e.redirect){const t=e.redirect;this.print_debug("WS connection changed to "+t),this.socket.close(1e3,"close"),this.clearSocket(this.socket),delete this.socket,this.wsconnect(t)}}handleSystemCommand(e){}binary2Json(e){let t=new Uint8Array(e);const i=[];for(;null!==t;){const e=o.default.dequeueOne(t);if(!e)break;const r={};for(let t=0;t<this.wscommands.length;t++){const i=this.wscommands[t];if(i.module===e.module){i.notifyFromBinary(r,e.func,e.payload);break}}i.push(r),t=e.next}return i}}},function(e,t,i){"use strict";let r;Object.defineProperty(t,"__esModule",{value:!0}),r="undefined"!=typeof WebSocket?WebSocket:"undefined"!=typeof MozWebSocket?MozWebSocket:window.WebSocket||window.MozWebSocket,t.default=r},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(5)),n=r(i(416)),a=r(i(417)),o=r(i(420)),h=r(i(421)),c=r(i(423)),d=r(i(107)),u=r(i(424)),l=r(i(425)),f=r(i(108)),p=r(i(426)),m=r(i(427)),_=r(i(428)),g=r(i(429)),y=r(i(430));s.default.addCommandClass("WSCommandSystem",_.default),s.default.addCommandClass("WSCommandDirective",o.default),s.default.addCommandClass("WSCommandIO",d.default),s.default.addCommandClass("WSCommandPWM",f.default),s.default.addCommandClass("WSCommandUart",y.default),s.default.addCommandClass("WSCommandAD",n.default),s.default.addCommandClass("WSCommandSPI",p.default),s.default.addCommandClass("WSCommandI2C",c.default),s.default.addCommandClass("WSCommandLogicAnalyzer",u.default),s.default.addCommandClass("WSCommandDisplay",h.default),s.default.addCommandClass("WSCommandSwitch",m.default),s.default.addCommandClass("WSCommandBle",a.default),s.default.addCommandClass("WSCommandMeasurement",l.default),s.default.addCommandClass("WSCommandTcp",g.default),t.default=s.default},function(e,t,i){"use strict";(function(e){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(248);s.defineError("UNIQUE_KEYS",10001,"{uniqueKeys} are must be unique value."),s.defineKeyword("uniqueKeys",(e,t,i)=>{if(!Array.isArray(t))return null;const r=[];for(const i of t)null!==e[i]&&void 0!==e[i]&&r.push(e[i]);return r.filter((e,t,i)=>i.indexOf(e)!==i.lastIndexOf(e)).length>0?{code:s.errorCodes.UNIQUE_KEYS,message:{uniqueKeys:t.join(",")}}:null});const n=[],a=r(i(106));i(36).context=a.default,i(36).context&&i(36).context.setBaseDir&&i(36).context.setBaseDir(e);const o=i(249);for(const e of o.keys()){const t=o(e);n.push(t)}n.map(s.addSchema),t.default=s}).call(this,"/")},function(e,t,i){var r,s,n;s=[],void 0===(n="function"==typeof(r=function(){var e,t,i,r;Object.keys||(Object.keys=(e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),r=(i=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(s){if("object"!=typeof s&&"function"!=typeof s||null===s)throw new TypeError("Object.keys called on non-object");var n=[];for(var a in s)e.call(s,a)&&n.push(a);if(t)for(var o=0;o<r;o++)e.call(s,i[o])&&n.push(i[o]);return n})),Object.create||(Object.create=function(){function e(){}return function(t){if(1!==arguments.length)throw new Error("Object.create implementation only accepts one parameter.");return e.prototype=t,new e}}()),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(null===this)throw new TypeError;var t=Object(this),i=t.length>>>0;if(0===i)return-1;var r=0;if(arguments.length>1&&((r=Number(arguments[1]))!=r?r=0:0!==r&&r!==1/0&&r!==-1/0&&(r=(r>0||-1)*Math.floor(Math.abs(r)))),r>=i)return-1;for(var s=r>=0?r:Math.max(i-Math.abs(r),0);s<i;s++)if(s in t&&t[s]===e)return s;return-1}),Object.isFrozen||(Object.isFrozen=function(e){for(var t="tv4_test_frozen_key";e.hasOwnProperty(t);)t+=Math.random();try{return e[t]=!0,delete e[t],!1}catch(e){return!0}});var s={"+":!0,"#":!0,".":!0,"/":!0,";":!0,"?":!0,"&":!0},n={"*":!0};function a(e){return encodeURI(e).replace(/%25[0-9][0-9]/g,(function(e){return"%"+e.substring(3)}))}function o(e){var t="";s[e.charAt(0)]&&(t=e.charAt(0),e=e.substring(1));var i="",r="",o=!0,h=!1,c=!1;"+"===t?o=!1:"."===t?(r=".",i="."):"/"===t?(r="/",i="/"):"#"===t?(r="#",o=!1):";"===t?(r=";",i=";",h=!0,c=!0):"?"===t?(r="?",i="&",h=!0):"&"===t&&(r="&",i="&",h=!0);for(var d=[],u=e.split(","),l=[],f={},p=0;p<u.length;p++){var m=u[p],_=null;if(-1!==m.indexOf(":")){var g=m.split(":");m=g[0],_=parseInt(g[1],10)}for(var y={};n[m.charAt(m.length-1)];)y[m.charAt(m.length-1)]=!0,m=m.substring(0,m.length-1);var b={truncate:_,name:m,suffices:y};l.push(b),f[m]=b,d.push(m)}var v=function(e){for(var t="",s=0,n=0;n<l.length;n++){var d=l[n],u=e(d.name);if(null==u||Array.isArray(u)&&0===u.length||"object"==typeof u&&0===Object.keys(u).length)s++;else if(t+=n===s?r:i||",",Array.isArray(u)){h&&(t+=d.name+"=");for(var f=0;f<u.length;f++)f>0&&(t+=d.suffices["*"]&&i||",",d.suffices["*"]&&h&&(t+=d.name+"=")),t+=o?encodeURIComponent(u[f]).replace(/!/g,"%21"):a(u[f])}else if("object"==typeof u){h&&!d.suffices["*"]&&(t+=d.name+"=");var p=!0;for(var m in u)p||(t+=d.suffices["*"]&&i||","),p=!1,t+=o?encodeURIComponent(m).replace(/!/g,"%21"):a(m),t+=d.suffices["*"]?"=":",",t+=o?encodeURIComponent(u[m]).replace(/!/g,"%21"):a(u[m])}else h&&(t+=d.name,c&&""===u||(t+="=")),null!=d.truncate&&(u=u.substring(0,d.truncate)),t+=o?encodeURIComponent(u).replace(/!/g,"%21"):a(u)}return t};return v.varNames=d,{prefix:r,substitution:v}}function h(e){if(!(this instanceof h))return new h(e);for(var t=e.split("{"),i=[t.shift()],r=[],s=[],n=[];t.length>0;){var a=t.shift(),c=a.split("}")[0],d=a.substring(c.length+1),u=o(c);s.push(u.substitution),r.push(u.prefix),i.push(d),n=n.concat(u.substitution.varNames)}this.fill=function(e){for(var t=i[0],r=0;r<s.length;r++)t+=(0,s[r])(e),t+=i[r+1];return t},this.varNames=n,this.template=e}h.prototype={toString:function(){return this.template},fillFromObject:function(e){return this.fill((function(t){return e[t]}))}};var c=function(e,t,i,r,s){if(this.missing=[],this.missingMap={},this.formatValidators=e?Object.create(e.formatValidators):{},this.schemas=e?Object.create(e.schemas):{},this.collectMultiple=t,this.errors=[],this.handleError=t?this.collectError:this.returnError,r&&(this.checkRecursive=!0,this.scanned=[],this.scannedFrozen=[],this.scannedFrozenSchemas=[],this.scannedFrozenValidationErrors=[],this.validatedSchemasKey="tv4_validation_id",this.validationErrorsKey="tv4_validation_errors_id"),s&&(this.trackUnknownProperties=!0,this.knownPropertyPaths={},this.unknownPropertyPaths={}),this.errorReporter=i||g("en"),"string"==typeof this.errorReporter)throw new Error("debug");if(this.definedKeywords={},e)for(var n in e.definedKeywords)this.definedKeywords[n]=e.definedKeywords[n].slice(0)};function d(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){if(Array.isArray(e)!==Array.isArray(t))return!1;if(Array.isArray(e)){if(e.length!==t.length)return!1;for(var i=0;i<e.length;i++)if(!d(e[i],t[i]))return!1}else{var r;for(r in e)if(void 0===t[r]&&void 0!==e[r])return!1;for(r in t)if(void 0===e[r]&&void 0!==t[r])return!1;for(r in e)if(!d(e[r],t[r]))return!1}return!0}return!1}c.prototype.defineKeyword=function(e,t){this.definedKeywords[e]=this.definedKeywords[e]||[],this.definedKeywords[e].push(t)},c.prototype.createError=function(e,t,i,r,s,n,a){var o=new S(e,t,i,r,s);return o.message=this.errorReporter(o,n,a),o},c.prototype.returnError=function(e){return e},c.prototype.collectError=function(e){return e&&this.errors.push(e),null},c.prototype.prefixErrors=function(e,t,i){for(var r=e;r<this.errors.length;r++)this.errors[r]=this.errors[r].prefixWith(t,i);return this},c.prototype.banUnknownProperties=function(e,t){for(var i in this.unknownPropertyPaths){var r=this.createError(y.UNKNOWN_PROPERTY,{path:i},i,"",null,e,t),s=this.handleError(r);if(s)return s}return null},c.prototype.addFormat=function(e,t){if("object"==typeof e){for(var i in e)this.addFormat(i,e[i]);return this}this.formatValidators[e]=t},c.prototype.resolveRefs=function(e,t){if(void 0!==e.$ref){if((t=t||{})[e.$ref])return this.createError(y.CIRCULAR_REFERENCE,{urls:Object.keys(t).join(", ")},"","",null,void 0,e);t[e.$ref]=!0,e=this.getSchema(e.$ref,t)}return e},c.prototype.getSchema=function(e,t){var i;if(void 0!==this.schemas[e])return i=this.schemas[e],this.resolveRefs(i,t);var r=e,s="";if(-1!==e.indexOf("#")&&(s=e.substring(e.indexOf("#")+1),r=e.substring(0,e.indexOf("#"))),"object"==typeof this.schemas[r]){i=this.schemas[r];var n=decodeURIComponent(s);if(""===n)return this.resolveRefs(i,t);if("/"!==n.charAt(0))return;for(var a=n.split("/").slice(1),o=0;o<a.length;o++){var h=a[o].replace(/~1/g,"/").replace(/~0/g,"~");if(void 0===i[h]){i=void 0;break}i=i[h]}if(void 0!==i)return this.resolveRefs(i,t)}void 0===this.missing[r]&&(this.missing.push(r),this.missing[r]=r,this.missingMap[r]=r)},c.prototype.searchSchemas=function(e,t){if(Array.isArray(e))for(var i=0;i<e.length;i++)this.searchSchemas(e[i],t);else if(e&&"object"==typeof e)for(var r in"string"==typeof e.id&&function(e,t){if(t.substring(0,e.length)===e){var i=t.substring(e.length);if(t.length>0&&"/"===t.charAt(e.length-1)||"#"===i.charAt(0)||"?"===i.charAt(0))return!0}return!1}(t,e.id)&&void 0===this.schemas[e.id]&&(this.schemas[e.id]=e),e)if("enum"!==r)if("object"==typeof e[r])this.searchSchemas(e[r],t);else if("$ref"===r){var s=m(e[r]);s&&void 0===this.schemas[s]&&void 0===this.missingMap[s]&&(this.missingMap[s]=s)}},c.prototype.addSchema=function(e,t){if("string"!=typeof e||void 0===t){if("object"!=typeof e||"string"!=typeof e.id)return;e=(t=e).id}e===m(e)+"#"&&(e=m(e)),this.schemas[e]=t,delete this.missingMap[e],_(t,e),this.searchSchemas(t,e)},c.prototype.getSchemaMap=function(){var e={};for(var t in this.schemas)e[t]=this.schemas[t];return e},c.prototype.getSchemaUris=function(e){var t=[];for(var i in this.schemas)e&&!e.test(i)||t.push(i);return t},c.prototype.getMissingUris=function(e){var t=[];for(var i in this.missingMap)e&&!e.test(i)||t.push(i);return t},c.prototype.dropSchemas=function(){this.schemas={},this.reset()},c.prototype.reset=function(){this.missing=[],this.missingMap={},this.errors=[]},c.prototype.validateAll=function(e,t,i,r,s){var n;if(!(t=this.resolveRefs(t)))return null;if(t instanceof S)return this.errors.push(t),t;var a,o=this.errors.length,h=null,c=null;if(this.checkRecursive&&e&&"object"==typeof e){if(n=!this.scanned.length,e[this.validatedSchemasKey]){var d=e[this.validatedSchemasKey].indexOf(t);if(-1!==d)return this.errors=this.errors.concat(e[this.validationErrorsKey][d]),null}if(Object.isFrozen(e)&&-1!==(a=this.scannedFrozen.indexOf(e))){var u=this.scannedFrozenSchemas[a].indexOf(t);if(-1!==u)return this.errors=this.errors.concat(this.scannedFrozenValidationErrors[a][u]),null}if(this.scanned.push(e),Object.isFrozen(e))-1===a&&(a=this.scannedFrozen.length,this.scannedFrozen.push(e),this.scannedFrozenSchemas.push([])),h=this.scannedFrozenSchemas[a].length,this.scannedFrozenSchemas[a][h]=t,this.scannedFrozenValidationErrors[a][h]=[];else{if(!e[this.validatedSchemasKey])try{Object.defineProperty(e,this.validatedSchemasKey,{value:[],configurable:!0}),Object.defineProperty(e,this.validationErrorsKey,{value:[],configurable:!0})}catch(t){e[this.validatedSchemasKey]=[],e[this.validationErrorsKey]=[]}c=e[this.validatedSchemasKey].length,e[this.validatedSchemasKey][c]=t,e[this.validationErrorsKey][c]=[]}}var l=this.errors.length,f=this.validateBasic(e,t,s)||this.validateNumeric(e,t,s)||this.validateString(e,t,s)||this.validateArray(e,t,s)||this.validateObject(e,t,s)||this.validateCombinations(e,t,s)||this.validateHypermedia(e,t,s)||this.validateFormat(e,t,s)||this.validateDefinedKeywords(e,t,s)||null;if(n){for(;this.scanned.length;)delete this.scanned.pop()[this.validatedSchemasKey];this.scannedFrozen=[],this.scannedFrozenSchemas=[]}if(f||l!==this.errors.length)for(;i&&i.length||r&&r.length;){var p=i&&i.length?""+i.pop():null,m=r&&r.length?""+r.pop():null;f&&(f=f.prefixWith(p,m)),this.prefixErrors(l,p,m)}return null!==h?this.scannedFrozenValidationErrors[a][h]=this.errors.slice(o):null!==c&&(e[this.validationErrorsKey][c]=this.errors.slice(o)),this.handleError(f)},c.prototype.validateFormat=function(e,t){if("string"!=typeof t.format||!this.formatValidators[t.format])return null;var i=this.formatValidators[t.format].call(null,e,t);return"string"==typeof i||"number"==typeof i?this.createError(y.FORMAT_CUSTOM,{message:i},"","/format",null,e,t):i&&"object"==typeof i?this.createError(y.FORMAT_CUSTOM,{message:i.message||"?"},i.dataPath||"",i.schemaPath||"/format",null,e,t):null},c.prototype.validateDefinedKeywords=function(e,t,i){for(var r in this.definedKeywords)if(void 0!==t[r])for(var s=this.definedKeywords[r],n=0;n<s.length;n++){var a=(0,s[n])(e,t[r],t,i);if("string"==typeof a||"number"==typeof a)return this.createError(y.KEYWORD_CUSTOM,{key:r,message:a},"","",null,e,t).prefixWith(null,r);if(a&&"object"==typeof a){var o=a.code;if("string"==typeof o){if(!y[o])throw new Error("Undefined error code (use defineError): "+o);o=y[o]}else"number"!=typeof o&&(o=y.KEYWORD_CUSTOM);var h="object"==typeof a.message?a.message:{key:r,message:a.message||"?"},c=a.schemaPath||"/"+r.replace(/~/g,"~0").replace(/\//g,"~1");return this.createError(o,h,a.dataPath||null,c,null,e,t)}}return null},c.prototype.validateBasic=function(e,t,i){var r;return(r=this.validateType(e,t,i))?r.prefixWith(null,"type"):(r=this.validateEnum(e,t,i))?r.prefixWith(null,"type"):null},c.prototype.validateType=function(e,t){if(void 0===t.type)return null;var i=typeof e;null===e?i="null":Array.isArray(e)&&(i="array");var r=t.type;Array.isArray(r)||(r=[r]);for(var s=0;s<r.length;s++){var n=r[s];if(n===i||"integer"===n&&"number"===i&&e%1==0)return null}return this.createError(y.INVALID_TYPE,{type:i,expected:r.join("/")},"","",null,e,t)},c.prototype.validateEnum=function(e,t){if(void 0===t.enum)return null;for(var i=0;i<t.enum.length;i++)if(d(e,t.enum[i]))return null;return this.createError(y.ENUM_MISMATCH,{value:"undefined"!=typeof JSON?JSON.stringify(e):e},"","",null,e,t)},c.prototype.validateNumeric=function(e,t,i){return this.validateMultipleOf(e,t,i)||this.validateMinMax(e,t,i)||this.validateNaN(e,t,i)||null};var u=Math.pow(2,-51),l=1-u;function f(e){var t=String(e).replace(/^\s+|\s+$/g,"").match(/^([^:\/?#]+:)?(\/\/(?:[^:@]*(?::[^:@]*)?@)?(([^:\/?#]*)(?::(\d*))?))?([^?#]*)(\?[^#]*)?(#[\s\S]*)?/);return t?{href:t[0]||"",protocol:t[1]||"",authority:t[2]||"",host:t[3]||"",hostname:t[4]||"",port:t[5]||"",pathname:t[6]||"",search:t[7]||"",hash:t[8]||""}:null}function p(e,t){return t=f(t||""),e=f(e||""),t&&e?(t.protocol||e.protocol)+(t.protocol||t.authority?t.authority:e.authority)+(i=t.protocol||t.authority||"/"===t.pathname.charAt(0)?t.pathname:t.pathname?(e.authority&&!e.pathname?"/":"")+e.pathname.slice(0,e.pathname.lastIndexOf("/")+1)+t.pathname:e.pathname,r=[],i.replace(/^(\.\.?(\/|$))+/,"").replace(/\/(\.(\/|$))+/g,"/").replace(/\/\.\.$/,"/../").replace(/\/?[^\/]*/g,(function(e){"/.."===e?r.pop():r.push(e)})),r.join("").replace(/^\//,"/"===i.charAt(0)?"/":""))+(t.protocol||t.authority||t.pathname?t.search:t.search||e.search)+t.hash:null;var i,r}function m(e){return e.split("#")[0]}function _(e,t){if(e&&"object"==typeof e)if(void 0===t?t=e.id:"string"==typeof e.id&&(t=p(t,e.id),e.id=t),Array.isArray(e))for(var i=0;i<e.length;i++)_(e[i],t);else for(var r in"string"==typeof e.$ref&&(e.$ref=p(t,e.$ref)),e)"enum"!==r&&_(e[r],t)}function g(e){var t=E[e=e||"en"];return function(e){var i=t[e.code]||w[e.code];if("string"!=typeof i)return"Unknown error code "+e.code+": "+JSON.stringify(e.messageParams);var r=e.params;return i.replace(/\{([^{}]*)\}/g,(function(e,t){var i=r[t];return"string"==typeof i||"number"==typeof i?i:e}))}}c.prototype.validateMultipleOf=function(e,t){var i=t.multipleOf||t.divisibleBy;if(void 0===i)return null;if("number"==typeof e){var r=e/i%1;if(r>=u&&r<l)return this.createError(y.NUMBER_MULTIPLE_OF,{value:e,multipleOf:i},"","",null,e,t)}return null},c.prototype.validateMinMax=function(e,t){if("number"!=typeof e)return null;if(void 0!==t.minimum){if(e<t.minimum)return this.createError(y.NUMBER_MINIMUM,{value:e,minimum:t.minimum},"","/minimum",null,e,t);if(t.exclusiveMinimum&&e===t.minimum)return this.createError(y.NUMBER_MINIMUM_EXCLUSIVE,{value:e,minimum:t.minimum},"","/exclusiveMinimum",null,e,t)}if(void 0!==t.maximum){if(e>t.maximum)return this.createError(y.NUMBER_MAXIMUM,{value:e,maximum:t.maximum},"","/maximum",null,e,t);if(t.exclusiveMaximum&&e===t.maximum)return this.createError(y.NUMBER_MAXIMUM_EXCLUSIVE,{value:e,maximum:t.maximum},"","/exclusiveMaximum",null,e,t)}return null},c.prototype.validateNaN=function(e,t){return"number"!=typeof e?null:!0===isNaN(e)||e===1/0||e===-1/0?this.createError(y.NUMBER_NOT_A_NUMBER,{value:e},"","/type",null,e,t):null},c.prototype.validateString=function(e,t,i){return this.validateStringLength(e,t,i)||this.validateStringPattern(e,t,i)||null},c.prototype.validateStringLength=function(e,t){return"string"!=typeof e?null:void 0!==t.minLength&&e.length<t.minLength?this.createError(y.STRING_LENGTH_SHORT,{length:e.length,minimum:t.minLength},"","/minLength",null,e,t):void 0!==t.maxLength&&e.length>t.maxLength?this.createError(y.STRING_LENGTH_LONG,{length:e.length,maximum:t.maxLength},"","/maxLength",null,e,t):null},c.prototype.validateStringPattern=function(e,t){if("string"!=typeof e||"string"!=typeof t.pattern&&!(t.pattern instanceof RegExp))return null;var i;if(t.pattern instanceof RegExp)i=t.pattern;else{var r,s="",n=t.pattern.match(/^\/(.+)\/([img]*)$/);n?(r=n[1],s=n[2]):r=t.pattern,i=new RegExp(r,s)}return i.test(e)?null:this.createError(y.STRING_PATTERN,{pattern:t.pattern},"","/pattern",null,e,t)},c.prototype.validateArray=function(e,t,i){return Array.isArray(e)&&(this.validateArrayLength(e,t,i)||this.validateArrayUniqueItems(e,t,i)||this.validateArrayItems(e,t,i))||null},c.prototype.validateArrayLength=function(e,t){var i;return void 0!==t.minItems&&e.length<t.minItems&&(i=this.createError(y.ARRAY_LENGTH_SHORT,{length:e.length,minimum:t.minItems},"","/minItems",null,e,t),this.handleError(i))?i:void 0!==t.maxItems&&e.length>t.maxItems&&(i=this.createError(y.ARRAY_LENGTH_LONG,{length:e.length,maximum:t.maxItems},"","/maxItems",null,e,t),this.handleError(i))?i:null},c.prototype.validateArrayUniqueItems=function(e,t){if(t.uniqueItems)for(var i=0;i<e.length;i++)for(var r=i+1;r<e.length;r++)if(d(e[i],e[r])){var s=this.createError(y.ARRAY_UNIQUE,{match1:i,match2:r},"","/uniqueItems",null,e,t);if(this.handleError(s))return s}return null},c.prototype.validateArrayItems=function(e,t,i){if(void 0===t.items)return null;var r,s;if(Array.isArray(t.items)){for(s=0;s<e.length;s++)if(s<t.items.length){if(r=this.validateAll(e[s],t.items[s],[s],["items",s],i+"/"+s))return r}else if(void 0!==t.additionalItems)if("boolean"==typeof t.additionalItems){if(!t.additionalItems&&(r=this.createError(y.ARRAY_ADDITIONAL_ITEMS,{},"/"+s,"/additionalItems",null,e,t),this.handleError(r)))return r}else if(r=this.validateAll(e[s],t.additionalItems,[s],["additionalItems"],i+"/"+s))return r}else for(s=0;s<e.length;s++)if(r=this.validateAll(e[s],t.items,[s],["items"],i+"/"+s))return r;return null},c.prototype.validateObject=function(e,t,i){return"object"!=typeof e||null===e||Array.isArray(e)?null:this.validateObjectMinMaxProperties(e,t,i)||this.validateObjectRequiredProperties(e,t,i)||this.validateObjectProperties(e,t,i)||this.validateObjectDependencies(e,t,i)||null},c.prototype.validateObjectMinMaxProperties=function(e,t){var i,r=Object.keys(e);return void 0!==t.minProperties&&r.length<t.minProperties&&(i=this.createError(y.OBJECT_PROPERTIES_MINIMUM,{propertyCount:r.length,minimum:t.minProperties},"","/minProperties",null,e,t),this.handleError(i))?i:void 0!==t.maxProperties&&r.length>t.maxProperties&&(i=this.createError(y.OBJECT_PROPERTIES_MAXIMUM,{propertyCount:r.length,maximum:t.maxProperties},"","/maxProperties",null,e,t),this.handleError(i))?i:null},c.prototype.validateObjectRequiredProperties=function(e,t){if(void 0!==t.required)for(var i=0;i<t.required.length;i++){var r=t.required[i];if(void 0===e[r]){var s=this.createError(y.OBJECT_REQUIRED,{key:r},"","/required/"+i,null,e,t);if(this.handleError(s))return s}}return null},c.prototype.validateObjectProperties=function(e,t,i){var r;for(var s in e){var n=i+"/"+s.replace(/~/g,"~0").replace(/\//g,"~1"),a=!1;if(void 0!==t.properties&&void 0!==t.properties[s]&&(a=!0,r=this.validateAll(e[s],t.properties[s],[s],["properties",s],n)))return r;if(void 0!==t.patternProperties)for(var o in t.patternProperties)if(new RegExp(o).test(s)&&(a=!0,r=this.validateAll(e[s],t.patternProperties[o],[s],["patternProperties",o],n)))return r;if(a)this.trackUnknownProperties&&(this.knownPropertyPaths[n]=!0,delete this.unknownPropertyPaths[n]);else if(void 0!==t.additionalProperties){if(this.trackUnknownProperties&&(this.knownPropertyPaths[n]=!0,delete this.unknownPropertyPaths[n]),"boolean"==typeof t.additionalProperties){if(!t.additionalProperties&&(r=this.createError(y.OBJECT_ADDITIONAL_PROPERTIES,{key:s},"","/additionalProperties",null,e,t).prefixWith(s,null),this.handleError(r)))return r}else if(r=this.validateAll(e[s],t.additionalProperties,[s],["additionalProperties"],n))return r}else this.trackUnknownProperties&&!this.knownPropertyPaths[n]&&(this.unknownPropertyPaths[n]=!0)}return null},c.prototype.validateObjectDependencies=function(e,t,i){var r;if(void 0!==t.dependencies)for(var s in t.dependencies)if(void 0!==e[s]){var n=t.dependencies[s];if("string"==typeof n){if(void 0===e[n]&&(r=this.createError(y.OBJECT_DEPENDENCY_KEY,{key:s,missing:n},"","",null,e,t).prefixWith(null,s).prefixWith(null,"dependencies"),this.handleError(r)))return r}else if(Array.isArray(n))for(var a=0;a<n.length;a++){var o=n[a];if(void 0===e[o]&&(r=this.createError(y.OBJECT_DEPENDENCY_KEY,{key:s,missing:o},"","/"+a,null,e,t).prefixWith(null,s).prefixWith(null,"dependencies"),this.handleError(r)))return r}else if(r=this.validateAll(e,n,[],["dependencies",s],i))return r}return null},c.prototype.validateCombinations=function(e,t,i){return this.validateAllOf(e,t,i)||this.validateAnyOf(e,t,i)||this.validateOneOf(e,t,i)||this.validateNot(e,t,i)||null},c.prototype.validateAllOf=function(e,t,i){if(void 0===t.allOf)return null;for(var r,s=0;s<t.allOf.length;s++){var n=t.allOf[s];if(r=this.validateAll(e,n,[],["allOf",s],i))return r}return null},c.prototype.validateAnyOf=function(e,t,i){if(void 0===t.anyOf)return null;var r,s,n=[],a=this.errors.length;this.trackUnknownProperties&&(r=this.unknownPropertyPaths,s=this.knownPropertyPaths);for(var o=!0,h=0;h<t.anyOf.length;h++){this.trackUnknownProperties&&(this.unknownPropertyPaths={},this.knownPropertyPaths={});var c=t.anyOf[h],d=this.errors.length,u=this.validateAll(e,c,[],["anyOf",h],i);if(null===u&&d===this.errors.length){if(this.errors=this.errors.slice(0,a),this.trackUnknownProperties){for(var l in this.knownPropertyPaths)s[l]=!0,delete r[l];for(var f in this.unknownPropertyPaths)s[f]||(r[f]=!0);o=!1;continue}return null}u&&n.push(u.prefixWith(null,""+h).prefixWith(null,"anyOf"))}return this.trackUnknownProperties&&(this.unknownPropertyPaths=r,this.knownPropertyPaths=s),o?(n=n.concat(this.errors.slice(a)),this.errors=this.errors.slice(0,a),this.createError(y.ANY_OF_MISSING,{},"","/anyOf",n,e,t)):void 0},c.prototype.validateOneOf=function(e,t,i){if(void 0===t.oneOf)return null;var r,s,n=null,a=[],o=this.errors.length;this.trackUnknownProperties&&(r=this.unknownPropertyPaths,s=this.knownPropertyPaths);for(var h=0;h<t.oneOf.length;h++){this.trackUnknownProperties&&(this.unknownPropertyPaths={},this.knownPropertyPaths={});var c=t.oneOf[h],d=this.errors.length,u=this.validateAll(e,c,[],["oneOf",h],i);if(null===u&&d===this.errors.length){if(null!==n)return this.errors=this.errors.slice(0,o),this.createError(y.ONE_OF_MULTIPLE,{index1:n,index2:h},"","/oneOf",null,e,t);if(n=h,this.trackUnknownProperties){for(var l in this.knownPropertyPaths)s[l]=!0,delete r[l];for(var f in this.unknownPropertyPaths)s[f]||(r[f]=!0)}}else u&&a.push(u)}return this.trackUnknownProperties&&(this.unknownPropertyPaths=r,this.knownPropertyPaths=s),null===n?(a=a.concat(this.errors.slice(o)),this.errors=this.errors.slice(0,o),this.createError(y.ONE_OF_MISSING,{},"","/oneOf",a,e,t)):(this.errors=this.errors.slice(0,o),null)},c.prototype.validateNot=function(e,t,i){if(void 0===t.not)return null;var r,s,n=this.errors.length;this.trackUnknownProperties&&(r=this.unknownPropertyPaths,s=this.knownPropertyPaths,this.unknownPropertyPaths={},this.knownPropertyPaths={});var a=this.validateAll(e,t.not,null,null,i),o=this.errors.slice(n);return this.errors=this.errors.slice(0,n),this.trackUnknownProperties&&(this.unknownPropertyPaths=r,this.knownPropertyPaths=s),null===a&&0===o.length?this.createError(y.NOT_PASSED,{},"","/not",null,e,t):null},c.prototype.validateHypermedia=function(e,t,i){if(!t.links)return null;for(var r,s=0;s<t.links.length;s++){var n=t.links[s];if("describedby"===n.rel){for(var a=new h(n.href),o=!0,c=0;c<a.varNames.length;c++)if(!(a.varNames[c]in e)){o=!1;break}if(o){var d={$ref:a.fillFromObject(e)};if(r=this.validateAll(e,d,[],["links",s],i))return r}}}};var y={INVALID_TYPE:0,ENUM_MISMATCH:1,ANY_OF_MISSING:10,ONE_OF_MISSING:11,ONE_OF_MULTIPLE:12,NOT_PASSED:13,NUMBER_MULTIPLE_OF:100,NUMBER_MINIMUM:101,NUMBER_MINIMUM_EXCLUSIVE:102,NUMBER_MAXIMUM:103,NUMBER_MAXIMUM_EXCLUSIVE:104,NUMBER_NOT_A_NUMBER:105,STRING_LENGTH_SHORT:200,STRING_LENGTH_LONG:201,STRING_PATTERN:202,OBJECT_PROPERTIES_MINIMUM:300,OBJECT_PROPERTIES_MAXIMUM:301,OBJECT_REQUIRED:302,OBJECT_ADDITIONAL_PROPERTIES:303,OBJECT_DEPENDENCY_KEY:304,ARRAY_LENGTH_SHORT:400,ARRAY_LENGTH_LONG:401,ARRAY_UNIQUE:402,ARRAY_ADDITIONAL_ITEMS:403,FORMAT_CUSTOM:500,KEYWORD_CUSTOM:501,CIRCULAR_REFERENCE:600,UNKNOWN_PROPERTY:1e3},b={};for(var v in y)b[y[v]]=v;var w={INVALID_TYPE:"Invalid type: {type} (expected {expected})",ENUM_MISMATCH:"No enum match for: {value}",ANY_OF_MISSING:'Data does not match any schemas from "anyOf"',ONE_OF_MISSING:'Data does not match any schemas from "oneOf"',ONE_OF_MULTIPLE:'Data is valid against more than one schema from "oneOf": indices {index1} and {index2}',NOT_PASSED:'Data matches schema from "not"',NUMBER_MULTIPLE_OF:"Value {value} is not a multiple of {multipleOf}",NUMBER_MINIMUM:"Value {value} is less than minimum {minimum}",NUMBER_MINIMUM_EXCLUSIVE:"Value {value} is equal to exclusive minimum {minimum}",NUMBER_MAXIMUM:"Value {value} is greater than maximum {maximum}",NUMBER_MAXIMUM_EXCLUSIVE:"Value {value} is equal to exclusive maximum {maximum}",NUMBER_NOT_A_NUMBER:"Value {value} is not a valid number",STRING_LENGTH_SHORT:"String is too short ({length} chars), minimum {minimum}",STRING_LENGTH_LONG:"String is too long ({length} chars), maximum {maximum}",STRING_PATTERN:"String does not match pattern: {pattern}",OBJECT_PROPERTIES_MINIMUM:"Too few properties defined ({propertyCount}), minimum {minimum}",OBJECT_PROPERTIES_MAXIMUM:"Too many properties defined ({propertyCount}), maximum {maximum}",OBJECT_REQUIRED:"Missing required property: {key}",OBJECT_ADDITIONAL_PROPERTIES:"Additional properties not allowed",OBJECT_DEPENDENCY_KEY:"Dependency failed - key must exist: {missing} (due to key: {key})",ARRAY_LENGTH_SHORT:"Array is too short ({length}), minimum {minimum}",ARRAY_LENGTH_LONG:"Array is too long ({length}), maximum {maximum}",ARRAY_UNIQUE:"Array items are not unique (indices {match1} and {match2})",ARRAY_ADDITIONAL_ITEMS:"Additional items not allowed",FORMAT_CUSTOM:"Format validation failed ({message})",KEYWORD_CUSTOM:"Keyword failed: {key} ({message})",CIRCULAR_REFERENCE:"Circular $refs: {urls}",UNKNOWN_PROPERTY:"Unknown property (not in schema)"};function S(e,t,i,r,s){if(Error.call(this),void 0===e)throw new Error("No error code supplied: "+r);this.message="",this.params=t,this.code=e,this.dataPath=i||"",this.schemaPath=r||"",this.subErrors=s||null;var n=new Error(this.message);if(this.stack=n.stack||n.stacktrace,!this.stack)try{throw n}catch(n){this.stack=n.stack||n.stacktrace}}S.prototype=Object.create(Error.prototype),S.prototype.constructor=S,S.prototype.name="ValidationError",S.prototype.prefixWith=function(e,t){if(null!==e&&(e=e.replace(/~/g,"~0").replace(/\//g,"~1"),this.dataPath="/"+e+this.dataPath),null!==t&&(t=t.replace(/~/g,"~0").replace(/\//g,"~1"),this.schemaPath="/"+t+this.schemaPath),null!==this.subErrors)for(var i=0;i<this.subErrors.length;i++)this.subErrors[i].prefixWith(e,t);return this};var E={},C=function e(t){var i,r,s=new c,n={setErrorReporter:function(e){return"string"==typeof e?this.language(e):(r=e,!0)},addFormat:function(){s.addFormat.apply(s,arguments)},language:function(e){return e?(E[e]||(e=e.split("-")[0]),!!E[e]&&(i=e,e)):i},addLanguage:function(e,t){var i;for(i in y)t[i]&&!t[y[i]]&&(t[y[i]]=t[i]);var r=e.split("-")[0];if(E[r])for(i in E[e]=Object.create(E[r]),t)void 0===E[r][i]&&(E[r][i]=t[i]),E[e][i]=t[i];else E[e]=t,E[r]=t;return this},freshApi:function(t){var i=e();return t&&i.language(t),i},validate:function(e,t,n,a){var o=g(i),h=new c(s,!1,r?function(e,t,i){return r(e,t,i)||o(e,t,i)}:o,n,a);"string"==typeof t&&(t={$ref:t}),h.addSchema("",t);var d=h.validateAll(e,t,null,null,"");return!d&&a&&(d=h.banUnknownProperties(e,t)),this.error=d,this.missing=h.missing,this.valid=null===d,this.valid},validateResult:function(){var e={toString:function(){return this.valid?"valid":this.error.message}};return this.validate.apply(e,arguments),e},validateMultiple:function(e,t,n,a){var o=g(i),h=new c(s,!0,r?function(e,t,i){return r(e,t,i)||o(e,t,i)}:o,n,a);"string"==typeof t&&(t={$ref:t}),h.addSchema("",t),h.validateAll(e,t,null,null,""),a&&h.banUnknownProperties(e,t);var d={toString:function(){return this.valid?"valid":this.error.message}};return d.errors=h.errors,d.missing=h.missing,d.valid=0===d.errors.length,d},addSchema:function(){return s.addSchema.apply(s,arguments)},getSchema:function(){return s.getSchema.apply(s,arguments)},getSchemaMap:function(){return s.getSchemaMap.apply(s,arguments)},getSchemaUris:function(){return s.getSchemaUris.apply(s,arguments)},getMissingUris:function(){return s.getMissingUris.apply(s,arguments)},dropSchemas:function(){s.dropSchemas.apply(s,arguments)},defineKeyword:function(){s.defineKeyword.apply(s,arguments)},defineError:function(e,t,i){if("string"!=typeof e||!/^[A-Z]+(_[A-Z]+)*$/.test(e))throw new Error("Code name must be a string in UPPER_CASE_WITH_UNDERSCORES");if("number"!=typeof t||t%1!=0||t<1e4)throw new Error("Code number must be an integer > 10000");if(void 0!==y[e])throw new Error("Error already defined: "+e+" as "+y[e]);if(void 0!==b[t])throw new Error("Error code already used: "+b[t]+" as "+t);for(var r in y[e]=t,b[t]=e,w[e]=w[t]=i,E){var s=E[r];s[e]&&(s[t]=s[t]||s[e])}},reset:function(){s.reset(),this.error=null,this.missing=[],this.valid=!0},missing:[],error:null,valid:!0,normSchema:_,resolveUrl:p,getDocumentUri:m,errorCodes:y};return n.language(t||"en"),n}();return C.addLanguage("en-gb",w),C.tv4=C,C})?r.apply(t,s):r)||(e.exports=n)},function(e,t,i){var r={"./index.yml":250,"./request/ad/deinit.yml":251,"./request/ad/index.yml":252,"./request/ad/input.yml":253,"./request/ble/central/characteristic_get.yml":254,"./request/ble/central/characteristic_read.yml":255,"./request/ble/central/characteristic_register_notify.yml":256,"./request/ble/central/characteristic_unregister_notify.yml":257,"./request/ble/central/characteristic_write.yml":258,"./request/ble/central/connect.yml":259,"./request/ble/central/descriptor_get.yml":260,"./request/ble/central/descriptor_read.yml":261,"./request/ble/central/descriptor_write.yml":262,"./request/ble/central/disconnect.yml":263,"./request/ble/central/index.yml":264,"./request/ble/central/scan_start.yml":265,"./request/ble/central/scan_stop.yml":266,"./request/ble/central/service_get.yml":267,"./request/ble/hci/advertisement_filter.yml":268,"./request/ble/hci/index.yml":269,"./request/ble/hci/write.yml":270,"./request/ble/index.yml":271,"./request/ble/peripheral/advertisement_start.yml":272,"./request/ble/peripheral/advertisement_stop.yml":273,"./request/ble/peripheral/characteristic_notify.yml":274,"./request/ble/peripheral/characteristic_read.yml":275,"./request/ble/peripheral/characteristic_write.yml":276,"./request/ble/peripheral/descriptor_read.yml":277,"./request/ble/peripheral/descriptor_write.yml":278,"./request/ble/peripheral/index.yml":279,"./request/ble/peripheral/servie_start.yml":280,"./request/ble/peripheral/servie_stop.yml":281,"./request/ble/peripheral/servie_stop_all.yml":282,"./request/ble/security/auth.yml":283,"./request/ble/security/devices_clear.yml":284,"./request/ble/security/index.yml":285,"./request/ble/security/indicate_security_level.yml":286,"./request/ble/security/key_max_size.yml":287,"./request/ble/security/key_type.yml":288,"./request/display/clear.yml":289,"./request/display/index.yml":290,"./request/display/pin_assign.yml":291,"./request/display/qr.yml":292,"./request/display/raw.yml":293,"./request/display/text.yml":294,"./request/i2c/deinit.yml":295,"./request/i2c/index.yml":296,"./request/i2c/init_master.yml":297,"./request/i2c/init_slave.yml":298,"./request/i2c/read.yml":299,"./request/i2c/write.yml":300,"./request/index.yml":301,"./request/io/deinit.yml":302,"./request/io/index.yml":303,"./request/io/input.yml":304,"./request/io/input_detail.yml":305,"./request/io/output.yml":306,"./request/io/output_detail.yml":307,"./request/io/output_type.yml":308,"./request/io/pull_type.yml":309,"./request/ioanimation/changeState.yml":310,"./request/ioanimation/index.yml":311,"./request/ioanimation/init.yml":312,"./request/logicanalyzer/deinit.yml":313,"./request/logicanalyzer/index.yml":314,"./request/logicanalyzer/init.yml":315,"./request/measure/echo.yml":316,"./request/measure/index.yml":317,"./request/message/index.yml":318,"./request/message/send.yml":319,"./request/pwm/deinit.yml":320,"./request/pwm/freq.yml":321,"./request/pwm/index.yml":322,"./request/pwm/init.yml":323,"./request/pwm/modulate.yml":324,"./request/pwm/pulse.yml":325,"./request/spi/deinit.yml":326,"./request/spi/index.yml":327,"./request/spi/init_master.yml":328,"./request/spi/write.yml":329,"./request/switch/get.yml":330,"./request/switch/index.yml":331,"./request/system/index.yml":332,"./request/system/keep_working_at_offline.yml":333,"./request/system/ping.yml":334,"./request/system/reboot.yml":335,"./request/system/reset.yml":336,"./request/system/self_check.yml":337,"./request/system/sleep_io_trigger.yml":338,"./request/system/sleep_minute.yml":339,"./request/system/sleep_seconds.yml":340,"./request/system/wait.yml":341,"./request/tcp/connect.yml":342,"./request/tcp/disconnect.yml":343,"./request/tcp/index.yml":344,"./request/tcp/write.yml":345,"./request/uart/deinit.yml":346,"./request/uart/index.yml":347,"./request/uart/init.yml":348,"./request/uart/send.yml":349,"./request/ws/index.yml":350,"./request/ws/reset_obniz_on_ws_disconnection.yml":351,"./response/ad/get.yml":352,"./response/ad/index.yml":353,"./response/ble/central/characteristic_get.yml":354,"./response/ble/central/characteristic_get_finish.yml":355,"./response/ble/central/characteristic_notify.yml":356,"./response/ble/central/characteristic_read.yml":357,"./response/ble/central/characteristic_register_notify.yml":358,"./response/ble/central/characteristic_unregister_notify.yml":359,"./response/ble/central/characteristic_write.yml":360,"./response/ble/central/descriptor_get.yml":361,"./response/ble/central/descriptor_get_finish.yml":362,"./response/ble/central/descriptor_read.yml":363,"./response/ble/central/descriptor_write.yml":364,"./response/ble/central/error.yml":365,"./response/ble/central/index.yml":366,"./response/ble/central/scan.yml":367,"./response/ble/central/scan_finish.yml":368,"./response/ble/central/service_get.yml":369,"./response/ble/central/service_get_finish.yml":370,"./response/ble/central/status_update.yml":371,"./response/ble/hci/index.yml":372,"./response/ble/hci/read.yml":373,"./response/ble/index.yml":374,"./response/ble/peripheral/characteristic_notify_read.yml":375,"./response/ble/peripheral/characteristic_notify_write.yml":376,"./response/ble/peripheral/characteristic_read.yml":377,"./response/ble/peripheral/characteristic_write.yml":378,"./response/ble/peripheral/descriptor_notify_read.yml":379,"./response/ble/peripheral/descriptor_notify_write.yml":380,"./response/ble/peripheral/descriptor_read.yml":381,"./response/ble/peripheral/descriptor_write.yml":382,"./response/ble/peripheral/index.yml":383,"./response/ble/peripheral/status.yml":384,"./response/debug/error.yml":385,"./response/debug/index.yml":386,"./response/debug/warning.yml":387,"./response/i2c/index.yml":388,"./response/i2c/master.yml":389,"./response/i2c/slave.yml":390,"./response/index.yml":391,"./response/io/get.yml":392,"./response/io/index.yml":393,"./response/ioanimation/index.yml":394,"./response/ioanimation/notify.yml":395,"./response/logicanalyzer/data.yml":396,"./response/logicanalyzer/index.yml":397,"./response/measure/echo.yml":398,"./response/measure/index.yml":399,"./response/message/index.yml":400,"./response/message/receive.yml":401,"./response/spi/index.yml":402,"./response/spi/read.yml":403,"./response/switch/change.yml":404,"./response/switch/index.yml":405,"./response/system/index.yml":406,"./response/system/pong.yml":407,"./response/tcp/index.yml":408,"./response/tcp/read.yml":409,"./response/uart/index.yml":410,"./response/uart/receive.yml":411,"./response/ws/index.yml":412,"./response/ws/obniz.yml":413,"./response/ws/ready.yml":414,"./response/ws/redirect.yml":415};function s(e){var t=n(e);return i(t)}function n(e){if(!i.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}s.keys=function(){return Object.keys(r)},s.resolve=n,e.exports=s,s.id=249},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/",definitions:{pinSetting:{id:"pinSetting",type:"integer",minimum:0,maximum:40,default:null},bleAdvertiseData:{id:"bleAdvertiseData",type:"array",default:null,maxItems:31,items:{type:"integer",minimum:0,maximum:255}},dataArray32:{id:"dataArray32",type:"array",default:null,maxItems:32,items:{type:"integer",minimum:0,maximum:255}},dataArray1024:{id:"dataArray1024",type:"array",default:null,maxItems:1024,items:{type:"integer",minimum:0,maximum:255}},bitArray:{id:"bitArray",type:"array",default:null,items:{type:"integer",minimum:0,maximum:1}},dataArray:{id:"dataArray",type:"array",default:null,items:{type:"integer",minimum:0,maximum:255}},imageDataArray:{id:"imageDataArray",type:"array",minItems:0,items:{type:"integer",minimum:0}},hexString:{id:"hexString",type:"string",default:null,pattern:"^([0-9a-fA-F]+)$"},uuid:{id:"uuid",type:"string",pattern:"^([-0-9a-fA-F]+)$",minLength:4,maxLength:36},uuidOrNull:{id:"uuidOrNull",type:["string","null"],pattern:"^([-0-9a-fA-F]+)$",minLength:4,maxLength:36},deviceAddress:{id:"deviceAddress",type:"string",pattern:"^([0-9a-fA-F]+)$",minLength:12,maxLength:12},obnizId:{id:"obnizId",type:["string","integer"],pattern:"^[0-9]{4}-?[0-9]{4}$",minimum:0,maximum:99999999}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ad/deinit",type:"null"}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ad",basePath:"ad0",anyOf:[{$ref:"/request/ad/get"},{$ref:"/request/ad/deinit"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ad/get",related:"/response/ad/get",desription:"enable & start ad module at io.",type:"object",required:["stream"],properties:{stream:{type:"boolean",default:!1}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/central/characteristic_get",related:"/response/ble/central/characteristic_get",deprecated:"3.0.0",type:"object",required:["get_characteristics"],properties:{get_characteristics:{type:"object",required:["address","service_uuid"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/central/characteristic_read",related:"/response/ble/central/characteristic_read",deprecated:"3.0.0",type:"object",required:["read_characteristic"],properties:{read_characteristic:{type:"object",required:["address","service_uuid","characteristic_uuid"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/central/characteristic_register_notify",related:"/response/ble/central/characteristic_register_notify",deprecated:"3.0.0",type:"object",required:["register_notify_characteristic"],properties:{register_notify_characteristic:{type:"object",required:["address","service_uuid","characteristic_uuid"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/central/characteristic_unregister_notify",related:"/response/ble/central/characteristic_unregister_notify",deprecated:"3.0.0",type:"object",required:["unregister_notify_characteristic"],properties:{unregister_notify_characteristic:{type:"object",required:["address","service_uuid","characteristic_uuid"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/central/characteristic_write",related:"/response/ble/central/characteristic_write",deprecated:"3.0.0",type:"object",required:["write_characteristic"],properties:{write_characteristic:{type:"object",required:["address","service_uuid","characteristic_uuid","data"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},data:{$ref:"/dataArray"},needResponse:{type:"boolean",default:!0}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/central/connect",related:"/response/ble/central/status_update",deprecated:"3.0.0",type:"object",required:["connect"],properties:{connect:{type:"object",required:["address"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/central/descriptor_get",related:"/response/ble/central/descriptor_get",deprecated:"3.0.0",type:"object",required:["get_descriptors"],properties:{get_descriptors:{type:"object",required:["address","service_uuid","characteristic_uuid"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/central/descriptor_read",related:"/response/ble/central/descriptor_read",deprecated:"3.0.0",type:"object",required:["read_descriptor"],properties:{read_descriptor:{type:"object",required:["address","service_uuid","characteristic_uuid","descriptor_uuid"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},descriptor_uuid:{$ref:"/uuid"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/central/descriptor_write",related:"/response/ble/central/descriptor_write",deprecated:"3.0.0",type:"object",required:["write_descriptor"],properties:{write_descriptor:{type:"object",required:["address","service_uuid","characteristic_uuid","descriptor_uuid","data"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},descriptor_uuid:{$ref:"/uuid"},data:{$ref:"/dataArray"},needResponse:{type:"boolean",default:!0}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/central/disconnect",deprecated:"3.0.0",type:"object",required:["disconnect"],properties:{disconnect:{type:"object",required:["address"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/central",basePath:"ble",anyOf:[{$ref:"/request/ble/central/scan_start"},{$ref:"/request/ble/central/scan_stop"},{$ref:"/request/ble/central/connect"},{$ref:"/request/ble/central/disconnect"},{$ref:"/request/ble/central/service_get"},{$ref:"/request/ble/central/characteristic_get"},{$ref:"/request/ble/central/characteristic_read"},{$ref:"/request/ble/central/characteristic_write"},{$ref:"/request/ble/central/characteristic_register_notify"},{$ref:"/request/ble/central/characteristic_unregister_notify"},{$ref:"/request/ble/central/descriptor_get"},{$ref:"/request/ble/central/descriptor_read"},{$ref:"/request/ble/central/descriptor_write"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/central/scan_start",related:["/response/ble/central/scan","/response/ble/central/scan_finish"],deprecated:"3.0.0",type:"object",required:["scan"],properties:{scan:{type:"object",additionalProperties:!1,properties:{duration:{type:"integer",default:30}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/central/scan_stop",deprecated:"3.0.0",type:"object",required:["scan"],properties:{scan:{type:"null"}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/central/service_get",related:"/response/ble/central/service_get",deprecated:"3.0.0",type:"object",required:["get_services"],properties:{get_services:{type:"object",required:["address"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/hci/advertisement_filter",type:"object",required:["hci"],properties:{hci:{type:"object",required:["advertisement_filter"],properties:{advertisement_filter:{type:"array",items:{type:"object",required:["range"],properties:{range:{type:"object",required:["index","length"],properties:{index:{type:"integer",minimum:0,maximum:255},length:{type:"integer",minimum:0,maximum:255}}},value:{$ref:"/dataArray"}}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/hci",basePath:"ble",anyOf:[{$ref:"/request/ble/hci/write"},{$ref:"/request/ble/hci/advertisement_filter"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/hci/write",type:"object",required:["hci"],properties:{hci:{type:"object",required:["write"],properties:{write:{$ref:"/dataArray"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble",basePath:"ble",anyOf:[{$ref:"/request/ble/peripheral"},{$ref:"/request/ble/central"},{$ref:"/request/ble/security"},{$ref:"/request/ble/hci"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/peripheral/advertisement_start",related:"/response/ble/peripheral/status",deprecated:"3.0.0",type:"object",required:["advertisement"],properties:{advertisement:{type:"object",required:["adv_data"],additionalProperties:!1,properties:{adv_data:{$ref:"/bleAdvertiseData"},scan_resp:{$ref:"/bleAdvertiseData"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/peripheral/advertisement_stop",deprecated:"3.0.0",type:"object",required:["advertisement"],properties:{advertisement:{type:"null"}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/peripheral/characteristic_notify",deprecated:"3.0.0",type:"object",required:["peripheral"],properties:{peripheral:{type:"object",required:["notify_characteristic"],properties:{notify_characteristic:{type:"object",required:["service_uuid","characteristic_uuid"],additionalProperties:!1,properties:{service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/peripheral/characteristic_read",related:"/response/ble/peripheral/characteristic_read",deprecated:"3.0.0",type:"object",required:["peripheral"],properties:{peripheral:{type:"object",required:["read_characteristic"],properties:{read_characteristic:{type:"object",required:["service_uuid","characteristic_uuid"],additionalProperties:!1,properties:{service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/peripheral/characteristic_write",related:"/response/ble/peripheral/characteristic_write",deprecated:"3.0.0",type:"object",required:["peripheral"],properties:{peripheral:{type:"object",required:["write_characteristic"],properties:{write_characteristic:{type:"object",required:["service_uuid","characteristic_uuid","data"],additionalProperties:!1,properties:{service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},data:{$ref:"/dataArray"}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/peripheral/descriptor_read",related:"/response/ble/peripheral/descriptor_read",deprecated:"3.0.0",type:"object",required:["peripheral"],properties:{peripheral:{type:"object",required:["read_descriptor"],properties:{read_descriptor:{type:"object",required:["service_uuid","characteristic_uuid"],additionalProperties:!1,properties:{service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},descriptor_uuid:{$ref:"/uuid"}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/peripheral/descriptor_write",related:"/response/ble/peripheral/descriptor_write",deprecated:"3.0.0",type:"object",required:["peripheral"],properties:{peripheral:{type:"object",required:["write_descriptor"],properties:{write_descriptor:{type:"object",required:["service_uuid","characteristic_uuid","descriptor_uuid","data"],additionalProperties:!1,properties:{service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},descriptor_uuid:{$ref:"/uuid"},data:{$ref:"/dataArray"}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/peripheral",basePath:"ble",anyOf:[{$ref:"/request/ble/peripheral/advertisement_start"},{$ref:"/request/ble/peripheral/advertisement_stop"},{$ref:"/request/ble/peripheral/service_start"},{$ref:"/request/ble/peripheral/service_stop"},{$ref:"/request/ble/peripheral/service_stop_all"},{$ref:"/request/ble/peripheral/characteristic_read"},{$ref:"/request/ble/peripheral/characteristic_write"},{$ref:"/request/ble/peripheral/descriptor_read"},{$ref:"/request/ble/peripheral/descriptor_write"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/peripheral/service_start",related:["/response/ble/peripheral/status","/response/ble/peripheral/characteristic_notify_read","/response/ble/peripheral/characteristic_notify_write","/response/ble/peripheral/descriptor_notify_read","/response/ble/peripheral/descriptor_notify_write"],deprecated:"3.0.0",type:"object",required:["peripheral"],properties:{peripheral:{type:"object",required:["services"],properties:{services:{type:"array",minItems:1,items:{type:"object",required:["uuid"],additionalProperties:!1,properties:{uuid:{$ref:"/uuid"},characteristics:{type:"array",minItems:0,items:{type:"object",required:["uuid"],additionalProperties:!1,properties:{uuid:{$ref:"/uuid"},data:{$ref:"/dataArray"},properties:{type:"array",default:["read","write"],items:{type:"string",enum:["broadcast","read","write_without_response","write","notify","indicate","auth","extended_properties"]}},permissions:{type:"array",default:["read","write"],items:{default:["read","write"],type:"string",enum:["read","read_encrypted","read_encrypted_mitm","write","write_encrypted","write_encrypted_mitm","write_signed","write_signed_mitm"]}},descriptors:{type:"array",minItems:0,items:{type:"object",required:["uuid"],additionalProperties:!1,properties:{uuid:{$ref:"/uuid"},data:{$ref:"/dataArray"},permissions:{type:"array",default:["read","write"],items:{default:["read","write"],type:"string",enum:["read","read_encrypted","read_encrypted_mitm","write","write_encrypted","write_encrypted_mitm","write_signed","write_signed_mitm"]}}}}}}}}}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/peripheral/service_stop",deprecated:"3.0.0",type:"object",required:["peripheral"],properties:{peripheral:{type:"object",required:["stop_service"],properties:{stop_service:{type:"object",required:["service_uuid"],additionalProperties:!1,properties:{service_uuid:{$ref:"/uuid"}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/peripheral/service_stop_all",deprecated:"3.0.0",type:"object",required:["peripheral"],properties:{peripheral:{type:"null"}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/security/auth",type:"object",required:["security"],properties:{security:{type:"object",required:["auth"],properties:{auth:{type:"array",default:["bonding"],minItems:"1,",items:{type:"string",enum:["bonding","mitm","secure_connection"]}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/security/devices_clear",deprecated:"3.0.0",type:"object",required:["security"],properties:{security:{type:"object",required:["devices"],properties:{devices:{type:"object",required:["clear"],properties:{clear:{type:"boolean",enum:[!0]}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/security",basePath:"ble.security",deprecated:"3.0.0",anyOf:[{$ref:"/request/ble/security/indicate_security_level"},{$ref:"/request/ble/security/auth"},{$ref:"/request/ble/security/key_type"},{$ref:"/request/ble/security/key_max_size"},{$ref:"/request/ble/security/devices_clear"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/security/indicate_security_level",deprecated:"3.0.0",type:"object",required:["security"],properties:{security:{type:"object",required:["indicate_security_level"],properties:{indicate_security_level:{type:"integer",min:0,max:4}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/security/key_max_size",deprecated:"3.0.0",type:"object",required:["security"],properties:{security:{type:"object",required:["key"],properties:{key:{type:"object",required:["max_size"],properties:{max_size:{type:"integer",min:7,max:16}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ble/security/key_type",deprecated:"3.0.0",type:"object",required:["security"],properties:{security:{type:"object",required:["key"],properties:{key:{type:"object",required:["type"],properties:{type:{type:"array",default:["encryption"],items:{type:"string",enum:["ltk","irk","csrk"]}}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/display/clear",type:"object",required:["clear"],properties:{clear:{type:"boolean",enum:[!0]}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/display",basePath:"display",anyOf:[{$ref:"/request/display/text"},{$ref:"/request/display/clear"},{$ref:"/request/display/qr"},{$ref:"/request/display/raw"},{$ref:"/request/display/pin_assign"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/display/pin_assign",type:"object",required:["pin_assign"],properties:{pin_assign:{type:"object",minProperties:1,patternExample:[0,1,2,3],patternProperties:{"^\\d{1,2}$":{type:"object",properties:{module_name:{type:"string"},pin_name:{type:"string"}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/display/qr",type:"object",required:["qr"],properties:{qr:{type:"object",required:["text"],additionalProperties:!1,properties:{text:{type:"string"},correction:{type:"string",enum:["L","M","Q","H"],default:"M"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/display/raw",type:"object",required:["raw"],properties:{raw:{$ref:"/imageDataArray"},color_depth:{type:"integer",enum:[1,4,16],default:1}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/display/text",type:"object",required:["text"],properties:{text:{type:"string"}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/i2c/deinit",type:"null"}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/i2c",basePath:"i2c0",anyOf:[{$ref:"/request/i2c/init_master"},{$ref:"/request/i2c/init_slave"},{$ref:"/request/i2c/write"},{$ref:"/request/i2c/read"},{$ref:"/request/i2c/deinit"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/i2c/init_master",type:"object",required:["mode","sda","scl","clock"],uniqueKeys:["sda","scl"],properties:{mode:{type:"string",enum:["master"]},sda:{$ref:"/pinSetting"},scl:{$ref:"/pinSetting"},clock:{type:"integer",minimum:1,maximum:1e6}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/i2c/init_slave",related:"/response/i2c/slave",type:"object",required:["mode","sda","scl","slave_address"],uniqueKeys:["sda","scl"],properties:{mode:{type:"string",enum:["master","slave"]},sda:{$ref:"/pinSetting"},scl:{$ref:"/pinSetting"},slave_address:{type:"integer",minimum:0,maximum:1023},slave_address_length:{type:"integer",enum:[7],default:7},address:{type:"integer",minimum:0,maximum:1023},address_bits:{type:"integer",enum:[7],default:7},data:{$ref:"/dataArray"},read:{type:"integer",minimum:0}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/i2c/read",related:"/response/i2c/master",type:"object",required:["address","read"],properties:{address:{type:"integer",minimum:0,maximum:1023},address_bits:{type:"integer",enum:[7],default:7},read:{type:"integer",minimum:0,maximum:1024}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/i2c/write",type:"object",required:["address","data"],properties:{address:{type:"integer",minimum:0,maximum:1023},address_bits:{type:"integer",enum:[7],default:7},data:{$ref:"/dataArray1024"}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request",type:"array",minItems:1,items:{type:"object",additionalProperties:!1,patternProperties:{"^io[0-9]$":{$ref:"/request/io"},"^io1[0-1]$":{$ref:"/request/io"},"^ad[0-9]$":{$ref:"/request/ad"},"^ad1[0-1]$":{$ref:"/request/ad"},"^pwm[0-5]$":{$ref:"/request/pwm"},"^uart[0-1]$":{$ref:"/request/uart"},"^spi[0-1]$":{$ref:"/request/spi"},"^i2c[0-1]$":{$ref:"/request/i2c"},"^tcp[0-7]$":{$ref:"/request/tcp"}},properties:{io:{$ref:"/request/ioAnimation"},ble:{$ref:"/request/ble"},switch:{$ref:"/request/switch"},display:{$ref:"/request/display"},measure:{$ref:"/request/measure"},message:{$ref:"/request/message"},logic_analyzer:{$ref:"/request/logicAnalyzer"},system:{$ref:"/request/system"},ws:{$ref:"/request/ws"}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/io/deinit",type:"null"}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/io",basePath:"io0",anyOf:[{$ref:"/request/io/input"},{$ref:"/request/io/input_detail"},{$ref:"/request/io/output"},{$ref:"/request/io/output_detail"},{$ref:"/request/io/output_type"},{$ref:"/request/io/pull_type"},{$ref:"/request/io/deinit"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/io/input",related:"/response/io/get",type:"string",enum:["get"]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/io/input_detail",related:"/response/io/get",type:"object",required:["direction"],properties:{direction:{type:"string",enum:["input"]},stream:{type:"boolean",default:!1}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/io/output",type:"boolean"}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/io/output_detail",type:"object",required:["direction","value"],properties:{direction:{type:"string",enum:["output"]},value:{type:"boolean"}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/io/output_type",type:"object",required:["output_type"],properties:{output_type:{type:"string",enum:["push-pull5v","push-pull3v","open-drain"]}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/io/pull_type",type:"object",required:["pull_type"],properties:{pull_type:{type:"string",enum:["pull-up5v","pull-up3v","pull-down","float"]}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ioAnimation/changeState",type:"object",required:["animation"],properties:{animation:{type:"object",required:["name","status"],additionalProperties:!1,properties:{name:{type:"string",minLength:1,maxLength:254},status:{type:"string",enum:["pause","resume"]}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ioAnimation",basePath:"io",anyOf:[{$ref:"/request/ioAnimation/init"},{$ref:"/request/ioAnimation/changeState"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ioAnimation/init",commandExample:{io:{animation:{name:"animation-1",status:"loop",states:[{duration:500,state:{io0:!0}},{duration:500,state:{io0:!1}}]}}},type:"object",required:["animation"],properties:{animation:{type:"object",required:["name","status","states"],additionalProperties:!1,properties:{name:{type:"string",minLength:1,maxLength:254},repeat:{type:"integer",minLength:1,maxLength:4294967295,default:"undefined"},status:{type:"string",default:"loop",enum:["loop","registrate"]},states:{type:"array",default:[],items:{type:"object",required:["duration","state"],additionalProperties:!1,properties:{duration:{type:"integer",minimum:0,maximum:6e4},state:{type:["object","array"],filter:"pass_all"}}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/logicAnalyzer/deinit",type:"null"}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/logicAnalyzer",basePath:"logic_analyzer",anyOf:[{$ref:"/request/logicAnalyzer/init"},{$ref:"/request/logicAnalyzer/deinit"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/logicAnalyzer/init",exampleDescription:"With below sample code, you will receive only data which start with 'false, false, false' 3bit.",type:"object",required:["io","interval","duration"],properties:{io:{type:"array",minItems:1,maxItems:1,items:{$ref:"/pinSetting"}},interval:{type:"number",minimum:0,exclusiveMinimum:!0},duration:{type:"integer",minimum:0,exclusiveMinimum:!0},trigger:{type:"object",additionalProperties:!1,required:["value","samples"],default:{value:!1,samples:0},properties:{value:{type:"boolean",default:!1},samples:{type:"integer",minimum:0,default:0}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/measure/echo",related:"/response/measure/echo",type:"object",required:["echo"],properties:{echo:{type:"object",required:["io_pulse","io_echo","pulse_width"],properties:{io_pulse:{$ref:"/pinSetting"},io_echo:{$ref:"/pinSetting"},pulse:{type:"string",default:"positive",enum:["positive","negative"]},pulse_width:{type:"number",minimum:.001,maximum:1e3},measure_edges:{type:"integer",minimum:1,maximum:4},timeout:{type:"number",default:1e3,minimum:.001,maximum:1e3}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/measure",basePath:"measure",anyOf:[{$ref:"/request/measure/echo"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/message",basePath:"message",anyOf:[{$ref:"/request/message/send"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/message/send",related:"/response/message/receive",type:"object",additionalProperties:!1,required:["data","to"],properties:{data:{},to:{type:"array",minItems:1,items:{$ref:"/obnizId"}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/pwm/deinit",type:"null"}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/pwm/freq",type:"object",required:["freq"],properties:{freq:{type:"integer",minimum:1,maximum:8e7}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/pwm",basePath:"pwm0",anyOf:[{$ref:"/request/pwm/init"},{$ref:"/request/pwm/freq"},{$ref:"/request/pwm/pulse"},{$ref:"/request/pwm/modulate"},{$ref:"/request/pwm/deinit"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/pwm/init",type:"object",required:["io"],properties:{io:{$ref:"/pinSetting"}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/pwm/modulate",type:"object",required:["modulate"],properties:{modulate:{type:"object",required:["type","symbol_length","data"],additionalProperties:!1,properties:{type:{type:"string",enum:["am"]},symbol_length:{type:"number",minimum:.05,maximum:1e3},data:{$ref:"/bitArray"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/pwm/pulse",type:"object",required:["pulse"],properties:{pulse:{type:"number",minimum:0}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/spi/deinit",type:"null"}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/spi",basePath:"spi0",anyOf:[{$ref:"/request/spi/init_master"},{$ref:"/request/spi/deinit"},{$ref:"/request/spi/write"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/spi/init_master",type:"object",required:["mode","clock"],uniqueKeys:["mosi","miso","clk"],properties:{mode:{type:"string",enum:["master"]},clk:{$ref:"/pinSetting"},mosi:{$ref:"/pinSetting"},miso:{$ref:"/pinSetting"},clock:{type:"integer",default:115200,minimum:1,maximum:26e6,desription:"frequency (Hz)"}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/spi/write",related:"/response/spi/read",type:"object",required:["data","read"],properties:{data:{$ref:"/dataArray1024"},read:{type:"boolean",default:!0}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/switch/get",related:"/response/switch/change",type:"string",enum:["get"]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/switch",basePath:"switch",anyOf:[{$ref:"/request/switch/get"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/system",basePath:"system",anyOf:[{$ref:"/request/system/wait"},{$ref:"/request/system/reset"},{$ref:"/request/system/reboot"},{$ref:"/request/system/selfCheck"},{$ref:"/request/system/keepWorkingAtOffline"},{$ref:"/request/system/ping"},{$ref:"/request/system/sleepSeconds"},{$ref:"/request/system/sleepMinute"},{$ref:"/request/system/sleepIoTrigger"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/system/keepWorkingAtOffline",type:"object",required:["keep_working_at_offline"],properties:{keep_working_at_offline:{type:"boolean"}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/system/ping",response:"/response/system/pong",type:"object",required:["ping"],properties:{ping:{type:"object",required:["key"],properties:{key:{$ref:"/dataArray"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/system/reboot",type:"object",required:["reboot"],properties:{reboot:{type:"boolean",enum:[!0]}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/system/reset",type:"object",required:["reset"],properties:{reset:{type:"boolean",enum:[!0]}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/system/selfCheck",type:"object",required:["self_check"],properties:{self_check:{type:"boolean",enum:[!0]}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/system/sleepIoTrigger",type:"object",required:["sleep_io_trigger"],properties:{sleep_io_trigger:{type:"boolean"}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/system/sleepMinute",type:"object",required:["sleep_minute"],properties:{sleep_minute:{type:"integer"}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/system/sleepSeconds",type:"object",required:["sleep_seconds"],properties:{sleep_seconds:{type:"integer"}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/system/wait",type:"object",required:["wait"],properties:{wait:{type:"integer"}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/tcp/connect",type:"object",required:["connect"],properties:{connect:{type:"object",required:["port","domain"],additionalProperties:!1,properties:{port:{type:"integer",minimum:0,maximum:65535},domain:{type:"string",default:"obniz.io",maxLength:30}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/tcp/disconnect",type:"object",required:["disconnect"],properties:{disconnect:{type:"boolean",additionalProperties:!1}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/tcp",basePath:"tcp0",anyOf:[{$ref:"/request/tcp/connect"},{$ref:"/request/tcp/disconnect"},{$ref:"/request/tcp/write"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/tcp/write",type:"object",required:["write"],properties:{write:{type:"object",required:["data"],additionalProperties:!1,properties:{data:{$ref:"/dataArray"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/uart/deinit",type:"null"}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/uart",basePath:"uart0",anyOf:[{$ref:"/request/uart/init"},{$ref:"/request/uart/send"},{$ref:"/request/uart/deinit"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/uart/init",type:"object",required:["rx","tx"],uniqueKeys:["rx","tx","rts","cts"],properties:{rx:{$ref:"/pinSetting"},tx:{$ref:"/pinSetting"},baud:{type:"integer",default:115200,minimum:1,maximum:5e6},stop:{type:"number",enum:[1,1.5,2],default:1},bits:{type:"integer",enum:[5,6,7,8],default:8},parity:{type:"string",enum:["off","odd","even"],default:"off"},flowcontrol:{type:"string",enum:["off","rts","cts","rts-cts"],default:"off"},rts:{$ref:"/pinSetting"},cts:{$ref:"/pinSetting"}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/uart/send",type:"object",required:["data"],properties:{data:{$ref:"/dataArray"}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ws",basePath:"ws",anyOf:[{$ref:"/request/ws/reset_obniz_on_ws_disconnection"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/request/ws/reset_obniz_on_ws_disconnection",type:"object",required:["reset_obniz_on_ws_disconnection"],properties:{reset_obniz_on_ws_disconnection:{type:"boolean",default:!1}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ad/get",type:"number",minimum:0,maximum:5}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ad",basePath:"ad0",anyOf:[{$ref:"/response/ad/get"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/central/characteristic_get",deprecated:"3.0.0",type:"object",required:["get_characteristic_result"],properties:{get_characteristic_result:{type:"object",required:["address","service_uuid","characteristic_uuid","properties"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},properties:{type:"array",items:{type:"string",enum:["broadcast","read","write_without_response","write","notify","indicate","auth","extended_properties"]}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/central/characteristic_get_finish",deprecated:"3.0.0",type:"object",required:["get_characteristic_result_finish"],properties:{get_characteristic_result_finish:{type:"object",required:["address","service_uuid"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/central/characteristic_notify",deprecated:"3.0.0",type:"object",required:["notify_characteristic"],properties:{notify_characteristic:{type:"object",required:["address","service_uuid","characteristic_uuid","data"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},data:{$ref:"/dataArray"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/central/characteristic_read",deprecated:"3.0.0",type:"object",required:["read_characteristic_result"],properties:{read_characteristic_result:{type:"object",required:["address","service_uuid","characteristic_uuid","result","data"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},result:{type:"string",enum:["success","failed"]},data:{$ref:"/dataArray"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/central/characteristic_register_notify",related:"/request/ble/central/characteristic_register_notify",deprecated:"3.0.0",type:"object",required:["characteristic_register_notify_result"],properties:{characteristic_register_notify_result:{type:"object",required:["address","service_uuid","characteristic_uuid","result"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},result:{type:"boolean"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/central/characteristic_unregister_notify",related:"/request/ble/central/characteristic_unregister_notify",deprecated:"3.0.0",type:"object",required:["unregister_notify_characteristic_result"],properties:{unregister_notify_characteristic_result:{type:"object",required:["address","service_uuid","characteristic_uuid","result"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},result:{type:"boolean"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/central/characteristic_write",deprecated:"3.0.0",type:"object",required:["write_characteristic_result"],properties:{write_characteristic_result:{type:"object",required:["address","service_uuid","characteristic_uuid","result"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},result:{type:"string",enum:["success","failed"]}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/central/descriptor_get",deprecated:"3.0.0",type:"object",required:["get_descriptor_result"],properties:{get_descriptor_result:{type:"object",required:["address","service_uuid","characteristic_uuid","descriptor_uuid"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},descriptor_uuid:{$ref:"/uuid"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/central/descriptor_get_finish",deprecated:"3.0.0",type:"object",required:["get_descriptor_result_finish"],properties:{get_descriptor_result_finish:{type:"object",required:["address","service_uuid","characteristic_uuid"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/central/descriptor_read",deprecated:"3.0.0",type:"object",required:["read_descriptor_result"],properties:{read_descriptor_results:{type:"object",required:["address","service_uuid","characteristic_uuid","descriptor_uuid","result","data"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},descriptor_uuid:{$ref:"/uuid"},result:{type:"string",enum:["success","failed"]},data:{$ref:"/dataArray"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/central/descriptor_write",deprecated:"3.0.0",type:"object",required:["write_descriptor_result"],properties:{write_descriptor_results:{type:"object",required:["address","service_uuid","characteristic_uuid","descriptor_uuid","result"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},descriptor_uuid:{$ref:"/uuid"},result:{type:"string",enum:["success","failed"]}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/central/error",deprecated:"3.0.0",type:"object",required:["error"],properties:{error:{type:"object",required:["error_code","message"],additionalProperties:!1,properties:{error_code:{type:"integer"},module_error_code:{type:"integer"},function_code:{type:"integer"},message:{type:"string"},address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuidOrNull"},characteristic_uuid:{$ref:"/uuidOrNull"},descriptor_uuid:{$ref:"/uuidOrNull"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/central",basePath:"ble",anyOf:[{$ref:"/response/ble/central/scan"},{$ref:"/response/ble/central/scan_finish"},{$ref:"/response/ble/central/status_update"},{$ref:"/response/ble/central/service_get"},{$ref:"/response/ble/central/service_get_finish"},{$ref:"/response/ble/central/characteristic_get"},{$ref:"/response/ble/central/characteristic_get_finish"},{$ref:"/response/ble/central/characteristic_write"},{$ref:"/response/ble/central/characteristic_read"},{$ref:"/response/ble/central/characteristic_register_notify"},{$ref:"/response/ble/central/characteristic_notify"},{$ref:"/response/ble/central/characteristic_notify"},{$ref:"/response/ble/central/descriptor_get"},{$ref:"/response/ble/central/descriptor_get_finish"},{$ref:"/response/ble/central/descriptor_write"},{$ref:"/response/ble/central/descriptor_read"},{$ref:"/response/ble/central/error"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/central/scan",deprecated:"3.0.0",type:"object",required:["scan_result"],properties:{scan_result:{type:"object",required:["address","ble_event_type","device_type","address_type","flag","rssi"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},ble_event_type:{type:"string",enum:["connectable_advertisemnt","connectable_directed_advertisemnt","scannable_advertising","non_connectable_advertising","scan_response"]},device_type:{type:"string",enum:["ble","dumo","breder"]},address_type:{type:"string",enum:["public","random","rpa_public","rpa_random"]},flag:{type:"integer",minimum:0},rssi:{type:"integer",maximum:0},adv_data:{$ref:"/bleAdvertiseData"},scan_resp:{$ref:"/bleAdvertiseData"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/central/scan_finish",deprecated:"3.0.0",type:"object",required:["scan_result_finish"],properties:{scan_result_finish:{type:"boolean",enum:[!0]}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/central/service_get",deprecated:"3.0.0",type:"object",required:["get_service_result"],properties:{get_service_result:{type:"object",required:["address","service_uuid"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/central/service_get_finish",deprecated:"3.0.0",type:"object",required:["get_service_result_finish"],properties:{get_service_result_finish:{type:"object",required:["address"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/central/status_update",deprecated:"3.0.0",type:"object",required:["status_update"],properties:{status_update:{type:"object",required:["address","status"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},status:{type:"string",enum:["connected","disconnected"]}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/hci",basePath:"ble",anyOf:[{$ref:"/response/ble/hci/read"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/hci/read",type:"object",required:["hci"],properties:{hci:{type:"object",required:["read"],properties:{read:{type:"object",required:["data"],properties:{data:{$ref:"/dataArray"}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble",basePath:"ble",anyOf:[{$ref:"/response/ble/central"},{$ref:"/response/ble/peripheral"},{$ref:"/response/ble/hci"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/peripheral/characteristic_notify_read",deprecated:"3.0.0",type:"object",required:["peripheral"],properties:{peripheral:{type:"object",additionalProperties:!1,required:["notify_read_characteristic"],properties:{notify_read_characteristic:{type:"object",required:["address","service_uuid","characteristic_uuid"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/peripheral/characteristic_notify_write",deprecated:"3.0.0",type:"object",required:["peripheral"],properties:{peripheral:{type:"object",additionalProperties:!1,required:["notify_write_characteristic"],properties:{notify_write_characteristic:{type:"object",required:["address","service_uuid","characteristic_uuid","data"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},data:{$ref:"/dataArray"}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/peripheral/characteristic_read",deprecated:"3.0.0",type:"object",required:["peripheral"],properties:{peripheral:{type:"object",additionalProperties:!1,required:["read_characteristic_result"],properties:{read_characteristic_result:{type:"object",required:["service_uuid","characteristic_uuid","data","result"],additionalProperties:!1,properties:{service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},data:{$ref:"/dataArray"},result:{type:"string",enum:["success","failed"]}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/peripheral/characteristic_write",deprecated:"3.0.0",type:"object",required:["peripheral"],properties:{peripheral:{type:"object",additionalProperties:!1,required:["write_characteristic_result"],properties:{write_characteristic_result:{type:"object",required:["service_uuid","characteristic_uuid","result"],additionalProperties:!1,properties:{service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},result:{type:"string",enum:["success","failed"]}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/peripheral/descriptor_notify_read",deprecated:"3.0.0",type:"object",required:["peripheral"],properties:{peripheral:{type:"object",additionalProperties:!1,required:["notify_read_descriptor"],properties:{notify_read_descriptor:{type:"object",required:["address","service_uuid","characteristic_uuid","descriptor_uuid"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},descriptor_uuid:{$ref:"/uuid"}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/peripheral/descriptor_notify_write",deprecated:"3.0.0",type:"object",required:["peripheral"],properties:{peripheral:{type:"object",additionalProperties:!1,required:["notify_write_descriptor"],properties:{notify_write_descriptor:{type:"object",required:["address","service_uuid","characteristic_uuid","descriptor_uuid","data"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},descriptor_uuid:{$ref:"/uuid"},data:{$ref:"/dataArray"}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/peripheral/descriptor_read",deprecated:"3.0.0",type:"object",required:["peripheral"],properties:{peripheral:{type:"object",additionalProperties:!1,required:["read_descriptor_result"],properties:{read_descriptor_result:{type:"object",required:["service_uuid","characteristic_uuid","descriptor_uuid","data","result"],additionalProperties:!1,properties:{service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},descriptor_uuid:{$ref:"/uuid"},data:{$ref:"/dataArray"},result:{type:"string",enum:["success","failed"]}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/peripheral/descriptor_write",deprecated:"3.0.0",type:"object",required:["peripheral"],properties:{peripheral:{type:"object",additionalProperties:!1,required:["write_descriptor_result"],properties:{write_descriptor_result:{type:"object",required:["service_uuid","characteristic_uuid","descriptor_uuid","result"],additionalProperties:!1,properties:{service_uuid:{$ref:"/uuid"},characteristic_uuid:{$ref:"/uuid"},descriptor_uuid:{$ref:"/uuid"},result:{type:"string",enum:["success","failed"]}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/peripheral",basePath:"ble",anyOf:[{$ref:"/response/ble/peripheral/status"},{$ref:"/response/ble/peripheral/characteristic_read"},{$ref:"/response/ble/peripheral/characteristic_write"},{$ref:"/response/ble/peripheral/characteristic_notify_read"},{$ref:"/response/ble/peripheral/characteristic_notify_write"},{$ref:"/response/ble/peripheral/descriptor_read"},{$ref:"/response/ble/peripheral/descriptor_write"},{$ref:"/response/ble/peripheral/descriptor_notify_read"},{$ref:"/response/ble/peripheral/descriptor_notify_write"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ble/peripheral/status",deprecated:"3.0.0",type:"object",required:["peripheral"],properties:{peripheral:{type:"object",additionalProperties:!1,required:["connection_status"],properties:{connection_status:{type:"object",required:["address","status"],additionalProperties:!1,properties:{address:{$ref:"/deviceAddress"},status:{type:"string",enum:["connected","disconnected"]}}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/debug/error",desccription:"global error",type:"object",required:["error"],properties:{error:{type:"object",additionalProperties:!0,properties:{message:{type:"string"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/debug",basePath:"debug",anyOf:[{$ref:"/response/debug/warning"},{$ref:"/response/debug/error"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/debug/warning",desccription:"global warnings",type:"object",required:["warning"],properties:{warning:{type:"object",additionalProperties:!0,properties:{message:{type:"string"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/i2c",basePath:"i2c0",anyOf:[{$ref:"/response/i2c/master"},{$ref:"/response/i2c/slave"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/i2c/master",type:"object",required:["mode","address","data"],properties:{mode:{type:"string",enum:["master"]},address:{type:"integer",minimum:0,maximum:1023},data:{$ref:"/dataArray"}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/i2c/slave",type:"object",required:["mode","address","is_fragmented","data"],properties:{mode:{type:"string",enum:["slave"]},address:{type:"integer",minimum:0,maximum:1023},is_fragmented:{type:"boolean"},data:{$ref:"/dataArray"}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response",type:"array",minItems:1,items:{type:"object",additionalProperties:!1,patternProperties:{"^io[0-9]$":{$ref:"/response/io"},"^io1[0-1]$":{$ref:"/response/io"},"^ad[0-9]$":{$ref:"/response/ad"},"^ad1[0-1]$":{$ref:"/response/ad"},"^uart[0-1]$":{$ref:"/response/uart"},"^spi[0-1]$":{$ref:"/response/spi"},"^i2c[0-1]$":{$ref:"/response/i2c"},"^tcp[0-7]$":{$ref:"/response/tcp"}},properties:{io:{$ref:"/response/ioAnimation"},switch:{$ref:"/response/switch"},ble:{$ref:"/response/ble"},measure:{$ref:"/response/measure"},message:{$ref:"/response/message"},logic_analyzer:{$ref:"/response/logicAnalyzer"},system:{$ref:"/response/system"},debug:{$ref:"/response/debug"},ws:{$ref:"/response/ws"}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/io/get",type:"boolean"}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/io",basePath:"io0",anyOf:[{$ref:"/response/io/get"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ioAnimation",basePath:"io",anyOf:[{$ref:"/response/ioAnimation/notify"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ioAnimation/notify",type:"object",required:["animation"],properties:{animation:{type:"object",required:["name","status"],properties:{name:{type:"string",minLength:1,maxLength:254},status:{type:"string",enum:["finish"]}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/logicAnalyzer/data",type:"object",required:["data"],properties:{data:{$ref:"/bitArray"}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/logicAnalyzer",basePath:"logic_analyzer",anyOf:[{$ref:"/response/logicAnalyzer/data"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/measure/echo",type:"object",required:["echo"],properties:{echo:{type:"array",minItesm:1,items:{type:"object",required:["edge","timing"],properties:{edge:{type:"boolean"},timing:{type:"number"}}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/measure",basePath:"measure",anyOf:[{$ref:"/response/measure/echo"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/message",basePath:"message",anyOf:[{$ref:"/response/message/receive"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/message/receive",related:"/request/message/send",type:"object",required:["data","from"],properties:{data:{},from:{type:["string","null"]}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/spi",basePath:"spi0",anyOf:[{$ref:"/response/spi/read"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/spi/read",type:"object",required:["data"],properties:{data:{$ref:"/dataArray"}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/switch/change",desccription:"value changes are always notified.",type:"object",required:["state"],properties:{state:{type:"string",enum:["none","push","left","right"]},action:{type:"string",enum:["get"]}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/switch",basePath:"switch",anyOf:[{$ref:"/response/switch/change"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/system",basePath:"system",anyOf:[{$ref:"/response/system/pong"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/system/pong",desccription:"pong response with same key of ping request",type:"object",required:["pong"],properties:{pong:{type:"object",required:["key"],properties:{key:{$ref:"/dataArray"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/tcp",basePath:"tcp0",anyOf:[{$ref:"/response/tcp/read"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/tcp/read",desccription:"value changes are always notified.",type:"object",required:["read"],properties:{read:{type:"object",required:["data"],properties:{data:{$ref:"/dataArray"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/uart",basePath:"uart0",anyOf:[{$ref:"/response/uart/receive"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/uart/receive",type:"object",properties:{data:{$ref:"/dataArray"}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ws",basePath:"ws",anyOf:[{$ref:"/response/ws/ready"},{$ref:"/response/ws/obniz"},{$ref:"/response/ws/redirect"}]}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ws/obniz",type:"object",required:["obniz"],properties:{obniz:{type:"object",required:["hw","firmware"],additionalProperties:!1,properties:{hw:{type:"string"},firmware:{type:"string"}}}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ws/ready",type:"object",required:["ready"],properties:{ready:{type:"boolean",enum:[!0]}}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",id:"/response/ws/redirect",type:"object",required:["redirect"],properties:{redirect:{type:"string"}}}},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(5));class n extends s.default{constructor(){super(),this.module=7,this._CommandInitNormalInterval=0,this._CommandDeinit=1,this._CommandNotifyValue=2,this._CommandDoOnece=3}get(e,t){const i=new Uint8Array([t]);this.sendCommand(e.stream?this._CommandInitNormalInterval:this._CommandDoOnece,i)}deinit(e,t){const i=new Uint8Array([t]);this.sendCommand(this._CommandDeinit,i)}parseFromJson(e){for(let t=0;t<40;t++){const i=e["ad"+t];if(void 0===i)continue;const r=[{uri:"/request/ad/deinit",onValid:this.deinit},{uri:"/request/ad/get",onValid:this.get}],s=this.validateCommandSchema(r,i,"ad"+t,t);if(0===s.valid)throw s.invalidButLike.length>0?new Error(s.invalidButLike[0].message):new this.WSCommandNotFoundError(`[ad${t}]unknown command`)}}notifyFromBinary(e,t,i){if(t===this._CommandNotifyValue)for(let t=0;t+2<i.byteLength;t+=3){let r;128&i[t+1]?(r=((3&i[t+1])<<8)+i[t+2],r=5*r/1023,r=Math.round(1e3*r)/1e3):64&i[t+1]?(r=((15&i[t+1])<<8)+i[t+2],r=3.3*r/4095,r=Math.round(1e3*r)/1e3):(r=(i[t+1]<<8)+i[t+2],r/=100),e["ad"+i[t]]=r}else super.notifyFromBinary(e,t,i)}}t.default=n},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(418)),n=r(i(5)),a=r(i(419));class o extends n.default{constructor(){super(),this.module=11,this.uuidLength=18,this._CommandSetAdvData=0,this._CommandSetScanRespData=1,this._CommandStartAdv=2,this._CommandStopAdv=3,this._CommandScan=4,this._CommandStartScan=4,this._CommandStopScan=5,this._CommandScanResults=6,this._CommandConnect=7,this._CommandServices=8,this._CommandCharacteristics=9,this._CommandWriteCharacteristics=10,this._CommandReadCharacteristics=11,this._CommandRegisterNotifyCharacteristic=12,this._CommandUnregisterNotifyCharacteristic=13,this._CommandDescriptors=14,this._CommandWriteDescriptor=15,this._CommandReadDescriptor=16,this._CommandNotifyCharacteristic=17,this._CommandSetDeviceName=19,this._CommandServerStartPeripheral=20,this._CommandServerNotifyConnect=21,this._CommandServerAddService=22,this._CommandServerAddCharacteristic=23,this._CommandServerAddDescriptor=24,this._CommandServerWriteCharavteristicValue=25,this._CommandServerReadCharavteristicValue=26,this._CommandServerNotifyWriteCharavteristicValue=27,this._CommandServerNotifyReadCharavteristicValue=28,this._CommandServerWriteDescriptorValue=29,this._CommandServerReadDescriptorValue=30,this._CommandServerNotifyWriteDescriptorValue=31,this._CommandServerNotifyReadDescriptorValue=32,this._CommandServerNotifyCharavteristic=33,this._CommandServerStartStopService=34,this._CommandSecuritySetAuth=35,this._CommandSecuritySetEncryptionLevel=36,this._CommandSecuritySetEnableKeyTypes=37,this._CommandSecuritySetKeyMaxSize=38,this._CommandSecuritySetIOCapability=39,this._CommandSecurityClearBondingDevices=40,this._CommandScanResultsDevice={breder:1,ble:2,dumo:3},this._CommandScanResultsDeviceAddress={public:0,random:1,rpa_public:2,rpa_random:3},this._CommandScanResultsEvet={inquiry_result:0/*!< Inquiry result for a peer device. */,inquiry_complete:1/*!< Inquiry complete. */,discovery_result:2/*!< Discovery result for a peer device. */,discovery_ble_result:3/*!< Discovery result for BLE GATT based service on a peer device. */,discovery_cmoplete:4/*!< Discovery complete. */,discovery_di_cmoplete:5/*!< Discovery complete. */,cancelled:6/*!< Search cancelled */},this._CommandScanResultsBleEvent={connectable_advertisemnt:0/*!< Connectable undirected advertising (ADV_IND) */,connectable_directed_advertisemnt:1/*!< Connectable directed advertising (ADV_DIRECT_IND) */,scannable_advertising:2/*!< Scannable undirected advertising (ADV_SCAN_IND) */,non_connectable_advertising:3/*!< Non connectable undirected advertising (ADV_NONCONN_IND) */,scan_response:4/*!< Scan Response (SCAN_RSP) */},this._CommandCharacteristicsProperties={broadcast:1,read:2,write_without_response:4,write:8,notify:16,indicate:32,auth:64,extended_properties:128},this._commandResults={success:0,failed:1},this._securityAuthValues={1:"bonding",4:"mitm",8:"secure_connection"},this._securityEncryotionLevels={none:1,encryption:2,mitm:3},this._securityKeyTypes={1:"ltk",2:"irk",4:"csrk"},this.hciCommand=new a.default(this)}centralScanStart(e){const t=s.default.createSendBuffer([{path:"scan.duration",length:4,type:"int",default:30}],e);this.sendCommand(this._CommandStartScan,t)}centralScanStop(e){this.sendCommand(this._CommandStopScan,null)}centralConnect(e){const t=s.default.createSendBuffer([{path:"connect.address",length:6,type:"hex",required:!0,endianness:"little"},{path:null,length:1,type:"char",default:!1}],e);this.sendCommand(this._CommandConnect,t)}centralDisconnect(e){const t=s.default.createSendBuffer([{path:"disconnect.address",length:6,type:"hex",required:!0,endianness:"little"},{path:null,length:1,type:"char",default:!0}],e);this.sendCommand(this._CommandConnect,t)}centralServiceGet(e){const t=s.default.createSendBuffer([{path:"get_services.address",length:6,type:"hex",required:!0,endianness:"little"}],e);this.sendCommand(this._CommandServices,t)}centralCharacteristicGet(e){const t=s.default.createSendBuffer([{path:"get_characteristics.address",length:6,type:"hex",required:!0,endianness:"little"},{path:"get_characteristics.service_uuid",length:18,type:"uuid",required:!0}],e);this.sendCommand(this._CommandCharacteristics,t)}centralCharacteristicRead(e){const t=s.default.createSendBuffer([{path:"read_characteristic.address",length:6,type:"hex",required:!0,endianness:"little"},{path:"read_characteristic.service_uuid",length:18,type:"uuid",required:!0},{path:"read_characteristic.characteristic_uuid",length:18,type:"uuid",required:!0}],e);this.sendCommand(this._CommandReadCharacteristics,t)}centralCharacteristicWrite(e){const t=s.default.createSendBuffer([{path:"write_characteristic.address",length:6,type:"hex",required:!0,endianness:"little"},{path:"write_characteristic.service_uuid",length:18,type:"uuid",required:!0},{path:"write_characteristic.characteristic_uuid",length:18,type:"uuid",required:!0},{path:"write_characteristic.needResponse",length:1,type:"char",default:1},{path:"write_characteristic.data",length:null,type:"dataArray"}],e);this.sendCommand(this._CommandWriteCharacteristics,t)}centralCharacteristicRegisterNotify(e){const t=s.default.createSendBuffer([{path:"register_notify_characteristic.address",length:6,type:"hex",required:!0,endianness:"little"},{path:"register_notify_characteristic.service_uuid",length:18,type:"uuid",required:!0},{path:"register_notify_characteristic.characteristic_uuid",length:18,type:"uuid",required:!0}],e);this.sendCommand(this._CommandRegisterNotifyCharacteristic,t)}centralCharacteristicUnregisterNotify(e){const t=s.default.createSendBuffer([{path:"unregister_notify_characteristic.address",length:6,type:"hex",required:!0,endianness:"little"},{path:"unregister_notify_characteristic.service_uuid",length:18,type:"uuid",required:!0},{path:"unregister_notify_characteristic.characteristic_uuid",length:18,type:"uuid",required:!0}],e);this.sendCommand(this._CommandUnregisterNotifyCharacteristic,t)}centralDescriptorGet(e){const t=s.default.createSendBuffer([{path:"get_descriptors.address",length:6,type:"hex",required:!0,endianness:"little"},{path:"get_descriptors.service_uuid",length:18,type:"uuid",required:!0},{path:"get_descriptors.characteristic_uuid",length:18,type:"uuid",required:!0}],e);this.sendCommand(this._CommandDescriptors,t)}centralDescriptorRead(e){const t=s.default.createSendBuffer([{path:"read_descriptor.address",length:6,type:"hex",required:!0,endianness:"little"},{path:"read_descriptor.service_uuid",length:18,type:"uuid",required:!0},{path:"read_descriptor.characteristic_uuid",length:18,type:"uuid",required:!0},{path:"read_descriptor.descriptor_uuid",length:18,type:"uuid",required:!0}],e);this.sendCommand(this._CommandReadDescriptor,t)}centralDescriptorWrite(e){const t=s.default.createSendBuffer([{path:"write_descriptor.address",length:6,type:"hex",required:!0,endianness:"little"},{path:"write_descriptor.service_uuid",length:18,type:"uuid",required:!0},{path:"write_descriptor.characteristic_uuid",length:18,type:"uuid",required:!0},{path:"write_descriptor.descriptor_uuid",length:18,type:"uuid",required:!0},{path:"write_descriptor.needResponse",length:1,type:"char",default:1},{path:"write_descriptor.data",length:null,type:"dataArray"}],e);this.sendCommand(this._CommandWriteDescriptor,t)}peripheralAdvertisementStart(e){this.sendCommand(this._CommandSetAdvData,new Uint8Array(e.advertisement.adv_data)),e.advertisement.scan_resp&&this.sendCommand(this._CommandSetScanRespData,new Uint8Array(e.advertisement.scan_resp)),this.sendCommand(this._CommandStartAdv,null)}peripheralAdvertisementStop(e){this.sendCommand(this._CommandStopAdv,null)}peripheralServiceStart(e){const t=e.peripheral,i={1:"read",2:"read_encrypted",4:"read_encrypted_mitm",16:"write",32:"write_encrypted",64:"write_encrypted_mitm",128:"write_signed",256:"write_signed_mitm"},r={service:{command:this._CommandServerAddService,schema:[{path:"uuid",length:18,type:"uuid",required:!0}]},characteristic:{command:this._CommandServerAddCharacteristic,schema:[{path:"service_uuid",length:18,type:"uuid",required:!0},{path:"uuid",length:18,type:"uuid",required:!0},{path:"permissions",length:2,type:"flag",default:["write","read"],flags:i},{path:"properties",length:1,type:"flag",default:["write","read"],flags:{1:"broadcast",2:"read",4:"write_without_response",8:"write",16:"notify",32:"indiate",64:"auth",128:"ext_prop"}},{path:"data",type:"dataArray"}]},descriptor:{command:this._CommandServerAddDescriptor,schema:[{path:"service_uuid",length:18,type:"uuid",required:!0},{path:"characteristic_uuid",length:18,type:"uuid",required:!0},{path:"uuid",length:18,type:"uuid",required:!0},{path:"permissions",length:2,type:"flag",default:["write","read"],flags:i},{path:"data",type:"dataArray"}]},startService:{command:this._CommandServerStartStopService,schema:[{path:"uuid",length:18,type:"uuid",required:!0},{path:null,length:1,type:"char",default:0}]}},n=[],a=[];let o;for(const e in t.services){const i=t.services[e];if(o=s.default.createSendBuffer(r.service.schema,i),0===o.length)return;n.push({command:r.service.command,buffer:o}),o=s.default.createSendBuffer(r.startService.schema,i),a.push({command:r.startService.command,buffer:o});for(const e in i.characteristics){const t=i.characteristics[e];if(t.service_uuid=i.uuid,o=s.default.createSendBuffer(r.characteristic.schema,t),0===o.length)return;n.push({command:r.characteristic.command,buffer:o});for(const e in t.descriptors){const a=t.descriptors[e];if(a.service_uuid=i.uuid,a.characteristic_uuid=t.uuid,o=s.default.createSendBuffer(r.descriptor.schema,a),0===o.length)return;n.push({command:r.descriptor.command,buffer:o})}}}for(const e in n)this.sendCommand(n[e].command,n[e].buffer);for(const e in a)this.sendCommand(a[e].command,a[e].buffer)}peripheralServiceStop(e){const t=s.default.createSendBuffer([{path:"peripheral.stop_service.service_uuid",length:18,type:"uuid",required:!0},{path:null,length:1,type:"char",default:1}],e);this.sendCommand(this._CommandServerStartStopService,t)}peripheralServiceStopAll(){this.sendCommand(this._CommandServerStartPeripheral,new Uint8Array([1]))}peripheralCharacteristicRead(e){const t=s.default.createSendBuffer([{path:"peripheral.read_characteristic.service_uuid",length:18,type:"uuid",required:!0},{path:"peripheral.read_characteristic.characteristic_uuid",length:18,type:"uuid",required:!0}],e);this.sendCommand(this._CommandServerReadCharavteristicValue,t)}peripheralCharacteristicWrite(e){const t=s.default.createSendBuffer([{path:"peripheral.write_characteristic.service_uuid",length:18,type:"uuid",required:!0},{path:"peripheral.write_characteristic.characteristic_uuid",length:18,type:"uuid",required:!0},{path:"peripheral.write_characteristic.data",type:"dataArray"}],e);this.sendCommand(this._CommandServerWriteCharavteristicValue,t)}peripheralCharacteristicNotify(e){const t=s.default.createSendBuffer([{path:"peripheral.notify_characteristic.service_uuid",length:18,type:"uuid",required:!0},{path:"peripheral.notify_characteristic.characteristic_uuid",length:18,type:"uuid",required:!0}],e);this.sendCommand(this._CommandServerNotifyCharavteristic,t)}peripheralDescriptorRead(e){const t=s.default.createSendBuffer([{path:"peripheral.read_descriptor.service_uuid",length:18,type:"uuid",required:!0},{path:"peripheral.read_descriptor.characteristic_uuid",length:18,type:"uuid",required:!0},{path:"peripheral.read_descriptor.descriptor_uuid",length:18,type:"uuid",required:!0}],e);this.sendCommand(this._CommandServerReadDescriptorValue,t)}peripheralDescriptorWrite(e){const t=s.default.createSendBuffer([{path:"peripheral.write_descriptor.service_uuid",length:18,type:"uuid",required:!0},{path:"peripheral.write_descriptor.characteristic_uuid",length:18,type:"uuid",required:!0},{path:"peripheral.write_descriptor.descriptor_uuid",length:18,type:"uuid",required:!0},{path:"peripheral.write_descriptor.data",type:"dataArray"}],e);this.sendCommand(this._CommandServerWriteDescriptorValue,t)}securityAuth(e){const t=[{path:"security.auth",type:"flag",length:1,required:!0,flags:this._securityAuthValues}],i=s.default.createSendBuffer(t,e);this.sendCommand(this._CommandSecuritySetAuth,i)}securityIndicateLevel(e){const t=s.default.createSendBuffer([{path:"security.indicate_security_level",type:"char",length:1,required:!0}],e);this.sendCommand(this._CommandSecuritySetEncryptionLevel,t)}securityKeyType(e){const t=[{path:"security.key.type",type:"flag",length:1,required:!0,flags:this._securityKeyTypes}],i=s.default.createSendBuffer(t,e);this.sendCommand(this._CommandSecuritySetEnableKeyTypes,i)}securityKeySize(e){const t=s.default.createSendBuffer([{path:"security.key.max_size",type:"char",length:1,required:!0}],e);this.sendCommand(this._CommandSecuritySetKeyMaxSize,t)}clearBondingDevicesList(e){const t=new Uint8Array([]);this.sendCommand(this._CommandSecurityClearBondingDevices,t)}parseFromJson(e){const t=e.ble;if(void 0===t)return;const i=[{uri:"/request/ble/central/scan_start",onValid:this.centralScanStart},{uri:"/request/ble/central/scan_stop",onValid:this.centralScanStop},{uri:"/request/ble/central/connect",onValid:this.centralConnect},{uri:"/request/ble/central/disconnect",onValid:this.centralDisconnect},{uri:"/request/ble/central/service_get",onValid:this.centralServiceGet},{uri:"/request/ble/central/characteristic_get",onValid:this.centralCharacteristicGet},{uri:"/request/ble/central/characteristic_read",onValid:this.centralCharacteristicRead},{uri:"/request/ble/central/characteristic_write",onValid:this.centralCharacteristicWrite},{uri:"/request/ble/central/characteristic_register_notify",onValid:this.centralCharacteristicRegisterNotify},{uri:"/request/ble/central/characteristic_unregister_notify",onValid:this.centralCharacteristicUnregisterNotify},{uri:"/request/ble/central/descriptor_get",onValid:this.centralDescriptorGet},{uri:"/request/ble/central/descriptor_read",onValid:this.centralDescriptorRead},{uri:"/request/ble/central/descriptor_write",onValid:this.centralDescriptorWrite},{uri:"/request/ble/peripheral/advertisement_start",onValid:this.peripheralAdvertisementStart},{uri:"/request/ble/peripheral/advertisement_stop",onValid:this.peripheralAdvertisementStop},{uri:"/request/ble/peripheral/service_start",onValid:this.peripheralServiceStart},{uri:"/request/ble/peripheral/service_stop",onValid:this.peripheralServiceStop},{uri:"/request/ble/peripheral/service_stop_all",onValid:this.peripheralServiceStopAll},{uri:"/request/ble/peripheral/characteristic_read",onValid:this.peripheralCharacteristicRead},{uri:"/request/ble/peripheral/characteristic_write",onValid:this.peripheralCharacteristicWrite},{uri:"/request/ble/peripheral/characteristic_notify",onValid:this.peripheralCharacteristicNotify},{uri:"/request/ble/peripheral/descriptor_read",onValid:this.peripheralDescriptorRead},{uri:"/request/ble/peripheral/descriptor_write",onValid:this.peripheralDescriptorWrite},{uri:"/request/ble/security/auth",onValid:this.securityAuth},{uri:"/request/ble/security/indicate_security_level",onValid:this.securityIndicateLevel},{uri:"/request/ble/security/key_type",onValid:this.securityKeyType},{uri:"/request/ble/security/key_max_size",onValid:this.securityKeySize},{uri:"/request/ble/security/devices_clear",onValid:this.clearBondingDevicesList}];i.push(...this.hciCommand.schemaData());const r=this.validateCommandSchema(i,t,"ble");if(0===r.valid)throw r.invalidButLike.length>0?new Error(r.invalidButLike[0].message):new this.WSCommandNotFoundError("[ble]unknown command")}notifyFromBinary(e,t,i){const r={};r[this._CommandScanResults]=this.notifyFromBinaryScanResponse.bind(this),r[this._CommandConnect]=this.notifyFromBinaryConnect.bind(this),r[this._CommandServices]=this.notifyFromBinaryServices.bind(this),r[this._CommandCharacteristics]=this.notifyFromBinaryChacateristics.bind(this),r[this._CommandWriteCharacteristics]=this.notifyFromBinaryWriteChacateristics.bind(this),r[this._CommandReadCharacteristics]=this.notifyFromBinaryReadChacateristics.bind(this),r[this._CommandRegisterNotifyCharacteristic]=this.notifyFromBinaryRegisterNotifyChacateristic.bind(this),r[this._CommandUnregisterNotifyCharacteristic]=this.notifyFromBinaryUnregisterNotifyChacateristic.bind(this),r[this._CommandNotifyCharacteristic]=this.notifyFromBinaryNotifyChacateristic.bind(this),r[this._CommandDescriptors]=this.notifyFromBinaryDescriptors.bind(this),r[this._CommandWriteDescriptor]=this.notifyFromBinaryWriteDescriptor.bind(this),r[this._CommandReadDescriptor]=this.notifyFromBinaryReadDescriptor.bind(this),r[this._CommandServerNotifyConnect]=this.notifyFromBinaryServerConnectionState.bind(this),r[this._CommandServerReadCharavteristicValue]=this.notifyFromBinaryServerReadCharavteristicValue.bind(this),r[this._CommandServerWriteCharavteristicValue]=this.notifyFromBinaryServerWriteCharavteristicValue.bind(this),r[this._CommandServerNotifyReadCharavteristicValue]=this.notifyFromBinaryServerNotifyReadCharavteristicValue.bind(this),r[this._CommandServerNotifyWriteCharavteristicValue]=this.notifyFromBinaryServerNotifyWriteCharavteristicValue.bind(this),r[this._CommandServerReadDescriptorValue]=this.notifyFromBinaryServerReadDescriptorValue.bind(this),r[this._CommandServerWriteDescriptorValue]=this.notifyFromBinaryServerWriteDescriptorValue.bind(this),r[this._CommandServerNotifyReadDescriptorValue]=this.notifyFromBinaryServerNotifyReadDescriptorValue.bind(this),r[this._CommandServerNotifyWriteDescriptorValue]=this.notifyFromBinaryServerNotifyWriteDescriptorValue.bind(this),r[this.COMMAND_FUNC_ID_ERROR]=this.notifyFromBinaryError.bind(this),Object.assign(r,this.hciCommand.notifyFunctionList()),r[t]&&r[t](e,i)}notifyFromBinaryScanResponse(e,t){if(t.byteLength>1){const i=[{name:"event_type",type:"enum",length:1,enum:this._CommandScanResultsEvet},{name:"address",type:"hex",length:6,endianness:"little"},{name:"device_type",type:"enum",length:1,enum:this._CommandScanResultsDevice},{name:"address_type",type:"enum",length:1,enum:this._CommandScanResultsDeviceAddress},{name:"ble_event_type",type:"enum",length:1,enum:this._CommandScanResultsBleEvent},{name:"rssi",type:"signed number",length:4},{name:"adv_data",type:"dataArray",length:62},{name:"flag",type:"number",length:4},{name:"num_response",type:"number",length:4},{name:"advertise_length",type:"number",length:1},{name:"scan_response_length",type:"number",length:1}],r=s.default.convertFromBinaryToJson(i,t);r.scan_resp=r.adv_data.slice(r.advertise_length,r.advertise_length+r.scan_response_length),r.adv_data=r.adv_data.slice(0,r.advertise_length),delete r.num_response,delete r.advertise_length,delete r.scan_response_length,delete r.advertise_data,"inquiry_result"===r.event_type?(delete r.event_type,this._addRowForPath(e,"ble.scan_result",r)):"inquiry_complete"===r.event_type&&this._addRowForPath(e,"ble.scan_result_finish",!0)}}notifyFromBinaryConnect(e,t){if(7===t.length){const i=[{name:"address",type:"hex",length:6,endianness:"little"},{name:"status",type:"enum",length:1,enum:{connected:0,disconnected:1}}],r=s.default.convertFromBinaryToJson(i,t);this._addRowForPath(e,"ble.status_update",r)}}notifyFromBinaryServices(e,t){const i=[{name:"address",type:"hex",length:6,endianness:"little"},{name:"service_uuid",type:"uuid",length:this.uuidLength}],r=s.default.convertFromBinaryToJson(i,t);null!==r.service_uuid?this._addRowForPath(e,"ble.get_service_result",r):(delete r.service_uuid,this._addRowForPath(e,"ble.get_service_result_finish",r))}notifyFromBinaryChacateristics(e,t){const i=[{name:"address",type:"hex",length:6,endianness:"little"},{name:"service_uuid",type:"uuid",length:this.uuidLength},{name:"characteristic_uuid",type:"uuid",length:this.uuidLength},{name:"properties",type:"enum",length:1,enum:this._CommandCharacteristicsProperties,flags:!0}],r=s.default.convertFromBinaryToJson(i,t);null!==r.characteristic_uuid?this._addRowForPath(e,"ble.get_characteristic_result",r):(delete r.characteristic_uuid,delete r.properties,this._addRowForPath(e,"ble.get_characteristic_result_finish",r))}notifyFromBinaryReadChacateristics(e,t){const i=[{name:"address",type:"hex",length:6,endianness:"little"},{name:"service_uuid",type:"uuid",length:this.uuidLength},{name:"characteristic_uuid",type:"uuid",length:this.uuidLength},{name:"result",type:"int",length:1},{name:"data",type:"dataArray",length:null}],r=s.default.convertFromBinaryToJson(i,t);r.result=r.result===this._commandResults.success?"success":"failed",this._addRowForPath(e,"ble.read_characteristic_result",r)}notifyFromBinaryWriteChacateristics(e,t){const i=[{name:"address",type:"hex",length:6,endianness:"little"},{name:"service_uuid",type:"uuid",length:this.uuidLength},{name:"characteristic_uuid",type:"uuid",length:this.uuidLength},{name:"result",type:"int",length:1}],r=s.default.convertFromBinaryToJson(i,t);r.result=r.result===this._commandResults.success?"success":"failed",this._addRowForPath(e,"ble.write_characteristic_result",r)}notifyFromBinaryRegisterNotifyChacateristic(e,t){const i=[{name:"address",type:"hex",length:6,endianness:"little"},{name:"service_uuid",type:"uuid",length:this.uuidLength},{name:"characteristic_uuid",type:"uuid",length:this.uuidLength},{name:"result",type:"int",length:1}],r=s.default.convertFromBinaryToJson(i,t);r.result=r.result===this._commandResults.success?"success":"failed",this._addRowForPath(e,"ble.register_notify_characteristic_result",r)}notifyFromBinaryUnregisterNotifyChacateristic(e,t){const i=[{name:"address",type:"hex",length:6,endianness:"little"},{name:"service_uuid",type:"uuid",length:this.uuidLength},{name:"characteristic_uuid",type:"uuid",length:this.uuidLength},{name:"result",type:"int",length:1}],r=s.default.convertFromBinaryToJson(i,t);r.result=r.result===this._commandResults.success?"success":"failed",this._addRowForPath(e,"ble.unregister_notify_characteristic_result",r)}notifyFromBinaryNotifyChacateristic(e,t){const i=[{name:"address",type:"hex",length:6,endianness:"little"},{name:"service_uuid",type:"uuid",length:this.uuidLength},{name:"characteristic_uuid",type:"uuid",length:this.uuidLength},{name:"is_notify",type:"int",length:1},{name:"data",type:"dataArray",length:null}],r=s.default.convertFromBinaryToJson(i,t);r.is_notify=1===r.is_notify,this._addRowForPath(e,"ble.notify_characteristic",r)}notifyFromBinaryDescriptors(e,t){const i=[{name:"address",type:"hex",length:6,endianness:"little"},{name:"service_uuid",type:"uuid",length:this.uuidLength},{name:"characteristic_uuid",type:"uuid",length:this.uuidLength},{name:"descriptor_uuid",type:"uuid",length:this.uuidLength}],r=s.default.convertFromBinaryToJson(i,t);null!==r.descriptor_uuid?this._addRowForPath(e,"ble.get_descriptor_result",r):(delete r.descriptor_uuid,this._addRowForPath(e,"ble.get_descriptor_result_finish",r))}notifyFromBinaryReadDescriptor(e,t){const i=[{name:"address",type:"hex",length:6,endianness:"little"},{name:"service_uuid",type:"uuid",length:this.uuidLength},{name:"characteristic_uuid",type:"uuid",length:this.uuidLength},{name:"descriptor_uuid",type:"uuid",length:this.uuidLength},{name:"result",type:"int",length:1},{name:"data",type:"dataArray",length:null}],r=s.default.convertFromBinaryToJson(i,t);r.result=r.result===this._commandResults.success?"success":"failed",this._addRowForPath(e,"ble.read_descriptor_result",r)}notifyFromBinaryWriteDescriptor(e,t){const i=[{name:"address",type:"hex",length:6,endianness:"little"},{name:"service_uuid",type:"uuid",length:this.uuidLength},{name:"characteristic_uuid",type:"uuid",length:this.uuidLength},{name:"descriptor_uuid",type:"uuid",length:this.uuidLength},{name:"result",type:"int",length:1}],r=s.default.convertFromBinaryToJson(i,t);r.result=r.result===this._commandResults.success?"success":"failed",this._addRowForPath(e,"ble.write_descriptor_result",r)}notifyFromBinaryServerConnectionState(e,t){const i=s.default.convertFromBinaryToJson([{name:"address",type:"hex",length:6,endianness:"little"},{name:"status",type:"enum",length:1,enum:{connected:1,disconnected:0}}],t);this._addRowForPath(e,"ble.peripheral.connection_status",i)}notifyFromBinaryServerWriteCharavteristicValue(e,t){const i=[{name:"service_uuid",type:"uuid",length:this.uuidLength},{name:"characteristic_uuid",type:"uuid",length:this.uuidLength},{name:"result",type:"int",length:1}],r=s.default.convertFromBinaryToJson(i,t);r.result=r.result===this._commandResults.success?"success":"failed",this._addRowForPath(e,"ble.peripheral.write_characteristic_result",r)}notifyFromBinaryServerReadCharavteristicValue(e,t){const i=[{name:"service_uuid",type:"uuid",length:this.uuidLength},{name:"characteristic_uuid",type:"uuid",length:this.uuidLength},{name:"data",type:"dataArray",length:null}],r=s.default.convertFromBinaryToJson(i,t);r.result="success",this._addRowForPath(e,"ble.peripheral.read_characteristic_result",r)}notifyFromBinaryServerNotifyReadCharavteristicValue(e,t){const i=[{name:"address",type:"hex",length:6,endianness:"little"},{name:"service_uuid",type:"uuid",length:this.uuidLength},{name:"characteristic_uuid",type:"uuid",length:this.uuidLength}],r=s.default.convertFromBinaryToJson(i,t);this._addRowForPath(e,"ble.peripheral.notify_read_characteristic",r)}notifyFromBinaryServerNotifyWriteCharavteristicValue(e,t){const i=[{name:"address",type:"hex",length:6,endianness:"little"},{name:"service_uuid",type:"uuid",length:this.uuidLength},{name:"characteristic_uuid",type:"uuid",length:this.uuidLength},{name:"data",type:"dataArray",length:null}],r=s.default.convertFromBinaryToJson(i,t);this._addRowForPath(e,"ble.peripheral.notify_write_characteristic",r)}notifyFromBinaryServerReadDescriptorValue(e,t){const i=[{name:"service_uuid",type:"uuid",length:this.uuidLength},{name:"characteristic_uuid",type:"uuid",length:this.uuidLength},{name:"descriptor_uuid",type:"uuid",length:this.uuidLength},{name:"data",type:"dataArray",length:null}],r=s.default.convertFromBinaryToJson(i,t);r.result="success",this._addRowForPath(e,"ble.peripheral.read_descriptor_result",r)}notifyFromBinaryServerWriteDescriptorValue(e,t){const i=[{name:"service_uuid",type:"uuid",length:this.uuidLength},{name:"characteristic_uuid",type:"uuid",length:this.uuidLength},{name:"descriptor_uuid",type:"uuid",length:this.uuidLength},{name:"result",type:"int",length:1}],r=s.default.convertFromBinaryToJson(i,t);r.result=r.result===this._commandResults.success?"success":"failed",this._addRowForPath(e,"ble.peripheral.write_descriptor_result",r)}notifyFromBinaryServerNotifyReadDescriptorValue(e,t){const i=[{name:"address",type:"hex",length:6,endianness:"little"},{name:"service_uuid",type:"uuid",length:this.uuidLength},{name:"characteristic_uuid",type:"uuid",length:this.uuidLength},{name:"descriptor_uuid",type:"uuid",length:this.uuidLength}],r=s.default.convertFromBinaryToJson(i,t);this._addRowForPath(e,"ble.peripheral.notify_read_descriptor",r)}notifyFromBinaryServerNotifyWriteDescriptorValue(e,t){const i=[{name:"address",type:"hex",length:6,endianness:"little"},{name:"service_uuid",type:"uuid",length:this.uuidLength},{name:"characteristic_uuid",type:"uuid",length:this.uuidLength},{name:"descriptor_uuid",type:"uuid",length:this.uuidLength},{name:"data",type:"dataArray",length:null}],r=s.default.convertFromBinaryToJson(i,t);this._addRowForPath(e,"ble.peripheral.notify_write_descriptor",r)}notifyFromBinaryError(e,t){const i=[{name:"module_error_code",type:"char",length:1},{name:"error_code",type:"char",length:1},{name:"function_code",type:"char",length:1},{name:"address",type:"hex",length:6,endianness:"little"},{name:"service_uuid",type:"uuid",length:this.uuidLength},{name:"characteristic_uuid",type:"uuid",length:this.uuidLength},{name:"descriptor_uuid",type:"uuid",length:this.uuidLength}],r=s.default.convertFromBinaryToJson(i,t);r.message={0:"no error",1:"device not connected",2:"service not found",3:"charavteristic not found",4:"descriptor not found",5:"no permission",6:"device not found",7:"ble is busy",8:"service already running",9:"security param are already set",255:"error"}[r.error_code]+" "+{0:"on setting advertisement data",1:"on setting scan response data",2:"on starting advertisement",3:"on stopping advertisement",4:"on starting scan",5:"on stoping scan",6:"",7:"on connecting device",8:"on getting services",9:"on getting characteristic",10:"on writing characteristic",11:"on reading characteristic",14:"on getting descriptor",15:"on writing descriptor",16:"on reading descriptor",20:"on start pheripheral",21:"on notify connect",22:"on adding service",23:"on adding characteristic",24:"on adding descriptor",25:"on writing characteristic",26:"on reading characteristic",27:"on writing characteristic from remote",28:"on reading characteristic from remote",29:"on writing descriptor",30:"on reading descriptor",31:"on writing descriptor from remote",32:"on reading descriptor from remote",33:"on notify characteristic",34:"on start/stop service",35:"on set security auth param",36:"on set security encryption level param",37:"on set security key type param",38:"on set security key size param",39:"on set security io capability",40:"on clear bonding devices list"}[r.function_code],this.envelopError(e,"ble",r)}_addRowForPath(e,t,i){const r=t.split(".");let s=e;for(let e=0;e<r.length-1;e++)s[r[e]]=s[r[e]]||{},s=s[r[e]];s[r[r.length-1]]=i}}t.default=o},function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});t.default=class{static convertFromBinaryToJson(e,t){const i={hex:this.hexFromBinary.bind(this),uuid:this.uuidFromBinary.bind(this),number:this.numberFromBinary.bind(this),"signed number":this.signedNumberFromBinary.bind(this),int:this.numberFromBinary.bind(this),char:this.numberFromBinary.bind(this),enum:this.enumFromBinary.bind(this),dataArray:this.dataArrayFromBinary.bind(this)},r={};let s=0;for(let n=0;n<e.length;n++){const a=t.slice(s,e[n].length?s+e[n].length:void 0);if(r[e[n].name]=i[e[n].type](a,e[n]),!e[n].length)break;s+=e[n].length}return r}static hexFromBinary(e,t){let i="";for(let r=0;r<e.length;r++)t.endianness&&"little"===t.endianness?i=("00"+e[r].toString(16)).slice(-2)+i:i+=("00"+e[r].toString(16)).slice(-2);return i}static uuidFromBinary(e){const t=16*e[0]+e[1];if(0===t)return null;const i=e.slice(2);let r="";for(let e=0;e<t;e++)r=("00"+i[e].toString(16)).slice(-2)+r;return r}static signedNumberFromBinary(e){let t=127&e[0];for(let i=1;i<e.length;i++)t=256*t+e[i];return 0!=(128&e[0])&&(t-=Math.pow(2,8*e.length-1)),t}static numberFromBinary(e){let t=0;for(let i=0;i<e.length;i++)t=256*t+e[i];return t}static keyForVal(e,t){return Object.keys(e).filter(i=>e[i]===t)[0]}static enumFromBinary(e,t){const i=t.enum;let r=this.numberFromBinary(e);if(!0===t.flags){const e=[];for(const t of Object.keys(i)){i[t]&r&&e.push(t)}r=e}else{const e=this.keyForVal(i,r);e&&(r=e)}return r}static dataArrayFromBinary(e){const t=new Array(e.length);for(let i=0;i<e.length;i++)t[i]=e[i];return t}static createSendBuffer(e,t){const i=[];for(let r=0;r<e.length;r++){const s=e[r];let n;if(Array.isArray(s))for(const e in s){const i=Object.assign({},s[e],{required:!0});if(n=this.analyzeSchema(t,i),n)break}else n=this.analyzeSchema(t,s);Array.prototype.push.apply(i,n)}return new Uint8Array(i)}static analyzeSchema(e,t){const i={hex:this.hexToBinary.bind(this),uuid:this.uuidToBinary.bind(this),int:this.intToBinary.bind(this),char:this.charToBinary.bind(this),dataArray:this.dataArrayToBinary.bind(this),enum:this.enumToBinary.bind(this),string:this.stringToBinary.bind(this),text:this.stringToBinary.bind(this),flag:this.flagToBinary.bind(this)};let r;if(t.path&&(r=this.getProperty(e,t.path)),void 0===r&&t.required)return null;void 0===r&&t.default&&(r=t.default);const s=i[t.type](r,t);return t.length&&s.length!==t.length&&console.log("JSON->BINARY SCHEMA ERROR: (",r,")",t),s}static getProperty(e,t){if(""===t||void 0===t)return e;"string"==typeof t&&(t=t.split(".")),Array.isArray(t)||(t=[t]);let i=0;const r=t.length;for(;i<r;)if(void 0===(e=e[t[i++]]))return;return i&&i===r?e:void 0}static hexToBinary(e,t){const i=[],r=e.toLowerCase().replace(/[^0-9abcdef]/g,"");for(let e=0;e<r.length/2;e++)i[e]=parseInt(r[2*e]+r[2*e+1],16);return t&&t.endianness&&"little"===t.endianness&&i.reverse(),i}static intToBinary(e){const t=[];return t[0]=e>>24&255,t[1]=e>>16&255,t[2]=e>>8&255,t[3]=e>>0&255,t}static charToBinary(e){const t=[];return t[0]=255&e,t}static dataArrayToBinary(e){return Array.isArray(e)||(e=[e]),e}static uuidToBinary(e){const t=this.hexToBinary(e);t.reverse();const i=t.length,r=[];r[0]=i>>8&255,r[1]=i>>0&255,Array.prototype.push.apply(r,t);for(let e=r.length;e<18;e++)r[e]=0;return r}static enumToBinary(e,t){const i=[];return i.push(t.enum[e]),i}static flagToBinary(e,t){Array.isArray(e)||(e=[e]);const i=t.flags;let r=0;for(const t in i)e.includes(i[t])&&(r+=parseInt(t));const s=[];for(let e=(t.length||1)-1;e>=0;e--)s.push(r>>8*e&255);return s}static stringToBinary(t){return new Uint8Array(e.from(t,"utf8"))}}}).call(this,i(0).Buffer)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e){this._CommandHCIInit=41,this._CommandHCIDeinit=42,this._CommandHCISend=43,this._CommandHCIRecv=44,this._CommandHCIAdvertisementFilter=45,this._delegate=e}schemaData(){return[{uri:"/request/ble/hci/write",onValid:this.send.bind(this)},{uri:"/request/ble/hci/advertisement_filter",onValid:this.advertisementFilter.bind(this)}]}notifyFunctionList(){const e={};return e[this._CommandHCIRecv]=this.recv.bind(this),e}send(e,t){const i=new Uint8Array(e.hci.write.length);i.set(e.hci.write),this._delegate.sendCommand(this._CommandHCISend,i)}recv(e,t){const i=new Array(t.byteLength);for(let e=0;e<i.length;e++)i[e]=t[e];e.ble=e.ble||{},e.ble.hci=e.ble.hci||{},e.ble.hci.read={data:i}}advertisementFilter(e){const t=[];e.hci.advertisement_filter.forEach(e=>{const i=[e.range.index,e.range.length,e.value.length,...e.value];t.push(...i)});const i=new Uint8Array(t.length);i.set(t),this._delegate.sendCommand(this._CommandHCIAdvertisementFilter,i)}}},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(17),n=r(i(6)),a=r(i(5)),o=r(i(107)),h=r(i(108));class c extends a.default{constructor(){super(),this.module=1,this._CommandRegistrate=0,this._CommandPause=1,this._CommandResume=2,this._CommandNotify=3,this.availableCommands=[new o.default,new h.default]}init(e,t){const i=n.default.string2dataArray(e.animation.name);let r,o=0;if(s.lt(this._hw.firmware,"2.0.0")){if(r=new Uint8Array(1+i.length+1),r[o++]=i.length+1,r.set(i,o),o+=i.length,r[o++]=0,"registrate"===e.animation.status||"number"==typeof e.animation.repeat)throw new Error("you need to update your firmware >= 2.0.0")}else{r=new Uint8Array(1+i.length+1+1+4),r[o++]=i.length+1,r.set(i,o),o+=i.length,r[o++]=0;let t=0,s=0;"loop"===e.animation.status&&(t=1),"number"==typeof e.animation.repeat&&(s=e.animation.repeat,t+=2),r[o++]=t,r[o++]=s>>24,r[o++]=s>>16,r[o++]=s>>8,r[o++]=s}const h=e.animation.states;for(let e=0;e<h.length;e++){const t=h[e],i=Math.floor(1e3*t.duration),s=t.state;let n=JSON.parse(JSON.stringify(s));Array.isArray(n)||(n=[n]);let o=null;for(let e=0;e<n.length;e++){const t=a.default.compress(this.availableCommands,n[e]);if(!t)throw new Error("[io.animation.states.state]only io or pwm commands. Pleave provide state at least one of them.");if(o){const e=new Uint8Array(o.length+t.length);e.set(o,0),e.set(t,o.length),o=e}else o=t}if(!o)throw new Error("[io.animation.states.state]only io or pwm commands. Pleave provide state at least one of them.");const c=o.byteLength,d=new Uint8Array(8);d[0]=c>>24,d[1]=c>>16,d[2]=c>>8,d[3]=c,d[4]=i>>24,d[5]=i>>16,d[6]=i>>8,d[7]=i;const u=new Uint8Array(r.byteLength+d.byteLength+o.byteLength);u.set(r,0),u.set(d,r.byteLength),u.set(o,r.byteLength+d.byteLength),r=u}if(r.byteLength>1e3)throw new Error("[io.animation]Too big animation datas");this.sendCommand(this._CommandRegistrate,r)}changeState(e){if("resume"===e.animation.status){const t=n.default.string2dataArray(e.animation.name),i=new Uint8Array(t.length+2);i[0]=t.length+1,i.set(t,1),i[i.byteLength-1]=0,this.sendCommand(this._CommandResume,i)}else if("pause"===e.animation.status){const t=n.default.string2dataArray(e.animation.name),i=new Uint8Array(t.length+2);i[0]=t.length+1,i.set(t,1),i[i.byteLength-1]=0,this.sendCommand(this._CommandPause,i)}}parseFromJson(e){let t=!1;try{super.parseFromJson(e)}catch(e){if(!(e instanceof this.WSCommandNotFoundError))throw e;t=!0}const i=e.io;if(void 0===i)return;const r=[{uri:"/request/ioAnimation/init",onValid:this.init},{uri:"/request/ioAnimation/changeState",onValid:this.changeState}],s=this.validateCommandSchema(r,i,"io",i);if(0===s.valid&&t){if(s.invalidButLike.length>0)throw new Error(s.invalidButLike[0].message);throw new(0,this.WSCommandNotFoundError)("[io.animation]unknown command")}}notifyFromBinary(e,t,i){if(t===this._CommandNotify){const t=n.default.dataArray2string(i.slice(2,i.byteLength-1));e.io={animation:{name:t,status:"finish"}}}else super.notifyFromBinary(e,t,i)}}t.default=c},function(e,t,i){"use strict";(function(e){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(422)),n=r(i(5));class a extends n.default{constructor(){super(...arguments),this.module=8,this._CommandClear=0,this._CommandPrint=1,this._CommandDrawCampusVerticalBytes=2,this._CommandDrawCampusHorizonalBytes=3,this._CommandDrawIOState=4,this._CommandSetPinName=5,this._CommandDrawCampusRawColors=6}clear(e){this.sendCommand(this._CommandClear,null)}print(e){this.sendCommand(this._CommandPrint,e)}printText(t){const i=e.from(t,"utf8"),r=new Uint8Array(i);this.print(r)}text(e){this.printText(e.text)}raw(e){"number"==typeof e.color_depth&&e.color_depth>1?this.drawRawColors(e.raw,e.color_depth):this.drawHorizonally(new Uint8Array(e.raw))}qr(e){const t=e.qr.text,i=e.qr.correction||"M",r=s.default(0,i);r.addData(t),r.make();let n=r.getModuleCount();if(n){n*=2;const e=r.getModules(),t=new Uint8Array(1024);t.fill(0);for(let e=0;e<2;e++)for(let i=0;i<n+4;i++)t[Math.floor(16*e+i/8)]|=128>>i%8,t[Math.floor(16*(e+n+2)+i/8)]|=128>>i%8;for(let e=2;e<n+2;e++){for(let i=0;i<2;i++)t[Math.floor(16*e+i/8)]|=128>>i%8;for(let i=n+2;i<n+4;i++)t[Math.floor(16*e+i/8)]|=128>>i%8}for(let i=0;i<n;i++)for(let r=0;r<n;r++)e[Math.floor(i/2)][Math.floor(r/2)]||(t[Math.floor(16*(i+2)+(r+2)/8)]|=128>>(r+2)%8);this.drawHorizonally(t)}}pinName(e){for(let t=0;t<40;t++)"object"==typeof e.pin_assign[t]&&this.setPinName(t,e.pin_assign[t].module_name||"?",e.pin_assign[t].pin_name||"?")}drawVertically(e){this.sendCommand(this._CommandDrawCampusVerticalBytes,e)}drawHorizonally(e){this.sendCommand(this._CommandDrawCampusHorizonalBytes,e)}drawIOState(e){const t=new Uint8Array([e?0:1]);this.sendCommand(this._CommandDrawIOState,t)}setPinName(t,i,r){let s=i.slice(0,4)+" "+r;s=s.slice(0,9);const n=new Uint8Array(1);n[0]=t;const a=new Uint8Array(e.from(s,"utf8")),o=new Uint8Array(n.length+a.length);o.set(n,0),o.set(a,1),this.sendCommand(this._CommandSetPinName,o)}drawRawColors(e,t){const i=new Uint8Array(1+e.length);i[0]=t,i.set(e,1),this.sendCommand(this._CommandDrawCampusRawColors,i)}parseFromJson(e){const t=e.display;if(void 0===t)return;const i=[{uri:"/request/display/clear",onValid:this.clear},{uri:"/request/display/text",onValid:this.text},{uri:"/request/display/raw",onValid:this.raw},{uri:"/request/display/pin_assign",onValid:this.pinName},{uri:"/request/display/qr",onValid:this.qr}],r=this.validateCommandSchema(i,t,"display");if(0===r.valid)throw r.invalidButLike.length>0?new Error(r.invalidButLike[0].message):new this.WSCommandNotFoundError("[display]unknown command")}}t.default=a}).call(this,i(0).Buffer)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=(()=>{const e=(e,t)=>{const i=n[t];let r=null,s=0,a=null;const o=[],h={},c=(t,n)=>{s=4*e+17,r=(e=>{const t=new Array(e);for(let i=0;i<e;i+=1){t[i]=new Array(e);for(let r=0;r<e;r+=1)t[i][r]=null}return t})(s),d(0,0),d(s-7,0),d(0,s-7),l(),u(),m(t,n),e>=7&&f(t),null===a&&(a=C(e,i,o)),E(a,n)},d=(e,t)=>{for(let i=-1;i<=7;i+=1)if(!(e+i<=-1||s<=e+i))for(let n=-1;n<=7;n+=1)t+n<=-1||s<=t+n||(r[e+i][t+n]=0<=i&&i<=6&&(0===n||6===n)||0<=n&&n<=6&&(0===i||6===i)||2<=i&&i<=4&&2<=n&&n<=4)},u=()=>{for(let e=8;e<s-8;e+=1)null===r[e][6]&&(r[e][6]=e%2==0);for(let e=8;e<s-8;e+=1)null===r[6][e]&&(r[6][e]=e%2==0)},l=()=>{const t=p.getPatternPosition(e);for(let e=0;e<t.length;e+=1)for(let i=0;i<t.length;i+=1){const s=t[e],n=t[i];if(null===r[s][n])for(let e=-2;e<=2;e+=1)for(let t=-2;t<=2;t+=1)r[s+e][n+t]=-2===e||2===e||-2===t||2===t||0===e&&0===t}},f=t=>{const i=p.getBCHTypeNumber(e);for(let e=0;e<18;e+=1){const n=!t&&1==(i>>e&1);r[Math.floor(e/3)][e%3+s-8-3]=n}for(let e=0;e<18;e+=1){const n=!t&&1==(i>>e&1);r[e%3+s-8-3][Math.floor(e/3)]=n}},m=(e,t)=>{const n=i<<3|t,a=p.getBCHTypeInfo(n);for(let t=0;t<15;t+=1){const i=!e&&1==(a>>t&1);t<6?r[t][8]=i:t<8?r[t+1][8]=i:r[s-15+t][8]=i}for(let t=0;t<15;t+=1){const i=!e&&1==(a>>t&1);t<8?r[8][s-t-1]=i:t<9?r[8][15-t-1+1]=i:r[8][15-t-1]=i}r[s-8][8]=!e},E=(e,t)=>{let i=-1,n=s-1,a=7,o=0;const h=p.getMaskFunction(t);for(let t=s-1;t>0;t-=2)for(6===t&&(t-=1);;){for(let i=0;i<2;i+=1)if(null===r[n][t-i]){let s=!1;o<e.length&&(s=1==(e[o]>>>a&1)),h(n,t-i)&&(s=!s),r[n][t-i]=s,a-=1,-1===a&&(o+=1,a=7)}if(n+=i,n<0||s<=n){n-=i,i=-i;break}}},C=(e,t,i)=>{const r=g.getRSBlocks(e,t),s=y();for(let t=0;t<i.length;t+=1){const r=i[t];s.put(r.getMode(),4),s.put(r.getLength(),p.getLengthInBits(r.getMode(),e)),r.write(s)}let n=0;for(let e=0;e<r.length;e+=1)n+=r[e].dataCount;if(s.getLengthInBits()>8*n)throw new Error("code length overflow. ("+s.getLengthInBits()+">"+8*n+")");for(s.getLengthInBits()+4<=8*n&&s.put(0,4);s.getLengthInBits()%8!=0;)s.putBit(!1);for(;!(s.getLengthInBits()>=8*n||(s.put(236,8),s.getLengthInBits()>=8*n));)s.put(17,8);return((e,t)=>{let i=0,r=0,s=0;const n=new Array(t.length),a=new Array(t.length);for(let o=0;o<t.length;o+=1){const h=t[o].dataCount,c=t[o].totalCount-h;r=Math.max(r,h),s=Math.max(s,c),n[o]=new Array(h);for(let t=0;t<n[o].length;t+=1)n[o][t]=255&e.getBuffer()[t+i];i+=h;const d=p.getErrorCorrectPolynomial(c),u=_(n[o],d.getLength()-1).mod(d);a[o]=new Array(d.getLength()-1);for(let e=0;e<a[o].length;e+=1){const t=e+u.getLength()-a[o].length;a[o][e]=t>=0?u.getAt(t):0}}let o=0;for(let e=0;e<t.length;e+=1)o+=t[e].totalCount;const h=new Array(o);let c=0;for(let e=0;e<r;e+=1)for(let i=0;i<t.length;i+=1)e<n[i].length&&(h[c]=n[i][e],c+=1);for(let e=0;e<s;e+=1)for(let i=0;i<t.length;i+=1)e<a[i].length&&(h[c]=a[i][e],c+=1);return h})(s,r)};return h.addData=(e,t)=>{let i=null;switch(t=t||"Byte"){case"Numeric":i=b(e);break;case"Alphanumeric":i=v(e);break;case"Byte":i=w(e);break;case"Kanji":i=S(e);break;default:throw new Error("mode:"+t)}o.push(i),a=null},h.getModules=()=>r,h.isDark=(e,t)=>{if(e<0||s<=e||t<0||s<=t)throw new Error(e+","+t);return r[e][t]},h.getModuleCount=()=>s,h.make=()=>{if(e<1){let t=1;for(;t<40;t++){const e=g.getRSBlocks(t,i),r=y();for(let e=0;e<o.length;e++){const i=o[e];r.put(i.getMode(),4),r.put(i.getLength(),p.getLengthInBits(i.getMode(),t)),i.write(r)}let s=0;for(let t=0;t<e.length;t++)s+=e[t].dataCount;if(r.getLengthInBits()<=8*s)break}e=t}c(!1,(()=>{let e=0,t=0;for(let i=0;i<8;i+=1){c(!0,i);const r=p.getLostPoint(h);(0===i||e>r)&&(e=r,t=i)}return t})())},h.createTableTag=(e,t)=>{e=e||2;let i="";i+='<table style="',i+=" border-width: 0px; border-style: none;",i+=" border-collapse: collapse;",i+=" padding: 0px; margin: "+(t=void 0===t?4*e:t)+"px;",i+='">',i+="<tbody>";for(let t=0;t<h.getModuleCount();t+=1){i+="<tr>";for(let r=0;r<h.getModuleCount();r+=1)i+='<td style="',i+=" border-width: 0px; border-style: none;",i+=" border-collapse: collapse;",i+=" padding: 0px; margin: 0px;",i+=" width: "+e+"px;",i+=" height: "+e+"px;",i+=" background-color: ",i+=h.isDark(t,r)?"#000000":"#ffffff",i+=";",i+='"/>';i+="</tr>"}return i+="</tbody>",i+="</table>",i},h.renderTo2dContext=(e,t)=>{t=t||2;const i=h.getModuleCount();for(let r=0;r<i;r++)for(let s=0;s<i;s++)e.fillStyle=h.isDark(r,s)?"black":"white",e.fillRect(r*t,s*t,t,t)},h};e.stringToBytes=(e.stringToBytesFuncs={default(e){const t=[];for(let i=0;i<e.length;i+=1){const r=e.charCodeAt(i);t.push(255&r)}return t}}).default,e.createStringToBytes=(e,t)=>{const i=(()=>{const i=E(e),r=()=>{const e=i.read();if(-1===e)throw new Error("eof");return e};let s=0;const n={};for(;;){const e=i.read();if(-1===e)break;const t=r(),a=r()<<8|r();n[String.fromCharCode(e<<8|t)]=a,s+=1}if(s!==t)throw new Error(s+" !=="+t);return n})(),r="?".charCodeAt(0);return e=>{const t=[];for(let s=0;s<e.length;s+=1){const n=e.charCodeAt(s);if(n<128)t.push(n);else{const n=i[e.charAt(s)];"number"==typeof n?(255&n)===n?t.push(n):(t.push(n>>>8),t.push(255&n)):t.push(r)}}return t}};const t=1,i=2,r=4,s=8,n={L:1,M:0,Q:3,H:2},a=0,o=1,h=2,c=3,d=4,u=5,l=6,f=7,p=(()=>{const e=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],n={},p=e=>{let t=0;for(;0!==e;)t+=1,e>>>=1;return t};return n.getBCHTypeInfo=e=>{let t=e<<10;for(;p(t)-p(1335)>=0;)t^=1335<<p(t)-p(1335);return 21522^(e<<10|t)},n.getBCHTypeNumber=e=>{let t=e<<12;for(;p(t)-p(7973)>=0;)t^=7973<<p(t)-p(7973);return e<<12|t},n.getPatternPosition=t=>e[t-1],n.getMaskFunction=e=>{switch(e){case a:return(e,t)=>(e+t)%2==0;case o:return(e,t)=>e%2==0;case h:return(e,t)=>t%3==0;case c:return(e,t)=>(e+t)%3==0;case d:return(e,t)=>(Math.floor(e/2)+Math.floor(t/3))%2==0;case u:return(e,t)=>e*t%2+e*t%3==0;case l:return(e,t)=>(e*t%2+e*t%3)%2==0;case f:return(e,t)=>(e*t%3+(e+t)%2)%2==0;default:throw new Error("bad maskPattern:"+e)}},n.getErrorCorrectPolynomial=e=>{let t=_([1],0);for(let i=0;i<e;i+=1)t=t.multiply(_([1,m.gexp(i)],0));return t},n.getLengthInBits=(e,n)=>{if(1<=n&&n<10)switch(e){case t:return 10;case i:return 9;case r:case s:return 8;default:throw new Error("mode:"+e)}else if(n<27)switch(e){case t:return 12;case i:return 11;case r:return 16;case s:return 10;default:throw new Error("mode:"+e)}else{if(!(n<41))throw new Error("type:"+n);switch(e){case t:return 14;case i:return 13;case r:return 16;case s:return 12;default:throw new Error("mode:"+e)}}},n.getLostPoint=e=>{const t=e.getModuleCount();let i=0;for(let r=0;r<t;r+=1)for(let s=0;s<t;s+=1){let n=0;const a=e.isDark(r,s);for(let i=-1;i<=1;i+=1)if(!(r+i<0||t<=r+i))for(let o=-1;o<=1;o+=1)s+o<0||t<=s+o||0===i&&0===o||a===e.isDark(r+i,s+o)&&(n+=1);n>5&&(i+=3+n-5)}for(let r=0;r<t-1;r+=1)for(let s=0;s<t-1;s+=1){let t=0;e.isDark(r,s)&&(t+=1),e.isDark(r+1,s)&&(t+=1),e.isDark(r,s+1)&&(t+=1),e.isDark(r+1,s+1)&&(t+=1),0!==t&&4!==t||(i+=3)}for(let r=0;r<t;r+=1)for(let s=0;s<t-6;s+=1)e.isDark(r,s)&&!e.isDark(r,s+1)&&e.isDark(r,s+2)&&e.isDark(r,s+3)&&e.isDark(r,s+4)&&!e.isDark(r,s+5)&&e.isDark(r,s+6)&&(i+=40);for(let r=0;r<t;r+=1)for(let s=0;s<t-6;s+=1)e.isDark(s,r)&&!e.isDark(s+1,r)&&e.isDark(s+2,r)&&e.isDark(s+3,r)&&e.isDark(s+4,r)&&!e.isDark(s+5,r)&&e.isDark(s+6,r)&&(i+=40);let r=0;for(let i=0;i<t;i+=1)for(let s=0;s<t;s+=1)e.isDark(s,i)&&(r+=1);return i+=10*(Math.abs(100*r/t/t-50)/5),i},n})(),m=(()=>{const e=new Array(256),t=new Array(256);for(let t=0;t<8;t+=1)e[t]=1<<t;for(let t=8;t<256;t+=1)e[t]=e[t-4]^e[t-5]^e[t-6]^e[t-8];for(let i=0;i<255;i+=1)t[e[i]]=i;const i={glog:e=>{if(e<1)throw new Error("glog("+e+")");return t[e]},gexp:t=>{for(;t<0;)t+=255;for(;t>=256;)t-=255;return e[t]}};return i})();function _(e,t){if(void 0===e.length)throw new Error(e.length+"/"+t);const i=(()=>{let i=0;for(;i<e.length&&0===e[i];)i+=1;const r=new Array(e.length-i+t);for(let t=0;t<e.length-i;t+=1)r[t]=e[t+i];return r})(),r={getAt:e=>i[e],getLength:()=>i.length,multiply:e=>{const t=new Array(r.getLength()+e.getLength()-1);for(let i=0;i<r.getLength();i+=1)for(let s=0;s<e.getLength();s+=1)t[i+s]^=m.gexp(m.glog(r.getAt(i))+m.glog(e.getAt(s)));return _(t,0)},mod:e=>{if(r.getLength()-e.getLength()<0)return r;const t=m.glog(r.getAt(0))-m.glog(e.getAt(0)),i=new Array(r.getLength());for(let e=0;e<r.getLength();e+=1)i[e]=r.getAt(e);for(let r=0;r<e.getLength();r+=1)i[r]^=m.gexp(m.glog(e.getAt(r))+t);return _(i,0).mod(e)}};return r}const g=(()=>{const e=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12,7,37,13],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],t=(e,t)=>{const i={};return i.totalCount=e,i.dataCount=t,i},i={};return i.getRSBlocks=(i,r)=>{const s=((t,i)=>{switch(i){case n.L:return e[4*(t-1)+0];case n.M:return e[4*(t-1)+1];case n.Q:return e[4*(t-1)+2];case n.H:return e[4*(t-1)+3];default:return}})(i,r);if(void 0===s)throw new Error("bad rs block @ typeNumber:"+i+"/errorCorrectionLevel:"+r);const a=s.length/3,o=[];for(let e=0;e<a;e+=1){const i=s[3*e+0],r=s[3*e+1],n=s[3*e+2];for(let e=0;e<i;e+=1)o.push(t(r,n))}return o},i})(),y=()=>{const e=[];let t=0;const i={getBuffer:()=>e,getAt:t=>{const i=Math.floor(t/8);return 1==(e[i]>>>7-t%8&1)},put:(e,t)=>{for(let r=0;r<t;r+=1)i.putBit(1==(e>>>t-r-1&1))},getLengthInBits:()=>t,putBit:i=>{const r=Math.floor(t/8);e.length<=r&&e.push(0),i&&(e[r]|=128>>>t%8),t+=1}};return i},b=e=>{const i=t,r={getMode:()=>i,getLength:t=>e.length,write:t=>{const i=e;let r=0;for(;r+2<i.length;)t.put(s(i.substring(r,r+3)),10),r+=3;r<i.length&&(i.length-r==1?t.put(s(i.substring(r,r+1)),4):i.length-r==2&&t.put(s(i.substring(r,r+2)),7))}},s=e=>{let t=0;for(let i=0;i<e.length;i+=1)t=10*t+n(e.charAt(i));return t},n=e=>{if("0"<=e&&e<="9")return e.charCodeAt(0)-"0".charCodeAt(0);throw new Error("illegal char :"+e)};return r},v=e=>{const t=i,r=e,s={getMode:()=>t,getLength:e=>r.length,write:e=>{const t=r;let i=0;for(;i+1<t.length;)e.put(45*n(t.charAt(i))+n(t.charAt(i+1)),11),i+=2;i<t.length&&e.put(n(t.charAt(i)),6)}},n=e=>{if("0"<=e&&e<="9")return e.charCodeAt(0)-"0".charCodeAt(0);if("A"<=e&&e<="Z")return e.charCodeAt(0)-"A".charCodeAt(0)+10;switch(e){case" ":return 36;case"$":return 37;case"%":return 38;case"*":return 39;case"+":return 40;case"-":return 41;case".":return 42;case"/":return 43;case":":return 44;default:throw new Error("illegal char :"+e)}};return s},w=t=>{const i=r,s=e.stringToBytes(t),n={getMode:()=>i,getLength:e=>s.length,write:e=>{for(let t=0;t<s.length;t+=1)e.put(s[t],8)}};return n},S=t=>{const i=s,r=e.stringToBytesFuncs.SJIS;if(!r)throw new Error("sjis not supported.");((e,t)=>{const i=r("");if(2!==i.length||38726!=(i[0]<<8|i[1]))throw new Error("sjis not supported.")})();const n=r(t),a={getMode:()=>i,getLength:e=>~~(n.length/2),write:e=>{const t=n;let i=0;for(;i+1<t.length;){let r=(255&t[i])<<8|255&t[i+1];if(33088<=r&&r<=40956)r-=33088;else{if(!(57408<=r&&r<=60351))throw new Error("illegal char at "+(i+1)+"/"+r);r-=49472}r=192*(r>>>8&255)+(255&r),e.put(r,13),i+=2}if(i<t.length)throw new Error("illegal char at "+(i+1))}};return a},E=e=>{const t=e;let i=0,r=0,s=0;const n={read:()=>{for(;s<8;){if(i>=t.length){if(0===s)return-1;throw new Error("unexpected end of file./"+s)}const e=t.charAt(i);if(i+=1,"="===e)return s=0,-1;e.match(/^\s$/)||(r=r<<6|a(e.charCodeAt(0)),s+=6)}const e=r>>>s-8&255;return s-=8,e}},a=e=>{if(65<=e&&e<=90)return e-65;if(97<=e&&e<=122)return e-97+26;if(48<=e&&e<=57)return e-48+52;if(43===e)return 62;if(47===e)return 63;throw new Error("c:"+e)};return n};return e})();r.stringToBytesFuncs["UTF-8"]=e=>function(e){const t=[];for(let i=0;i<e.length;i++){let r=e.charCodeAt(i);r<128?t.push(r):r<2048?t.push(192|r>>6,128|63&r):r<55296||r>=57344?t.push(224|r>>12,128|r>>6&63,128|63&r):(i++,r=65536+((1023&r)<<10|1023&e.charCodeAt(i)),t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r))}return t}(e),t.default=r},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(5));class n extends s.default{constructor(){super(),this.module=6,this._CommandInit=0,this._CommandDeinit=1,this._CommandWrite=2,this._CommandRead=3,this._CommandSlvWritten=4}initMaster(e,t){const i=parseInt(e.sda),r=parseInt(e.scl),s=parseInt(e.clock),n=new Uint8Array(8);n[0]=t,n[1]=0,n[2]=i,n[3]=r,n[4]=s>>24,n[5]=s>>16,n[6]=s>>8,n[7]=s,this.sendCommand(this._CommandInit,n)}initSlave(e,t){const i=parseInt(e.sda),r=parseInt(e.scl);let s=e.slave_address_length;const n=e.slave_address;n>127&&(s=10);const a=new Uint8Array(11);a[0]=t,a[1]=1,a[2]=i,a[3]=r,a[4]=0,a[5]=0,a[6]=0,a[7]=0,a[8]=s,a[9]=n>>8,a[10]=n,this.sendCommand(this._CommandInit,a)}deinit(e,t){const i=new Uint8Array([t]);this.sendCommand(this._CommandDeinit,i)}write(e,t){let i=parseInt(e.address);(10===e.address_bits||i>127)&&(i|=32768);const r=new Uint8Array(3+e.data.length);r[0]=t,r[1]=i>>8,r[2]=i,r.set(e.data,3),this.sendCommand(this._CommandWrite,r)}read(e,t){let i=parseInt(e.address);(10===e.address_bits||i>127)&&(i|=32768);const r=e.read,s=new Uint8Array(7);s[0]=t,s[1]=i>>8,s[2]=i,s[3]=r>>24,s[4]=r>>16,s[5]=r>>8,s[6]=r,this.sendCommand(this._CommandRead,s)}parseFromJson(e){for(let t=0;t<2;t++){const i=e["i2c"+t];if(void 0===i)continue;const r=[{uri:"/request/i2c/init_master",onValid:this.initMaster},{uri:"/request/i2c/init_slave",onValid:this.initSlave},{uri:"/request/i2c/write",onValid:this.write},{uri:"/request/i2c/read",onValid:this.read},{uri:"/request/i2c/deinit",onValid:this.deinit}],s=this.validateCommandSchema(r,i,"i2c"+t,t);if(0===s.valid)throw s.invalidButLike.length>0?new Error(s.invalidButLike[0].message):new this.WSCommandNotFoundError(`[i2c${t}]unknown command`)}}notifyFromBinary(e,t,i){if(t===this._CommandRead&&i.byteLength>3){const t=i[0],r=(i[1]<<8)+i[2],s=new Array(i.byteLength-3);for(let e=0;e<s.length;e++)s[e]=i[e+3];e["i2c"+t]={mode:"master",address:r,data:s}}else if(t===this._CommandSlvWritten&&i.byteLength>4){const t=i[0],r=(i[2]<<8)+i[3],s=new Array(i.byteLength-4);for(let e=0;e<s.length;e++)s[e]=i[e+4];e["i2c"+t]={mode:"slave",is_fragmented:!0,address:r,data:s}}else if(t===this.COMMAND_FUNC_ID_ERROR&&i.byteLength>2){const r=i[1],s=i[2];if(s===this._CommandWrite||s===this._CommandRead){let t=(s===this._CommandWrite?"writing":"reading")+" error. ";7===r?t+="Communication Timeout. Maybe, target is not connected.":255===r&&(t+="Communication Failed. Maybe, target is not connected."),this.envelopError(e,"i2c0",{message:t})}else super.notifyFromBinary(e,t,i)}else super.notifyFromBinary(e,t,i)}}t.default=n},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(5));class n extends s.default{constructor(){super(),this.module=10,this._CommandInit=0,this._CommandDeinit=1,this._CommandRecv=2}init(e){const t=e.io[0],i=1e3*e.interval,r=1e3*e.duration,s=parseInt(e.trigger.value),n=e.trigger.samples,a=new Uint8Array(12);a[0]=1,a[1]=t,a[2]=i>>24,a[3]=i>>16,a[4]=i>>8,a[5]=i,a[6]=r>>24,a[7]=r>>16,a[8]=r>>8,a[9]=r,a[10]=s,a[11]=n,this.sendCommand(this._CommandInit,a)}deinit(e){const t=new Uint8Array(0);this.sendCommand(this._CommandDeinit,t)}parseFromJson(e){const t=e.logic_analyzer;if(void 0===t)return;const i=[{uri:"/request/logicAnalyzer/init",onValid:this.init},{uri:"/request/logicAnalyzer/deinit",onValid:this.deinit}],r=this.validateCommandSchema(i,t,"logic_analyzer");if(0===r.valid)throw r.invalidButLike.length>0?new Error(r.invalidButLike[0].message):new this.WSCommandNotFoundError("[logic_analyzer]unknown command")}notifyFromBinary(e,t,i){if(t===this._CommandRecv){const t=new Array(8*i.byteLength);let r=0;for(let e=0;e<i.byteLength;e++){const s=i[e];for(let e=0;e<8;e++)t[r]=s&128>>>e?1:0,r++}e.logic_analyzer={data:t}}else super.notifyFromBinary(e,t,i)}}t.default=n},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(5));class n extends s.default{constructor(){super(),this.module=12,this._CommandMeasurementEcho=0}echo(e){const t=e.echo.io_pulse,i="negative"!==e.echo.pulse,r=Math.floor(1e3*e.echo.pulse_width),s=e.echo.io_echo,n=e.echo.measure_edges;let a=1e3*e.echo.timeout;a=parseInt(a);const o=new Uint8Array(13);o[0]=0,o[1]=t,o[2]=i?1:0,o[3]=r>>24,o[4]=r>>16,o[5]=r>>8,o[6]=r,o[7]=s,o[8]=n,o[9]=a>>24,o[10]=a>>16,o[11]=a>>8,o[12]=a,this.sendCommand(this._CommandMeasurementEcho,o)}parseFromJson(e){const t=e.measure;if(void 0===t)return;const i=[{uri:"/request/measure/echo",onValid:this.echo}],r=this.validateCommandSchema(i,t,"measure");if(0===r.valid)throw r.invalidButLike.length>0?new Error(r.invalidButLike[0].message):new this.WSCommandNotFoundError("[measure]unknown command")}notifyFromBinary(e,t,i){if(t===this._CommandMeasurementEcho){let t=0;const r=parseInt(i[t++]),s=[];for(let e=0;e<r;e++){let e;const r=i[t++]>0;e=i[t++]<<24,e+=i[t++]<<16,e+=i[t++]<<8,e+=i[t++],e/=1e3,s.push({edge:r,timing:e})}e.measure={echo:s}}else super.notifyFromBinary(e,t,i)}}t.default=n},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(5));class n extends s.default{constructor(){super(),this.module=5,this._CommandInit=0,this._CommandDeinit=1,this._CommandWriteRead=2,this._CommandWrite=3}initMaster(e,t){let i=e.clk,r=e.mosi,s=e.miso,n=e.cs;const a=e.clock;if(null===i&&null===r&&null===s)throw new Error("spi: master mode require one of clk/mosi/miso");null===i&&(i=this.ioNotUsed),null===r&&(r=this.ioNotUsed),null===s&&(s=this.ioNotUsed),null===n&&(n=this.ioNotUsed);const o=new Uint8Array(11);o[0]=t,o[1]=0,o[2]=i,o[3]=r,o[4]=s,o[5]=this.ioNotUsed,o[6]=this.ioNotUsed,o[7]=a>>24,o[8]=a>>16,o[9]=a>>8,o[10]=a,o[11]=n,this.sendCommand(this._CommandInit,o)}deinit(e,t){const i=new Uint8Array([t]);this.sendCommand(this._CommandDeinit,i)}write(e,t){const i=new Uint8Array(1+e.data.length);i[0]=t,i.set(e.data,1),e.read?this.sendCommand(this._CommandWriteRead,i):this.sendCommand(this._CommandWrite,i)}parseFromJson(e){for(let t=0;t<2;t++){const i=e["spi"+t];if(void 0===i)continue;const r=[{uri:"/request/spi/init_master",onValid:this.initMaster},{uri:"/request/spi/write",onValid:this.write},{uri:"/request/spi/deinit",onValid:this.deinit}],s=this.validateCommandSchema(r,i,"spi"+t,t);if(0===s.valid)throw s.invalidButLike.length>0?new Error(s.invalidButLike[0].message):new this.WSCommandNotFoundError(`[spi${t}]unknown command`)}}notifyFromBinary(e,t,i){if(t===this._CommandWriteRead&&i.byteLength>1){const t=i[0],r=new Array(i.byteLength-1);for(let e=0;e<r.length;e++)r[e]=i[e+1];e["spi"+t]={data:r}}else super.notifyFromBinary(e,t,i)}}t.default=n},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(5));class n extends s.default{constructor(){super(),this.module=9,this._CommandNotifyValue=0,this._CommandOnece=1}get(e){const t=new Uint8Array(0);this.sendCommand(this._CommandOnece,t)}parseFromJson(e){const t=e.switch;if(void 0===t)return;const i=[{uri:"/request/switch/get",onValid:this.get}],r=this.validateCommandSchema(i,t,"switch");if(0===r.valid)throw r.invalidButLike.length>0?new Error(r.invalidButLike[0].message):new this.WSCommandNotFoundError("[switch]unknown command")}notifyFromBinary(e,t,i){if(t!==this._CommandOnece&&t!==this._CommandNotifyValue||1!==i.byteLength)super.notifyFromBinary(e,t,i);else{const r=parseInt(i[0]),s=["none","push","left","right"];e.switch={state:s[r]},t===this._CommandOnece&&(e.switch.action="get")}}}t.default=n},function(e,t,i){"use strict";(function(e){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(5));class n extends s.default{constructor(){super(),this.module=0,this._CommandReboot=0,this._CommandReset=2,this._CommandSelfCheck=3,this._CommandWait=4,this._CommandResetOnDisconnect=5,this._CommandPingPong=8,this._CommandVCC=9,this._CommandSleepSeconds=10,this._CommandSleepMinute=11,this._CommandSleepIoTrigger=12}reboot(e){this.sendCommand(this._CommandReboot,null)}reset(e){this.sendCommand(this._CommandReset,null)}selfCheck(e){this.sendCommand(this._CommandSelfCheck,null)}wait(e){const t=e.wait,i=new Uint8Array([t>>8,t]);this.sendCommand(this._CommandWait,i)}keepWorkingAtOffline(e){this.resetOnDisconnect(!e.keep_working_at_offline)}ping(e){const t=(new Date).getTime(),i=new Uint8Array(e.ping.key.length+8),r=Math.floor(t/Math.pow(2,32)),s=t-r*Math.pow(2,32);i[0]=r>>24,i[1]=r>>16,i[2]=r>>8,i[3]=r>>0,i[4]=s>>24,i[5]=s>>16,i[6]=s>>8,i[7]=s>>0;for(let t=0;t<e.ping.key.length;t++)i[8+t]=e.ping.key[t];this.sendCommand(this._CommandPingPong,i)}resetOnDisconnect(e){const t=new Uint8Array([e?1:0]);this.sendCommand(this._CommandResetOnDisconnect,t)}parseFromJson(e){const t=e.system;if(void 0===t)return;const i=[{uri:"/request/system/reboot",onValid:this.reboot},{uri:"/request/system/reset",onValid:this.reset},{uri:"/request/system/wait",onValid:this.wait},{uri:"/request/system/selfCheck",onValid:this.selfCheck},{uri:"/request/system/keepWorkingAtOffline",onValid:this.keepWorkingAtOffline},{uri:"/request/system/ping",onValid:this.ping},{uri:"/request/system/sleepSeconds",onValid:this.sleepSeconds},{uri:"/request/system/sleepMinute",onValid:this.sleepMinute},{uri:"/request/system/sleepIoTrigger",onValid:this.sleepIoTrigger}],r=this.validateCommandSchema(i,t,"system");if(0===r.valid)throw r.invalidButLike.length>0?new Error(r.invalidButLike[0].message):new this.WSCommandNotFoundError("[system]unknown command")}pong(t,i){t.system=t.system||{};const r=(new Date).getTime();if(i.length>=16){const s=(i=e.from(i)).readUIntBE(0,4)*Math.pow(2,32)+i.readUIntBE(4,4),n=i.readUIntBE(8,4)*Math.pow(2,32)+i.readUIntBE(12,4),a=[];for(let e=16;e<i.length;e++)a.push(i[e]);t.system.pong={key:a,obnizTime:s,pingServerTime:n,pongServerTime:r}}else t.system.pong={pongServerTime:r}}notifyFromBinary(e,t,i){switch(t){case this._CommandVCC:if(3===i.byteLength){let t=(i[1]<<8)+i[2];t/=100,this.envelopWarning(e,"debug",{message:`Low Voltage ${t}v. connect obniz to more powerful USB.`})}break;case this._CommandPingPong:this.pong(e,i);break;default:super.notifyFromBinary(e,t,i)}}sleepSeconds(e){const t=e.sleep_seconds,i=new Uint8Array([t>>8,t]);this.sendCommand(this._CommandSleepSeconds,i)}sleepMinute(e){const t=e.sleep_minute,i=new Uint8Array([t>>8,t]);this.sendCommand(this._CommandSleepMinute,i)}sleepIoTrigger(e){let t=e.sleep_io_trigger;t=!0===t?1:0;const i=new Uint8Array([t]);this.sendCommand(this._CommandSleepIoTrigger,i)}}t.default=n}).call(this,i(0).Buffer)},function(e,t,i){"use strict";(function(e){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(5));class n extends s.default{constructor(){super(),this.module=13,this._MaxPort=8,this._CommandConnect=0,this._CommandClose=1,this._CommandConnection=2,this._CommandWrite=3,this._CommandRead=4}connect(t,i){const r=new Uint8Array(e.from(t.connect.domain,"utf8")),s=new Uint8Array(r.length+3);s[0]=i,s[1]=t.connect.port>>8,s[2]=t.connect.port;for(let e=0;e<r.length;e++)s[3+e]=r[e];this.sendCommand(this._CommandConnect,s)}disconnect(e,t){const i=new Uint8Array([t]);this.sendCommand(this._CommandClose,i)}write(e,t){const i=new Uint8Array(e.write.data.length+1);i[0]=t;for(let t=0;t<e.write.data.length;t++)i[1+t]=e.write.data[t];this.sendCommand(this._CommandWrite,i)}parseFromJson(e){for(let t=0;t<this._MaxPort;t++){const i=e["tcp"+t];if(void 0===i)continue;const r=[{uri:"/request/tcp/connect",onValid:this.connect},{uri:"/request/tcp/disconnect",onValid:this.disconnect},{uri:"/request/tcp/write",onValid:this.write}],s=this.validateCommandSchema(r,i,"tcp"+t,t);if(0===s.valid)throw s.invalidButLike.length>0?new Error(s.invalidButLike[0].message):new this.WSCommandNotFoundError(`[tcp${t}]unknown command`)}}notifyFromBinary(e,t,i){switch(t){case this._CommandConnect:{let t="Error";switch(i[1]){case 0:t="ok";break;case 1:t="Port Used";break;case 2:t="Port Area Error";break;case 3:t="Lookup Error";break;case 4:t="Error"}e["tcp"+i[0]]={connect:{message:t,code:i[1]}};break}case this._CommandConnection:if(2===i.length&&0===i[1]){e["tcp"+i[0]]={connection:{connected:!0}}}else{e["tcp"+i[0]]={connection:{connected:!1}}}break;case this._CommandRead:if(i.length>=1){const t=i[0],r=new Array(i.byteLength-1);for(let e=0;e<r.length;e++)r[e]=i[e+1];e["tcp"+t]={read:{data:r}}}}}}t.default=n}).call(this,i(0).Buffer)},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(5));class n extends s.default{constructor(){super(),this.module=4,this._CommandInit=0,this._CommandDeinit=1,this._CommandSend=2,this._CommandRecv=3}init(e,t){const i=new Uint8Array(13);if(i[0]=t,i[1]=parseInt(e.tx),i[2]=parseInt(e.rx),i[3]=e.baud>>24,i[4]=e.baud>>16,i[5]=e.baud>>8,i[6]=e.baud,1===e.stop)i[7]=1;else if(1.5===e.stop)i[7]=2;else if(2===e.stop)i[7]=3;else{if(0!==e.stop)throw new Error("uart: invalid stop bits");i[7]=0}i[8]=e.bits,"even"===e.parity?i[9]=2:"odd"===e.parity&&(i[9]=3),"rts"===e.flowcontrol?i[10]=2:"cts"===e.flowcontrol?i[10]=3:"rts-cts"===e.flowcontrol&&(i[10]=4),null!==e.rts&&(i[11]=e.rts),null!==e.cts&&(i[12]=e.cts),this.sendCommand(this._CommandInit,i)}deinit(e,t){const i=new Uint8Array(1);i[0]=t,this.sendCommand(this._CommandDeinit,i)}send(e,t){const i=new Uint8Array(1+e.data.length);i[0]=t,i.set(e.data,1),this.sendCommand(this._CommandSend,i)}parseFromJson(e){for(let t=0;t<3;t++){const i=e["uart"+t];if(void 0===i)continue;const r=[{uri:"/request/uart/init",onValid:this.init},{uri:"/request/uart/send",onValid:this.send},{uri:"/request/uart/deinit",onValid:this.deinit}],s=this.validateCommandSchema(r,i,"uart"+t,t);if(0===s.valid)throw s.invalidButLike.length>0?new Error(s.invalidButLike[0].message):new this.WSCommandNotFoundError(`[uart${t}]unknown command`)}}notifyFromBinary(e,t,i){if(t===this._CommandRecv&&i.byteLength>1){const t=i[0],r=new Array(i.byteLength-1);for(let e=0;e<r.length;e++)r[e]=i[e+1];e["uart"+t]={data:r}}else super.notifyFromBinary(e,t,i)}}t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{static getDefinitionFor(e){return"obnizb1"===e?i(432):"obnizb2"===e?i(433):"esp32w"===e?i(434):"esp32p"===e?i(435):"m5stickc"===e?i(436):"encored"===e?i(437):void 0}}},function(e){e.exports=JSON.parse('{"rev":"2","hw":"obnizb1","peripherals":{"io":{"units":{"0":{},"1":{},"2":{},"3":{},"4":{},"5":{},"6":{},"7":{},"8":{},"9":{},"10":{},"11":{}}},"ad":{"units":{"0":{},"1":{},"2":{},"3":{},"4":{},"5":{},"6":{},"7":{},"8":{},"9":{},"10":{},"11":{}}},"pwm":{"units":{"0":{},"1":{},"2":{},"3":{},"4":{},"5":{}}},"uart":{"units":{"0":{},"1":{}}},"spi":{"units":{"0":{},"1":{}}},"i2c":{"units":{"0":{}}}},"embeds":{"ble":{},"display":{"paper_white":false,"raw_alternate":false,"width":128,"height":64,"color_depth":[1]},"switch":{}},"protocol":{"tcp":{"units":{"0":{},"1":{},"2":{},"3":{},"4":{},"5":{},"6":{},"7":{}}}}}')},function(e){e.exports=JSON.parse('{"rev":"2","hw":"obnizb2","peripherals":{"io":{"units":{"0":{},"1":{},"2":{},"3":{},"4":{},"5":{},"6":{},"7":{},"8":{},"9":{},"10":{},"11":{}}},"ad":{"units":{"0":{},"1":{},"2":{},"3":{},"4":{},"5":{},"6":{},"7":{},"8":{},"9":{},"10":{},"11":{}}},"pwm":{"units":{"0":{},"1":{},"2":{},"3":{},"4":{},"5":{}}},"uart":{"units":{"0":{},"1":{}}},"spi":{"units":{"0":{},"1":{}}},"i2c":{"units":{"0":{}}}},"embeds":{"ble":{},"display":{"paper_white":true,"raw_alternate":true,"width":128,"height":64,"color_depth":[1]},"switch":{}},"protocol":{"tcp":{"units":{"0":{},"1":{},"2":{},"3":{},"4":{},"5":{},"6":{},"7":{}}}}}')},function(e){e.exports=JSON.parse('{"rev":"2","hw":"esp32w","peripherals":{"io":{"units":{"0":{},"2":{},"4":{},"5":{},"12":{},"13":{},"14":{},"15":{},"16":{},"17":{},"18":{},"19":{},"21":{},"22":{},"23":{},"25":{},"26":{},"27":{},"32":{},"33":{},"34":{},"35":{},"36":{},"37":{},"38":{},"39":{}}},"ad":{"units":{"32":{},"33":{},"34":{},"35":{},"36":{},"39":{}}},"pwm":{"units":{"0":{},"1":{},"2":{},"3":{},"4":{},"5":{}}},"uart":{"units":{"0":{},"1":{}}},"spi":{"units":{"0":{},"1":{}}},"i2c":{"units":{"0":{}}}},"embeds":{"ble":{}},"protocol":{"tcp":{"units":{"0":{},"1":{},"2":{},"3":{},"4":{},"5":{},"6":{},"7":{}}}}}')},function(e){e.exports=JSON.parse('{"rev":"2","hw":"esp32w","peripherals":{"io":{"units":{"0":{},"2":{},"4":{},"5":{},"9":{},"10":{},"12":{},"13":{},"14":{},"15":{},"18":{},"19":{},"21":{},"22":{},"23":{},"25":{},"26":{},"27":{},"32":{},"33":{},"34":{},"35":{},"36":{},"37":{},"38":{},"39":{}}},"ad":{"units":{"32":{},"33":{},"34":{},"35":{},"36":{},"37":{},"38":{},"39":{}}},"pwm":{"units":{"0":{},"1":{},"2":{},"3":{},"4":{},"5":{}}},"uart":{"units":{"0":{},"1":{}}},"spi":{"units":{"0":{},"1":{}}},"i2c":{"units":{"0":{}}}},"embeds":{"ble":{}},"protocol":{"tcp":{"units":{"0":{},"1":{},"2":{},"3":{},"4":{},"5":{},"6":{},"7":{}}}}}')},function(e){e.exports=JSON.parse('{"rev":"3","hw":"m5stickc","peripherals":{"io":{"units":{"0":{},"9":{},"10":{},"21":{},"22":{},"26":{},"27":{},"32":{},"33":{},"34":{},"35":{},"36":{},"37":{},"39":{}}},"ad":{"units":{"32":{},"33":{},"34":{},"35":{},"36":{}}},"pwm":{"units":{"0":{},"1":{},"2":{},"3":{},"4":{},"5":{}}},"uart":{"units":{"0":{},"1":{}}},"spi":{"units":{"0":{},"1":{}}},"i2c":{"units":{"0":{},"1":{}}},"grove":{"units":{"0":{"pin1":33,"pin2":32}}}},"embeds":{"ble":{},"display":{"paper_white":true,"raw_alternate":false,"width":160,"height":80,"color_depth":[1,4,16]}},"protocol":{"tcp":{"units":{"0":{},"1":{},"2":{},"3":{},"4":{},"5":{},"6":{},"7":{}}}}}')},function(e){e.exports=JSON.parse('{"rev":"2","hw":"encored","peripherals":{"io":{"units":{"0":{},"25":{},"26":{},"27":{}}},"ad":{"units":{}},"pwm":{"units":{"0":{},"1":{},"2":{},"3":{},"4":{},"5":{}}},"uart":{"units":{"0":{},"1":{}}},"spi":{"units":{"0":{},"1":{}}},"i2c":{"units":{"0":{}}}},"embeds":{"ble":{}},"protocol":{"tcp":{"units":{"0":{},"1":{},"2":{},"3":{},"4":{},"5":{},"6":{},"7":{}}}}}')},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e,t,i){this.used=!1,this._current={},this.Obniz=e,this.no=t,this._params=i,this._reset()}getDigital(e="5v"){return this.useWithType("digital",e),{primary:this.Obniz.isValidIO(this._params.pin1)?this.Obniz.getIO(this._params.pin1):void 0,secondary:this.Obniz.isValidIO(this._params.pin2)?this.Obniz.getIO(this._params.pin2):void 0}}getAnalog(e="5v"){return this.useWithType("analog",e),{primary:this.Obniz.isValidAD(this._params.pin1)?this.Obniz.getAD(this._params.pin1):void 0,secondary:this.Obniz.isValidAD(this._params.pin2)?this.Obniz.getAD(this._params.pin2):void 0}}getI2c(e,t="5v"){return this.useWithType("i2c",t),this._current.i2c||(this._current.i2c=this.Obniz.getI2CWithConfig({mode:"master",sda:this._params.pin2,scl:this._params.pin1,clock:e})),this._current.i2c}getUart(e,t="5v"){return this.useWithType("uart",t),this._current.uart=this.Obniz.getFreeUart(),this._current.uart.start({rx:1,tx:2,baud:e}),this._current.uart}_reset(){}end(){this.used=!1,this._current.uart&&this._current.uart.end(),this._current.i2c&&this._current.i2c.end(),"analog"===this._current.type&&(this.Obniz.isValidAD(this._params.pin1)&&this.Obniz.getAD(this._params.pin1).end(),this.Obniz.isValidAD(this._params.pin2)&&this.Obniz.getAD(this._params.pin2).end()),this._current={}}notified(e){}useWithType(e,t){if(this.used&&("i2c"!==this._current.type||this._current.drive!==t))throw new Error("Grove pins are already used.");this.used=!0,this._current.type=e,this._current.drive=t,this.Obniz.setVccGnd(this._params.vcc,this._params.gnd,t),this.Obniz.isValidIO(this._params.pin1)&&this.Obniz.getIO(this._params.pin1).drive(t),this.Obniz.isValidIO(this._params.pin2)&&this.Obniz.getIO(this._params.pin2).drive(t)}}},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(440)),n=r(i(105));t.default=class{constructor(e,t){this.id=e,t=t||{},this.options={access_token:t.access_token||null,obniz_server:t.obniz_server||"https://obniz.io"},this.urlBase=this.options.obniz_server+"/obniz/"+this.id}get apiVersion(){return n.default.version.split(".").shift()}getState(e){return this.post("/state",null,e)}postJson(e,t){return this.post("/api/"+this.apiVersion,e,t)}post(e,t,i){const r=this.urlBase+e,n={"Content-Type":"application/json"};this.options.access_token&&(n.authorization="Bearer "+this.options.access_token);const a={method:"POST",headers:n};return t&&(a.body=JSON.stringify(t)),s.default(r,a).then(e=>e.json()).then(e=>("function"==typeof i&&i(e),new Promise(t=>{t(e)})))}}},function(e,t,i){"use strict";var r=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==r)return r;throw new Error("unable to locate global object")}();e.exports=t=r.fetch,t.default=r.fetch.bind(r),t.Headers=r.Headers,t.Request=r.Request,t.Response=r.Response},function(e,t){function i(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}i.keys=function(){return[]},i.resolve=i,e.exports=i,i.id=441},function(e,t,i){var r={"./ADConverter/hx711/index.js":443,"./Accessory/USB/index.js":444,"./Biological/PULSE08-M5STICKC-S/index.js":445,"./Ble/2jcie/index.js":446,"./Camera/ArduCAMMini/index.js":447,"./Camera/JpegSerialCam/index.js":448,"./ColorSensor/PT550/index.js":449,"./ColorSensor/S11059/index.js":450,"./Display/7SegmentLED/index.js":451,"./Display/7SegmentLEDArray/index.js":452,"./Display/7SegmentLED_MAX7219/index.js":453,"./Display/MatrixLED_MAX7219/index.js":454,"./Display/ST7735S/index.js":455,"./Display/SainSmartTFT18LCD/index.js":456,"./Display/SharpMemoryTFT/index.js":457,"./DistanceSensor/GP2Y0A21YK0F/index.js":458,"./DistanceSensor/HC-SR04/index.js":459,"./GPS/GYSFDMAXB/index.js":460,"./GasSensor/MQ135/index.js":461,"./GasSensor/MQ2/index.js":462,"./GasSensor/MQ3/index.js":463,"./GasSensor/MQ4/index.js":464,"./GasSensor/MQ5/index.js":465,"./GasSensor/MQ6/index.js":466,"./GasSensor/MQ7/index.js":467,"./GasSensor/MQ8/index.js":468,"./GasSensor/MQ9/index.js":469,"./GasSensor/MQGas/index.js":12,"./Grove/Grove_3AxisAccelerometer/index.js":470,"./Grove/Grove_Button/index.js":471,"./Grove/Grove_Buzzer/index.js":472,"./Grove/Grove_EarHeartRate/index.js":473,"./Grove/Grove_GPS/index.js":474,"./Grove/Grove_MP3/index.js":475,"./GyroSensor/ENC03R_Module/index.js":476,"./Infrared/IRModule/index.js":477,"./Infrared/IRSensor/index.js":478,"./Infrared/InfraredLED/index.js":479,"./Infrared/YG1006/index.js":480,"./Light/FullColorLED/index.js":481,"./Light/LED/index.js":482,"./Light/WS2811/index.js":483,"./Light/WS2812/index.js":484,"./Light/WS2812B/index.js":485,"./Logic/SNx4HC595/index.js":486,"./Magnet/CT10/index.js":487,"./Magnet/HMC5883L/index.js":488,"./Memory/24LC256/index.js":489,"./MovementSensor/AK8963/index.js":490,"./MovementSensor/Button/index.js":491,"./MovementSensor/FlickHat/index.js":492,"./MovementSensor/HC-SR505/index.js":493,"./MovementSensor/IPM-165/index.js":494,"./MovementSensor/JoyStick/index.js":495,"./MovementSensor/KXR94-2050/index.js":496,"./MovementSensor/KXSC7-2050/index.js":497,"./MovementSensor/MPU6050/index.js":498,"./MovementSensor/MPU6886/index.js":499,"./MovementSensor/MPU9250/index.js":500,"./MovementSensor/PaPIRsVZ/index.js":501,"./MovementSensor/Potentiometer/index.js":502,"./MovementSensor/SH200Q/index.js":503,"./Moving/DCMotor/index.js":504,"./Moving/PCA9685/index.js":505,"./Moving/ServoMotor/index.js":506,"./Moving/Solenoid/index.js":507,"./Moving/StepperMotor/index.js":508,"./Power/AXP192/index.js":509,"./PressureSensor/DPS310/index.js":510,"./PressureSensor/FSR-40X/index.js":511,"./SoilSensor/SEN0114/index.js":512,"./Sound/Speaker/index.js":513,"./TemperatureSensor/analog/AnalogTemperatureSensor.js":15,"./TemperatureSensor/analog/LM35DZ/index.js":514,"./TemperatureSensor/analog/LM60/index.js":515,"./TemperatureSensor/analog/LM61/index.js":516,"./TemperatureSensor/analog/LMT87/index.js":517,"./TemperatureSensor/analog/MCP9700/index.js":518,"./TemperatureSensor/analog/MCP9701/index.js":519,"./TemperatureSensor/analog/S8100B/index.js":520,"./TemperatureSensor/analog/S8120C/index.js":521,"./TemperatureSensor/i2c/ADT7410/index.js":522,"./TemperatureSensor/i2c/AM2320/index.js":523,"./TemperatureSensor/i2c/AMG8833/index.js":524,"./TemperatureSensor/i2c/BME280/index.js":525,"./TemperatureSensor/i2c/D6T44L/index.js":526,"./TemperatureSensor/i2c/DHT12/index.js":527,"./TemperatureSensor/i2c/S-5851A/index.js":528,"./TemperatureSensor/i2c/SHT31/index.js":529,"./TemperatureSensor/spi/ADT7310/index.js":530,"./Wireless/MFRC522/index.js":531,"./Wireless/RN42/index.js":532,"./Wireless/XBee/index.js":533,"./i2cParts.js":37};function s(e){var t=n(e);return i(t)}function n(e){if(!i.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}s.keys=function(){return Object.keys(r)},s.resolve=n,e.exports=s,s.id=442},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.keys=["vcc","gnd","sck","dout"],this.requiredKeys=["sck","dout"],this._offset=0,this._scale=1}static info(){return{name:"hx711"}}wired(e){this.obniz=e,this.spi=e.getFreeSpi(),e.setVccGnd(this.params.vcc,this.params.gnd,"5v");const t=["clk","dout"];for(const e of t)if(this.params[e]&&!this.obniz.isValidIO(this.params[e]))throw new Error("spi start param '"+e+"' are to be valid io no");this.sck=e.getIO(this.params.sck),this.dout=e.getIO(this.params.dout),this.sck.output(!0),e.wait(500)}readWait(){return r(this,void 0,void 0,(function*(){for(this.sck.output(!1);;){if(!1===(yield this.dout.inputWait()))break}this.spi.start({mode:"master",mosi:this.params.sck,miso:this.params.dout,frequency:5e5});const e=yield this.spi.writeWait([170,170,170,170,170,170,128]);this.spi.end(!0),this.sck.output(!1);const t=[this.doubleBit2singleBit(e[0],e[1]),this.doubleBit2singleBit(e[2],e[3]),this.doubleBit2singleBit(e[4],e[5])];return(0==(128&t[0])?1:-1)*(((127&t[0])<<16)+(t[1]<<8)+(t[2]<<0))}))}doubleBit2singleBit(e,t){return this.bit(e,7)<<7|this.bit(e,5)<<6|this.bit(e,3)<<5|this.bit(e,1)<<4|this.bit(t,7)<<3|this.bit(t,5)<<2|this.bit(t,3)<<1|this.bit(t,1)<<0}bit(e,t){return e&1<<t?1:0}readAverageWait(e){return r(this,void 0,void 0,(function*(){const t=[];for(let i=0;i<e;i++)t.push(yield this.readWait());return t.reduce((e,t,i)=>e+t,0)/t.length}))}powerDown(){this.sck.output(!0)}powerUp(){this.sck.output(!1)}zeroAdjustWait(e){return r(this,void 0,void 0,(function*(){e=parseInt(e)||1,this._offset=yield this.readAverageWait(e)}))}getValueWait(e){return r(this,void 0,void 0,(function*(){return e=parseInt(e)||1,((yield this.readAverageWait(e))-this._offset)/this._scale}))}setOffset(e){if("number"!=typeof e)throw new Error("offset variable is Number");this._offset=e}setScale(e){if("number"!=typeof e)throw new Error("scale variable is Number");this._scale=e}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.keys=["vcc","gnd"],this.requiredKeys=["vcc","gnd"],this.displayIoNames={vcc:"vcc",gnd:"gnd"}}static info(){return{name:"USB"}}wired(e){this.obniz=e,this.io_vdd=e.getIO(this.params.vcc),this.io_gnd=e.getIO(this.params.gnd),this.io_gnd.output(!1)}on(){this.io_vdd.output(!0)}off(){this.io_vdd.output(!1)}}},function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.keys=["vcc","gnd","tx","rx"],this.requiredKeys=["tx","rx"],this.delimiter=10}static info(){return{name:"Puls08M5stickcS"}}onbpmupdate(e){}onrawupdate(e){}wired(e){this.obniz=e,e.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.uart=e.getFreeUart(),this.uart.start({tx:this.params.tx,rx:this.params.rx,baud:19200}),this.receivingData=[],this.init(),this.uart.onreceive=(e,t)=>{const i=[];e.forEach(e=>{if(e===this.delimiter){const e=this.receivingData;if(e[0]==="#".charCodeAt(0)){e[0]=" ".charCodeAt(0);const t=this.decode(e),i=parseInt(t),r=i>0?6e4/i:null;this.onbpmupdate(r)}else{const t=this.decode(e),r=parseInt(t);i.push(r)}this.receivingData=[]}else this.receivingData.push(e)}),i.length>0&&this.onrawupdate(i)}}decode(t){return e.from(t).toString("utf8")}init(){this.uart.send("@OF30"),this.uart.send(10),this.uart.send("@RG2"),this.uart.send(10)}}}).call(this,i(0).Buffer)},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.keys=[],this.requiredKeys=[],this.periperal=null}static info(){return{name:"2JCIE"}}wired(e){this.obniz=e}findWait(){return r(this,void 0,void 0,(function*(){return this.periperal=yield this.obniz.ble.scan.startOneWait({localName:"Env"}),this.periperal}))}omron_uuid(e){return`0C4C${e}-7700-46F4-AA96D5E974E32A54`}connectWait(){return r(this,void 0,void 0,(function*(){if(this.periperal||(yield this.findWait()),!this.periperal)throw new Error("2JCIE not found");this.periperal.connected||(yield this.periperal.connectWait())}))}disconnectWait(){return r(this,void 0,void 0,(function*(){this.periperal&&this.periperal.connected&&this.periperal.disconnectWait()}))}signedNumberFromBinary(e){let t=127&e[e.length-1];for(let i=e.length-2;i>=0;i--)t=256*t+e[i];return 0!=(128&e[e.length-1])&&(t-=Math.pow(2,8*e.length-1)),t}unsignedNumberFromBinary(e){let t=e[e.length-1];for(let i=e.length-2;i>=0;i--)t=256*t+e[i];return t}getLatestData(){return r(this,void 0,void 0,(function*(){yield this.connectWait();const e=this.periperal.getService(this.omron_uuid("3000")).getCharacteristic(this.omron_uuid("3001")),t=yield e.readWait();return{row_number:t[0],temperature:.01*this.signedNumberFromBinary(t.slice(1,3)),relative_humidity:.01*this.signedNumberFromBinary(t.slice(3,5)),light:1*this.signedNumberFromBinary(t.slice(5,7)),uv_index:.01*this.signedNumberFromBinary(t.slice(7,9)),barometric_pressure:.1*this.signedNumberFromBinary(t.slice(9,11)),soud_noise:.01*this.signedNumberFromBinary(t.slice(11,13)),discomfort_index:.01*this.signedNumberFromBinary(t.slice(13,15)),heatstroke_risk_factor:.01*this.signedNumberFromBinary(t.slice(15,17)),battery_voltage:.001*this.unsignedNumberFromBinary(t.slice(17,19))}}))}}},function(e,t,i){"use strict";(function(e){var i=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.keys=["cs","mosi","miso","sclk","gnd","vcc","sda","scl","spi","i2c","spi_frequency","spi_drive","module_version"],this.requiredKeys=["cs"],this.ioKeys=this.keys,this.displayName="Cam",this.regs={ARDUCHIP_TEST1:0,ARDUCHIP_MODE:2,ARDUCHIP_FIFO:4,BURST_FIFO_READ:60,ARDUCHIP_TRIG:65,FIFO_SIZE1:66,FIFO_SIZE2:67,FIFO_SIZE3:68},this.configs={OV2640_JPEG_INIT:[[255,0],[44,255],[46,223],[255,1],[60,50],[17,4],[9,2],[4,40],[19,229],[20,72],[44,12],[51,120],[58,51],[59,251],[62,0],[67,17],[22,16],[57,146],[53,218],[34,26],[55,195],[35,0],[52,192],[54,26],[6,136],[7,192],[13,135],[14,65],[76,0],[72,0],[91,0],[66,3],[74,129],[33,153],[36,64],[37,56],[38,130],[92,0],[99,0],[97,112],[98,128],[124,5],[32,128],[40,48],[108,0],[109,128],[110,0],[112,2],[113,148],[115,193],[18,64],[23,17],[24,67],[25,0],[26,75],[50,9],[55,192],[79,96],[80,168],[109,0],[61,56],[70,63],[79,96],[12,60],[255,0],[229,127],[249,192],[65,36],[224,20],[118,255],[51,160],[66,32],[67,24],[76,0],[135,213],[136,63],[215,3],[217,16],[211,130],[200,8],[201,128],[124,0],[125,0],[124,3],[125,72],[125,72],[124,8],[125,32],[125,16],[125,14],[144,0],[145,14],[145,26],[145,49],[145,90],[145,105],[145,117],[145,126],[145,136],[145,143],[145,150],[145,163],[145,175],[145,196],[145,215],[145,232],[145,32],[146,0],[147,6],[147,227],[147,5],[147,5],[147,0],[147,4],[147,0],[147,0],[147,0],[147,0],[147,0],[147,0],[147,0],[150,0],[151,8],[151,25],[151,2],[151,12],[151,36],[151,48],[151,40],[151,38],[151,2],[151,152],[151,128],[151,0],[151,0],[195,237],[164,0],[168,0],[197,17],[198,81],[191,128],[199,16],[182,102],[184,165],[183,100],[185,124],[179,175],[180,151],[181,255],[176,197],[177,148],[178,15],[196,92],[192,100],[193,75],[140,0],[134,61],[80,0],[81,200],[82,150],[83,0],[84,0],[85,0],[90,200],[91,150],[92,0],[211,0],[195,237],[127,0],[218,0],[229,31],[225,103],[224,0],[221,127],[5,0],[18,64],[211,4],[192,22],[193,18],[140,0],[134,61],[80,0],[81,44],[82,36],[83,0],[84,0],[85,0],[90,44],[91,36],[92,0],[255,255]],OV2640_YUV422:[[255,0],[5,0],[218,16],[215,3],[223,0],[51,128],[60,64],[225,119],[0,0],[255,255]],OV2640_JPEG:[[224,20],[225,119],[229,31],[215,3],[218,16],[224,0],[255,1],[4,8],[255,255]],OV2640_160x120_JPEG:[[255,1],[18,64],[23,17],[24,67],[25,0],[26,75],[50,9],[79,202],[80,168],[90,35],[109,0],[57,18],[53,218],[34,26],[55,195],[35,0],[52,192],[54,26],[6,136],[7,192],[13,135],[14,65],[76,0],[255,0],[224,4],[192,100],[193,75],[134,53],[80,146],[81,200],[82,150],[83,0],[84,0],[85,0],[87,0],[90,40],[91,30],[92,0],[224,0],[255,255]],OV2640_176x144_JPEG:[[255,1],[18,64],[23,17],[24,67],[25,0],[26,75],[50,9],[79,202],[80,168],[90,35],[109,0],[57,18],[53,218],[34,26],[55,195],[35,0],[52,192],[54,26],[6,136],[7,192],[13,135],[14,65],[76,0],[255,0],[224,4],[192,100],[193,75],[134,53],[80,146],[81,200],[82,150],[83,0],[84,0],[85,0],[87,0],[90,44],[91,36],[92,0],[224,0],[255,255]],OV2640_320x240_JPEG:[[255,1],[18,64],[23,17],[24,67],[25,0],[26,75],[50,9],[79,202],[80,168],[90,35],[109,0],[57,18],[53,218],[34,26],[55,195],[35,0],[52,192],[54,26],[6,136],[7,192],[13,135],[14,65],[76,0],[255,0],[224,4],[192,100],[193,75],[134,53],[80,137],[81,200],[82,150],[83,0],[84,0],[85,0],[87,0],[90,80],[91,60],[92,0],[224,0],[255,255]],OV2640_352x288_JPEG:[[255,1],[18,64],[23,17],[24,67],[25,0],[26,75],[50,9],[79,202],[80,168],[90,35],[109,0],[57,18],[53,218],[34,26],[55,195],[35,0],[52,192],[54,26],[6,136],[7,192],[13,135],[14,65],[76,0],[255,0],[224,4],[192,100],[193,75],[134,53],[80,137],[81,200],[82,150],[83,0],[84,0],[85,0],[87,0],[90,88],[91,72],[92,0],[224,0],[255,255]],OV2640_640x480_JPEG:[[255,1],[17,1],[18,0],[23,17],[24,117],[50,54],[25,1],[26,151],[3,15],[55,64],[79,187],[80,156],[90,87],[109,128],[61,52],[57,2],[53,136],[34,10],[55,64],[52,160],[6,2],[13,183],[14,1],[255,0],[224,4],[192,200],[193,150],[134,61],[80,137],[81,144],[82,44],[83,0],[84,0],[85,136],[87,0],[90,160],[91,120],[92,0],[211,4],[224,0],[255,255]],OV2640_800x600_JPEG:[[255,1],[17,1],[18,0],[23,17],[24,117],[50,54],[25,1],[26,151],[3,15],[55,64],[79,187],[80,156],[90,87],[109,128],[61,52],[57,2],[53,136],[34,10],[55,64],[52,160],[6,2],[13,183],[14,1],[255,0],[224,4],[192,200],[193,150],[134,53],[80,137],[81,144],[82,44],[83,0],[84,0],[85,136],[87,0],[90,200],[91,150],[92,0],[211,2],[224,0],[255,255]],OV2640_1024x768_JPEG:[[255,1],[17,1],[18,0],[23,17],[24,117],[50,54],[25,1],[26,151],[3,15],[55,64],[79,187],[80,156],[90,87],[109,128],[61,52],[57,2],[53,136],[34,10],[55,64],[52,160],[6,2],[13,183],[14,1],[255,0],[192,200],[193,150],[140,0],[134,61],[80,0],[81,144],[82,44],[83,0],[84,0],[85,136],[90,0],[91,192],[92,1],[211,2],[255,255]],OV2640_1280x960_JPEG:[[255,1],[17,1],[18,0],[23,17],[24,117],[50,54],[25,1],[26,151],[3,15],[55,64],[79,187],[80,156],[90,87],[109,128],[61,52],[57,2],[53,136],[34,10],[55,64],[52,160],[6,2],[13,183],[14,1],[255,0],[224,4],[192,200],[193,150],[134,61],[80,0],[81,144],[82,44],[83,0],[84,0],[85,136],[87,0],[90,64],[91,240],[92,1],[211,2],[224,0],[255,255]],OV2640_1600x1200_JPEG:[[255,1],[17,1],[18,0],[23,17],[24,117],[50,54],[25,1],[26,151],[3,15],[55,64],[79,187],[80,156],[90,87],[109,128],[61,52],[57,2],[53,136],[34,10],[55,64],[52,160],[6,2],[13,183],[14,1],[255,0],[224,4],[192,200],[193,150],[134,61],[80,0],[81,144],[82,44],[83,0],[84,0],[85,136],[87,0],[90,144],[91,44],[92,5],[211,2],[224,0],[255,255]]}}static info(){return{name:"ArduCAMMini"}}wired(e){this.obniz.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.io_cs=e.getIO(this.params.cs),this.io_cs.output(!0),e.wait(100),this.sensor_addr=48,this.params.module_version=this.params.module_version||0,this.params.mode=this.params.mode||"master",this.params.drive=this.params.spi_drive||"3v",this.params.frequency=this.params.spi_frequency||4e6,this.params.clk=this.params.sclk,this.spi=this.obniz.getSpiWithConfig(this.params),this.params.sda=this.params.sda,this.params.scl=this.params.scl,this.params.clock=this.params.clock||1e5,this.params.mode="master",this.params.pull="5v",this.i2c=e.getI2CWithConfig(this.params)}spi_write(e,t){const i=[];i.push(e),i.push(t),this.io_cs.output(!1),this.spi.write(i),this.io_cs.output(!0)}spi_readWait(e){return i(this,void 0,void 0,(function*(){const t=[];t.push(e),t.push(0),this.io_cs.output(!1);const i=yield this.spi.writeWait(t);return this.io_cs.output(!0),i[1]}))}i2c_byte_write(e,t){this.i2c.write(this.sensor_addr,[e,t])}i2c_regs_write(e){for(let t=0;t<e.length;t++)this.i2c.write(this.sensor_addr,e[t])}spi_write_reg(e,t){this.spi_write(128|e,t)}spi_read_regWait(e){return i(this,void 0,void 0,(function*(){return yield this.spi_readWait(127&e)}))}spi_pingpongWait(){return i(this,void 0,void 0,(function*(){if(this.spi_write_reg(this.regs.ARDUCHIP_TEST1,85),85!==(yield this.spi_read_regWait(this.regs.ARDUCHIP_TEST1)))throw new Error("spi bus fail")}))}setMode(e){const t={MCU2LCD:0,CAM2LCD:1,LCD2MCU:2};if("number"!=typeof t[e])throw new Error("unknown mode. options are "+t);this.spi_write_reg(this.regs.ARDUCHIP_MODE,t[e])}getChipIdWait(){return i(this,void 0,void 0,(function*(){this.i2c.write(this.sensor_addr,[10]);const e=yield this.i2c.readWait(this.sensor_addr,1);this.i2c.write(this.sensor_addr,[11]);const t=yield this.i2c.readWait(this.sensor_addr,1);return(e[0]<<8)+t[0]}))}init(){this.i2c_byte_write(255,1),this.i2c_byte_write(18,128),this.obniz.wait(100),this.i2c_regs_write(this.configs.OV2640_JPEG_INIT),this.i2c_regs_write(this.configs.OV2640_YUV422),this.i2c_regs_write(this.configs.OV2640_JPEG),this.i2c_byte_write(255,1),this.i2c_byte_write(21,0),this.setSize("320x240")}startupWait(){return i(this,void 0,void 0,(function*(){yield this.spi_pingpongWait(),this.setMode("MCU2LCD");const e=yield this.getChipIdWait();if(9794!==e&&9793!==e)throw new Error("unknown chip "+e);this.init()}))}takeWait(e){return i(this,void 0,void 0,(function*(){for("string"==typeof e&&this._size!==e&&(this.setSize(e),this.obniz.wait(1e3)),this.flushFIFO(),this.flushFIFO(),this.startCapture();!(yield this.isCaptureDoneWait()););return yield this.readFIFOWait()}))}setSize(e){if(this._size===e)return;const t={"160x120":this.configs.OV2640_160x120_JPEG,"176x144":this.configs.OV2640_176x144_JPEG,"320x240":this.configs.OV2640_320x240_JPEG,"352x288":this.configs.OV2640_352x288_JPEG,"640x480":this.configs.OV2640_640x480_JPEG,"800x600":this.configs.OV2640_800x600_JPEG,"1024x768":this.configs.OV2640_1024x768_JPEG,"1280x960":this.configs.OV2640_1280x960_JPEG,"1600x1200":this.configs.OV2640_1600x1200_JPEG};if(!t[e])throw new Error("unsupported size options are "+Object.keys(t));this._size=e,this.i2c_regs_write(t[e])}updateFIFO(e){this.spi_write_reg(this.regs.ARDUCHIP_FIFO,e)}flushFIFO(){this.spi_write_reg(this.regs.ARDUCHIP_FIFO,1)}readFIFOLengthWait(){return i(this,void 0,void 0,(function*(){const e=yield this.spi_read_regWait(this.regs.FIFO_SIZE1),t=yield this.spi_read_regWait(this.regs.FIFO_SIZE2);return 524287&((7&(yield this.spi_read_regWait(this.regs.FIFO_SIZE3)))<<16|t<<8|e)}))}startCapture(){this.spi_write_reg(this.regs.ARDUCHIP_FIFO,2)}isCaptureDoneWait(){return i(this,void 0,void 0,(function*(){return!!(8&(yield this.spi_read_regWait(this.regs.ARDUCHIP_TRIG)))}))}readFIFOWait(){return i(this,void 0,void 0,(function*(){const e=yield this.readFIFOLengthWait();this.io_cs.output(!1),this.spi.write([this.regs.BURST_FIFO_READ]),0===this.params.module_version&&this.spi.write([255]);const t=[];for(;t.length<e;){let i=e-t.length;i>1024&&(i=1024);const r=new Array(i);r.fill(0);const s=yield this.spi.writeWait(r);t.push(...s)}return this.io_cs.output(!0),t}))}arrayToBase64(t){return e.from(t).toString("base64")}}}).call(this,i(0).Buffer)},function(e,t,i){"use strict";(function(e){var i=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.keys=["vcc","cam_tx","cam_rx","gnd"],this.requiredKeys=["cam_tx","cam_rx"],this.ioKeys=this.keys,this.displayName="Jcam",this.displayIoNames={cam_tx:"camTx",cam_rx:"camRx"}}static info(){return{name:"JpegSerialCam"}}wired(e){this.obniz=e,this.obniz.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.my_tx=this.params.cam_rx,this.my_rx=this.params.cam_tx,this.obniz.getIO(this.my_tx).drive("3v"),this.uart=this.obniz.getFreeUart()}_drainUntil(e,t,r){return i(this,void 0,void 0,(function*(){for(r||(r=[]);;){const i=e.readBytes();r=r.concat(i);const s=this._seekTail(t,r);if(s>=0)return r.splice(0,s),r;yield this.obniz.wait(10)}}))}_seekTail(e,t){let i=0;for(let r=0;r<t.length;r++)if(t[r]===e[i]){if(i++,i===e.length)return r+1}else i=0;return-1}arrayToBase64(t){return e.from(t).toString("base64")}startWait(e){return i(this,void 0,void 0,(function*(){e||(e={}),this.uart.start({tx:this.my_tx,rx:this.my_rx,baud:e.baud||38400}),this.obniz.display.setPinName(this.my_tx,"JpegSerialCam","camRx"),this.obniz.display.setPinName(this.my_rx,"JpegSerialCam","camTx"),yield this.obniz.wait(2500)}))}resetwait(){return i(this,void 0,void 0,(function*(){this.uart.send([86,0,38,0]),yield this._drainUntil(this.uart,[118,0,38,0]),yield this.obniz.wait(2500)}))}setSizeWait(e){return i(this,void 0,void 0,(function*(){let t;if("640x480"===e)t=0;else if("320x240"===e)t=17;else{if("160x120"!==e)throw new Error("unsupported size");t=34}this.uart.send([86,0,49,5,4,1,0,25,t]),yield this._drainUntil(this.uart,[118,0,49,0]),yield this.resetwait()}))}setCompressibilityWait(e){return i(this,void 0,void 0,(function*(){const t=Math.floor(e/100*255);this.uart.send([86,0,49,5,1,1,18,4,t]),yield this._drainUntil(this.uart,[118,0,49,0]),yield this.resetwait()}))}setBaudWait(e){return i(this,void 0,void 0,(function*(){let t;switch(e){case 9600:t=[174,200];break;case 19200:t=[86,228];break;case 38400:t=[42,242];break;case 57600:t=[28,76];break;case 115200:t=[13,166];break;default:throw new Error("invalid baud rate")}this.uart.send([86,0,49,6,4,2,0,8,t[0],t[1]]),yield this._drainUntil(this.uart,[118,0,49,0]),yield this.startWait({baud:e})}))}takeWait(){return i(this,void 0,void 0,(function*(){const e=this.uart;e.send([86,0,54,1,2]),yield this._drainUntil(e,[118,0,54,0,0]),e.send([86,0,54,1,0]),yield this._drainUntil(e,[118,0,54,0,0]),e.send([86,0,52,1,0]);let t,i,r=yield this._drainUntil(e,[118,0,52,0,4,0,0]);for(;;){const s=e.readBytes();if(r=r.concat(s),r.length>=2){t=r[0],i=r[1];break}yield this.obniz.wait(1e3)}const s=256*t+i;for(e.send([86,0,50,12,0,10,0,0,0,0,0,0,t,i,0,255]),r=yield this._drainUntil(e,[118,0,50,0,0]);;){const t=e.readBytes();if(r=r.concat(t),r.length>=s)break;yield this.obniz.wait(10)}return r=r.splice(0,s),r=r.concat([255,217]),r}))}}}).call(this,i(0).Buffer)},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.keys=["signal","vcc","gnd"],this.requiredKeys=["signal"]}static info(){return{name:"PT550"}}onchange(e){}wired(e){this.obniz=e,this.obniz.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.signal=this.obniz.getAD(this.params.signal),this.signal.start(e=>{this.onchange&&this.onchange(e)})}getWait(){return r(this,void 0,void 0,(function*(){return yield this.signal.getWait()}))}}},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.keys=["vcc","sda","scl","i2c","gnd"],this.requiredKeys=[],this.address=42,this.regAdrs={ctrl:0,manualTiming:1,sensorRed:3}}static info(){return{name:"S11059"}}wired(e){this.obniz=e,e.setVccGnd(this.params.vcc,this.params.gnd,"3v"),this.obniz.wait(100),this.params.clock=1e5,this.params.pull="3v",this.params.mode="master",this.i2c=e.getI2CWithConfig(this.params),this.obniz.wait(100)}init(e,t){this.i2c.write(this.address,[this.regAdrs.ctrl,128]);const i=e<<3|t;this.i2c.write(this.address,[this.regAdrs.ctrl,i])}getVal(){return r(this,void 0,void 0,(function*(){this.i2c.write(this.address,[this.regAdrs.sensorRed]);const e=yield this.i2c.readWait(this.address,8),t=[0,0,0,0];return t[0]=e[0]<<8|e[1],t[1]=e[2]<<8|e[3],t[2]=e[4]<<8|e[5],t[3]=e[6]<<8|e[7],t}))}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.keys=["a","b","c","d","e","f","g","dp","common","commonType"],this.requiredKeys=["a","b","c","d","e","f","g"],this.digits=[63,6,91,79,102,109,125,7,127,111,111],this.displayIoNames={a:"a",b:"b",c:"c",d:"d",e:"e",f:"f",g:"g",dp:"dp",common:"com"},this.ios=[],this.isCathodeCommon=!1}static info(){return{name:"7SegmentLED"}}wired(e){function t(t){return t&&"object"==typeof t&&"function"==typeof t.output?t:e.getIO(t)}function i(t){return!(!t||"object"!=typeof t||"function"!=typeof t.output)||e.isValidIO(t)}this.obniz=e,this.ios=[],this.ios.push(t(this.params.a)),this.ios.push(t(this.params.b)),this.ios.push(t(this.params.c)),this.ios.push(t(this.params.d)),this.ios.push(t(this.params.e)),this.ios.push(t(this.params.f)),this.ios.push(t(this.params.g)),this.isCathodeCommon="anode"!==this.params.commonType;for(let e=0;e<this.ios.length;e++)this.ios[e].output(!this.isCathodeCommon);if(i(this.params.dp)){const e=t(this.params.dp);e.output(!1),this.dp=e}i(this.params.common)&&(this.common=t(this.params.common),this.on())}print(e){if("number"==typeof e){e=Math.floor(e),e%=10;for(let t=0;t<7;t++)if(this.ios[t]){let i=!!(this.digits[e]&1<<t);this.isCathodeCommon||(i=!i),this.ios[t].output(i)}this.on()}}printRaw(e){if("number"==typeof e){for(let t=0;t<7;t++)if(this.ios[t]){let i=!!(e&1<<t);this.isCathodeCommon||(i=!i),this.ios[t].output(i)}this.on()}}dpState(e){this.dp&&this.dp.output(this.isCathodeCommon?e:!e)}on(){this.common&&this.common.output(!this.isCathodeCommon)}off(){this.common&&this.common.output(!!this.isCathodeCommon)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.identifier=""+(new Date).getTime(),this.keys=["segments"],this.requiredKeys=this.keys}static info(){return{name:"7SegmentLEDArray"}}wired(e){this.obniz=e,this.segments=this.params.segments}print(e){if("number"==typeof e){e=Math.floor(e);const t=t=>{let i=e;for(let e=0;e<this.segments.length;e++)t===e?this.segments[e].print(i%10):this.segments[e].off(),i/=10},i=[];for(let e=0;e<this.segments.length;e++)i.push({duration:3,state:t});this.obniz.io.animation(this.identifier,"loop",i)}}on(){this.obniz.io.animation(this.identifier,"resume")}off(){this.obniz.io.animation(this.identifier,"pause");for(let e=0;e<this.segments.length;e++)this.segments[e].off()}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.keys=["vcc","gnd","din","cs","clk"],this.requiredKeys=["din","cs","clk"]}static info(){return{name:"7SegmentLED_MAX7219"}}wired(e){this.cs=e.getIO(this.params.cs),e.isValidIO(this.params.vcc)&&e.getIO(this.params.vcc).output(!0),e.isValidIO(this.params.gnd)&&e.getIO(this.params.gnd).output(!1),this.params.frequency=this.params.frequency||1e7,this.params.mode="master",this.params.mosi=this.params.din,this.params.drive="3v",this.spi=this.obniz.getSpiWithConfig(this.params),this.cs.output(!0),this.cs.output(!1),this.cs.output(!0)}init(e,t){this.numOfDisp=e,this.digits=t,this.writeAllDisp([9,255]),this.writeAllDisp([10,5]),this.writeAllDisp([11,t-1]),this.writeAllDisp([12,1]),this.writeAllDisp([15,0]),this.obniz.wait(10)}clear(e){for(let t=0;t<this.digits;t++)this.writeOneDisp(e,[t+1,15])}clearAll(){for(let e=0;e<this.numOfDisp;e++)for(let e=0;e<this.digits;e++)this.writeAllDisp([e+1,15])}test(){this.writeAllDisp([15,0])}brightness(e,t){this.writeOneDisp(e,[10,t])}brightnessAll(e){this.writeAllDisp([10,e])}writeAllDisp(e){for(let t=0;t<this.numOfDisp;t++)this.writeOneDisp(t,e)}writeOneDisp(e,t){this.cs.output(!1);for(let t=0;t<e;t++)this.spi.write([0,0]);this.spi.write(t);for(let t=0;t<this.numOfDisp-(e+1);t++)this.spi.write([0,0]);this.cs.output(!0)}setNumber(e,t,i,r){t>=0&&t<=this.digits-1&&this.writeOneDisp(e,[t+1,this.encodeBCD(i,r)])}encodeBCD(e,t){const i=!0===t?128:0;return e>=0&&e<=9?e|i:"-"===e||10===e?10|i:"e"===e||11===e?11|i:"h"===e||12===e?12|i:"l"===e||13===e?13|i:"p"===e||14===e?14|i:"on"===e?136:15|i}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.width=0,this.height=0,this.vram=[[]],this.keys=["vcc","gnd","din","cs","clk"],this.requiredKeys=["din","cs","clk"]}static info(){return{name:"MatrixLED_MAX7219"}}wired(e){this.cs=e.getIO(this.params.cs),e.isValidIO(this.params.vcc)&&e.getIO(this.params.vcc).output(!0),e.isValidIO(this.params.gnd)&&e.getIO(this.params.gnd).output(!1),this.params.frequency=this.params.frequency||1e7,this.params.mode="master",this.params.mosi=this.params.din,this.params.drive="3v",this.spi=this.obniz.getSpiWithConfig(this.params),this.cs.output(!0),this.cs.output(!1),this.cs.output(!0)}init(e,t){this.width=e,this.height=t,this.preparevram(e,t),this.initModule()}initModule(){this.write([9,0]),this.write([10,5]),this.write([11,7]),this.write([12,1]),this.write([15,0]),this.passingCommands(),this.obniz.wait(10)}test(){this.write([15,0]),this.passingCommands()}passingCommands(){for(let e=8;e<this.width;e+=8)this.write([0,0])}brightness(e){this.write([10,e]),this.passingCommands()}preparevram(e,t){this.vram=[];for(let i=0;i<t;i++){const t=new Array(e/8);for(let e=0;e<t.length;e++)t[e]=0;this.vram.push(t)}}write(e){this.cs.output(!1),this.spi.write(e),this.cs.output(!0)}writeVram(){for(let e=0;e<this.height;e++){const t=e+1,i=this.vram[e],r=[];for(let e=0;e<i.length;e++)r.push(t),r.push(i[e]);this.write(r)}}clear(){for(let e=0;e<this.height;e++){const t=this.vram[e];for(let i=0;i<t.length;i++)this.vram[e][i]=0;this.writeVram()}}draw(e){const t=e.getImageData(0,0,this.width,this.height).data;for(let e=0;e<t.length;e+=4){const i=.34*t[e]+.5*t[e+1]+.16*t[e+2],r=Math.floor(e/4),s=Math.floor(r/this.width),n=Math.floor((r-s*this.width)/8),a=Math.floor(r-s*this.width)%8;0===a&&(this.vram[s][n]=0),i>127&&(this.vram[s][n]|=128>>a)}this.writeVram()}}},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.debugprint=!1,this.width=0,this.height=0,this.x_offset=0,this.y_offset=0,this.writeBuffer=[],this.keys=["sclk","mosi","cs","res","dc"],this.requiredKeys=[]}static info(){return{name:"ST7735S"}}wired(e){this.debugprint=!1,this.obniz=e,this.io_dc=e.getIO(this.params.dc),this.io_res=e.getIO(this.params.res),this.io_cs=e.getIO(this.params.cs),this.params.frequency=16e6,this.params.mode="master",this.params.clk=this.params.sclk,this.params.mosi=this.params.mosi,this.params.drive="3v",this.spi=this.obniz.getSpiWithConfig(this.params),this.io_dc.output(!0),this.io_cs.output(!1),this.width=s,this.height=n,this.rotation=0,this.x_offset=26,this.y_offset=2,this.writeBuffer=[],this._setPresetColor(),this.init()}print_debug(e){this.debugprint&&console.log("SainSmartTFT18LCD: "+Array.prototype.slice.call(arguments).join(""))}_deadSleep(e){const t=new Date;for(;new Date-t<e;);}_reset(){this.io_res.output(!1),this._deadSleep(10),this.io_res.output(!0),this._deadSleep(10)}writeCommand(e){this.io_dc.output(!1),this.io_cs.output(!1),this.spi.write([e]),this.io_cs.output(!0)}writeData(e){this.io_dc.output(!0),this.io_cs.output(!1),this.spi.write(e),this.io_cs.output(!0)}write(e,t){0!==t.length&&(this.writeCommand(e),this.writeData(t))}asyncwait(){return r(this,void 0,void 0,(function*(){return yield this.spi.writeWait([0])}))}_writeFlush(){for(;this.writeBuffer.length>0;)if(this.writeBuffer.length>1024){const e=this.writeBuffer.slice(0,1024);this.writeData(e),this.writeBuffer.splice(0,1024)}else this.writeBuffer.length>0&&this.writeData(this.writeBuffer),this.writeBuffer=[]}_writeBuffer(e){e&&e.length>0?this.writeBuffer=this.writeBuffer.concat(e):this._writeFlush()}color16(e,t,i){return(248&e)<<8|(252&t)<<3|i>>3}complementaryColor16(e){const t=(63488&e)>>8,i=(2016&e)>>3,r=(31&e)<<3,s=Math.max(t,i,r)+Math.min(t,i,r);return this.color16(s-t,s-i,s-r)}reverseColor16(e){const t=(63488&e)>>8,i=(2016&e)>>3,r=(31&e)<<3;return this.color16(255-t,255-i,255-r)}_initG(){this.writeCommand(a),this.obniz.wait(150),this.writeCommand(o),this.obniz.wait(500),this.write(g,[1,44,45]),this.write(y,[1,44,45]),this.write(b,[1,44,45,1,44,45]),this.write(v,[7]),this.write(w,[162,2,132]),this.write(S,[197]),this.write(E,[10,0]),this.write(C,[138,42]),this.write(A,[138,238]),this.write(I,[14]),this.writeCommand(h),this.write(m,[200]),this.write(_,[5]),this.write(l,[0,0,0,127]),this.write(f,[0,0,0,159]),this.writeCommand(c),this.write(P,[2,28,7,18,55,50,41,45,41,37,43,57,0,1,3,16]),this.write(O,[3,29,7,6,46,44,41,45,46,46,55,63,0,0,2,16])}init(){this._reset(),this._initG(),this.setDisplayOn(),this.setRotation(0)}setDisplayOn(){this.writeCommand(u)}setDisplayOff(){this.writeCommand(d)}setDisplay(e){!0===e?this.setDisplayOn():this.setDisplayOff()}setInversionOn(){this.writeCommand(c)}setInversionOff(){this.writeCommand(h)}setInversion(e){!0===e?this.setInversionOn():this.setInversionOff()}setRotation(e){let t=[];switch(this.rotation=e%4,this.rotation){case 0:t=[192],this.width=s,this.height=n;break;case 1:t=[160],this.width=n,this.height=s;break;case 2:t=[0],this.width=s,this.height=n;break;case 3:t=[96],this.width=n,this.height=s}this.write(m,t),this.setAddrWindow(0,0,this.width-1,this.height-1)}setAddrWindow(e,t,i,r){this.print_debug(`setAddrWindow: (x0: ${e}, y0: ${t}) - (x1: ${i}, y1: ${r})`),e<0&&(e=0),t<0&&(t=0),i<0&&(i=0),r<0&&(r=0),0===this.rotation||2===this.rotation?(e+=this.x_offset,i+=this.x_offset,t+=this.y_offset,r+=this.y_offset):(e+=this.y_offset,i+=this.y_offset,t+=this.x_offset,r+=this.x_offset),this.write(l,[0,e,0,i]),this.write(f,[0,t,0,r]),this.writeCommand(p),this.writeBuffer=[]}fillScreen(e){this.fillRect(0,0,this.width,this.height,e)}fillRect(e,t,i,r,s){if(e>=this.width||t>=this.height)return;e+i-1>=this.width&&(i=this.width-e),t+r-1>=this.height&&(r=this.height-t);const n=this._color2pixels(i,r,s);this.rawBound16(e,t,i,r,n,!0)}drawRect(e,t,i,r,s){this.drawHLine(e,t,i,s),this.drawHLine(e,t+r-1,i,s),this.drawVLine(e,t,r,s),this.drawVLine(e+i-1,t,r,s)}drawCircle(e,t,i,r){let s=1-i,n=1,a=-2*i,o=0,h=i;for(this.drawPixel(e,t+i,r),this.drawPixel(e,t-i,r),this.drawPixel(e+i,t,r),this.drawPixel(e-i,t,r);o<h;)s>=0&&(h--,a+=2,s+=a),o++,n+=2,s+=n,this.drawPixel(e+o,t+h,r),this.drawPixel(e-o,t+h,r),this.drawPixel(e+o,t-h,r),this.drawPixel(e-o,t-h,r),this.drawPixel(e+h,t+o,r),this.drawPixel(e-h,t+o,r),this.drawPixel(e+h,t-o,r),this.drawPixel(e-h,t-o,r)}fillCircle(e,t,i,r){this.drawVLine(e,t-i,2*i+1,r),this._fillCircleHelper(e,t,i,3,0,r)}_fillCircleHelper(e,t,i,r,s,n){let a=1-i,o=1,h=-2*i,c=0,d=i;for(;c<d;)a>=0&&(d--,h+=2,a+=h),c++,o+=2,a+=o,1&r&&(this.drawVLine(e+c,t-d,2*d+1+s,n),this.drawVLine(e+d,t-c,2*c+1+s,n)),2&r&&(this.drawVLine(e-c,t-d,2*d+1+s,n),this.drawVLine(e-d,t-c,2*c+1+s,n))}drawRoundRect(e,t,i,r,s,n){this.drawHLine(e+s,t,i-2*s,n),this.drawHLine(e+s,t+r-1,i-2*s,n),this.drawVLine(e,t+s,r-2*s,n),this.drawVLine(e+i-1,t+s,r-2*s,n),this._drawCircleHelper(e+s,t+s,s,1,n),this._drawCircleHelper(e+i-s-1,t+s,s,2,n),this._drawCircleHelper(e+i-s-1,t+r-s-1,s,4,n),this._drawCircleHelper(e+s,t+r-s-1,s,8,n)}fillRoundRect(e,t,i,r,s,n){this.fillRect(e+s,t,i-2*s,r,n),this._fillCircleHelper(e+i-s-1,t+s,s,1,r-2*s-1,n),this._fillCircleHelper(e+s,t+s,s,2,r-2*s-1,n)}drawTriangle(e,t,i,r,s,n,a){this.drawLine(e,t,i,r,a),this.drawLine(i,r,s,n,a),this.drawLine(s,n,e,t,a)}fillTriangle(e,t,i,r,s,n,a){let o,h,c,d;if(t>r&&(r=[t,t=r][0],i=[e,e=i][0]),r>n&&(n=[r,r=n][0],s=[i,i=s][0]),t>r&&(r=[t,t=r][0],i=[e,e=i][0]),t===n)return o=h=e,i<o?o=i:i>h&&(h=i),s<o?o=s:s>h&&(h=s),void this.drawHLine(o,t,h-o+1,a);const u=i-e,l=r-t,f=s-e,p=n-t,m=s-i,_=n-r;let g=0,y=0;for(d=r===n?r:r-1,c=t;c<=d;c++)o=e+Math.floor(g/l),h=e+Math.floor(y/p),g+=u,y+=f,o>h&&(h=[o,o=h][0]),this.drawHLine(o,c,h-o+1,a);for(g=m*(c-r),y=f*(c-t);c<=n;c++)o=i+Math.floor(g/_),h=e+Math.floor(y/p),g+=m,y+=f,o>h&&(h=[o,o=h][0]),this.drawHLine(o,c,h-o+1,a)}drawVLine(e,t,i,r){if(i<0&&(t-=i=-i),e>=this.width||t>=this.height)return;t+i-1>=this.height&&(i=this.height-t);const s=this._color2pixels(1,i,r);this.rawBound16(e,t,1,i,s,!1)}drawHLine(e,t,i,r){if(i<0&&(e-=i=-i),e>=this.width||t>=this.height)return;e+i-1>=this.width&&(i=this.width-e);const s=this._color2pixels(i,1,r);this.rawBound16(e,t,i,1,s,!1)}drawLine(e,t,i,r,s){if(e===i)return void this.drawVLine(e,t,r-t,s);if(t===r)return void this.drawHLine(e,t,i-e,s);const n=Math.abs(r-t)>Math.abs(i-e);n&&(t=[e,e=t][0],r=[i,i=r][0]),e>i&&(i=[e,e=i][0],r=[t,t=r][0]);const a=i-e,o=Math.abs(r-t);let h=a/2;const c=t<r?1:-1;for(;e<=i;e++)n?this.drawPixel(t,e,s):this.drawPixel(e,t,s),h-=o,h<0&&(t+=c,h+=a)}drawPixel(e,t,i){e<0||e>=this.width||t<0||t>=this.height||this.rawBound16(e,t,1,1,[i],!1)}drawChar(e,t,i,r,s,n){if(n=n||1,e>=this.width||t>=this.height||e+6*n-1<0||t+8*n-1<0)return;if(r!==s)return void this.drawChar2(e,t,i,r,s,n);const a=i.charCodeAt(0);for(let i=0;i<6;i++){let o=5===i?0:x[5*a+i];for(let a=0;a<8;a++)1&o?1===n?this.drawPixel(e+i,t+a,r):this.fillRect(e+i*n,t+a*n,n,n,r):s!==r&&(1===n?this.drawPixel(e+i,t+a,s):this.fillRect(e+i*n,t+a*n,n,n,s)),o>>=1}}drawChar2(e,t,i,r,s,n){if(n=n||1,e>=this.width||t>=this.height||e+6*n-1<0||t+8*n-1<0)return;const a=new Array(48*n*n),o=i.charCodeAt(0);for(let e=0;e<6;e++){let t=5===e?0:x[5*o+e];for(let i=0;i<8;i++){const o=1&t?r:s;for(let t=0;t<n;t++)for(let r=0;r<n;r++)a[e*(1*n)+t+(i*(6*n*n)+r*(6*n))]=o;t>>=1}}this.rawBound16(e,t,6*n,8*n,a)}rawBound16(e,t,i,r,s,n){const a=[];s.forEach(e=>{const t=(63488&e)>>11|2016&e|(31&e)<<11;a.push((65280&t)>>8),a.push(255&t)}),this.setAddrWindow(e,t,e+i-1,t+r-1),n?(this._writeBuffer(a),this._writeBuffer()):this.writeData(a)}drawString(e,t,i,r,s,n,a){n=n||1;for(let o=0;o<i.length;o++){const h=i.charAt(o);"\n"===h?(t+=8*n,e=0):"\r"===h||(this.drawChar(e,t,h,r,s,n),e+=6*n,a&&e>this.width-6*n&&(t+=8*n,e=0))}return[e,t]}drawContextBound(e,t,i,r,s,n,a,o){t=t||0,i=i||0,r=r||e.canvas.clientWidth,s=s||e.canvas.clientHeight,n=n||0,a=a||0,o=o||!1,this.write(_,[R]);const h=e.getImageData(t,i,r,s).data,c=[];for(let e=0;e<h.length;e+=4){const t=h[e+0],i=h[e+1],r=h[e+2];if(o){const e=Math.round(.299*t+.587*i+.114*r);c.push(e),c.push(e),c.push(e)}else c.push(r),c.push(i),c.push(t)}this.write(_,[R]),this.setAddrWindow(n,a,n+r-1,a+s-1),this._writeBuffer(c),this._writeBuffer(),this.write(_,[M])}drawContext(e,t){t=t||!1,this.drawContextBound(e,0,0,this.width,this.height,0,0,t)}draw(e,t){this.drawContext(e,t)}rawBound(e,t,i,r,s){const n=[];s.forEach(e=>{n.push(255&e),n.push((65280&e)>>8),n.push((16711680&e)>>16)}),this.write(_,[R]),this.setAddrWindow(e,t,e+i-1,t+r-1),this._writeBuffer(n),this._writeBuffer(),this.write(_,[M])}raw(e){this.rawBound16(0,0,this.width,this.height,e,!0)}_setPresetColor(){this.color={AliceBlue:63455,AntiqueWhite:65370,Aqua:2047,Aquamarine:32762,Azure:63487,Beige:63419,Bisque:65336,Black:0,BlanchedAlmond:65369,Blue:31,BlueViolet:35164,Brown:41285,BurlyWood:56784,CadetBlue:23796,Chartreuse:32736,Chocolate:54083,Coral:64490,CornflowerBlue:25789,Cornsilk:65499,Crimson:55463,Cyan:2047,DarkBlue:17,DarkCyan:1105,DarkGoldenRod:48161,DarkGray:44373,DarkGreen:800,DarkKhaki:48557,DarkMagenta:34833,DarkOliveGreen:21317,DarkOrange:64608,DarkOrchid:39321,DarkRed:34816,DarkSalmon:60591,DarkSeaGreen:36337,DarkSlateBlue:18929,DarkSlateGray:10857,DarkTurquoise:1658,DarkViolet:36890,DeepPink:63666,DeepSkyBlue:1535,DimGray:27469,DodgerBlue:7327,FireBrick:45316,FloralWhite:65502,ForestGreen:9284,Fuchsia:63519,Gainsboro:57083,GhostWhite:65503,Gold:65184,GoldenRod:56612,Gray:33808,Green:1024,GreenYellow:45029,HoneyDew:63486,HotPink:64342,IndianRed:51947,Indigo:18448,Ivory:65534,Khaki:63281,Lavender:59199,LavenderBlush:65438,LawnGreen:32736,LemonChiffon:65497,LightBlue:44764,LightCoral:62480,LightCyan:59391,LightGoldenRodYellow:65498,LightGray:54938,LightGreen:38770,LightPink:64952,LightSalmon:64783,LightSeaGreen:9621,LightSkyBlue:34431,LightSlateGray:29779,LightSteelBlue:46651,LightYellow:65532,Lime:2016,LimeGreen:13926,Linen:65436,Magenta:63519,Maroon:32768,MediumAquaMarine:26229,MediumBlue:25,MediumOrchid:47802,MediumPurple:37787,MediumSeaGreen:15758,MediumSlateBlue:31581,MediumSpringGreen:2003,MediumTurquoise:20121,MediumVioletRed:49328,MidnightBlue:6350,MintCream:63487,MistyRose:65340,Moccasin:65334,NavajoWhite:65269,Navy:16,OldLace:65468,Olive:33792,OliveDrab:27748,Orange:64800,OrangeRed:64032,Orchid:56218,PaleGoldenRod:61269,PaleGreen:40915,PaleTurquoise:44925,PaleVioletRed:56210,PapayaWhip:65402,PeachPuff:65239,Peru:52263,Pink:65049,Plum:56603,PowderBlue:46876,Purple:32784,RebeccaPurple:24979,Red:63488,RosyBrown:48241,RoyalBlue:17244,SaddleBrown:35362,Salmon:64526,SandyBrown:62764,SeaGreen:11338,SeaShell:65469,Sienna:41605,Silver:50712,SkyBlue:34429,SlateBlue:27353,SlateGray:29714,Snow:65503,SpringGreen:2031,SteelBlue:17430,Tan:54705,Teal:1040,Thistle:56827,Tomato:64264,Turquoise:18202,Violet:60445,Wheat:63222,White:65535,WhiteSmoke:63422,Yellow:65504,YellowGreen:40550}}_color2pixels(e,t,i){return Array.from(new Array(Math.abs(e*t))).map((e,t)=>i)}_drawCircleHelper(e,t,i,r,s){let n=1-i,a=1,o=-2*i,h=0,c=i;for(;h<c;)n>=0&&(c--,o+=2,n+=o),h++,a+=2,n+=a,4&r&&(this.drawPixel(e+h,t+c,s),this.drawPixel(e+c,t+h,s)),2&r&&(this.drawPixel(e+h,t-c,s),this.drawPixel(e+c,t-h,s)),8&r&&(this.drawPixel(e-c,t+h,s),this.drawPixel(e-h,t+c,s)),1&r&&(this.drawPixel(e-c,t-h,s),this.drawPixel(e-h,t-c,s))}};const s=80,n=160,a=1,o=17,h=32,c=33,d=40,u=41,l=42,f=43,p=44,m=54,_=58,g=177,y=178,b=179,v=180,w=192,S=193,E=194,C=195,A=196,I=197,P=224,O=225,R=6,M=5,x=[0,0,0,0,0,62,91,79,91,62,62,107,79,107,62,28,62,124,62,28,24,60,126,60,24,28,87,125,87,28,28,94,127,94,28,0,24,60,24,0,255,231,195,231,255,0,24,36,24,0,255,231,219,231,255,48,72,58,6,14,38,41,121,41,38,64,127,5,5,7,64,127,5,37,63,90,60,231,60,90,127,62,28,28,8,8,28,28,62,127,20,34,127,34,20,95,95,0,95,95,6,9,127,1,127,0,102,137,149,106,96,96,96,96,96,148,162,255,162,148,8,4,126,4,8,16,32,126,32,16,8,8,42,28,8,8,28,42,8,8,30,16,16,16,16,12,30,12,30,12,48,56,62,56,48,6,14,62,14,6,0,0,0,0,0,0,0,95,0,0,0,7,0,7,0,20,127,20,127,20,36,42,127,42,18,35,19,8,100,98,54,73,86,32,80,0,8,7,3,0,0,28,34,65,0,0,65,34,28,0,42,28,127,28,42,8,8,62,8,8,0,128,112,48,0,8,8,8,8,8,0,0,96,96,0,32,16,8,4,2,62,81,73,69,62,0,66,127,64,0,114,73,73,73,70,33,65,73,77,51,24,20,18,127,16,39,69,69,69,57,60,74,73,73,49,65,33,17,9,7,54,73,73,73,54,70,73,73,41,30,0,0,20,0,0,0,64,52,0,0,0,8,20,34,65,20,20,20,20,20,0,65,34,20,8,2,1,89,9,6,62,65,93,89,78,124,18,17,18,124,127,73,73,73,54,62,65,65,65,34,127,65,65,65,62,127,73,73,73,65,127,9,9,9,1,62,65,65,81,115,127,8,8,8,127,0,65,127,65,0,32,64,65,63,1,127,8,20,34,65,127,64,64,64,64,127,2,28,2,127,127,4,8,16,127,62,65,65,65,62,127,9,9,9,6,62,65,81,33,94,127,9,25,41,70,38,73,73,73,50,3,1,127,1,3,63,64,64,64,63,31,32,64,32,31,63,64,56,64,63,99,20,8,20,99,3,4,120,4,3,97,89,73,77,67,0,127,65,65,65,2,4,8,16,32,0,65,65,65,127,4,2,1,2,4,64,64,64,64,64,0,3,7,8,0,32,84,84,120,64,127,40,68,68,56,56,68,68,68,40,56,68,68,40,127,56,84,84,84,24,0,8,126,9,2,24,164,164,156,120,127,8,4,4,120,0,68,125,64,0,32,64,64,61,0,127,16,40,68,0,0,65,127,64,0,124,4,120,4,120,124,8,4,4,120,56,68,68,68,56,252,24,36,36,24,24,36,36,24,252,124,8,4,4,8,72,84,84,84,36,4,4,63,68,36,60,64,64,32,124,28,32,64,32,28,60,64,48,64,60,68,40,16,40,68,76,144,144,144,124,68,100,84,76,68,0,8,54,65,0,0,0,119,0,0,0,65,54,8,0,2,1,2,4,2,60,38,35,38,60,30,161,161,97,18,58,64,64,32,122,56,84,84,85,89,33,85,85,121,65,33,84,84,120,65,33,85,84,120,64,32,84,85,121,64,12,30,82,114,18,57,85,85,85,89,57,84,84,84,89,57,85,84,84,88,0,0,69,124,65,0,2,69,125,66,0,1,69,124,64,240,41,36,41,240,240,40,37,40,240,124,84,85,69,0,32,84,84,124,84,124,10,9,127,73,50,73,73,73,50,50,72,72,72,50,50,74,72,72,48,58,65,65,33,122,58,66,64,32,120,0,157,160,160,125,57,68,68,68,57,61,64,64,64,61,60,36,255,36,36,72,126,73,67,102,43,47,252,47,43,255,9,41,246,32,192,136,126,9,3,32,84,84,121,65,0,0,68,125,65,48,72,72,74,50,56,64,64,34,122,0,122,10,10,114,125,13,25,49,125,38,41,41,47,40,38,41,41,41,38,48,72,77,64,32,56,8,8,8,8,8,8,8,8,56,47,16,200,172,186,47,16,40,52,250,0,0,123,0,0,8,20,42,20,34,34,20,42,20,8,170,0,85,0,170,170,85,170,85,170,0,0,0,255,0,16,16,16,255,0,20,20,20,255,0,16,16,255,0,255,16,16,240,16,240,20,20,20,252,0,20,20,247,0,255,0,0,255,0,255,20,20,244,4,252,20,20,23,16,31,16,16,31,16,31,20,20,20,31,0,16,16,16,240,0,0,0,0,31,16,16,16,16,31,16,16,16,16,240,16,0,0,0,255,16,16,16,16,16,16,16,16,16,255,16,0,0,0,255,20,0,0,255,0,255,0,0,31,16,23,0,0,252,4,244,20,20,23,16,23,20,20,244,4,244,0,0,255,0,247,20,20,20,20,20,20,20,247,0,247,20,20,20,23,20,16,16,31,16,31,20,20,20,244,20,16,16,240,16,240,0,0,31,16,31,0,0,0,31,20,0,0,0,252,20,0,0,240,16,240,16,16,255,16,255,20,20,20,255,20,16,16,16,31,0,0,0,0,240,16,255,255,255,255,255,240,240,240,240,240,255,255,255,0,0,0,0,0,255,255,15,15,15,15,15,56,68,68,56,68,124,42,42,62,20,126,2,2,6,6,2,126,2,126,2,99,85,73,65,99,56,68,68,60,4,64,126,32,30,32,6,2,126,2,2,153,165,231,165,153,28,42,73,42,28,76,114,1,114,76,48,74,77,77,48,48,72,120,72,48,188,98,90,70,61,62,73,73,73,0,126,1,1,1,126,42,42,42,42,42,68,68,95,68,68,64,81,74,68,64,64,68,74,81,64,0,0,255,1,3,224,128,255,0,0,8,8,107,107,8,54,18,54,36,54,6,15,9,15,6,0,0,24,24,0,0,0,16,16,0,48,64,255,1,1,0,31,1,1,30,0,25,29,23,18,0,60,60,60,60,0,0,0,0,0]},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.debugprint=!1,this.width=0,this.height=0,this.writeBuffer=[],this.keys=["vcc","gnd","scl","sda","dc","res","cs"],this.requiredKeys=["scl","sda","dc","res","cs"],this.displayIoNames={vcc:"vcc",gnd:"gnd",scl:"scl",sda:"sda",dc:"dc",res:"res",cs:"cs"}}static info(){return{name:"SainSmartTFT18LCD"}}wired(e){this.debugprint=!1,this.obniz=e,this.io_dc=e.getIO(this.params.dc),this.io_res=e.getIO(this.params.res),this.io_cs=e.getIO(this.params.cs),this.obniz.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.params.frequency=16e6,this.params.mode="master",this.params.clk=this.params.scl,this.params.mosi=this.params.sda,this.params.drive="3v",this.spi=this.obniz.getSpiWithConfig(this.params),this.io_dc.output(!0),this.io_cs.output(!1),this.width=s,this.height=n,this.writeBuffer=[],this._setPresetColor(),this.init()}print_debug(e){this.debugprint&&console.log("SainSmartTFT18LCD: "+Array.prototype.slice.call(arguments).join(""))}_deadSleep(e){const t=new Date;for(;new Date-t<e;);}_reset(){this.io_res.output(!1),this._deadSleep(10),this.io_res.output(!0),this._deadSleep(10)}writeCommand(e){this.io_dc.output(!1),this.io_cs.output(!1),this.spi.write([e]),this.io_cs.output(!0)}writeData(e){this.io_dc.output(!0),this.io_cs.output(!1),this.spi.write(e),this.io_cs.output(!0)}write(e,t){0!==t.length&&(this.writeCommand(e),this.writeData(t))}asyncwait(){return r(this,void 0,void 0,(function*(){return yield this.spi.writeWait([0])}))}_writeFlush(){for(;this.writeBuffer.length>0;)if(this.writeBuffer.length>1024){const e=this.writeBuffer.slice(0,1024);this.writeData(e),this.writeBuffer.splice(0,1024)}else this.writeBuffer.length>0&&this.writeData(this.writeBuffer),this.writeBuffer=[]}_writeBuffer(e){e&&e.length>0?this.writeBuffer=this.writeBuffer.concat(e):this._writeFlush()}color16(e,t,i){return(248&e)<<8|(252&t)<<3|i>>3}_initG(){this.writeCommand(a),this.obniz.wait(120),this.write(_,[1,44,45]),this.write(g,[1,44,45]),this.write(y,[1,44,45,1,44,45]),this.write(b,[7]),this.write(v,[162,2,132]),this.write(w,[197]),this.write(S,[10,0]),this.write(E,[138,42]),this.write(C,[138,238]),this.write(A,[14]),this.write(I,[2,28,7,18,55,50,41,45,41,37,43,57,0,1,3,16]),this.write(P,[3,29,7,6,46,44,41,45,46,46,55,63,0,0,2,16]),this.write(p,[R])}init(){this._reset(),this._initG(),this.setDisplayOn(),this.setRotation(0)}setDisplayOn(){this.writeCommand(d)}setDisplayOff(){this.writeCommand(c)}setDisplay(e){!0===e?this.setDisplayOn():this.setDisplayOff()}setInversionOn(){this.writeCommand(h)}setInversionOff(){this.writeCommand(o)}setInversion(e){!0===e?this.setInversionOn():this.setInversionOff()}setRotation(e){let t;switch(e%4){case 0:t=[192],this.width=s,this.height=n;break;case 1:t=[160],this.width=n,this.height=s;break;case 2:t=[0],this.width=s,this.height=n;break;case 3:t=[96],this.width=n,this.height=s}this.write(m,t),this.setAddrWindow(0,0,this.width-1,this.height-1)}setAddrWindow(e,t,i,r){this.print_debug(`setAddrWindow: (x0: ${e}, y0: ${t}) - (x1: ${i}, y1: ${r})`),e<0&&(e=0),t<0&&(t=0),i<0&&(i=0),r<0&&(r=0),this.write(u,[0,e,0,i]),this.write(l,[0,t,0,r]),this.writeCommand(f),this.writeBuffer=[]}fillScreen(e){this.fillRect(0,0,this.width,this.height,e)}fillRect(e,t,i,r,s){if(e>=this.width||t>=this.height)return;e+i-1>=this.width&&(i=this.width-e),t+r-1>=this.height&&(r=this.height-t),this.setAddrWindow(e,t,e+i-1,t+r-1);const n=s>>8,a=255&s,o=[];for(t=r;t>0;t--)for(e=i;e>0;e--)o.push(n),o.push(a);this._writeBuffer(o),this._writeBuffer()}drawRect(e,t,i,r,s){this.drawHLine(e,t,i,s),this.drawHLine(e,t+r-1,i,s),this.drawVLine(e,t,r,s),this.drawVLine(e+i-1,t,r,s)}drawCircle(e,t,i,r){let s=1-i,n=1,a=-2*i,o=0,h=i;for(this.drawPixel(e,t+i,r),this.drawPixel(e,t-i,r),this.drawPixel(e+i,t,r),this.drawPixel(e-i,t,r);o<h;)s>=0&&(h--,a+=2,s+=a),o++,n+=2,s+=n,this.drawPixel(e+o,t+h,r),this.drawPixel(e-o,t+h,r),this.drawPixel(e+o,t-h,r),this.drawPixel(e-o,t-h,r),this.drawPixel(e+h,t+o,r),this.drawPixel(e-h,t+o,r),this.drawPixel(e+h,t-o,r),this.drawPixel(e-h,t-o,r)}fillCircle(e,t,i,r){this.drawVLine(e,t-i,2*i+1,r),this._fillCircleHelper(e,t,i,3,0,r)}drawRoundRect(e,t,i,r,s,n){this.drawHLine(e+s,t,i-2*s,n),this.drawHLine(e+s,t+r-1,i-2*s,n),this.drawVLine(e,t+s,r-2*s,n),this.drawVLine(e+i-1,t+s,r-2*s,n),this._drawCircleHelper(e+s,t+s,s,1,n),this._drawCircleHelper(e+i-s-1,t+s,s,2,n),this._drawCircleHelper(e+i-s-1,t+r-s-1,s,4,n),this._drawCircleHelper(e+s,t+r-s-1,s,8,n)}fillRoundRect(e,t,i,r,s,n){this.fillRect(e+s,t,i-2*s,r,n),this._fillCircleHelper(e+i-s-1,t+s,s,1,r-2*s-1,n),this._fillCircleHelper(e+s,t+s,s,2,r-2*s-1,n)}drawTriangle(e,t,i,r,s,n,a){this.drawLine(e,t,i,r,a),this.drawLine(i,r,s,n,a),this.drawLine(s,n,e,t,a)}fillTriangle(e,t,i,r,s,n,a){let o=0,h=0,c=0,d=0;if(t>r&&(r=[t,t=r][0],i=[e,e=i][0]),r>n&&(n=[r,r=n][0],s=[i,i=s][0]),t>r&&(r=[t,t=r][0],i=[e,e=i][0]),t===n)return o=h=e,i<o?o=i:i>h&&(h=i),s<o?o=s:s>h&&(h=s),void this.drawHLine(o,t,h-o+1,a);const u=i-e,l=r-t,f=s-e,p=n-t,m=s-i,_=n-r;let g=0,y=0;for(d=r===n?r:r-1,c=t;c<=d;c++)o=e+Math.floor(g/l),h=e+Math.floor(y/p),g+=u,y+=f,o>h&&(h=[o,o=h][0]),this.drawHLine(o,c,h-o+1,a);for(g=m*(c-r),y=f*(c-t);c<=n;c++)o=i+Math.floor(g/_),h=e+Math.floor(y/p),g+=m,y+=f,o>h&&(h=[o,o=h][0]),this.drawHLine(o,c,h-o+1,a)}drawVLine(e,t,i,r){if(e>=this.width||t>=this.height)return;t+i-1>=this.height&&(i=this.height-t),this.setAddrWindow(e,t,e,t+i-1);const s=r>>8,n=255&r,a=[];for(;i--;)a.push(s),a.push(n);this.writeData(a)}drawHLine(e,t,i,r){if(e>=this.width||t>=this.height)return;e+i-1>=this.width&&(i=this.width-e),this.setAddrWindow(e,t,e+i-1,t);const s=r>>8,n=255&r,a=[];for(;i--;)a.push(s),a.push(n);this.writeData(a)}drawLine(e,t,i,r,s){const n=Math.abs(r-t)>Math.abs(i-e);n&&(t=[e,e=t][0],r=[i,i=r][0]),e>i&&(i=[e,e=i][0],r=[t,t=r][0]);const a=i-e,o=Math.abs(r-t);let h=a/2;const c=t<r?1:-1;for(;e<=i;e++)n?this.drawPixel(t,e,s):this.drawPixel(e,t,s),h-=o,h<0&&(t+=c,h+=a)}drawPixel(e,t,i){e<0||e>=this.width||t<0||t>=this.height||(this.setAddrWindow(e,t,e+1,t+1),this.writeData([i>>8,255&i]))}drawChar(e,t,i,r,s,n){if(n=n||1,e>=this.width||t>=this.height||e+6*n-1<0||t+8*n-1<0)return;if(r!==s)return void this.drawChar2(e,t,i,r,s,n);const a=i.charCodeAt(0);for(let i=0;i<6;i++){let o=5===i?0:M[5*a+i];for(let a=0;a<8;a++)1&o?1===n?this.drawPixel(e+i,t+a,r):this.fillRect(e+i*n,t+a*n,n,n,r):s!==r&&(1===n?this.drawPixel(e+i,t+a,s):this.fillRect(e+i*n,t+a*n,n,n,s)),o>>=1}}drawString(e,t,i,r,s,n,a){n=n||1;for(let o=0;o<i.length;o++){const h=i.charAt(o);"\n"===h?(t+=8*n,e=0):"\r"===h||(this.drawChar(e,t,h,r,s,n),e+=6*n,a&&e>this.width-6*n&&(t+=8*n,e=0))}return[e,t]}drawContextBound(e,t,i,r,s,n,a,o){t=t||0,i=i||0,r=r||e.canvas.clientWidth,s=s||e.canvas.clientHeight,n=n||0,a=a||0,o=o||!1,this.write(p,[O]);const h=e.getImageData(t,i,r,s).data,c=[];for(let e=0;e<h.length;e+=4){const t=h[e+0],i=h[e+1],r=h[e+2];if(o){const e=Math.round(.299*t+.587*i+.114*r);c.push(e),c.push(e),c.push(e)}else c.push(t),c.push(i),c.push(r)}this.write(p,[O]),this.setAddrWindow(n,a,n+r-1,a+s-1),this._writeBuffer(c),this._writeBuffer(),this.write(p,[R])}drawContext(e,t){t=t||!1,this.drawContextBound(e,0,0,this.width,this.height,0,0,t)}rawBound(e,t,i,r,s){const n=[];s.forEach(e=>{n.push((16711680&e)>>16),n.push((65280&e)>>8),n.push(255&e)}),this.write(p,[O]),this.setAddrWindow(e,t,e+i-1,t+r-1),this._writeBuffer(n),this._writeBuffer(),this.write(p,[R])}raw(e){this.rawBound(0,0,this.width,this.height,e)}_setPresetColor(){this.color={AliceBlue:63455,AntiqueWhite:65370,Aqua:2047,Aquamarine:32762,Azure:63487,Beige:63419,Bisque:65336,Black:0,BlanchedAlmond:65369,Blue:31,BlueViolet:35164,Brown:41285,BurlyWood:56784,CadetBlue:23796,Chartreuse:32736,Chocolate:54083,Coral:64490,CornflowerBlue:25789,Cornsilk:65499,Crimson:55463,Cyan:2047,DarkBlue:17,DarkCyan:1105,DarkGoldenRod:48161,DarkGray:44373,DarkGreen:800,DarkKhaki:48557,DarkMagenta:34833,DarkOliveGreen:21317,DarkOrange:64608,DarkOrchid:39321,DarkRed:34816,DarkSalmon:60591,DarkSeaGreen:36337,DarkSlateBlue:18929,DarkSlateGray:10857,DarkTurquoise:1658,DarkViolet:36890,DeepPink:63666,DeepSkyBlue:1535,DimGray:27469,DodgerBlue:7327,FireBrick:45316,FloralWhite:65502,ForestGreen:9284,Fuchsia:63519,Gainsboro:57083,GhostWhite:65503,Gold:65184,GoldenRod:56612,Gray:33808,Green:1024,GreenYellow:45029,HoneyDew:63486,HotPink:64342,IndianRed:51947,Indigo:18448,Ivory:65534,Khaki:63281,Lavender:59199,LavenderBlush:65438,LawnGreen:32736,LemonChiffon:65497,LightBlue:44764,LightCoral:62480,LightCyan:59391,LightGoldenRodYellow:65498,LightGray:54938,LightGreen:38770,LightPink:64952,LightSalmon:64783,LightSeaGreen:9621,LightSkyBlue:34431,LightSlateGray:29779,LightSteelBlue:46651,LightYellow:65532,Lime:2016,LimeGreen:13926,Linen:65436,Magenta:63519,Maroon:32768,MediumAquaMarine:26229,MediumBlue:25,MediumOrchid:47802,MediumPurple:37787,MediumSeaGreen:15758,MediumSlateBlue:31581,MediumSpringGreen:2003,MediumTurquoise:20121,MediumVioletRed:49328,MidnightBlue:6350,MintCream:63487,MistyRose:65340,Moccasin:65334,NavajoWhite:65269,Navy:16,OldLace:65468,Olive:33792,OliveDrab:27748,Orange:64800,OrangeRed:64032,Orchid:56218,PaleGoldenRod:61269,PaleGreen:40915,PaleTurquoise:44925,PaleVioletRed:56210,PapayaWhip:65402,PeachPuff:65239,Peru:52263,Pink:65049,Plum:56603,PowderBlue:46876,Purple:32784,RebeccaPurple:24979,Red:63488,RosyBrown:48241,RoyalBlue:17244,SaddleBrown:35362,Salmon:64526,SandyBrown:62764,SeaGreen:11338,SeaShell:65469,Sienna:41605,Silver:50712,SkyBlue:34429,SlateBlue:27353,SlateGray:29714,Snow:65503,SpringGreen:2031,SteelBlue:17430,Tan:54705,Teal:1040,Thistle:56827,Tomato:64264,Turquoise:18202,Violet:60445,Wheat:63222,White:65535,WhiteSmoke:63422,Yellow:65504,YellowGreen:40550}}_drawCircleHelper(e,t,i,r,s){let n=1-i,a=1,o=-2*i,h=0,c=i;for(;h<c;)n>=0&&(c--,o+=2,n+=o),h++,a+=2,n+=a,4&r&&(this.drawPixel(e+h,t+c,s),this.drawPixel(e+c,t+h,s)),2&r&&(this.drawPixel(e+h,t-c,s),this.drawPixel(e+c,t-h,s)),8&r&&(this.drawPixel(e-c,t+h,s),this.drawPixel(e-h,t+c,s)),1&r&&(this.drawPixel(e-c,t-h,s),this.drawPixel(e-h,t-c,s))}_fillCircleHelper(e,t,i,r,s,n){let a=1-i,o=1,h=-2*i,c=0,d=i;for(;c<d;)a>=0&&(d--,h+=2,a+=h),c++,o+=2,a+=o,1&r&&(this.drawVLine(e+c,t-d,2*d+1+s,n),this.drawVLine(e+d,t-c,2*c+1+s,n)),2&r&&(this.drawVLine(e-c,t-d,2*d+1+s,n),this.drawVLine(e-d,t-c,2*c+1+s,n))}drawChar2(e,t,i,r,s,n){if(n=n||1,e>=this.width||t>=this.height||e+6*n-1<0||t+8*n-1<0)return;const a=new Array(48*n*n),o=i.charCodeAt(0);for(let e=0;e<6;e++){let t=5===e?0:M[5*o+e];for(let i=0;i<8;i++){const o=1&t?r:s;for(let t=0;t<n;t++)for(let r=0;r<n;r++)a[e*(1*n)+t+(i*(6*n*n)+r*(6*n))]=o;t>>=1}}this.rawBound16(e,t,6*n,8*n,a)}rawBound16(e,t,i,r,s){const n=[];s.forEach(e=>{n.push((65280&e)>>8),n.push(255&e)}),this.setAddrWindow(e,t,e+i-1,t+r-1),this._writeBuffer(n),this._writeBuffer()}};const s=128,n=160,a=17,o=32,h=33,c=40,d=41,u=42,l=43,f=44,p=58,m=54,_=177,g=178,y=179,b=180,v=192,w=193,S=194,E=195,C=196,A=197,I=224,P=225,O=6,R=5,M=[0,0,0,0,0,62,91,79,91,62,62,107,79,107,62,28,62,124,62,28,24,60,126,60,24,28,87,125,87,28,28,94,127,94,28,0,24,60,24,0,255,231,195,231,255,0,24,36,24,0,255,231,219,231,255,48,72,58,6,14,38,41,121,41,38,64,127,5,5,7,64,127,5,37,63,90,60,231,60,90,127,62,28,28,8,8,28,28,62,127,20,34,127,34,20,95,95,0,95,95,6,9,127,1,127,0,102,137,149,106,96,96,96,96,96,148,162,255,162,148,8,4,126,4,8,16,32,126,32,16,8,8,42,28,8,8,28,42,8,8,30,16,16,16,16,12,30,12,30,12,48,56,62,56,48,6,14,62,14,6,0,0,0,0,0,0,0,95,0,0,0,7,0,7,0,20,127,20,127,20,36,42,127,42,18,35,19,8,100,98,54,73,86,32,80,0,8,7,3,0,0,28,34,65,0,0,65,34,28,0,42,28,127,28,42,8,8,62,8,8,0,128,112,48,0,8,8,8,8,8,0,0,96,96,0,32,16,8,4,2,62,81,73,69,62,0,66,127,64,0,114,73,73,73,70,33,65,73,77,51,24,20,18,127,16,39,69,69,69,57,60,74,73,73,49,65,33,17,9,7,54,73,73,73,54,70,73,73,41,30,0,0,20,0,0,0,64,52,0,0,0,8,20,34,65,20,20,20,20,20,0,65,34,20,8,2,1,89,9,6,62,65,93,89,78,124,18,17,18,124,127,73,73,73,54,62,65,65,65,34,127,65,65,65,62,127,73,73,73,65,127,9,9,9,1,62,65,65,81,115,127,8,8,8,127,0,65,127,65,0,32,64,65,63,1,127,8,20,34,65,127,64,64,64,64,127,2,28,2,127,127,4,8,16,127,62,65,65,65,62,127,9,9,9,6,62,65,81,33,94,127,9,25,41,70,38,73,73,73,50,3,1,127,1,3,63,64,64,64,63,31,32,64,32,31,63,64,56,64,63,99,20,8,20,99,3,4,120,4,3,97,89,73,77,67,0,127,65,65,65,2,4,8,16,32,0,65,65,65,127,4,2,1,2,4,64,64,64,64,64,0,3,7,8,0,32,84,84,120,64,127,40,68,68,56,56,68,68,68,40,56,68,68,40,127,56,84,84,84,24,0,8,126,9,2,24,164,164,156,120,127,8,4,4,120,0,68,125,64,0,32,64,64,61,0,127,16,40,68,0,0,65,127,64,0,124,4,120,4,120,124,8,4,4,120,56,68,68,68,56,252,24,36,36,24,24,36,36,24,252,124,8,4,4,8,72,84,84,84,36,4,4,63,68,36,60,64,64,32,124,28,32,64,32,28,60,64,48,64,60,68,40,16,40,68,76,144,144,144,124,68,100,84,76,68,0,8,54,65,0,0,0,119,0,0,0,65,54,8,0,2,1,2,4,2,60,38,35,38,60,30,161,161,97,18,58,64,64,32,122,56,84,84,85,89,33,85,85,121,65,33,84,84,120,65,33,85,84,120,64,32,84,85,121,64,12,30,82,114,18,57,85,85,85,89,57,84,84,84,89,57,85,84,84,88,0,0,69,124,65,0,2,69,125,66,0,1,69,124,64,240,41,36,41,240,240,40,37,40,240,124,84,85,69,0,32,84,84,124,84,124,10,9,127,73,50,73,73,73,50,50,72,72,72,50,50,74,72,72,48,58,65,65,33,122,58,66,64,32,120,0,157,160,160,125,57,68,68,68,57,61,64,64,64,61,60,36,255,36,36,72,126,73,67,102,43,47,252,47,43,255,9,41,246,32,192,136,126,9,3,32,84,84,121,65,0,0,68,125,65,48,72,72,74,50,56,64,64,34,122,0,122,10,10,114,125,13,25,49,125,38,41,41,47,40,38,41,41,41,38,48,72,77,64,32,56,8,8,8,8,8,8,8,8,56,47,16,200,172,186,47,16,40,52,250,0,0,123,0,0,8,20,42,20,34,34,20,42,20,8,170,0,85,0,170,170,85,170,85,170,0,0,0,255,0,16,16,16,255,0,20,20,20,255,0,16,16,255,0,255,16,16,240,16,240,20,20,20,252,0,20,20,247,0,255,0,0,255,0,255,20,20,244,4,252,20,20,23,16,31,16,16,31,16,31,20,20,20,31,0,16,16,16,240,0,0,0,0,31,16,16,16,16,31,16,16,16,16,240,16,0,0,0,255,16,16,16,16,16,16,16,16,16,255,16,0,0,0,255,20,0,0,255,0,255,0,0,31,16,23,0,0,252,4,244,20,20,23,16,23,20,20,244,4,244,0,0,255,0,247,20,20,20,20,20,20,20,247,0,247,20,20,20,23,20,16,16,31,16,31,20,20,20,244,20,16,16,240,16,240,0,0,31,16,31,0,0,0,31,20,0,0,0,252,20,0,0,240,16,240,16,16,255,16,255,20,20,20,255,20,16,16,16,31,0,0,0,0,240,16,255,255,255,255,255,240,240,240,240,240,255,255,255,0,0,0,0,0,255,255,15,15,15,15,15,56,68,68,56,68,124,42,42,62,20,126,2,2,6,6,2,126,2,126,2,99,85,73,65,99,56,68,68,60,4,64,126,32,30,32,6,2,126,2,2,153,165,231,165,153,28,42,73,42,28,76,114,1,114,76,48,74,77,77,48,48,72,120,72,48,188,98,90,70,61,62,73,73,73,0,126,1,1,1,126,42,42,42,42,42,68,68,95,68,68,64,81,74,68,64,64,68,74,81,64,0,0,255,1,3,224,128,255,0,0,8,8,107,107,8,54,18,54,36,54,6,15,9,15,6,0,0,24,24,0,0,0,16,16,0,48,64,255,1,1,0,31,1,1,30,0,25,29,23,18,0,60,60,60,60,0,0,0,0,0]},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.commands={write:128,clear:32,vcom:64},this.width=0,this.height=0,this._pos={x:0,y:0},this.autoFlush=!1,this.fontSize=0,this.keys=["vcc","gnd","vcc_a","gnd_a","sclk","mosi","cs","disp","extcomin","extmode","width","height"],this.requiredKeys=["sclk","mosi","cs","width","height"],this._canvas=null,this._reset()}static info(){return{name:"SharpMemoryTFT"}}wired(e){this.obniz=e,this.io_cs=e.getIO(this.params.cs),this.params.disp&&this.params.extcomin&&this.params.extmode&&(this.io_disp=e.getIO(this.params.disp),this.io_extcomin=e.getIO(this.params.extcomin),this.io_extmode=e.getIO(this.params.extmode),this.io_disp.output(!0),this.io_extcomin.output(!1),this.io_extmode.output(!1)),e.setVccGnd(this.params.vcc,this.params.gnd,"5v"),e.setVccGnd(this.params.vcc_a,this.params.gnd_a,"5v"),this.params.mode="master",this.params.frequency=1e6,this.params.clk=this.params.sclk,this.params.drive="5v",this.spi=this.obniz.getSpiWithConfig(this.params),this.width=this.params.width,this.height=this.params.height,this.obniz.wait(100)}_reverseBits(e){let t=0;for(let i=0;i<8;i++)t+=1&e,e>>=1,i<7&&(t<<=1);return t}sendLSB(e){this.spi.write([this._reverseBits(e)])}sendClear(){this.io_cs.output(!0),this.spi.write([0|this.commands.clear,0]),this.io_cs.output(!1)}raw(e){let t,i;const r=this.width*this.height/8;let s=new Array(1024),n=0;s[n++]=this.commands.write|this.commands.vcom,t=i=1,s[n++]=this._reverseBits(i),this.io_cs.output(!0);for(let a=0;a<r;a++)s[n++]=e[a],i=Math.floor((a+1)/(this.width/8)+1),i!==t&&(s[n++]=0,i<=this.height&&(s[n++]=this._reverseBits(i)),t=i),n>=1021&&(this.spi.write(s.slice(0,n)),s=new Array(1024),n=0);n>0&&this.spi.write(s.slice(0,n)),this.spi.write([0]),this.io_cs.output(!1)}_reset(){this._pos={x:0,y:0},this.autoFlush=!0}warnCanvasAvailability(){throw this.obniz.isNode?new Error("MemoryDisplay require node-canvas to draw rich contents. see more detail on docs"):new Error("MemoryDisplay cant create canvas element to body")}_preparedCanvas(){if(this._canvas)return this._canvas;if(this.obniz.isNode)try{const{createCanvas:e}=i(38);this._canvas=e(this.width,this.height)}catch(e){return null}else{const e="MemoryDispCanvas-"+this.obniz.id;let t=document.getElementById(e);if(!t){t=document.createElement("canvas"),t.setAttribute("id",e),t.style.visibility="hidden",t.width=this.width,t.height=this.height,t.style["-webkit-font-smoothing"]="none",document.getElementsByTagName("body")[0].appendChild(t)}this._canvas=t}const e=this._canvas.getContext("2d");return e.fillStyle="#FFF",e.fillRect(0,0,this.width,this.height),e.fillStyle="#000",e.strokeStyle="#000",this._pos.x=0,this._pos.y=0,this.fontSize=16,e.font=`${this.fontSize}px Arial`,this._canvas}_ctx(){return this._preparedCanvas().getContext("2d")}font(e,t){const i=this._ctx();"number"!=typeof t&&(t=16),"string"!=typeof e&&(e="Arial"),this.fontSize=t,i.font=t+"px "+e}clear(){const e=this._ctx();this._pos.x=0,this._pos.y=0,e?(e.fillStyle="#fff",e.fillRect(0,0,this.width,this.height),e.fillStyle="#000",e.strokeStyle="#000",this.draw(e)):this.sendClear()}pos(e,t){return this._ctx(),"number"==typeof e&&(this._pos.x=e),"number"==typeof t&&(this._pos.y=t),this._pos}print(e){const t=this._ctx();t&&(t.fillText(e,this._pos.x,this._pos.y+this.fontSize),this.draw(t),this._pos.y+=this.fontSize)}line(e,t,i,r){const s=this._ctx();s?(s.beginPath(),s.moveTo(e,t),s.lineTo(i,r),s.stroke(),this.draw(s)):this.warnCanvasAvailability()}rect(e,t,i,r,s){const n=this._ctx();n?(s?n.fillRect(e,t,i,r):n.strokeRect(e,t,i,r),this.draw(n)):this.warnCanvasAvailability()}circle(e,t,i,r){const s=this._ctx();s?(s.beginPath(),s.arc(e,t,i,0,2*Math.PI),r?s.fill():s.stroke(),this.draw(s)):this.warnCanvasAvailability()}draw(e){this.autoFlush&&this._draw(e)}drawing(e){this.autoFlush=!0===e;const t=this._ctx();t&&this.draw(t)}_draw(e){const t=this.width/8,i=new Array(64*t),r=e.getImageData(0,0,this.width,this.height).data;for(let e=0;e<r.length;e+=4){const s=.34*r[e]+.5*r[e+1]+.16*r[e+2],n=Math.floor(e/4),a=Math.floor(n/this.width),o=Math.floor((n-a*this.width)/8),h=Math.floor(n-a*this.width)%8;0===h&&(i[a*t+o]=0),s>115&&(i[a*t+o]|=128>>h)}this.raw(i)}}},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.displayIoNames={vcc:"vcc",gnd:"gnd",signal:"signal"},this._unit="mm",this.keys=["vcc","gnd","signal"],this.requiredKeys=["signal"]}static info(){return{name:"GP2Y0A21YK0F"}}wired(e){this.obniz=e,e.setVccGnd(this.params.vcc,this.params.gnd,"5v"),e.getIO(this.params.signal).end(),this.ad_signal=e.getAD(this.params.signal)}start(e){this.ad_signal.start(t=>{const i=this._volt2distance(t);"function"==typeof e&&e(i)})}_volt2distance(e){e<=0&&(e=.001);let t=19988.34*Math.pow(e/5*1024,-1.25214)*10;return"mm"===this._unit?t=Math.floor(10*t)/10:(t*=.0393701,t=Math.floor(1e3*t)/1e3),t}getWait(){return new Promise((e,t)=>r(this,void 0,void 0,(function*(){try{const t=yield this.ad_signal.getWait(),i=this._volt2distance(t);e(i)}catch(e){t(e)}})))}unit(e){if("mm"===e)this._unit="mm";else{if("inch"!==e)throw new Error("unknown unit "+e);this._unit="inch"}}}},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this._unit="mm",this.reset_alltime=!1,this.temp=15,this.keys=["vcc","trigger","echo","gnd"],this.requiredKeys=["vcc","trigger","echo"]}static info(){return{name:"HC-SR04"}}wired(e){if(this.obniz=e,e.setVccGnd(null,this.params.gnd,"5v"),this.vccIO=e.getIO(this.params.vcc),!1===e.isValidIO(this.params.trigger))throw new Error(`trigger ${this.params.trigger} is invalid io`);if(!1===e.isValidIO(this.params.echo))throw new Error(`echo ${this.params.echo} is invalid io`);this.trigger=this.params.trigger,this.echo=this.params.echo,this.vccIO.drive("5v"),this.vccIO.output(!0),this.obniz.wait(100)}measure(e){this.obniz.measure.echo({io_pulse:this.trigger,io_echo:this.echo,pulse:"positive",pulse_width:.011,measure_edges:3,timeout:10/340*1e3,callback:t=>r(this,void 0,void 0,(function*(){let i;this.reset_alltime&&(this.vccIO.output(!1),this.obniz.wait(100),this.vccIO.output(!0),this.obniz.wait(100));for(let e=0;e<t.length-1;e++)if(!0===t[e].edge){i=(t[e+1].timing-t[e].timing)/1e3/2*20.055*Math.sqrt(this.temp+273.15)*1e3,"inch"===this._unit&&(i*=.0393701)}"function"==typeof e&&e(i)}))})}measureWait(){return r(this,void 0,void 0,(function*(){return new Promise(e=>{this.measure(t=>{e(t)})})}))}unit(e){if("mm"===e)this._unit="mm";else{if("inch"!==e)throw new Error("HCSR04: unknown unit "+e);this._unit="inch"}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.displayName="gps",this.displayIoNames={txd:"txd",rxd:"rxd",Opps:"1pps"},this.on1pps=null,this.last1pps=0,this.keys=["vcc","txd","rxd","gnd","Opps"],this.requiredKeys=["txd","rxd"],this.ioKeys=this.keys}get latitude(){return this.nmea2dd(this._latitude)}get longitude(){return this.nmea2dd(this._longitude)}static info(){return{name:"GYSFDMAXB"}}wired(e){this.obniz=e,this.tx=this.params.txd,this.rx=this.params.rxd,this.vcc=this.params.vcc,this.gnd=this.params.gnd,this.Opps=this.params.Opps,this.obniz.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.uart=e.getFreeUart(),this.uart.start({tx:this.params.txd,rx:this.params.rxd,baud:9600,drive:"3v"}),this.editedData={},this.editedData.enable=!1,this.editedData.GPGSV=new Array(4),this.on1pps=null,this.last1pps=0,this.gpsInfo={},this.gpsInfo._sentenceType={GPGGA:1,GPGSA:2,GPGSV:4,GPRMC:8,GPVTG:16,GPZDA:32},this.gpsInfo.status="V",this.gpsInfo.sentences=new Set,this.gpsInfo.satelliteInfo={satellites:[],inView:0}}start1pps(e){this.on1pps=e,e?(this.last1pps=2,this.obniz.getAD(this.Opps).start(e=>{const t=Math.round(e);t!==this.last1pps&&(this.last1pps=t,0===t&&this.on1pps&&this.on1pps())})):this.obniz.getAD(this.Opps).end()}readSentence(){let e=[];if(this.uart.isDataExists()){const t=this.uart.received.indexOf(10);if(t>=0)return e=this.uart.received.slice(0,t-1),this.uart.received.splice(0,t+1),this.uart.tryConvertString(e)}return""}getEditedData(){let e,t,i,r=this.readSentence();for(this.editedData.enable=!1,this.editedData.GPGSV=new Array(4);r.length>0;){const s=r.split(",");if(","!==r.slice(-4,-3)){const e=s[s.length-1].slice(0,-3);s.push(s[s.length-1].slice(-3)),s[s.length-2]=e}switch(this.editedData.sentence=s.join(","),s[0]){case"$GPGGA":this.editedData.GPGGA=s;break;case"$GPGLL":this.editedData.GPGLL=s;break;case"$GPGSA":this.editedData.GPGSA=s;break;case"$GPGSV":if(e=Number(s[2]),e>this.editedData.GPGSV.length)for(;e>this.editedData.GPGSV.length;)this.editedData.GPGSV.push([]);this.editedData.GPGSV[e-1]=s;break;case"$GPRMC":this.editedData.GPRMC=s;break;case"$GPVTG":this.editedData.GPVTG=s;break;case"$GPZDA":this.editedData.GPZDA=s,t=s[4]+"/"+s[3]+"/"+s[2]+" "+s[1].substring(0,2)+":"+s[1].substring(2,4)+":"+s[1].substring(4,6)+" +00:00",this.editedData.timestamp=new Date(t);break;default:i=s[0].substr(1),this.editedData[i]=s}this.editedData.enable=!0,r=this.readSentence()}return this.editedData}getGpsInfo(e){if(e=e||this.getEditedData(),this.gpsInfo.status="V",e.enable){if(e.GPGGA){const t=e.GPGGA;this.gpsInfo.gpsQuality=parseFloat(t[6]),this.gpsInfo.hdop=parseFloat(t[8]),this.gpsInfo.altitude=parseFloat(t[9]);const i=this.nmea2dd(parseFloat(t[2]));this.gpsInfo.latitude="N"===t[3]?i:-i;const r=this.nmea2dd(parseFloat(t[4]));this.gpsInfo.longitude="E"===t[5]?r:-r,this.gpsInfo.sentences.add(this.gpsInfo._sentenceType.GPGGA)}if(e.GPGSV)for(let t=0;t<e.GPGSV.length;t++)if(e.GPGSV[t]){const i=e.GPGSV[t].map(e=>parseFloat(e)),r=i[1],s=i[2],n=i[3];if(s>r)continue;this.gpsInfo.satelliteInfo.inView=n;let a=4*(s-1);a=a+4>n?n-a:4;for(let e=0;e<a;++e){const t=4*(s-1)+e;this.gpsInfo.satelliteInfo.satellites.length<=t&&this.gpsInfo.satelliteInfo.satellites.push({});const r=4*e;this.gpsInfo.satelliteInfo.satellites[t]={id:i[r+4],elevation:i[r+5],azimuth:i[r+6],snr:i[r+7],inUse:!1}}this.gpsInfo.sentences.add(this.gpsInfo._sentenceType.GPGSV)}if(e.GPGSA){const t=e.GPGSA;let i=0;this.gpsInfo.fixMode=parseFloat(t[2]),this.gpsInfo.pdop=parseFloat(t[15]),this.gpsInfo.hdop=parseFloat(t[16]),this.gpsInfo.vdop=parseFloat(t[17]);for(let e=0;e<12;++e)for(let r=0;r<this.gpsInfo.satelliteInfo.inView;++r)this.gpsInfo.satelliteInfo.satellites[r]&&t[e+3]===this.gpsInfo.satelliteInfo.satellites[r].id&&(this.gpsInfo.satelliteInfo.satellites[r].inUse=!0,i++);this.gpsInfo.satelliteInfo.inUse=i,this.gpsInfo.sentences.add(this.gpsInfo._sentenceType.GPGSA)}if(e.GPRMC){const t=e.GPRMC;this.gpsInfo.status=t[2];const i=this.nmea2dd(parseFloat(t[3]));this.gpsInfo.latitude="N"===t[4]?i:-i;const r=this.nmea2dd(parseFloat(t[5]));this.gpsInfo.longitude="E"===t[6]?r:-r;const s=1.852;this.gpsInfo.speed=parseFloat(t[7])*s,this.gpsInfo.direction=t[8],this.gpsInfo.sentences.add(this.gpsInfo._sentenceType.GPRMC)}if(e.GPVTG){const t=e.GPVTG;this.gpsInfo.direction=parseFloat(t[1]),this.gpsInfo.declination=parseFloat(t[3]),this.gpsInfo.speed=parseFloat(t[7]),this.gpsInfo.sentences.add(this.gpsInfo._sentenceType.GPVTG)}e.GPZDA&&(this.gpsInfo.utc=e.timestamp,this.gpsInfo.sentences.add(this.gpsInfo._sentenceType.GPZDA))}return this.gpsInfo}_mneaTo(e,t){let i=this.nmea2dd(t);if("string"==typeof e)switch(e.toUpperCase()){case"DMS":i=this.nmea2dms(t);break;case"DM":i=this.nmea2dm(t);break;case"S":i=this.nmea2s(t)}return i}latitudeTo(e){return this._mneaTo(e,this._latitude)}longitudeTo(e){return this._mneaTo(e,this._longitude)}status2string(e){return"A"===(e=e||this.status)?"Active":"V"===e?"Void":e}fixMode2string(e){return 1===(e=e||this.fixMode)?"Fix not available":2===e?"2D":3===e?"3D":e}gpsQuality2string(e){return 0===(e=e||this.gpsQuality)?"Invalid":1===e?"GPS fix":2===e?"DGPS fix":e}nmea2dms(e){e=parseFloat(e);const t=Math.floor(e/100),i=Math.floor(100*(e/100-t));return t+""+i+"'"+(60*(100*(e/100-t)-i)).toFixed(1)+'"'}nmea2dm(e){e=parseFloat(e);const t=Math.floor(e/100);return t+""+(100*(e/100-t)).toFixed(4)+"'"}nmea2dd(e){e=parseFloat(e);const t=Math.floor(e/100),i=Math.floor(100*(e/100-t)/60);return parseFloat((t+i+60*(100*(e/100-t)-i)/3600).toFixed(6))}nmea2s(e){e=parseFloat(e);const t=Math.floor(e/100),i=Math.floor(100*(e/100-t)/60);return(t+i+60*(100*(e/100-t)-i)/3600)/(1/60/60)}}},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(12));class n extends s.default{static info(){return{name:"MQ135"}}constructor(){super()}}t.default=n},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(12));class n extends s.default{static info(){return{name:"MQ2"}}constructor(){super()}}t.default=n},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(12));class n extends s.default{static info(){return{name:"MQ3"}}constructor(){super()}}t.default=n},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(12));class n extends s.default{static info(){return{name:"MQ4"}}constructor(){super()}}t.default=n},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(12));class n extends s.default{static info(){return{name:"MQ5"}}constructor(){super()}}t.default=n},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(12));class n extends s.default{static info(){return{name:"MQ6"}}constructor(){super()}}t.default=n},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(12));class n extends s.default{static info(){return{name:"MQ7"}}constructor(){super()}}t.default=n},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(12));class n extends s.default{static info(){return{name:"MQ8"}}constructor(){super()}}t.default=n},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(12));class n extends s.default{static info(){return{name:"MQ9"}}constructor(){super()}}t.default=n},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.displayName="3axis",this.displayIoNames={sda:"sda",scl:"scl"},this.address=83,this.keys=["gnd","vcc","sda","scl","grove"],this.requiredKeys=[],this.ioKeys=this.keys,this.regAdrs={},this.regAdrs.POWER_CTL=45,this.regAdrs.THRESH_ACT=36,this.regAdrs.THRESH_INACT=37,this.regAdrs.TIME_INACT=38,this.regAdrs.ACT_INACT_CTL=39,this.regAdrs.TAP_AXES=42,this.regAdrs.THRESH_TAP=29,this.regAdrs.DUR=33,this.regAdrs.LATENT=34,this.regAdrs.WINDOW=35,this.regAdrs.THRESH_FF=40,this.regAdrs.TIME_FF=41,this.regAdrs.INT_MAP=47,this.regAdrs.INT_ENABLE=46,this.regAdrs.DATAX0=50,this.regAdrs.INT_DATA_READY_BIT=7,this.regAdrs.INT_SINGLE_TAP_BIT=6,this.regAdrs.INT_DOUBLE_TAP_BIT=5,this.regAdrs.INT_ACTIVITY_BIT=4,this.regAdrs.INT_INACTIVITY_BIT=3,this.regAdrs.INT_FREE_FALL_BIT=2,this.regAdrs.INT_WATERMARK_BIT=1,this.regAdrs.INT_OVERRUNY_BIT=0,this.constVal={},this.constVal.gainX=.0037639,this.constVal.gainY=.00376009,this.constVal.gainZ=.00349265,this.constVal.INT1_PIN=0,this.constVal.INT2_PIN=1}static info(){return{name:"Grove_3AxisAccelerometer"}}wired(e){return r(this,void 0,void 0,(function*(){this.obniz=e,this.params.grove?this.i2c=this.params.grove.getI2c(4e5,"5v"):(this.vcc=this.params.vcc,this.gnd=this.params.gnd,this.obniz.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.params.clock=4e5,this.params.mode="master",this.i2c=e.getI2CWithConfig(this.params)),this.obniz.wait(100),this.i2c.write(this.address,[this.regAdrs.POWER_CTL,0]),this.i2c.write(this.address,[this.regAdrs.POWER_CTL,16]),this.i2c.write(this.address,[this.regAdrs.POWER_CTL,8]),this.i2c.write(this.address,[this.regAdrs.THRESH_ACT,75]),this.i2c.write(this.address,[this.regAdrs.THRESH_INACT,75]),this.i2c.write(this.address,[this.regAdrs.THRESH_INACT,10]),yield this.setRegisterBit(this.regAdrs.ACT_INACT_CTL,6,1),yield this.setRegisterBit(this.regAdrs.ACT_INACT_CTL,5,1),yield this.setRegisterBit(this.regAdrs.ACT_INACT_CTL,4,1),yield this.setRegisterBit(this.regAdrs.ACT_INACT_CTL,2,1),yield this.setRegisterBit(this.regAdrs.ACT_INACT_CTL,1,1),yield this.setRegisterBit(this.regAdrs.ACT_INACT_CTL,0,1),yield this.setRegisterBit(this.regAdrs.TAP_AXES,2,0),yield this.setRegisterBit(this.regAdrs.TAP_AXES,1,0),yield this.setRegisterBit(this.regAdrs.TAP_AXES,0,1),this.i2c.write(this.address,[this.regAdrs.THRESH_TAP,50]),this.i2c.write(this.address,[this.regAdrs.DUR,15]),this.i2c.write(this.address,[this.regAdrs.LATENT,80]),this.i2c.write(this.address,[this.regAdrs.WINDOW,200]),this.i2c.write(this.address,[this.regAdrs.THRESH_FF,7]),this.i2c.write(this.address,[this.regAdrs.TIME_FF,45]),yield this.setInterruptMapping(this.regAdrs.INT_SINGLE_TAP_BIT,this.constVal.INT1_PIN),yield this.setInterruptMapping(this.regAdrs.INT_DOUBLE_TAP_BIT,this.constVal.INT1_PIN),yield this.setInterruptMapping(this.regAdrs.INT_FREE_FALL_BIT,this.constVal.INT1_PIN),yield this.setInterruptMapping(this.regAdrs.INT_ACTIVITY_BIT,this.constVal.INT1_PIN),yield this.setInterruptMapping(this.regAdrs.INT_INACTIVITY_BIT,this.constVal.INT1_PIN),yield this.setInterrupt(this.regAdrs.INT_SINGLE_TAP_BIT,1),yield this.setInterrupt(this.regAdrs.INT_DOUBLE_TAP_BIT,1),yield this.setInterrupt(this.regAdrs.INT_FREE_FALL_BIT,1),yield this.setInterrupt(this.regAdrs.INT_ACTIVITY_BIT,1),yield this.setInterrupt(this.regAdrs.INT_INACTIVITY_BIT,1)}))}setRegisterBit(e,t,i){return r(this,void 0,void 0,(function*(){this.i2c.write(this.address,[e]);let r=yield this.i2c.readWait(this.address,1);i?r|=1<<t:r&=~(1<<t),this.i2c.write(this.address,[r])}))}setInterruptMapping(e,t){return r(this,void 0,void 0,(function*(){yield this.setRegisterBit(this.regAdrs.INT_MAP,e,t)}))}setInterrupt(e,t){return r(this,void 0,void 0,(function*(){yield this.setRegisterBit(this.regAdrs.INT_ENABLE,e,t)}))}signHandling(e){return e>>15&&(e=-(65535-e)),e}getRawVal(){return r(this,void 0,void 0,(function*(){this.i2c.write(this.address,[this.regAdrs.DATAX0]);const e=yield this.i2c.readWait(this.address,6),t=[0,0,0];return t[0]=this.signHandling(e[1]<<8|e[0]),t[1]=this.signHandling(e[3]<<8|e[2]),t[2]=this.signHandling(e[5]<<8|e[4]),t}))}getWait(){return r(this,void 0,void 0,(function*(){const e=[0,0,0],t=yield this.getRawVal();return e[0]=t[0]*this.constVal.gainX,e[1]=t[1]*this.constVal.gainY,e[2]=t[2]*this.constVal.gainZ,e}))}}},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.isPressed=null,this.onchange=null,this.onChangeForStateWait=e=>{},this.keys=["signal","gnd","vcc","grove"],this.requiredKeys=[]}static info(){return{name:"Grove_Button"}}wired(e){if(this.params.grove){const e=this.params.grove.getDigital("5v");this.io_signal=e.primary}else this.io_signal=e.getIO(this.params.signal),e.setVccGnd(this.params.vcc,this.params.gnd,"5v");this.io_signal.pull("5v"),this.io_signal.input(e=>{this.isPressed=e,this.onchange&&this.onchange(e),this.onChangeForStateWait(e)})}isPressedWait(){return r(this,void 0,void 0,(function*(){return yield this.io_signal.inputWait()}))}stateWait(e){return new Promise((t,i)=>{this.onChangeForStateWait=i=>{e===i&&(this.onChangeForStateWait=()=>{},t())}})}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.keys=["signal","gnd","vcc"],this.requiredKeys=["signal"]}static info(){return{name:"Grove_Buzzer"}}wired(e){this.obniz=e,this.obniz.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.pwm=e.getFreePwm(),this.pwm.start({io:this.params.signal})}play(e){if("number"!=typeof e)throw new Error("freq must be a number");(e=Math.floor(e))>0?(this.pwm.freq(e),this.pwm.pulse(1/e/2*1e3)):this.pwm.pulse(0)}stop(){this.play(0)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.displayIoNames={vcc:"vcc",gnd:"gnd",signal:"signal"},this.interval=5,this.duration=2500,this.keys=["vcc","gnd","signal"],this.requiredKeys=["vcc","gnd"]}static info(){return{name:"Grove_EarHeartRate"}}wired(e){this.obniz=e,e.setVccGnd(this.params.vcc,this.params.gnd,"5v")}start(e){this.obniz.logicAnalyzer.start({io:this.params.signal,interval:this.interval,duration:this.duration}),this.obniz.logicAnalyzer.onmeasured=t=>{const i=[];for(let e=0;e<t.length-1;e++)0===t[e]&&1===t[e+1]&&i.push(e);if(i.length>=2){let t=0,r=0;t=(i[1]-i[0])*this.interval/1e3,r=60/t,e(r)}}}getWait(){return new Promise(e=>{this.start(t=>{e(t)})})}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this._latitude=0,this._longitude=0,this.keys=["tx","rx","vcc","gnd"],this.requiredKeys=["tx","rx"],this.ioKeys=this.keys,this.displayName="gps",this.displayIoNames={tx:"tx",rx:"rx"}}get latitude(){return this.nmea2dd(this._latitude)}get longitude(){return this.nmea2dd(this._longitude)}static info(){return{name:"Grove_GPS"}}wired(e){this.obniz=e,this.obniz.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.uart=e.getFreeUart(),this.uart.start({tx:this.params.tx,rx:this.params.rx,baud:9600}),this.editedData={},this.editedData.enable=!1,this.editedData.GPGSV=new Array(4),this.gpsInfo={},this.gpsInfo._sentenceType={GPGGA:1,GPGSA:2,GPGSV:4,GPRMC:8,GPVTG:16,GPZDA:32},this.gpsInfo.status="V",this.gpsInfo.sentences=new Set,this.gpsInfo.satelliteInfo={satellites:[],inView:0}}readSentence(){let e=[];if(this.uart.isDataExists()){const t=this.uart.received.indexOf(10);if(t>=0){e=this.uart.received.slice(0,t-1),this.uart.received.splice(0,t+1);let i=this.uart.tryConvertString(e);return null===i&&(i=""),i}}return""}getEditedData(){let e,t,i,r=this.readSentence();for(this.editedData.enable=!1,this.editedData.GPGSV=new Array(4);r.length>0;){const s=r.split(",");if(","!==r.slice(-4,-3)){const e=s[s.length-1].slice(0,-3);s.push(s[s.length-1].slice(-3)),s[s.length-2]=e}switch(this.editedData.sentence=s.join(","),s[0]){case"$GPGGA":this.editedData.GPGGA=s;break;case"$GPGLL":this.editedData.GPGLL=s;break;case"$GPGSA":this.editedData.GPGSA=s;break;case"$GPGSV":if(e=Number(s[2]),e>this.editedData.GPGSV.length)for(;e>this.editedData.GPGSV.length;)this.editedData.GPGSV.push([]);this.editedData.GPGSV[e-1]=s;break;case"$GPRMC":this.editedData.GPRMC=s;break;case"$GPVTG":this.editedData.GPVTG=s;break;case"$GPZDA":this.editedData.GPZDA=s,t=s[4]+"/"+s[3]+"/"+s[2]+" "+s[1].substring(0,2)+":"+s[1].substring(2,4)+":"+s[1].substring(4,6)+" +00:00",this.editedData.timestamp=new Date(t);break;default:i=s[0].substr(1),this.editedData[i]=s}this.editedData.enable=!0,r=this.readSentence()}return this.editedData}getGpsInfo(e){if(e=e||this.getEditedData(),this.gpsInfo.status="V",e.enable){if(e.GPGGA){const t=e.GPGGA;this.gpsInfo.gpsQuality=parseFloat(t[6]),this.gpsInfo.hdop=parseFloat(t[8]),this.gpsInfo.altitude=parseFloat(t[9]);const i=this.nmea2dd(parseFloat(t[2]));this.gpsInfo.latitude="N"===t[3]?i:-i;const r=this.nmea2dd(parseFloat(t[4]));this.gpsInfo.longitude="E"===t[5]?r:-r,this.gpsInfo.sentences.add(this.gpsInfo._sentenceType.GPGGA)}if(e.GPGSV)for(let t=0;t<e.GPGSV.length;t++)if(e.GPGSV[t]){const i=e.GPGSV[t].map(e=>parseFloat(e)),r=i[1],s=i[2],n=i[3];if(s>r)continue;this.gpsInfo.satelliteInfo.inView=n;let a=4*(s-1);a=a+4>n?n-a:4;for(let e=0;e<a;++e){const t=4*(s-1)+e;this.gpsInfo.satelliteInfo.satellites.length<=t&&this.gpsInfo.satelliteInfo.satellites.push({});const r=4*e;this.gpsInfo.satelliteInfo.satellites[t]={id:i[r+4],elevation:i[r+5],azimuth:i[r+6],snr:i[r+7],inUse:!1}}this.gpsInfo.sentences.add(this.gpsInfo._sentenceType.GPGSV)}if(e.GPGSA){const t=e.GPGSA;let i=0;this.gpsInfo.fixMode=parseFloat(t[2]),this.gpsInfo.pdop=parseFloat(t[15]),this.gpsInfo.hdop=parseFloat(t[16]),this.gpsInfo.vdop=parseFloat(t[17]);for(let e=0;e<12;++e)for(let r=0;r<this.gpsInfo.satelliteInfo.inView;++r)this.gpsInfo.satelliteInfo.satellites[r]&&t[e+3]===this.gpsInfo.satelliteInfo.satellites[r].id&&(this.gpsInfo.satelliteInfo.satellites[r].inUse=!0,i++);this.gpsInfo.satelliteInfo.inUse=i,this.gpsInfo.sentences.add(this.gpsInfo._sentenceType.GPGSA)}if(e.GPRMC){const t=e.GPRMC;this.gpsInfo.status=t[2];const i=this.nmea2dd(parseFloat(t[3]));this.gpsInfo.latitude="N"===t[4]?i:-i;const r=this.nmea2dd(parseFloat(t[5]));this.gpsInfo.longitude="E"===t[6]?r:-r;const s=1.852;this.gpsInfo.speed=parseFloat(t[7])*s,this.gpsInfo.direction=t[8],this.gpsInfo.sentences.add(this.gpsInfo._sentenceType.GPRMC)}if(e.GPVTG){const t=e.GPVTG;this.gpsInfo.direction=parseFloat(t[1]),this.gpsInfo.declination=parseFloat(t[3]),this.gpsInfo.speed=parseFloat(t[7]),this.gpsInfo.sentences.add(this.gpsInfo._sentenceType.GPVTG)}e.GPZDA&&(this.gpsInfo.utc=e.timestamp,this.gpsInfo.sentences.add(this.gpsInfo._sentenceType.GPZDA))}return this.gpsInfo}_mneaTo(e,t){let i=this.nmea2dd(t);if("string"==typeof e)switch(e.toUpperCase()){case"DMS":i=this.nmea2dms(t);break;case"DM":i=this.nmea2dm(t);break;case"S":i=this.nmea2s(t)}return i}latitudeTo(e){return this._mneaTo(e,this._latitude)}longitudeTo(e){return this._mneaTo(e,this._longitude)}status2string(e){return"A"===(e=e||this.status)?"Active":"V"===e?"Void":e}fixMode2string(e){return 1===(e=e||this.fixMode)?"Fix not available":2===e?"2D":3===e?"3D":e}gpsQuality2string(e){return 0===(e=e||this.gpsQuality)?"Invalid":1===e?"GPS fix":2===e?"DGPS fix":e}nmea2dms(e){e=parseFloat(e);const t=Math.floor(e/100),i=Math.floor(100*(e/100-t));return t+""+i+"'"+(60*(100*(e/100-t)-i)).toFixed(1)+'"'}nmea2dm(e){e=parseFloat(e);const t=Math.floor(e/100);return t+""+(100*(e/100-t)).toFixed(4)+"'"}nmea2dd(e){e=parseFloat(e);const t=Math.floor(e/100),i=Math.floor(100*(e/100-t)/60);return parseFloat((t+i+60*(100*(e/100-t)-i)/3600).toFixed(6))}nmea2s(e){e=parseFloat(e);const t=Math.floor(e/100),i=Math.floor(100*(e/100-t)/60);return(t+i+60*(100*(e/100-t)-i)/3600)/(1/60/60)}}},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.keys=["vcc","gnd","mp3_rx","mp3_tx"],this.requiredKeys=["mp3_rx","mp3_tx"],this.ioKeys=this.keys,this.displayName="MP3",this.displayIoNames={mp3_rx:"MP3Rx",mp3_tx:"MP3Tx"}}static info(){return{name:"Grove_MP3"}}wired(e){this.obniz=e,e.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.my_tx=this.params.mp3_rx,this.my_rx=this.params.mp3_tx,this.uart=this.obniz.getFreeUart()}initWait(e){return r(this,void 0,void 0,(function*(){this.uart.start({tx:this.my_tx,rx:this.my_rx,baud:9600}),yield this.obniz.wait(100),this.uartSend(12,0),yield this.obniz.wait(500),this.uartSend(11,0),yield this.obniz.wait(100),e?"usb"===e?this.uartSend(9,1):"sd"===e&&this.uartSend(9,2):this.uartSend(9,2),yield this.obniz.wait(200)}))}setVolume(e){e>=0&&e<=31&&this.uartSend(6,e)}volUp(){this.uartSend(4,0)}volDown(){this.uartSend(5,0)}play(e,t){t?this.uart.send([126,255,6,15,0,t,e,239]):this.uartSend(18,e)}stop(){this.uartSend(22,0)}pause(){this.uartSend(14,0)}resume(){this.uartSend(13,0)}next(){this.uartSend(1,0)}prev(){this.uartSend(2,0)}uartSend(e,t){const i=t>>8,r=255&t;return this.uart.send([126,255,6,e,1,i,r,239]),this.uart.readBytes()}}},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.Sens=67e-5,this.sens1=0,this.sens2=0,this.keys=["vcc","out1","out2","gnd"],this.requiredKeys=["out1","out2"]}static info(){return{name:"ENC03R_Module"}}wired(e){this.obniz=e,e.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.ad0=e.getAD(this.params.out1),this.ad1=e.getAD(this.params.out2),this.ad0.start(e=>{this.sens1=(e-1.45)/this.Sens,this.onchange1&&this.onchange1(this.sens1)}),this.ad1.start(e=>{this.sens2=(e-1.35)/this.Sens,this.onchange2&&this.onchange2(this.sens2)})}get1Wait(){return new Promise(e=>r(this,void 0,void 0,(function*(){const t=yield this.ad0.getWait();this.sens1=(t-1.45)/this.Sens,e(this.sens1)})))}get2Wait(){return new Promise(e=>r(this,void 0,void 0,(function*(){const t=yield this.ad1.getWait();this.sens2=(t-1.35)/this.Sens,e(this.sens2)})))}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.keys=["recv","vcc","send","gnd"],this.requiredKeys=["recv","send"]}static info(){return{name:"IRModule"}}get dataSymbolLength(){return this.sensor.dataSymbolLength}set dataSymbolLength(e){this.sensor.dataSymbolLength=e,this.led.dataSymbolLength=e}wired(e){if(this.obniz=e,e.setVccGnd(this.params.vcc,this.params.gnd,"5v"),!e.isValidIO(this.params.recv))throw new Error("recv is not valid io");if(!e.isValidIO(this.params.send))throw new Error("send is not valid io");this.sensor=e.wired("IRSensor",{output:this.params.recv}),this.setGetterSetter("sensor","duration"),this.setGetterSetter("sensor","dataInverted"),this.setGetterSetter("sensor","cutTail"),this.setGetterSetter("sensor","output_pullup"),this.setGetterSetter("sensor","ondetect"),this.led=e.wired("InfraredLED",{anode:this.params.send})}send(e){this.led.send(e)}start(e){this.sensor.start(e)}setGetterSetter(e,t){Object.defineProperty(this,t,{get(){return this[e][t]},set(i){this[e][t]=i}})}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.dataSymbolLength=.07,this.duration=500,this.dataInverted=!0,this.triggerSampleCount=16,this.cutTail=!1,this.output_pullup=!0,this.ondetect=null,this.keys=["output","vcc","gnd"],this.requiredKeys=["output"]}static info(){return{name:"IRSensor"}}wired(e){if(this.obniz=e,e.setVccGnd(this.params.vcc,this.params.gnd,"5v"),!e.isValidIO(this.params.output))throw new Error("output is not valid io")}start(e){e&&(this.ondetect=e),this.output_pullup&&this.obniz.getIO(this.params.output).pull("5v"),this.obniz.logicAnalyzer.start({io:this.params.output,interval:this.dataSymbolLength,duration:this.duration,triggerValue:!this.dataInverted,triggerValueSamples:this.triggerSampleCount}),this.obniz.logicAnalyzer.onmeasured=e=>{if("function"==typeof this.ondetect){if(this.dataInverted){const t=new Uint8Array(e);for(let e=0;e<t.length;e++)t[e]=t[e]?0:1;e=Array.from(t)}if(this.cutTail)for(let t=e.length-1;t>1&&(0===e[t]&&0===e[t-1]);t--)e.splice(t,1);this.ondetect(e)}}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.dataSymbolLength=.07,this.keys=["anode","cathode"],this.requiredKeys=["anode"]}static info(){return{name:"InfraredLED"}}wired(e){if(this.obniz=e,!this.obniz.isValidIO(this.params.anode))throw new Error("anode is not valid io");if(this.params.cathode){if(!this.obniz.isValidIO(this.params.cathode))throw new Error("cathode is not valid io");this.io_cathode=e.getIO(this.params.cathode),this.io_cathode.output(!1)}this.pwm=this.obniz.getFreePwm(),this.pwm.start({io:this.params.anode}),this.pwm.freq(38e3),this.obniz.wait(150)}send(e){e&&e.length>0&&1===e[e.length-1]&&e.push(0),this.pwm.modulate("am",this.dataSymbolLength,e)}}},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.onchange=null,this.keys=["signal","vcc","gnd"],this.requiredKeys=["signal"]}static info(){return{name:"YG1006"}}wired(e){this.obniz=e,this.obniz.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.signal=this.obniz.getAD(this.params.signal),this.signal.start(e=>{this.onchange&&this.onchange(e)})}getWait(){return r(this,void 0,void 0,(function*(){return yield this.signal.getWait()}))}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.COMMON_TYPE_ANODE=1,this.COMMON_TYPE_CATHODE=0,this.anode_keys=["anode","anode_common","anodeCommon","vcc"],this.cathode_keys=["cathode","cathode_common","cathodeCommon","gnd"],this.animationName="FullColorLED-"+Math.round(1e3*Math.random()),this.keys=["r","g","b","common","commonType"],this.requiredKeys=["r","g","b","common","commonType"]}static info(){return{name:"FullColorLED"}}wired(e){const t=this.params.r,i=this.params.g,r=this.params.b,s=this.params.common,n=this.params.commonType;this.obniz=e,this.anode_keys.includes(n)?this.commontype=this.COMMON_TYPE_ANODE:this.cathode_keys.includes(n)?this.commontype=this.COMMON_TYPE_CATHODE:this.obniz.error("FullColorLED param need common type [  anode_common or cathode_common ] "),this.common=this.obniz.getIO(s),this.common.output(this.commontype),this.obniz.getIO(t).output(this.commontype),this.obniz.getIO(i).output(this.commontype),this.obniz.getIO(r).output(this.commontype),this.pwmR=this.obniz.getFreePwm(),this.pwmR.start({io:t}),this.pwmR.freq(1e3),this.pwmG=this.obniz.getFreePwm(),this.pwmG.start({io:i}),this.pwmG.freq(1e3),this.pwmB=this.obniz.getFreePwm(),this.pwmB.start({io:r}),this.pwmB.freq(1e3),this.rgb(0,0,0)}rgb(e,t,i){e=Math.min(Math.max(parseInt(e),0),255),t=Math.min(Math.max(parseInt(t),0),255),i=Math.min(Math.max(parseInt(i),0),255),this.commontype===this.COMMON_TYPE_ANODE&&(e=255-e,t=255-t,i=255-i),this.pwmR.duty(e/255*100),this.pwmG.duty(t/255*100),this.pwmB.duty(i/255*100)}hsv(e,t,i){const r=i*t,s=e/60,n=r*(1-Math.abs(s%2-1));let a=0,o=0,h=0;0<=s&&s<1&&([a,o,h]=[r,n,0]),1<=s&&s<2&&([a,o,h]=[n,r,0]),2<=s&&s<3&&([a,o,h]=[0,r,n]),3<=s&&s<4&&([a,o,h]=[0,n,r]),4<=s&&s<5&&([a,o,h]=[n,0,r]),5<=s&&s<6&&([a,o,h]=[r,0,n]);const c=i-r;[a,o,h]=[a+c,o+c,h+c],a=Math.floor(255*a),o=Math.floor(255*o),h=Math.floor(255*h),this.rgb(a,o,h)}gradation(e){const t=[],i=Math.round(e/18);for(let e=0;e<18;e++){const e={duration:i,state:e=>{this.hsv(10*e*2,1,1)}};t.push(e)}this.obniz.io.animation(this.animationName,"loop",t)}stopgradation(){this.obniz.io.animation(this.animationName,"pause")}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.keys=["anode","cathode"],this.requiredKeys=[]}static info(){return{name:"LED"}}wired(e){function t(t){return t&&"object"==typeof t&&"function"==typeof t.output?t:e.getIO(t)}this.obniz=e,this.obniz.isValidIO(this.params.anode)&&(this.io_anode=t(this.params.anode)),this.obniz.isValidIO(this.params.cathode)&&(this.io_cathode=t(this.params.cathode)),this.animationName="Led-"+this.params.anode,this.off()}on(){this.endBlink(),this._on()}off(){this.endBlink(),this._off()}output(e){e?this.on():this.off()}endBlink(){this.obniz.io.animation(this.animationName,"pause")}blink(e){e||(e=100);const t=[{duration:e,state:e=>{this._on()}},{duration:e,state:e=>{this._off()}}];this.obniz.io.animation(this.animationName,"loop",t)}_on(){this.io_anode&&this.io_cathode?(this.io_anode.output(!0),this.io_cathode.output(!1)):this.io_anode?this.io_anode.output(!0):this.io_cathode&&this.io_cathode.output(!1)}_off(){this.io_anode&&this.io_cathode?(this.io_anode.output(!1),this.io_cathode.output(!1)):this.io_anode?this.io_anode.output(!1):this.io_cathode&&this.io_cathode.output(!0)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(){this.keys=["din","vcc","gnd"],this.requiredKeys=["din"]}static info(){return{name:"WS2811"}}static _generateFromByte(e){e=parseInt(e);const t=[];for(let i=0;i<8;i+=2){let r=0;r=e&128>>i?224:128,r|=e&128>>i+1?14:8,t.push(r)}return t}static _generateColor(e,t,i){let s=r._generateFromByte(e);return s=s.concat(r._generateFromByte(t)),s=s.concat(r._generateFromByte(i)),s}static _generateHsvColor(e,t,i){const s=i*t,n=e/60,a=s*(1-Math.abs(n%2-1));let o,h,c;0<=n&&n<1&&([o,h,c]=[s,a,0]),1<=n&&n<2&&([o,h,c]=[a,s,0]),2<=n&&n<3&&([o,h,c]=[0,s,a]),3<=n&&n<4&&([o,h,c]=[0,a,s]),4<=n&&n<5&&([o,h,c]=[a,0,s]),5<=n&&n<6&&([o,h,c]=[s,0,a]);const d=i-s;[o,h,c]=[o+d,h+d,c+d],o=Math.floor(255*o),h=Math.floor(255*h),c=Math.floor(255*c);let u=r._generateFromByte(o);return u=u.concat(r._generateFromByte(h)),u=u.concat(r._generateFromByte(c)),u}wired(e){this.obniz=e,e.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.params.mode="master",this.params.frequency=2e6,this.params.mosi=this.params.din,this.params.drive="5v",this.spi=this.obniz.getSpiWithConfig(this.params)}rgb(e,t,i){this.spi.write(r._generateColor(e,t,i))}hsv(e,t,i){this.spi.write(r._generateHsvColor(e,t,i))}rgbs(e){let t=[];for(let i=0;i<e.length;i++){const s=e[i];t=t.concat(r._generateColor(s[0],s[1],s[2]))}this.spi.write(t)}hsvs(e){let t=[];for(let i=0;i<e.length;i++){const s=e[i];t=t.concat(r._generateHsvColor(s[0],s[1],s[2]))}this.spi.write(t)}}t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(){this.keys=["din","vcc","gnd"],this.requiredKeys=["din"]}static info(){return{name:"WS2812"}}static _generateFromByte(e){e=parseInt(e);const t=[];for(let i=0;i<8;i+=2){let r=0;r=e&128>>i?192:128,r|=e&128>>i+1?12:8,t.push(r)}return t}static _generateColor(e,t,i){let s=r._generateFromByte(t);return s=s.concat(r._generateFromByte(e)),s=s.concat(r._generateFromByte(i)),s}static _generateHsvColor(e,t,i){const s=i*t,n=e/60,a=s*(1-Math.abs(n%2-1));let o,h,c;0<=n&&n<1&&([o,h,c]=[s,a,0]),1<=n&&n<2&&([o,h,c]=[a,s,0]),2<=n&&n<3&&([o,h,c]=[0,s,a]),3<=n&&n<4&&([o,h,c]=[0,a,s]),4<=n&&n<5&&([o,h,c]=[a,0,s]),5<=n&&n<6&&([o,h,c]=[s,0,a]);const d=i-s;return[o,h,c]=[o+d,h+d,c+d],o=Math.floor(255*o),h=Math.floor(255*h),c=Math.floor(255*c),r._generateColor(o,h,c)}wired(e){this.obniz=e,e.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.params.mode="master",this.params.frequency=Math.floor(333e4),this.params.mosi=this.params.din,this.params.drive="5v",this.spi=this.obniz.getSpiWithConfig(this.params)}rgb(e,t,i){this.spi.write(r._generateColor(e,t,i))}hsv(e,t,i){this.spi.write(r._generateHsvColor(e,t,i))}rgbs(e){let t=[];for(let i=0;i<e.length;i++){const s=e[i];t=t.concat(r._generateColor(s[0],s[1],s[2]))}this.spi.write(t)}hsvs(e){let t=[];for(let i=0;i<e.length;i++){const s=e[i];t=t.concat(r._generateHsvColor(s[0],s[1],s[2]))}this.spi.write(t)}}t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(){this.keys=["din","vcc","gnd"],this.requiredKeys=["din"]}static info(){return{name:"WS2812B"}}static _generateFromByte(e){e=parseInt(e);const t=[];for(let i=0;i<8;i+=2){let r=0;r=e&128>>i?224:128,r|=e&128>>i+1?14:8,t.push(r)}return t}static _generateColor(e,t,i){let s=r._generateFromByte(t);return s=s.concat(r._generateFromByte(e)),s=s.concat(r._generateFromByte(i)),s}static _generateHsvColor(e,t,i){const s=i*t,n=e/60,a=s*(1-Math.abs(n%2-1));let o,h,c;0<=n&&n<1&&([o,h,c]=[s,a,0]),1<=n&&n<2&&([o,h,c]=[a,s,0]),2<=n&&n<3&&([o,h,c]=[0,s,a]),3<=n&&n<4&&([o,h,c]=[0,a,s]),4<=n&&n<5&&([o,h,c]=[a,0,s]),5<=n&&n<6&&([o,h,c]=[s,0,a]);const d=i-s;return[o,h,c]=[o+d,h+d,c+d],o=Math.floor(255*o),h=Math.floor(255*h),c=Math.floor(255*c),r._generateColor(o,h,c)}wired(e){this.obniz=e,e.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.params.mode="master",this.params.frequency=Math.floor(333e4),this.params.mosi=this.params.din,this.params.drive="5v",this.spi=this.obniz.getSpiWithConfig(this.params)}rgb(e,t,i){this.spi.write(r._generateColor(e,t,i))}hsv(e,t,i){this.spi.write(r._generateHsvColor(e,t,i))}rgbs(e){let t=[];for(let i=0;i<e.length;i++){const s=e[i];t=t.concat(r._generateColor(s[0],s[1],s[2]))}this.spi.write(t)}hsvs(e){let t=[];for(let i=0;i<e.length;i++){const s=e[i];t=t.concat(r._generateHsvColor(s[0],s[1],s[2]))}this.spi.write(t)}}t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(e,t){this.chip=e,this.id=t,this.value=0}output(e){this.chip.output(this.id,e)}}t.default=class{constructor(){this.keys=["gnd","vcc","ser","srclk","rclk","oe","srclr","io_num","enabled"],this.requiredKeys=["ser","srclk","rclk"],this.autoFlash=!0}static info(){return{name:"SNx4HC595"}}wired(e){this.obniz=e,this.io_ser=this.obniz.getIO(this.params.ser),this.io_srclk=this.obniz.getIO(this.params.srclk),this.io_rclk=this.obniz.getIO(this.params.rclk),this.io_ser.output(!1),this.io_srclk.output(!1),this.io_rclk.output(!1),this.obniz.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.obniz.isValidIO(this.params.srclr)&&(this.io_srclr=this.obniz.getIO(this.params.srclr),this.io_srclr.output(!0)),this.obniz.isValidIO(this.params.oe)&&(this.io_oe=this.obniz.getIO(this.params.oe),this.io_oe.output(!0)),(this.obniz.isValidIO(this.params.vcc)||this.obniz.isValidIO(this.params.gnd))&&this.obniz.wait(100),"number"!=typeof this.params.io_num&&(this.params.io_num=8),this.ioNum(this.params.io_num),"boolean"!=typeof this.params.enabled&&(this.params.enabled=!0),this.io_oe&&this.params.enabled&&this.io_oe.output(!1)}ioNum(e){if("number"!=typeof e||this._io_num===e)throw new Error("io num should be a number");this._io_num=e,this.io=[];for(let t=0;t<e;t++)this.io.push(new r(this,t));this.flush()}isValidIO(e){return"number"==typeof e&&e>=0&&e<this._io_num}getIO(e){if(!this.isValidIO(e))throw new Error("io "+e+" is not valid io");return this.io[e]}output(e,t){t=!0===t,this.io[e].value=t,this.autoFlash&&this.flush()}onece(e){if("function"!=typeof e)throw new Error("please provide function");const t=this.autoFlash;this.autoFlash=!1,e(),this.flush(),this.autoFlash=t}setEnable(e){if(!this.io_oe&&!1===e)throw new Error('pin "oe" is not specified');this.io_oe.output(!e)}flush(){this.io_rclk.output(!1);for(let e=this.io.length-1;e>=0;e--)this.io_ser.output(this.io[e].value),this.io_srclk.output(!0),this.io_srclk.output(!1);this.io_rclk.output(!0)}}},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.isNear=null,this.onchange=null,this.keys=["signal","gnd","vcc"],this.requiredKeys=["signal"],this.onChangeForStateWait=()=>{}}static info(){return{name:"CT10"}}wired(e){this.io_signal=e.getIO(this.params.signal),e.isValidIO(this.params.vcc)&&(this.io_vcc=e.getIO(this.params.vcc),this.io_vcc.output(!0)),e.isValidIO(this.params.gnd)&&(this.io_supply=e.getIO(this.params.gnd),this.io_supply.output(!1)),this.io_signal.pull("0v"),this.io_signal.input(e=>{this.isNear=e,this.onchange&&this.onchange(e),this.onChangeForStateWait(e)})}isNearWait(){return r(this,void 0,void 0,(function*(){return yield this.io_signal.inputWait()}))}stateWait(e){return new Promise(t=>{this.onChangeForStateWait=i=>{e===i&&(this.onChangeForStateWait=()=>{},t())}})}}},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.address={device:30,reset:[2,0],xMSB:[3]},this.keys=["gnd","sda","scl","i2c"],this.requiredKeys=[]}static info(){return{name:"HMC5883L"}}wired(e){this.obniz=e,e.setVccGnd(null,this.params.gnd,"3v"),this.params.clock=1e5,this.params.pull="3v",this.params.mode="master",this.i2c=e.getI2CWithConfig(this.params),this.obniz.wait(500)}init(){this.i2c.write(this.address.device,this.address.reset),this.obniz.wait(500)}get(){return r(this,void 0,void 0,(function*(){this.i2c.write(this.address.device,this.address.xMSB);const e=yield this.i2c.readWait(this.address.device,6),t={},i=["x","y","z"];for(let r=0;r<3;r++){let s=e[2*r]<<8|e[2*r+1];32768&s&&(s-=65536),t[i[r]]=s}return t}))}}},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.requiredKeys=["address"],this.keys=["sda","scl","clock","pull","i2c","address"]}static info(){return{name:"24LC256"}}wired(e){this.params.mode=this.params.mode||"master",this.params.clock=this.params.clock||4e5,this.i2c=e.getI2CWithConfig(this.params)}set(e,t){const i=[];i.push(e>>8&255),i.push(255&e),i.push.apply(i,t),this.i2c.write(80,i),this.obniz.wait(5)}getWait(e,t){return r(this,void 0,void 0,(function*(){const i=[];return i.push(e>>8&255),i.push(255&e),this.i2c.write(80,i),yield this.i2c.readWait(80,t)}))}}},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this._adc_cycle=0,this.keys=["gnd","vcc","sda","scl","i2c","address","adb_cycle"],this.requiredKeys=[]}static info(){return{name:"AK8963"}}wired(e){this.obniz=e,e.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.params.clock=1e5,this.params.pull="3v",this.params.mode="master",this._address=this.params.address||12,this.i2c=e.getI2CWithConfig(this.params),this.setConfig(this.params.adc_cycle||8)}setConfig(e){switch(e){case 8:this.i2c.write(this._address,[10,18]);break;case 100:this.i2c.write(this._address,[10,22]);break;default:throw new Error("ADC_cycle variable 8,100 setting")}this._adc_cycle=e}getWait(){return r(this,void 0,void 0,(function*(){this.i2c.write(this._address,[3]);const e=yield this.i2c.readWait(this._address,7);return{x:this.char2short(e[0],e[1]),y:this.char2short(e[2],e[3]),z:this.char2short(e[4],e[5])}}))}char2short(e,t){const i=new ArrayBuffer(2),r=new DataView(i);return r.setUint8(0,e),r.setUint8(1,t),r.getInt16(0,!1)}}},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.isPressed=null,this.onchange=null,this.keys=["signal","gnd","pull"],this.requiredKeys=["signal"],this.onChangeForStateWait=()=>{}}static info(){return{name:"Button"}}wired(e){this.io_signal=e.getIO(this.params.signal),e.isValidIO(this.params.gnd)&&(this.io_supply=e.getIO(this.params.gnd),this.io_supply.output(!1)),"3v"===this.params.pull?this.io_signal.pull("3v"):"0v"===this.params.pull?this.io_signal.pull("0v"):this.io_signal.pull("5v"),this.io_signal.input(e=>{this.isPressed=!1===e,this.onchange&&this.onchange(!1===e),this.onChangeForStateWait(!1===e)})}isPressedWait(){return r(this,void 0,void 0,(function*(){return!1===(yield this.io_signal.inputWait())}))}stateWait(e){return new Promise((t,i)=>{this.onChangeForStateWait=i=>{e===i&&(this.onChangeForStateWait=()=>{},t())}})}}},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.keys=["vcc","gnd","sda","scl","reset","ts","led1","led2"],this.requiredKeys=["gnd","sda","scl","reset","ts"],this.displayIoNames={sda:"sda",scl:"scl",gnd:"gnd",reset:"reset",ts:"ts"}}static info(){return{name:"FlickHat"}}wired(e){this.obniz=e,this.address=66,this.obniz.isValidIO(this.params.vcc)&&(this.obniz.getIO(this.params.vcc).drive("5v"),this.obniz.getIO(this.params.vcc).output(!0)),this.obniz.getIO(this.params.gnd).output(!1),this.io_reset=this.obniz.getIO(this.params.reset),this.io_reset.drive("3v"),this.io_ts=this.obniz.getIO(this.params.ts),this.io_ts.drive("open-drain"),this.io_ts.pull("3v"),this.params.mode="master",this.params.pull="3v",this.params.clock=1e5,this.i2c=this.obniz.getI2CWithConfig(this.params),this.obniz.isValidIO(this.params.led1)&&(this.led1=this.obniz.wired("LED",{anode:this.params.led1})),this.obniz.isValidIO(this.params.led2)&&(this.led2=this.obniz.wired("LED",{anode:this.params.led2}))}start(e){return r(this,void 0,void 0,(function*(){this.io_ts.pull("3v"),this.io_reset.output(!1),yield this.obniz.wait(50),this.io_reset.output(!0),yield this.obniz.wait(50),this.onfwinfo=e,this.fwInfo={fwValid:0,fwInfoReceived:!1},this.rotation=0,this.lastRotation=0,this.readSize=132,yield this.polling(),yield this.obniz.wait(200),this.i2c.write(this.address,[16,0,0,162,161,0,0,0,31,0,0,0,255,255,255,255]),yield this.obniz.wait(100),this.i2c.write(this.address,[16,0,0,162,128,0,0,0,63,0,0,0,63,0,0,0])}))}_dataArray2string(e){let t="";for(const i of e)t+=String.fromCharCode(i);return t}polling(e){return r(this,void 0,void 0,(function*(){e=e||3e3;const t=new Date;let i=!0;for(;i&&new Date-t<e;)i=yield this.io_ts.inputWait();if(!i){this.io_ts.pull("0v");const e=yield this.i2c.readWait(this.address,this.readSize),t=e[0],i=e[2],r=e[3];if(255!==t&&t>0){let s,n,a,o,h,c,d;switch((this.debugprint||this.obniz.debugprint)&&console.log("flickHat: "+e.slice(0,t).map(e=>"0x"+e.toString(16))),r){case 145:if(s=e[4]|e[5]<<8,n=e[7],a=e.slice(10,14),o=e.slice(14,18),h=e.slice(18,20),255===a[0]&&255===a[1]&&255===a[2]&&255===a[3])break;if(16&s&&1&n){const t={x:(e[20]|e[21]<<8)/65536,y:(e[22]|e[23]<<8)/65536,z:(e[24]|e[25]<<8)/65536,seq:i};this.xyz=t,"function"==typeof this.onxyz&&this.onxyz(t)}if(2&s&&a[0]>0){this.lastGesture=a[0];const e=[["","",""],["garbage","",""],["flick","west","east"],["flick","east","west"],["flick","south","north"],["flick","north","south"],["circle","clockwise",""],["circle","counter-clockwise",""],["wave","x",""],["wave","y",""],["hold","",""]];for(const t in e)t===a[0]&&"function"==typeof this.ongestureall&&this.ongestureall({action:e[t][0],from:e[t][1],to:e[t][2],raw:a,seq:i}),t===a[0]&&"flick"===e[t][0]&&"function"==typeof this.ongesture&&this.ongesture({action:"gesture",from:e[t][1],to:e[t][2],raw:a,seq:i})}if(4&s&&(0!==o[0]||0!==o[1])&&0===o[3]){const e=o[0]|o[1]<<8;if(65535===e)break;const t=[["touch","south"],["touch","west"],["touch","north"],["touch","east"],["touch","center"],["tap","south"],["tap","west"],["tap","north"],["tap","east"],["tap","center"],["doubletap","south"],["doubletap","west"],["doubletap","north"],["doubletap","east"],["doubletap","center"]],r=[],s=[],n=[];this.lastTouch=e;let a=1;for(const i in t){const o=t[i];if(e&a)switch(o[0]){case"touch":r.push(o[1]);break;case"tap":s.push(o[1]);break;case"doubletap":n.push(o[1])}a<<=1}r.length>0&&"function"==typeof this.ontouch&&this.ontouch({action:"touch",positions:r,raw:o,seq:i}),s.length>0&&"function"==typeof this.ontap&&this.ontap({action:"tap",positions:s,raw:o,seq:i}),n.length>0&&"function"==typeof this.ondoubletap&&this.ondoubletap({action:"doubletap",positions:n,raw:o,seq:i})}if(8&s&&2&n){const e=(h[0]-this.lastRotation)/32;this.rotation+=360*e,this.rotation%=360,0!==e&&e>-.5&&e<.5&&"function"==typeof this.onairwheel&&this.onairwheel({delta:360*e,rotation:this.rotation,raw:h,seq:i}),this.lastRotation=h[0]}break;case 21:c={msgId:e[4],maxCmdSize:e[5],error:e[6]|e[7]<<8},this.statusInfo=c,(this.debugprint||this.obniz.debugprint)&&console.log(`flickHat: system status: {msgId: ${c.msgId}, maxCmdSize: ${c.maxCmdSize}, error: ${c.error}}`);break;case 131:d={fwValid:170===e[4],hwRev:[e[5],e[6]],paramStartAddr:128*e[7],libLoaderVer:[e[8],e[9]],libLoaderPlatform:e[10],fwStartAddr:128*e[11],fwVersion:this._dataArray2string(e.slice(12,132)).split("\0")[0],fwInfoReceived:!0},this.fwInfo=d,"function"==typeof this.onfwinfo&&this.onfwinfo(d),this.readSize=26;break;default:console.error(`unknown message: 0x${r.toString(16)}, data:${e.slice(0,t).map(e=>"0x"+e.toString(16))}`)}}this.io_ts.pull("3v")}}))}}},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.keys=["vcc","gnd","signal"],this.requiredKeys=["signal"]}static info(){return{name:"HC-SR505"}}wired(e){this.obniz=e,this.io_signal=e.getIO(this.params.signal),e.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.io_signal.input(e=>{this.onchange&&this.onchange(e)})}getWait(){return r(this,void 0,void 0,(function*(){return yield this.io_signal.inputWait()}))}}},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.keys=["signal","vcc","gnd"],this.requiredKeys=["signal"]}static info(){return{name:"IPM-165"}}wired(e){this.obniz=e,this.obniz.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.signal=this.obniz.getAD(this.params.signal),this.signal.start(e=>{this.onchange&&this.onchange(e)})}getWait(){return r(this,void 0,void 0,(function*(){return yield this.signal.getWait()}))}}},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.keys=["sw","y","x","vcc","gnd","i2c"],this.requiredKeys=["sw","y","x"],this.pins=this.keys||["sw","y","x","vcc","gnd"],this.pinname={sw:"sw12"},this.shortName="joyS"}static info(){return{name:"JoyStick"}}wired(e){this.obniz=e,e.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.io_sig_sw=e.getIO(this.params.sw),this.ad_x=e.getAD(this.params.x),this.ad_y=e.getAD(this.params.y),this.io_sig_sw.pull("5v"),this.ad_x.start(e=>{this.positionX=e/5,this.onchangex&&this.onchangex(2*this.positionX-1)}),this.ad_y.start(e=>{this.positionY=e/5,this.onchangey&&this.onchangey(2*this.positionY-1)}),this.io_sig_sw.input(e=>{this.isPressed=!1===e,this.onchangesw&&this.onchangesw(!1===e)})}isPressedWait(){return r(this,void 0,void 0,(function*(){return!1===(yield this.io_sig_sw.inputWait())}))}getXWait(){return r(this,void 0,void 0,(function*(){const e=yield this.ad_x.getWait();return this.positionX=e/5,2*this.positionX-1}))}getYWait(){return r(this,void 0,void 0,(function*(){const e=yield this.ad_y.getWait();return this.positionY=e/5,2*this.positionY-1}))}}},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.keys=["x","y","z","vcc","gnd","enable","self_test"],this.requiredKeys=["x","y","z"]}static info(){return{name:"KXR94-2050"}}wired(e){this.obniz=e,e.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.ad_x=e.getAD(this.params.x),this.ad_y=e.getAD(this.params.y),this.ad_z=e.getAD(this.params.z),e.isValidIO(this.params.enable)&&(e.getIO(this.params.enable).drive("5v"),e.getIO(this.params.enable).output(!0)),e.isValidIO(this.params.self_test)&&(e.getIO(this.params.self_test).drive("5v"),e.getIO(this.params.self_test).output(!1)),this.changeVccVoltage(5),this.ad_x.start(e=>{this._x_val=e,this.onChangeX&&this.onChangeX(this.voltage2gravity(e)),this.onChange&&this.onChange(this._get())}),this.ad_y.start(e=>{this._y_val=e,this.onChangeY&&this.onChangeY(this.voltage2gravity(e)),this.onChange&&this.onChange(this._get())}),this.ad_z.start(e=>{this._z_val=e,this.onChangeZ&&this.onChangeZ(this.voltage2gravity(e)),this.onChange&&this.onChange(this._get())}),this.obniz.isValidIO(this.params.vcc)&&this.obniz.getAD(this.params.vcc).start(e=>{this.changeVccVoltage(e)})}changeVccVoltage(e){this.sensitivity=e/5,this.offsetVoltage=e/2}voltage2gravity(e){return(e-this.offsetVoltage)/this.sensitivity}get(){return this._get()}_get(){return{x:this.voltage2gravity(this._x_val),y:this.voltage2gravity(this._y_val),z:this.voltage2gravity(this._z_val)}}getWait(){return r(this,void 0,void 0,(function*(){return this._x_val=yield this.ad_x.getWait(),this._y_val=yield this.ad_y.getWait(),this._z_val=yield this.ad_z.getWait(),this._get()}))}}},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.keys=["x","y","z","vcc","gnd"],this.requiredKeys=["x","y","z"]}static info(){return{name:"KXSC7-2050"}}wired(e){return r(this,void 0,void 0,(function*(){this.obniz=e,e.setVccGnd(this.params.vcc,this.params.gnd,"3v"),this.ad_x=e.getAD(this.params.x),this.ad_y=e.getAD(this.params.y),this.ad_z=e.getAD(this.params.z),yield e.wait(500);const t=e.getAD(this.params.vcc),i=yield t.getWait(),r=yield this.ad_z.getWait(),s=i/5,n=r-s,a=this;this.ad_x.start(e=>{a.gravity=(e-n)/s,a.onchangex&&a.onchangex(a.gravity)}),this.ad_y.start(e=>{a.gravity=(e-n)/s,a.onchangey&&a.onchangey(a.gravity)}),this.ad_z.start(e=>{a.gravity=(e-n)/s,a.onchangez&&a.onchangez(a.gravity)})}))}}},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this._address=104,this.keys=["gnd","vcc","sda","scl","i2c","address","accelerometer_range","gyroscope_range"],this.requiredKeys=[]}static info(){return{name:"MPU6050"}}wired(e){this.obniz=e,e.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.params.clock=1e5,this.params.pull="3v",this.params.mode="master","number"==typeof this.params.address&&(this._address=this.params.address),this.i2c=e.getI2CWithConfig(this.params),this.setConfig(this.params.accelerometer_range||2,this.params.gyroscope_range||250)}setConfig(e,t){switch(e){case 2:this.i2c.write(this._address,[28,0]);break;case 4:this.i2c.write(this._address,[28,8]);break;case 8:this.i2c.write(this._address,[28,16]);break;case 16:this.i2c.write(this._address,[28,24]);break;default:throw new Error("accel_range variable 2,4,8,16 setting")}switch(t){case 250:this.i2c.write(this._address,[27,0]);break;case 500:this.i2c.write(this._address,[27,8]);break;case 1e3:this.i2c.write(this._address,[27,16]);break;case 2e3:this.i2c.write(this._address,[27,24]);break;default:throw new Error("accel_range variable 250,500,1000,2000 setting")}this._accel_range=e,this._gyro_range=t}getWait(){return r(this,void 0,void 0,(function*(){this.i2c.write(this._address,[59]);const e=yield this.i2c.readWait(this._address,14),t=this._accel_range/32768,i=this._gyro_range/32768;return{accelerometer:{x:this.char2short(e[0],e[1])*t,y:this.char2short(e[2],e[3])*t,z:this.char2short(e[4],e[5])*t},temp:this.char2short(e[6],e[7])/333.87+21,gyroscope:{x:this.char2short(e[8],e[9])*i,y:this.char2short(e[10],e[11])*i,z:this.char2short(e[12],e[13])*i}}}))}char2short(e,t){const i=new ArrayBuffer(2),r=new DataView(i);return r.setUint8(0,e),r.setUint8(1,t),r.getInt16(0,!1)}}},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(i(37));class a extends n.default{constructor(){super(),this.commands={},this.commands.whoami=117,this.commands.accelIntelCtrl=105,this.commands.smplrtDiv=25,this.commands.intPinCfg=55,this.commands.intEnable=56,this.commands.accelXoutH=59,this.commands.accelXoutL=60,this.commands.accelYoutH=61,this.commands.accelYoutL=62,this.commands.accelZoutH=63,this.commands.accelZoutL=64,this.commands.tempOutH=65,this.commands.tempOutL=66,this.commands.gyroXoutH=67,this.commands.gyroXoutL=68,this.commands.gyroYoutH=69,this.commands.gyroYoutL=70,this.commands.gyroZoutH=71,this.commands.gyroZoutL=72,this.commands.userCtrl=106,this.commands.pwrMgmt1=107,this.commands.pwrMgmt2=108,this.commands.config=26,this.commands.gyroConfig=27,this.commands.accelConfig=28,this.commands.accelConfig2=29,this.commands.fifoEn=35}static info(){return{name:"MPU6886"}}wired(e){super.wired(e),this.init()}i2cInfo(){return{address:104,clock:1e5,voltage:"3v"}}whoamiWait(){return r(this,void 0,void 0,(function*(){return(yield this.readWait(this.commands.whoami,1))[0]}))}init(){this.write(this.commands.pwrMgmt1,0),this.obniz.wait(10),this.write(this.commands.pwrMgmt1,128),this.obniz.wait(10),this.write(this.commands.pwrMgmt1,1),this.obniz.wait(10),this.setConfig(this.params.accelerometer_range||2,this.params.gyroscope_range||250),this.obniz.wait(1),this.write(this.commands.config,1),this.obniz.wait(1),this.write(this.commands.smplrtDiv,5),this.obniz.wait(1),this.write(this.commands.intEnable,0),this.obniz.wait(1),this.write(this.commands.accelConfig2,0),this.obniz.wait(1),this.write(this.commands.userCtrl,0),this.obniz.wait(1),this.write(this.commands.fifoEn,0),this.obniz.wait(1),this.write(this.commands.intPinCfg,34),this.obniz.wait(1),this.write(this.commands.intEnable,1),this.obniz.wait(1)}setConfig(e,t){switch(e){case 2:this.write(this.commands.accelConfig,0);break;case 4:this.write(this.commands.accelConfig,8);break;case 8:this.write(this.commands.accelConfig,16);break;case 16:this.write(this.commands.accelConfig,24);break;default:throw new Error("accel_range variable 2,4,8,16 setting")}switch(t){case 250:this.write(this.commands.gyroConfig,0);break;case 500:this.write(this.commands.gyroConfig,8);break;case 1e3:this.write(this.commands.gyroConfig,16);break;case 2e3:this.write(this.commands.gyroConfig,24);break;default:throw new Error("accel_range variable 250,500,1000,2000 setting")}this._accel_range=e,this._gyro_range=t}getAllDataWait(){return r(this,void 0,void 0,(function*(){const e=yield this.readWait(this.commands.accelXoutH,14),t=this._accel_range/32768,i=this._gyro_range/32768;return{accelerometer:{x:this.char2short(e[0],e[1])*t,y:this.char2short(e[2],e[3])*t,z:this.char2short(e[4],e[5])*t},temperature:this.char2short(e[6],e[7])/326.8+25,gyroscope:{x:this.char2short(e[8],e[9])*i,y:this.char2short(e[10],e[11])*i,z:this.char2short(e[12],e[13])*i}}}))}getTempWait(){return r(this,void 0,void 0,(function*(){return(yield this.getAllDataWait()).temperature}))}getAccelWait(){return r(this,void 0,void 0,(function*(){return(yield this.getAllDataWait()).accelerometer}))}getGyroWait(){return r(this,void 0,void 0,(function*(){return(yield this.getAllDataWait()).gyroscope}))}}t.default=a},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.keys=["gnd","vcc","sda","scl","i2c","address"],this.requiredKeys=[]}static info(){return{name:"MPU9250"}}wired(e){this.obniz=e,e.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this._address=this.params.address||104,this.params.clock=1e5,this.params.pull="3v",this.params.mode="master",this.i2c=e.getI2CWithConfig(this.params),this.i2c.write(this._address,[107,0]),this.i2c.write(this._address,[55,2]),this.i2c.write(this._address,[26,6]),this.i2c.write(this._address,[29,2]),this.mpu6050=e.wired("MPU6050",{i2c:this.i2c}),this.ak8963=e.wired("AK8963",{i2c:this.i2c})}setConfig(e,t,i){this.mpu6050.setConfig(e,t),this.ak8963.setConfig(i)}_getAK8963Wait(){return r(this,void 0,void 0,(function*(){return yield this.i2c.write(this._address,[2]),1&(yield this.i2c.readWait(this._address,1))?yield this.ak8963.getWait():{}}))}getAllWait(){return r(this,void 0,void 0,(function*(){const e=yield this.mpu6050.getWait();return e.compass=yield this.ak8963.getWait(),e}))}getCompassWait(){return r(this,void 0,void 0,(function*(){return yield this.ak8963.getWait()}))}getAccelerometerWait(){return r(this,void 0,void 0,(function*(){return(yield this.mpu6050.getWait()).accelerometer}))}getGyroscopeWait(){return r(this,void 0,void 0,(function*(){return(yield this.mpu6050.getWait()).gyroscope}))}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.keys=["vcc","gnd","signal"],this.requiredKeys=["signal"]}static info(){return{name:"PaPIRsVZ"}}wired(e){this.obniz=e,this.io_signal=e.getIO(this.params.signal),this.io_signal.pull("0v"),e.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.io_signal.input(e=>{this.onchange&&this.onchange(e)})}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.vcc_voltage=5,this.position=0,this.keys=["pin0","pin1","pin2"],this.requiredKeys=["pin0","pin1","pin2"]}static info(){return{name:"Potentiometer"}}wired(e){this.obniz.setVccGnd(this.params.pin0,this.params.pin2,"5v"),this.ad=e.getAD(this.params.pin1),e.getAD(this.params.pin0).start(e=>{this.vcc_voltage=e}),this.ad.start(e=>{this.position=e/this.vcc_voltage,this.onchange&&this.onchange(this.position)})}}},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(i(37));class a extends n.default{constructor(){super(),this.commands={},this.commands.whoami=48,this.commands.accConfig=14,this.commands.gyroConfig=15,this.commands.gyroDlpf=17,this.commands.fifoConfig=18,this.commands.accRange=22,this.commands.gyroRange=43,this.commands.outputAcc=0,this.commands.outputGyro=6,this.commands.outputTemp=12,this.commands.regSet1=186,this.commands.regSet2=202,this.commands.adcReset=194,this.commands.softReset=127,this.commands.reset=117}static info(){return{name:"SH200Q"}}wired(e){super.wired(e)}i2cInfo(){return{address:108,clock:1e5,voltage:"3v"}}whoamiWait(){return r(this,void 0,void 0,(function*(){return(yield this.readWait(this.commands.whoami,1))[0]}))}initWait(){return r(this,void 0,void 0,(function*(){yield this.resetAdcWait(),yield this.writeFlagWait(216,7),yield this.obniz.wait(1),yield this.clearFlagWait(216,7),yield this.write(120,97),yield this.obniz.wait(1),yield this.write(120,0),yield this.write(this.commands.accConfig,145),yield this.write(this.commands.gyroConfig,19),yield this.write(this.commands.gyroDlpf,3),yield this.write(this.commands.fifoConfig,0),this.setConfig(8,2e3),yield this.write(this.commands.regSet1,192),yield this.writeFlagWait(this.commands.regSet2,4),yield this.obniz.wait(1),yield this.clearFlagWait(this.commands.regSet2,4),yield this.obniz.wait(10)}))}setConfig(e,t){switch(e){case 4:this.write(this.commands.accRange,0);break;case 8:this.write(this.commands.accRange,1);break;case 16:this.write(this.commands.accRange,16);break;default:throw new Error("accel_range variable 4,8,16 setting")}switch(t){case 125:this.write(this.commands.gyroRange,4);break;case 250:this.write(this.commands.gyroRange,3);break;case 500:this.write(this.commands.gyroRange,2);break;case 1e3:this.write(this.commands.gyroRange,1);break;case 2e3:this.write(this.commands.gyroRange,0);break;default:throw new Error("gyroscope_range variable 125,250,500,1000,2000 setting")}this._accel_range=e,this._gyro_range=t}resetAdcWait(){return r(this,void 0,void 0,(function*(){const e=yield this.readWait(this.commands.adcReset,1);e[0]=4|e[0],this.write(this.commands.adcReset,e),yield this.obniz.wait(1),e[0]=251&e[0],this.write(this.commands.adcReset,e)}))}getAllDataWait(){return r(this,void 0,void 0,(function*(){const e=yield this.readWait(this.commands.outputAcc,14),t=this._accel_range/32768,i=this._gyro_range/32768,r={x:this.char2short(e[0],e[1])*t,y:this.char2short(e[2],e[3])*t,z:this.char2short(e[4],e[5])*t},s={x:this.char2short(e[6],e[7])*i,y:this.char2short(e[8],e[9])*i,z:this.char2short(e[10],e[11])*i};return{accelerometer:r,temperature:this.char2short(e[12],e[13])/333.87+21,gyroscope:s}}))}getTempWait(){return r(this,void 0,void 0,(function*(){const e=yield this.readWait(this.commands.outputTemp,2);return this.char2short(e[1],e[0])/333.87+21}))}getAccelWait(){return r(this,void 0,void 0,(function*(){return(yield this.getAllDataWait()).accelerometer}))}getGyroWait(){return r(this,void 0,void 0,(function*(){return(yield this.getAllDataWait()).gyroscope}))}}t.default=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.keys=["forward","back"],this.requiredKeys=["forward","back"]}static info(){return{name:"DCMotor"}}wired(e){this.status={direction:null,power:null},this.pwm1_io_num=this.params.forward,this.pwm2_io_num=this.params.back,this.pwm1=e.getFreePwm(),this.pwm1.start({io:this.pwm1_io_num}),this.pwm1.freq(1e5),this.pwm2=e.getFreePwm(),this.pwm2.start({io:this.pwm2_io_num}),this.pwm2.freq(1e5),this.power(30)}forward(){this.move(!0)}reverse(){this.move(!1)}stop(){null!==this.status.direction&&(this.status.direction=null,this.pwm1.duty(0),this.pwm2.duty(0))}move(e){if(e){if(!0===this.status.direction)return;this.status.direction=!0}else{if(!1===this.status.direction)return;this.status.direction=!1}const t=this.power();this.power(0),this.power(t)}power(e){return void 0===e?this.status.power:(this.status.power=e,null===this.status.direction?(this.pwm1.duty(0),void this.pwm2.duty(0)):void(this.status.direction?(this.pwm1.duty(e),this.pwm2.duty(0)):(this.pwm1.duty(0),this.pwm2.duty(e))))}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(e,t){this.value=0,this.state={},this.chip=e,this.id=t}freq(e){this.chip.freq(e)}pulse(e){this.chip.pulse(this.id,e)}duty(e){this.chip.duty(this.id,e)}}t.default=class{constructor(){this.pwms=[],this._freq=0,this.keys=["gnd","vcc","scl","sda","oe","i2c","enabled","address","drive"],this.requiredKeys=[],this.address=64,this._commands={MODE1:0,MODE2:1,SUBADR1:2,SUBADR2:3,SUBADR3:4,PRESCALE:254,LED0_ON_L:6,ALL_LED_ON_L:250,bits:{ALLCALL:1,SLEEP_ENABLE:16,AUTO_INCREMENT_ENABLED:32,RESTART:128,OUTDRV:4,INVRT:16}},this._regs=new Array(1),this.pwmNum=16,this.pwms=[],this._preparePWM(this.pwmNum)}static info(){return{name:"PCA9685"}}wired(e){this.obniz=e,e.isValidIO(this.params.oe)&&(this.io_oe=e.getIO(this.params.oe)),this.obniz.setVccGnd(this.params.vcc,this.params.gnd,"5v"),"number"==typeof this.params.address&&(this.address=this.params.address),this.params.clock=this.params.clock||4e5,this.params.mode=this.params.mode||"master",this.params.pull=this.params.pull||"5v",this.i2c=e.getI2CWithConfig(this.params),this.obniz.isValidIO(this.params.srclr)&&(this.io_srclr=this.obniz.getIO(this.params.srclr),this.io_srclr.output(!0)),"boolean"!=typeof this.params.enabled&&(this.params.enabled=!0),this.io_oe&&this.params.enabled&&this.io_oe.output(!1),"open-drain"===this.params.drive&&this.i2c.write(this.address,[this._commands.MODE2,this._commands.bits.OUTDRV]);let t=this._commands.bits.AUTO_INCREMENT_ENABLED;t&=~this._commands.bits.SLEEP_ENABLE,this.i2c.write(this.address,[this._commands.MODE1,t]),this.i2c.write(this.address,[this._commands.MODE1,t|this._commands.bits.RESTART]),this._regs[this._commands.MODE1]=t,e.wait(10)}_preparePWM(e){for(let t=0;t<e;t++)this.pwms.push(new r(this,t))}isValidPWM(e){return"number"==typeof e&&e>=0&&e<this.pwmNum}getPWM(e){if(!this.isValidPWM(e))throw new Error("pwm "+e+" is not valid pwm");return this.pwms[e]}freq(e){if("number"!=typeof e)return;if(e<24||1526<e)throw new Error("freq must be within 24-1526 hz");if(this._freq===e)return;let t=25e6;t/=4096,t/=.9*e,t-=1;const i=Math.floor(Math.floor(t+.5)),r=this._regs[this._commands.MODE1];this.i2c.write(this.address,[this._commands.MODE1,127&r|this._commands.bits.SLEEP_ENABLE]),this.i2c.write(this.address,[this._commands.PRESCALE,i]),this.i2c.write(this.address,[this._commands.MODE1,r]),this.obniz.wait(5),this._freq=e;for(let e=0;e<this.pwms.length;e++)this.pwms[e].state.freq=this._freq}pulse(e,t){if("number"!=typeof this._freq||this._freq<=0)throw new Error("please provide freq first.");this.duty(e,t/1e3/(1/this._freq)*100)}duty(e,t){if(t*=1,"number"!=typeof this._freq||this._freq<=0)throw new Error("please provide freq first.");if("number"!=typeof t)throw new Error("please provide duty in number");t<0&&(t=0),t>100&&(t=100),this.getPWM(e).state.duty=t,this.writeSingleONOFF(e,0,t/100*4095)}writeSingleONOFF(e,t,i){this.i2c.write(this.address,[this._commands.LED0_ON_L+4*e,255&t,t>>8,255&i,i>>8])}setEnable(e){if(!this.io_oe&&!1===e)throw new Error('pin "oe" is not specified');this.io_oe.output(!e)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.range={min:.5,max:2.4},this.keys=["gnd","vcc","signal","pwm"],this.requiredKeys=[]}static info(){return{name:"ServoMotor"}}wired(e){if(this.obniz=e,this.obniz.setVccGnd(this.params.vcc,this.params.gnd,"5v"),e.isValidIO(this.params.vcc)&&(this.io_vcc=e.getIO(this.params.vcc)),this.params.pwm)this.pwm=this.params.pwm;else{if(this.pwm=e.getFreePwm(),this.pwm_io_num=this.params.signal,"number"!=typeof this.pwm_io_num)throw new Error("no io specified for pwm");this.pwm.start({io:this.pwm_io_num})}this.pwm.freq(50)}angle(e){const t=this.range.max,i=this.range.min,r=(t-i)*e/180+i;this.pwm.pulse(r)}on(){this.io_vcc&&this.io_vcc.output(!0)}off(){this.io_vcc&&this.io_vcc.output(!1)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.keys=["gnd","signal"],this.requiredKeys=["signal"]}static info(){return{name:"Solenoid"}}wired(e){this.obniz=e,e.isValidIO(this.params.gnd)&&(this.io_gnd=e.getIO(this.params.gnd),this.io_gnd.output(!1)),this.io_signal=e.getIO(this.params.signal),this.io_signal.output(!1)}on(){this.io_signal.output(!0)}off(){this.io_signal.output(!1)}click(e){this.on(),"number"!=typeof e&&(e=100),this.obniz.wait(e),this.off()}doubleClick(e){"number"!=typeof e&&(e=100),this.click(e),this.obniz.wait(e),this.click(e)}}},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.currentStep=0,this.frequency=100,this.rotationStepCount=100,this.milliMeterStepCount=1,this.ios=[],this._stepInstructions={1:[[0,1,1,1],[1,0,1,1],[1,1,0,1],[1,1,1,0]],2:[[0,0,1,1],[1,0,0,1],[1,1,0,0],[0,1,1,0]],"1-2":[[0,1,1,1],[0,0,1,1],[1,0,1,1],[1,0,0,1],[1,1,0,1],[1,1,0,0],[1,1,1,0],[0,1,1,0]]},this._stepType="2",this.keys=["a","b","aa","bb","common"],this.requiredKeys=["a","b","aa","bb"]}static info(){return{name:"StepperMotor"}}wired(e){this.obniz=e,e.isValidIO(this.params.common)?(this.common=e.getIO(this.params.common),this.common.output(!0),this.type="unipolar"):this.type="bipolar",this.ios=[],this.ios.push(e.getIO(this.params.a)),this.ios.push(e.getIO(this.params.b)),this.ios.push(e.getIO(this.params.aa)),this.ios.push(e.getIO(this.params.bb))}stepWait(e){return r(this,void 0,void 0,(function*(){if("number"!=typeof e)throw new Error("must provide number");if(0===(e=Math.round(e)))return;const t=Math.abs(e),i=this._getStepInstructions(),r=i.length,s=[];let n=this.currentStep%r;if(n<0&&(n=r- -1*n),e>0)for(let e=0;e<i.length;e++)++n>=r&&(n=0),s.push(i[n]);else for(let e=0;e<i.length;e++)--n<0&&(n=r-1),s.push(i[n]);let a=1e3/this.frequency;a=parseInt(a),a<1&&(a=1);const o=e=>{const t=s[e];for(let e=0;e<this.ios.length;e++)this.ios[e].output(t[e])},h=[];for(let e=0;e<r;e++)h.push({duration:a,state:o});yield this.obniz.io.repeatWait(h,t),this.currentStep+=e}))}stepToWait(e){return r(this,void 0,void 0,(function*(){const t=e-this.currentStep;yield this.stepWait(t)}))}holdWait(){return r(this,void 0,void 0,(function*(){const e=this._getStepInstructions(),t=e.length;let i=this.currentStep%t;i<0&&(i=t- -1*i);for(let t=0;t<this.ios.length;t++)this.ios[t].output(1===e[i][t]);yield this.obniz.pingWait()}))}freeWait(){return r(this,void 0,void 0,(function*(){for(let e=0;e<this.ios.length;e++)this.ios[e].output(!0);yield this.obniz.pingWait()}))}stepType(e){if(!this._stepInstructions[e])throw new Error("unknown step type "+e);this._stepType=e}speed(e){this.frequency=e}currentRotation(){return this.currentStep/this.rotationStepCount*360}currentAngle(){let e=Math.floor(1e3*this.currentRotation())%36e4/1e3;return e<0&&(e=360-e),e}rotateWait(e){return r(this,void 0,void 0,(function*(){const t=(e/=360)*this.rotationStepCount;yield this.stepWait(t)}))}rotateToWait(e){return r(this,void 0,void 0,(function*(){let t=e-this.currentAngle();Math.abs(t)>180&&(t=t>0?t-360:360+t),t=t/360*this.rotationStepCount,yield this.stepWait(t)}))}currentDistance(){return this.currentStep/this.milliMeterStepCount}moveWait(e){return r(this,void 0,void 0,(function*(){const t=e*this.milliMeterStepCount;yield this.stepWait(t)}))}moveToWait(e){return r(this,void 0,void 0,(function*(){const t=(e-this.currentDistance())*this.milliMeterStepCount;yield this.stepWait(t)}))}_getStepInstructions(){return this._stepInstructions[this._stepType]}}},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.requiredKeys=[],this.keys=["sda","scl","i2c"]}static info(){return{name:"AXP192"}}wired(e){this.params.mode="master",this.params.clock=4e5,this.i2c=e.getI2CWithConfig(this.params)}set(e,t){this.i2c.write(s,[e,t])}getWait(e){return r(this,void 0,void 0,(function*(){return this.i2c.write(s,[e]),yield this.i2c.readWait(s,1)}))}setLDO2Voltage(e){return r(this,void 0,void 0,(function*(){e<1.8&&(e=1.8),e>3.3&&(e=3.3);let t=yield this.getWait(o),i=10*(e-1.8);i>15&&(i=15),t=15&t|i<<4,console.log("set voltage to ",t),this.set(o,t)}))}setLDO3Voltage(e){return r(this,void 0,void 0,(function*(){e<1.8&&(e=1.8),e>3.3&&(e=3.3);let t=yield this.getWait(o),i=10*(e-1.8);i>15&&(i=15),t=240&t|i,this.set(o,t)}))}set3VLDO2_3(){this.set(o,204)}enableLDO2_3(){this.set(a,77)}toggleLDO2(e){return r(this,void 0,void 0,(function*(){const t=e?1:0;let i=yield this.getWait(a);i=i&y|t<<2,this.set(a,i)}))}toggleLDO3(e){return r(this,void 0,void 0,(function*(){const t=e?1:0;let i=yield this.getWait(a);i=i&b|t<<3,this.set(a,i)}))}initM5StickC(){this.i2c.write(s,[n,255]),this.i2c.write(s,[o,204]),this.i2c.write(s,[m,255]),this.i2c.write(s,[c,192]),this.i2c.write(s,[g,128]),this.i2c.write(s,[a,77]),this.i2c.write(s,[u,12]),this.i2c.write(s,[_,2]),this.i2c.write(s,[h,224]),this.i2c.write(s,[l,252]),this.i2c.write(s,[d,162])}getVbat(){return r(this,void 0,void 0,(function*(){this.i2c.write(s,[f]);const e=yield this.i2c.readWait(s,1);return this.i2c.write(s,[p]),(e<<4)+(yield this.i2c.readWait(s,1))}))}};const s=52,n=16,a=18,o=40,h=48,c=51,d=53,u=54,l=57,f=120,p=121,m=130,_=144,g=184,y=251,b=247},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.configration={DPS310__STD_SLAVE_ADDRESS:119},this.DPS310__OSR_SE=3,this.DPS310__LSB=1,this.DPS310__PRS_STD_MR=2,this.DPS310__PRS_STD_OSR=3,this.DPS310__TEMP_STD_MR=2,this.DPS310__TEMP_STD_OSR=3,this.DPS310__SUCCEEDED=0,this.DPS310__FAIL_UNKNOWN=-1,this.DPS310__FAIL_INIT_FAILED=-2,this.DPS310__FAIL_TOOBUSY=-3,this.DPS310__FAIL_UNFINISHED=-4,this.prsMr=0,this.prsOsr=0,this.tempMr=0,this.tempOsr=0,this.m_lastTempScal=0,this.mode={IDLE:0,CMD_PRS:1,CMD_TEMP:2,INVAL_OP_CMD_BOTH:3,INVAL_OP_CONT_NONE:4,CONT_PRS:5,CONT_TMP:6,CONT_BOTH:7},this.bitFileds={DPS310__REG_INFO_PROD_ID:{address:13,mask:15,shift:0},DPS310__REG_INFO_REV_ID:{address:13,mask:240,shift:4},DPS310__REG_INFO_TEMP_SENSORREC:{address:40,mask:128,shift:7},DPS310__REG_INFO_TEMP_SENSOR:{address:7,mask:128,shift:7},DPS310__REG_INFO_OPMODE:{address:8,mask:7,shift:0},DPS310__REG_INFO_FIFO_FL:{address:12,mask:128,shift:7},DPS310__REG_INFO_FIFO_EN:{address:9,mask:2,shift:1},DPS310__REG_INFO_TEMP_MR:{address:7,mask:112,shift:4},DPS310__REG_INFO_TEMP_OSR:{address:7,mask:7,shift:0},DPS310__REG_INFO_PRS_MR:{address:6,mask:112,shift:4},DPS310__REG_INFO_PRS_OSR:{address:6,mask:7,shift:0},DPS310__REG_INFO_PRS_SE:{address:9,mask:4,shift:2},DPS310__REG_INFO_PRS_RDY:{address:8,mask:16,shift:4},DPS310__REG_INFO_TEMP_SE:{address:9,mask:8,shift:3},DPS310__REG_INFO_TEMP_RDY:{address:8,mask:32,shift:5}},this.dataBlock={DPS310__REG_ADR_COEF:{address:16,length:18},DPS310__REG_ADR_PRS:{address:0,length:3},DPS310__REG_ADR_TEMP:{address:3,length:3}},this.scaling_facts=[524288,1572864,3670016,7864320,253952,516096,1040384,2088960],this.requiredKeys=["sda","scl"],this.keys=["gpio3","vcc","gnd","scl","sda"],this.ioKeys=["gpio3","vcc","gnd","scl","sda"],this.coeffs={},this.opMode=this.mode.IDLE}static info(){return{name:"DPS310",datasheet:""}}wired(e){this.obniz=e,this.address=119,this.params.sda=this.params.sda,this.params.scl=this.params.scl,this.params.clock=this.params.clock||1e5,this.params.mode="master",this.params.pull="3v",this.i2c=e.getI2CWithConfig(this.params),this.obniz.wait(10)}initWait(){return r(this,void 0,void 0,(function*(){if(0!==(yield this.readByteBitfieldWait(this.bitFileds.DPS310__REG_INFO_PROD_ID)))throw new Error("invalid prodId");yield this.readByteBitfieldWait(this.bitFileds.DPS310__REG_INFO_REV_ID),yield this.readByteBitfieldWait(this.bitFileds.DPS310__REG_INFO_TEMP_SENSORREC),yield this.writeByteBitfield(this.bitFileds.DPS310__REG_INFO_TEMP_SENSOR,0),yield this.readCoeffsWait(),yield this.standbyWait(),yield this.configTempWait(this.DPS310__TEMP_STD_MR,this.DPS310__TEMP_STD_OSR),yield this.configPressureWait(this.DPS310__PRS_STD_MR,this.DPS310__PRS_STD_OSR),yield this.standbyWait(),yield this.measureTempOnceWait(),yield this.standbyWait(),yield this.correctTempWait()}))}measurePressureOnceWait(e){return r(this,void 0,void 0,(function*(){return void 0===e&&(e=this.prsOsr),yield this.startMeasurePressureOnceWait(e),yield this.obniz.wait(100),yield this.getSingleResultWait()}))}readByteWait(e){return r(this,void 0,void 0,(function*(){return this.i2c.write(this.address,[e]),yield this.obniz.wait(1),(yield this.i2c.readWait(this.address,1))[0]}))}readByteBitfieldWait(e){return r(this,void 0,void 0,(function*(){const t=e.address,i=e.mask,r=e.shift;let s=yield this.readByteWait(t);return s<0?s:(void 0!==i&&(s&=i),void 0!==r&&(s>>=r),s)}))}readBlockWait(e){return r(this,void 0,void 0,(function*(){const t=e.address,i=e.length;return yield this.obniz.wait(1),this.i2c.write(this.address,[t]),yield this.i2c.readWait(this.address,i)}))}writeByteWait(e,t,i){return r(this,void 0,void 0,(function*(){if(this.i2c.write(this.address,[e,t]),i&&(yield this.readByteWait(e))!==t)throw new Error("DPS310 data write failed")}))}writeByteBitfield(e,t,i){return r(this,void 0,void 0,(function*(){const r=(yield this.readByteWait(e.address))&~e.mask|t<<e.shift&e.mask;yield this.writeByteWait(e.address,r,i)}))}setOpModeDetailWait(e,t,i){return r(this,void 0,void 0,(function*(){const r=(e&this.DPS310__LSB)<<2|(t&this.DPS310__LSB)<<1|i&this.DPS310__LSB;return yield this.setOpModeWait(r)}))}setOpModeWait(e){return r(this,void 0,void 0,(function*(){e&=this.bitFileds.DPS310__REG_INFO_OPMODE.mask>>this.bitFileds.DPS310__REG_INFO_OPMODE.shift,yield this.writeByteWait(this.bitFileds.DPS310__REG_INFO_OPMODE.address,e),this.opMode=e}))}standbyWait(){return r(this,void 0,void 0,(function*(){this.setOpModeWait(this.mode.IDLE),yield this.writeByteBitfield(this.bitFileds.DPS310__REG_INFO_FIFO_FL,1),yield this.writeByteBitfield(this.bitFileds.DPS310__REG_INFO_FIFO_EN,0)}))}configTempWait(e,t){return r(this,void 0,void 0,(function*(){yield this.writeByteBitfield(this.bitFileds.DPS310__REG_INFO_TEMP_MR,e),yield this.writeByteBitfield(this.bitFileds.DPS310__REG_INFO_TEMP_OSR,t),t>this.DPS310__OSR_SE?yield this.writeByteBitfield(this.bitFileds.DPS310__REG_INFO_TEMP_SE,1):yield this.writeByteBitfield(this.bitFileds.DPS310__REG_INFO_TEMP_SE,0),this.tempMr=e,this.tempOsr=t}))}configPressureWait(e,t){return r(this,void 0,void 0,(function*(){yield this.writeByteBitfield(this.bitFileds.DPS310__REG_INFO_PRS_MR,e),yield this.writeByteBitfield(this.bitFileds.DPS310__REG_INFO_PRS_OSR,t),t>this.DPS310__OSR_SE?yield this.writeByteBitfield(this.bitFileds.DPS310__REG_INFO_PRS_SE,1):yield this.writeByteBitfield(this.bitFileds.DPS310__REG_INFO_PRS_SE,0),this.prsMr=e,this.prsOsr=t}))}readCoeffsWait(){return r(this,void 0,void 0,(function*(){const e=yield this.readBlockWait(this.dataBlock.DPS310__REG_ADR_COEF);this.coeffs.m_c0Half=e[0]<<4|e[1]>>4&15,2048&this.coeffs.m_c0Half&&(this.coeffs.m_c0Half-=4096),this.coeffs.m_c0Half=this.coeffs.m_c0Half/2,this.coeffs.m_c1=(15&e[1])<<8|e[2],2048&this.coeffs.m_c1&&(this.coeffs.m_c1-=4096),this.coeffs.m_c00=e[3]<<12|e[4]<<4|e[5]>>4&15,this.coeffs.m_c00&1<<19&&(this.coeffs.m_c00-=1<<20),this.coeffs.m_c10=(15&e[5])<<16|e[6]<<8|e[7],this.coeffs.m_c10&1<<19&&(this.coeffs.m_c10-=1<<20),this.coeffs.m_c01=e[8]<<8|e[9],32768&this.coeffs.m_c01&&(this.coeffs.m_c01-=65536),this.coeffs.m_c11=e[10]<<8|e[11],32768&this.coeffs.m_c11&&(this.coeffs.m_c11-=65536),this.coeffs.m_c20=e[12]<<8|e[13],32768&this.coeffs.m_c20&&(this.coeffs.m_c20-=65536),this.coeffs.m_c21=e[14]<<8|e[15],32768&this.coeffs.m_c21&&(this.coeffs.m_c21-=65536),this.coeffs.m_c30=e[16]<<8|e[17],32768&this.coeffs.m_c30&&(this.coeffs.m_c30-=65536)}))}getSingleResultWait(){return r(this,void 0,void 0,(function*(){let e,t;switch(this.opMode){case this.mode.CMD_TEMP:e=yield this.readByteBitfieldWait(this.bitFileds.DPS310__REG_INFO_TEMP_RDY);break;case this.mode.CMD_PRS:e=yield this.readByteBitfieldWait(this.bitFileds.DPS310__REG_INFO_PRS_RDY);break;default:return this.DPS310__FAIL_TOOBUSY}switch(e){case this.DPS310__FAIL_UNKNOWN:throw new Error("DPS310__FAIL_UNKNOWN");case 0:return this.obniz.wait(10).then(()=>this.getSingleResultWait());case 1:switch(t=this.opMode,this.opMode=this.mode.IDLE,t){case this.mode.CMD_TEMP:return yield this.getTempWait();case this.mode.CMD_PRS:return yield this.getPressureWait();default:throw new Error("DPS310__FAIL_UNKNOWN")}}throw new Error("DPS310__FAIL_UNKNOWN")}))}startMeasureTempOnceWait(e){return r(this,void 0,void 0,(function*(){yield this.configTempWait(0,e),yield this.setOpModeDetailWait(0,1,0)}))}startMeasurePressureOnceWait(e){return r(this,void 0,void 0,(function*(){yield this.configPressureWait(0,e),yield this.setOpModeDetailWait(0,0,1)}))}calcPressure(e){let t=e;return t/=this.scaling_facts[this.prsOsr],t=this.coeffs.m_c00+t*(this.coeffs.m_c10+t*(this.coeffs.m_c20+t*this.coeffs.m_c30))+this.m_lastTempScal*(this.coeffs.m_c01+t*(this.coeffs.m_c11+t*this.coeffs.m_c21)),t}calcTemp(e){let t=e;return t/=this.scaling_facts[this.tempOsr],this.m_lastTempScal=t,t=this.coeffs.m_c0Half+this.coeffs.m_c1*t,t}correctTempWait(){return r(this,void 0,void 0,(function*(){this.writeByteWait(14,229),this.writeByteWait(15,150),this.writeByteWait(98,2),this.writeByteWait(14,0),this.writeByteWait(15,0),yield this.measureTempOnceWait()}))}measureTempOnceWait(e){return r(this,void 0,void 0,(function*(){return void 0===e&&(e=this.tempOsr),yield this.startMeasureTempOnceWait(e),yield this.obniz.wait(100),yield this.getSingleResultWait()}))}getTempWait(){return r(this,void 0,void 0,(function*(){const e=yield this.readBlockWait(this.dataBlock.DPS310__REG_ADR_TEMP);let t=e[0]<<16|e[1]<<8|e[2];return t&1<<23&&(t-=1<<24),this.calcTemp(t)}))}getPressureWait(){return r(this,void 0,void 0,(function*(){const e=yield this.readBlockWait(this.dataBlock.DPS310__REG_ADR_PRS);let t=e[0]<<16|e[1]<<8|e[2];return t&1<<23&&(t-=1<<24),this.calcPressure(t)}))}}},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.pressure=0,this.keys=["pin0","pin1"],this.requiredKeys=["pin0","pin1"]}static info(){return{name:"FSR40X"}}wired(e){this.obniz=e,this.io_pwr=e.getIO(this.params.pin0),this.ad=e.getAD(this.params.pin1),this.io_pwr.drive("5v"),this.io_pwr.output(!0),this.ad.start(e=>{const t=100*e;this.pressure=t,this.onchange&&this.onchange(this.pressure)})}getWait(){return r(this,void 0,void 0,(function*(){const e=100*(yield this.ad.getWait());return this.pressure=e,this.pressure}))}}},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.keys=["vcc","output","gnd"],this.requiredKeys=["output"]}static info(){return{name:"SEN0114"}}wired(e){this.obniz=e,this.obniz.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.ad=e.getAD(this.params.output),this.ad.start(e=>{this.value=e,this.onchange&&this.onchange(this.value)})}getHumidityWait(){return r(this,void 0,void 0,(function*(){return yield this.ad.getWait()}))}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e){this.keys=["signal","gnd"],this.requiredKeys=["signal"]}static info(){return{name:"Speaker"}}wired(e){this.obniz=e,this.obniz.setVccGnd(null,this.params.gnd,"5v"),this.pwm=e.getFreePwm(),this.pwm.start({io:this.params.signal})}play(e){if("number"!=typeof e)throw new Error("freq must be a number");(e=Math.floor(e))>0?(this.pwm.freq(e),this.pwm.pulse(1/e/2*1e3)):this.pwm.pulse(0)}stop(){this.play(0)}}},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(15));class n extends s.default{static info(){return{name:"LM35DZ"}}calc(e){return 100*e}}t.default=n},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(15));class n extends s.default{static info(){return{name:"LM60"}}calc(e){return Math.round((e-.424)/.00625*10)/10}}t.default=n},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(15));class n extends s.default{static info(){return{name:"LM61"}}calc(e){return Math.round((e-.6)/.01)}}t.default=n},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(15));class n extends s.default{static info(){return{name:"LMT87"}}calc(e){return(1e3*e-2365)/-13.6+20}}t.default=n},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(15));class n extends s.default{static info(){return{name:"MCP9700"}}calc(e){return(e-.5)/.01}}t.default=n},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(15));class n extends s.default{static info(){return{name:"MCP9701"}}calc(e){return(e-.4)/.0195}}t.default=n},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(15));class n extends s.default{static info(){return{name:"S8100B"}}calc(e){return 30+(1.508-e)/-.08}}t.default=n},function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(15));class n extends s.default{static info(){return{name:"S8120C"}}calc(e){return(e-1.474)/-.0082+30}}t.default=n},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.keys=["vcc","gnd","sda","scl","addressMode"],this.requiredKeys=["addressMode"]}static info(){return{name:"ADT7410"}}wired(e){if(this.obniz=e,e.setVccGnd(this.params.vcc,this.params.gnd,"5v"),8===this.params.addressMode)this.address=72;else{if(9!==this.params.addressMode)throw new Error("please specify address. 8 or 9");this.address=73}this.params.clock=4e5,this.params.pull="5v",this.params.mode="master",this.i2c=e.getI2CWithConfig(this.params)}getTempWait(){return r(this,void 0,void 0,(function*(){const e=yield this.i2c.readWait(this.address,2);let t=e[0]<<8;return t|=e[1],t>>=3,4096&t&&(t-=8192),t/16}))}}},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.keys=["vcc","gnd","sda","scl","i2c"],this.requiredKeys=[]}static info(){return{name:"AM2320"}}wired(e){this.obniz=e,e.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.address=92,this.params.pull="5v",this.params.mode="master",this.params.clock=this.params.clock||1e5,this.i2c=e.getI2CWithConfig(this.params)}getAllWait(){return r(this,void 0,void 0,(function*(){const e=this.i2c.onerror;this.i2c.onerror=()=>{},this.i2c.write(this.address,[0]),this.obniz.wait(2),this.i2c.write(this.address,[3,0,4]),this.obniz.wait(2),this.i2c.write(this.address,[3,0,4]);const t=yield this.i2c.readWait(this.address,6);if(this.i2c.onerror=e,3!==t[0]||4!==t[1])throw new Error("Could not receive data correctly");const i=(256*t[2]+t[3])/10;return{temperature:(256*t[4]+t[5])/10,humidity:i}}))}getTempWait(){return r(this,void 0,void 0,(function*(){return(yield this.getAllWait()).temperature}))}getHumdWait(){return r(this,void 0,void 0,(function*(){return(yield this.getAllWait()).humidity}))}}},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.requiredKeys=[],this.keys=["vcc","gnd","sda","scl","address"],this.ioKeys=["vcc","gnd","sda","scl"],this.commands={},this.commands.mode_normal=[0,0],this.commands.reset_flag=[1,48],this.commands.reset_initial=[1,63],this.commands.frameRate_10fps=[2,0],this.commands.frameRate_1fps=[2,1],this.commands.int_disable=[3,0],this.commands.int_absVal=[3,3],this.commands.int_diff=[3,1],this.commands.stat=[4],this.commands.statClr_ovs=[5,4],this.commands.statClr_int=[5,2],this.commands.average_disable=[7,0],this.commands.average_enable=[7,16]}static info(){return{name:"AMG8833"}}wired(e){if(this.obniz=e,this.obniz.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.address=105,105===this.params.address)this.address=105;else if(104===this.params.addressmode)this.address=104;else if(void 0!==this.params.address)throw new Error("address must be 0x68 or 0x69");this.params.clock=this.params.clock||4e5,this.params.mode=this.params.mode||"master",this.params.pull=this.params.pull||null,this.i2c=e.getI2CWithConfig(this.params),this.obniz.wait(50),this.i2c.write(this.address,this.commands.mode_normal),this.i2c.write(this.address,this.commands.reset_flag),this.i2c.write(this.address,this.commands.frameRate_10fps),this.i2c.write(this.address,this.commands.int_disable)}getOnePixWait(e){return r(this,void 0,void 0,(function*(){let t=128,i=129;if(!(e>=0&&e<=63))throw new Error("pixel number must be range of 0 to 63");t=128+2*e,i=129+2*e,this.i2c.write(this.address,[t]);const r=yield this.i2c.readWait(this.address,1);this.i2c.write(this.address,[i]);const s=yield this.i2c.readWait(this.address,1);let n=s<<8|r;return 8&s?(n-=1,n=4095-n,-.25*n):.25*n}))}getAllPixWait(){return r(this,void 0,void 0,(function*(){const e=new Array(64);this.i2c.write(this.address,[128]);const t=yield this.i2c.readWait(this.address,128);for(let i=0;i<64;i++){let r=t[2*i+1]<<8|t[2*i],s=0;8&t[2*i+1]?(r-=1,r=4095-r,s=-.25*r):s=.25*r,e[i]=s}return e}))}}},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.requiredKeys=[],this.keys=["vcore","vio","gnd","csb","sdi","sck","sdo","i2c","address"],this.ioKeys=["vcore","vio","gnd","csb","sdi","sdo","sck"],this.configration={sampling:{temp:1,hum:1,pres:1},interval:5,iir_strength:0,mode:3,Modes:{sleep:0,forced:1,normal:3}},this.commands={},this.commands.addresses={config:245,ctrl_meas:244,ctrl_hum:242}}static info(){return{name:"BME280",datasheet:"https://ae-bst.resource.bosch.com/media/_tech/media/datasheets/BST-BME280_DS001-12.pdf"}}wired(e){if(this.obniz=e,e.isValidIO(this.params.csb)&&(this.io_csb=e.getIO(this.params.csb),this.io_csb.drive("3v"),this.io_csb.output(!0)),this.obniz.setVccGnd(this.params.vio,null,"3v"),this.obniz.setVccGnd(this.params.vcore,null,"3v"),this.obniz.setVccGnd(null,this.params.gnd,"5v"),this.obniz.wait(10),this.address=118,118===this.params.address)this.address=118;else if(119===this.params.address)this.address=119;else if(void 0!==this.params.address)throw new Error("address must be 0x76 or 0x77");e.isValidIO(this.params.sdo)&&(this.io_sdo=e.getIO(this.params.sdo),this.io_sdo.drive("3v"),this.io_sdo.output(118!==this.address)),this.params.sda=this.params.sda||this.params.sdi,this.params.scl=this.params.scl||this.params.sck,this.params.clock=this.params.clock||1e5,this.params.mode="master",this.params.pull="3v",this.i2c=e.getI2CWithConfig(this.params),this.obniz.wait(10),this.config(),this.obniz.wait(10)}config(){return r(this,void 0,void 0,(function*(){this.write([this.commands.addresses.config,this.configration.interval<<5|this.configration.iir_strength<<2|0]),this.write([this.commands.addresses.ctrl_hum,this.configration.sampling.hum]),this.write([this.commands.addresses.ctrl_meas,this.configration.sampling.temp<<5|this.configration.sampling.pres<<2|this.configration.mode])}))}setIIRStrength(e){return r(this,void 0,void 0,(function*(){this.configration.iir_strength=e,this.config()}))}applyCalibration(){return r(this,void 0,void 0,(function*(){this.i2c.write(this.address,[136]);const e=yield this.i2c.readWait(this.address,24);this.i2c.write(this.address,[161]);let t=yield this.i2c.readWait(this.address,1);e.push(...t),this.i2c.write(this.address,[225]),t=yield this.i2c.readWait(this.address,7),e.push(...t),this._calibrated={dig_T1:e[1]<<8|e[0],dig_T2:this._readSigned16(e[3]<<8|e[2]),dig_T3:this._readSigned16(e[5]<<8|e[4]),dig_P1:e[7]<<8|e[6],dig_P2:this._readSigned16(e[9]<<8|e[8]),dig_P3:this._readSigned16(e[11]<<8|e[10]),dig_P4:this._readSigned16(e[13]<<8|e[12]),dig_P5:this._readSigned16(e[15]<<8|e[14]),dig_P6:this._readSigned16(e[17]<<8|e[16]),dig_P7:this._readSigned16(e[19]<<8|e[18]),dig_P8:this._readSigned16(e[21]<<8|e[20]),dig_P9:this._readSigned16(e[23]<<8|e[22]),dig_H1:this._readSigned8(e[24]),dig_H2:this._readSigned16(e[26]<<8|e[25]),dig_H3:this._readSigned8(e[27]),dig_H4:this._readSigned16(e[28]<<4|15&e[29]),dig_H5:this._readSigned16(e[30]<<4|e[29]>>4&15),dig_H6:this._readSigned8(e[31])},this._t_fine=0}))}_readSigned16(e){return e>=32768&&(e-=65536),e}_readSigned8(e){return e>=128&&(e-=256),e}write(e){this.i2c.write(this.address,e)}getData(){return r(this,void 0,void 0,(function*(){return this.i2c.write(this.address,[247]),yield this.i2c.readWait(this.address,8)}))}getAllWait(){return r(this,void 0,void 0,(function*(){const e=yield this.getData(),t=e[0]<<12|e[1]<<4|e[2]>>4,i=e[3]<<12|e[4]<<4|e[5]>>4,r=e[6]<<8|e[7],s=this.calibration_T(i)/100,n=this.calibration_P(t)/100;return{temperature:s,humidity:this.calibration_H(r),pressure:n}}))}calibration_T(e){let t,i,r;return t=((e>>3)-(this._calibrated.dig_T1<<1))*this._calibrated.dig_T2>>11,i=(((e>>4)-this._calibrated.dig_T1)*((e>>4)-this._calibrated.dig_T1)>>12)*this._calibrated.dig_T3>>14,this._t_fine=t+i,r=5*this._t_fine+128>>8,r}calibration_P(e){let t=this._t_fine/2-64e3,i=t*t*this._calibrated.dig_P6/32768;if(i+=t*this._calibrated.dig_P5*2,i=i/4+65536*this._calibrated.dig_P4,t=(this._calibrated.dig_P3*t*t/524288+this._calibrated.dig_P2*t)/524288,t=(1+t/32768)*this._calibrated.dig_P1,0!==t){let r=1048576-e;return r=6250*(r-i/4096)/t,t=this._calibrated.dig_P9*r*r/2147483648,i=r*this._calibrated.dig_P8/32768,r+=(t+i+this._calibrated.dig_P7)/16,r}return 0}calibration_H(e){let t=this._t_fine-76800;return t=(e-(64*this._calibrated.dig_H4+this._calibrated.dig_H5/16384*t))*(this._calibrated.dig_H2/65536*(1+this._calibrated.dig_H6/67108864*t*(1+this._calibrated.dig_H3/67108864*t))),t*=1-this._calibrated.dig_H1*t/524288,t}getTempWait(){return r(this,void 0,void 0,(function*(){return(yield this.getAllWait()).temperature}))}getHumdWait(){return r(this,void 0,void 0,(function*(){return(yield this.getAllWait()).humidity}))}getPressureWait(){return r(this,void 0,void 0,(function*(){return(yield this.getAllWait()).pressure}))}getAltitudeWait(){return r(this,void 0,void 0,(function*(){const e=yield this.getPressureWait();return this.calcAltitude(e)}))}calcAltitude(e,t){return"number"!=typeof t&&(t=1013.25),145366.45*(1-Math.pow(e/t,1/5.2553))*.3048}}},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.requiredKeys=[],this.keys=["vcc","gnd","sda","scl","clock"],this.address=10,this.ioKeys=["vcc","gnd","sda","scl"],this.commands={},this.commands.read_data=[76]}static info(){return{name:"D6T44L"}}wired(e){this.obniz=e,this.obniz.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.params.clock=this.params.clock||1e5,this.params.mode=this.params.mode||"master",this.params.pull=this.params.pull||null,this.i2c=e.getI2CWithConfig(this.params),this.obniz.wait(50)}getOnePixWait(e){return r(this,void 0,void 0,(function*(){return(yield this.getAllPixWait())[e]}))}getAllPixWait(){return r(this,void 0,void 0,(function*(){this.i2c.write(this.address,[76]);const e=yield this.i2c.readWait(this.address,35),t=[];for(let i=0;i<16;i++)t[i]=parseFloat((.1*(e[2*i+2]+(e[2*i+3]<<8))).toFixed(1));return t}))}}},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(i(37));class a extends n.default{static info(){return{name:"DHT12"}}i2cInfo(){return{address:92,clock:1e5,voltage:"3v"}}getAllDataWait(){return r(this,void 0,void 0,(function*(){const e=yield this.readWait(0,5),t=e[0]+.1*e[1];let i=e[2]+.1*(127&e[3]);if(128&e[3]&&(i*=-1),e[0]+e[1]+e[2]+e[3]!==e[4])throw new Error("checksum does not match");return{humidity:t,temperature:i}}))}getTempWait(){return r(this,void 0,void 0,(function*(){return(yield this.getAllDataWait()).temperature}))}getHumdWait(){return r(this,void 0,void 0,(function*(){return(yield this.getAllDataWait()).humidity}))}}t.default=a},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.requiredKeys=["vcc","gnd","adr0","adr1","adr_select"],this.keys=["sda","scl","adr0","adr1","adr_select","i2c"]}static info(){return{name:"S5851A"}}wired(e){switch(this.io_adr0=e.getIO(this.params.adr0),this.io_adr1=e.getIO(this.params.adr1),this.obniz.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.params.adr_select){case 8:this.io_adr0.output(!1),this.io_adr1.output(!1),this.address=72;break;case 9:this.io_adr0.pull(null),this.io_adr1.output(!1),this.address=73;break;case"A":this.io_adr0.output(!0),this.io_adr1.output(!1),this.address=74;break;case"B":this.io_adr0.output(!1),this.io_adr1.output(!0),this.address=75;break;case"C":this.io_adr0.pull(null),this.io_adr1.output(!0),this.address=76;break;case"D":this.io_adr0.output(!0),this.io_adr1.output(!0),this.address=77;break;case"E":this.io_adr0.output(!1),this.io_adr1.pull(null),this.address=78;break;case"F":this.io_adr0.output(!0),this.io_adr1.pull(null),this.address=79;break;default:this.io_adr0.output(!1),this.io_adr1.output(!1),this.address=72}console.log("i2c address="+this.address),this.params.clock=this.params.clock||4e5,this.params.mode=this.params.mode||"master",this.params.pull=this.params.pull||"5v",this.i2c=e.getI2CWithConfig(this.params)}getTempWait(){return r(this,void 0,void 0,(function*(){const e=yield this.i2c0.readWait(this.address,2),t=e[0].toString(2)+("00000000"+e[1].toString(2)).slice(-8);return parseInt(t,2)/65535*175-45}))}getHumdWait(){return r(this,void 0,void 0,(function*(){this.i2c.write(this.address,[32,36]),this.i2c.write(this.address,[224,0]);const e=yield this.i2c.readWait(this.address,4),t=e[2].toString(2)+("00000000"+e[3].toString(2)).slice(-8);return parseInt(t,2)/65535*100}))}}},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.requiredKeys=[],this.keys=["vcc","sda","scl","gnd","adr","addressmode","i2c","pull","address"],this.ioKeys=["vcc","sda","scl","gnd","adr"],this.commands={},this.commands.softReset=[48,162],this.commands.highRepeatStreach=[44,6],this.commands.middleRepeatStreach=[44,13],this.commands.lowRepeatStreach=[44,16],this.commands.highRepeat=[36,0],this.commands.mediumRepeat=[36,11],this.commands.lowRepeat=[36,22],this.waitTime={},this.waitTime.wakeup=1,this.waitTime.softReset=1,this.waitTime.lowRepeat=4,this.waitTime.mediumRepeat=6,this.waitTime.highRepeat=15,this.commands.readStatus=[243,45]}static info(){return{name:"SHT31"}}wired(e){this.obniz=e,this.obniz.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.address=this.params.address||68,this.params.addressmode&&(this.io_adr=e.getIO(this.params.adr),4===this.params.addressmode?(this.io_adr.output(!1),this.address=68):5===this.params.addressmode&&(this.io_adr.pull("5v"),this.address=69)),this.params.clock=this.params.clock||1e5,this.params.mode=this.params.mode||"master",this.params.pull=this.params.pull||"5v",this.i2c=e.getI2CWithConfig(this.params),this.i2c.write(this.address,this.commands.softReset)}getData(){return r(this,void 0,void 0,(function*(){return this.i2c.write(this.address,this.commands.highRepeat),yield this.obniz.wait(this.waitTime.highRepeat),yield this.i2c.readWait(this.address,6)}))}getTempWait(){return r(this,void 0,void 0,(function*(){return(yield this.getAllWait()).temperature}))}getHumidWait(){return r(this,void 0,void 0,(function*(){return(yield this.getAllWait()).humidity}))}getAllWait(){return r(this,void 0,void 0,(function*(){const e=yield this.getData();return{temperature:(256*e[0]+e[1])/65535*175-45,humidity:(256*e[3]+e[4])/65535*100}}))}}},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.keys=["vcc","gnd","frequency","din","dout","clk","spi"],this.requiredKeys=[]}static info(){return{name:"ADT7310"}}wired(e){this.obniz=e,e.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.params.mode=this.params.mode||"master",this.params.frequency=this.params.frequency||5e5,this.params.mosi=this.params.din,this.params.miso=this.params.dout,this.spi=this.obniz.getSpiWithConfig(this.params)}getTempWait(){return r(this,void 0,void 0,(function*(){yield this.spi.writeWait([84]),yield this.obniz.wait(200);const e=yield this.spi.writeWait([0,0]);let t=e[0]<<8;return t|=e[1],t>>=3,4096&t&&(t-=8192),t/16}))}}},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.PCD_Idle=0,this.PCD_Mem=1,this.PCD_GenerateRandomID=2,this.PCD_CalcCRC=3,this.PCD_Transmit=4,this.PCD_NoCmdChange=7,this.PCD_Receive=8,this.PCD_Transceive=12,this.PCD_MFAuthent=14,this.PCD_SoftReset=15,this.RxGain_18dB=0,this.RxGain_23dB=16,this.RxGain_18dB_2=32,this.RxGain_23dB_2=48,this.RxGain_33dB=64,this.RxGain_38dB=80,this.RxGain_43dB=96,this.RxGain_48dB=112,this.RxGain_min=0,this.RxGain_avg=64,this.RxGain_max=112,this.PICC_REQA=38,this.PICC_WUPA=82,this.PICC_CT=136,this.PICC_SEL_CL1=147,this.PICC_SEL_CL2=149,this.PICC_SEL_CL3=151,this.PICC_HLTA=80,this.PICC_RATS=224,this.PICC_AUTH_KEYA=96,this.PICC_AUTH_KEYB=97,this.PICC_READ=48,this.PICC_WRITE=160,this.PICC_DECREMENT=192,this.PICC_INCREMENT=193,this.PICC_RESTORE=194,this.PICC_TRANSFER=176,this.PICC_UL_WRITE=162,this.PICC_SElECTTAG=147,this.CommandReg=1,this.ComlEnReg=2,this.DivlEnReg=3,this.ComIrqReg=4,this.DivIrqReg=5,this.ErrorReg=6,this.Status1Reg=7,this.Status2Reg=8,this.FIFODataReg=9,this.FIFOLevelReg=10,this.WaterLevelReg=11,this.ControlReg=12,this.BitFramingReg=13,this.CollReg=14,this.ModeReg=17,this.TxModeReg=18,this.RxModeReg=19,this.TxControlReg=20,this.TxASKReg=21,this.TxSelReg=22,this.RxSelReg=23,this.RxThresholdReg=24,this.DemodReg=25,this.Reserved1Ah=26,this.Reserved1Bh=27,this.MfTxReg=28,this.MfRxReg=29,this.Reserved1Eh=30,this.SerialSpeedReg=31,this.CRCResultRegMSB=33,this.CRCResultRegLSB=34,this.ModWidthReg=36,this.RFCfgReg=38,this.GsNReg=39,this.CWGsPReg=40,this.ModGsPReg=41,this.TModeReg=42,this.TPrescalerReg=43,this.TReloadRegHi=44,this.TReloadRegLo=45,this.TCounterValRegHi=46,this.TCounterValRegLo=47,this.TestSel1Reg=49,this.TestSel2Reg=50,this.TestPinEnReg=51,this.TestPinValueReg=52,this.TestBusReg=53,this.AutoTestReg=54,this.VersionReg=55,this.AnalogTestReg=56,this.TestDAC1Reg=57,this.TestDAC2Reg=58,this.TestADCReg=59,this.keys=["cs","clk","mosi","miso","rst","vcc","gnd","spi","spi_frequency"],this.requiredKeys=["cs","mosi","miso","rst"]}static info(){return{name:"MFRC522"}}wired(e){this.obniz=e,this.obniz.setVccGnd(this.params.vcc,this.params.gnd,"5v"),this.rst=e.getIO(this.params.rst),this.cs=e.getIO(this.params.cs),this.cs.output(!0),this.params.mode="master",this.params.drive="3v",this.params.pull="3v",this.params.frequency=this.params.spi_frequency||5e6,this.spi=this.obniz.getSpiWithConfig(this.params)}init(){return r(this,void 0,void 0,(function*(){this.rst.output(!1),yield this.obniz.wait(50),this.rst.output(!0),this.writeRegister(this.CommandReg,this.PCD_SoftReset),this.writeRegister(this.TModeReg,128),this.writeRegister(this.TPrescalerReg,169),this.writeRegister(this.TReloadRegHi,3),this.writeRegister(this.TReloadRegLo,232),this.writeRegister(this.TxASKReg,64),this.writeRegister(this.ModeReg,61),yield this.antennaOn()}))}writeRegister(e,t){let i;i=t instanceof Array?[e<<1&126].concat(t):[e<<1&126,t],this.cs.output(!1),this.spi.write(i),this.cs.output(!0)}readRegister(e){return r(this,void 0,void 0,(function*(){const t=[e<<1&126|128,0];this.cs.output(!1);const i=yield this.spi.writeWait(t);return this.cs.output(!0),i[1]}))}readRegister_nByte(e,t){return r(this,void 0,void 0,(function*(){const i=[];if(e instanceof Array)for(let t=0;t<e.length;t++)i.push(e[t]<<1&126|128);else for(let r=0;r<t;r++)i.push(e<<1&126|128);i.push(0),this.cs.output(!1);const r=yield this.spi.writeWait(i);return this.cs.output(!0),r.shift(),r}))}setRegisterBitMask(e,t){return r(this,void 0,void 0,(function*(){const i=yield this.readRegister(e);this.writeRegister(e,i|t)}))}clearRegisterBitMask(e,t){return r(this,void 0,void 0,(function*(){const i=yield this.readRegister(e);this.writeRegister(e,i&~t)}))}antennaOn(){return r(this,void 0,void 0,(function*(){const e=yield this.readRegister(this.TxControlReg);3!=(3&e)&&(yield this.setRegisterBitMask(this.TxControlReg,3|e))}))}antennaOff(){return r(this,void 0,void 0,(function*(){yield this.clearRegisterBitMask(this.TxControlReg,3)}))}toCard(e,t){return r(this,void 0,void 0,(function*(){let i=[],r=0,s=!1,n=0,a=0;e===this.PCD_MFAuthent&&(n=18,a=16),e===this.PCD_Transceive&&(n=119,a=48),this.writeRegister(this.CommandReg,this.PCD_Idle),this.writeRegister(this.ComlEnReg,128|n),this.writeRegister(this.ComIrqReg,127),this.writeRegister(this.FIFOLevelReg,128),this.writeRegister(this.FIFODataReg,t),this.writeRegister(this.CommandReg,e),e===this.PCD_Transceive&&(yield this.setRegisterBitMask(this.BitFramingReg,128));let o=10,h=0;do{h=yield this.readRegister(this.ComIrqReg),o--}while(!(0===o||1&h||h&a));const c=yield this.readRegister_nByte([this.ErrorReg,this.FIFOLevelReg,this.ControlReg]);if(0!==o)if(0==(27&c[0])){if(s=!(h&n&1),e===this.PCD_Transceive){h=c[1];const e=7&c[2];r=e?8*(h-1)+e:8*h,0===h&&(h=1),h>16&&(h=16),i=yield this.readRegister_nByte(this.FIFODataReg,h)}}else s=!1;return{status:s,data:i,bitSize:r}}))}findCardWait(){return r(this,void 0,void 0,(function*(){yield this.init(),yield this.searchTagWait();const e=yield this.getUidWait();return{uid:e,PICC_Type:yield this.identifyCardTypeWait(e)}}))}searchTagWait(){return r(this,void 0,void 0,(function*(){this.writeRegister(this.BitFramingReg,7);const e=[this.PICC_REQA];if(16!==(yield this.toCard(this.PCD_Transceive,e)).bitSize)throw new Error("card_search_ERROR")}))}getUidWait(){return r(this,void 0,void 0,(function*(){this.writeRegister(this.BitFramingReg,0);let e=[this.PICC_SEL_CL1,32];const t=yield this.toCard(this.PCD_Transceive,e);if(!t.status)throw new Error("uid_scan_ERROR");if((t.data[0]^t.data[1]^t.data[2]^t.data[3])!==t.data[4])throw new Error("uid_check_ERROR");return e=t.data,e}))}calculateCRCWait(e){return r(this,void 0,void 0,(function*(){this.writeRegister(this.CommandReg,this.PCD_Idle),this.writeRegister(this.DivIrqReg,4),this.writeRegister(this.FIFOLevelReg,128),this.writeRegister(this.FIFODataReg,e),this.writeRegister(this.CommandReg,this.PCD_CalcCRC);let t,i=255;do{t=yield this.readRegister(this.DivIrqReg),i--}while(0!==i&&!(4&t));return yield this.readRegister_nByte([this.CRCResultRegLSB,this.CRCResultRegMSB])}))}identifySoftwareWait(){return r(this,void 0,void 0,(function*(){let e=yield this.readRegister(this.VersionReg);switch(e){case 136:e="(clone)";break;case 144:e="v0.0";break;case 145:e="v1.0";break;case 146:e="v2.0";break;case 18:e="counterfeit chip";break;default:e="(unknown)"}if(0===e||255===e)throw new Error("software_version_ERROR");return e}))}identifyCardTypeWait(e){return r(this,void 0,void 0,(function*(){let t=[this.PICC_SElECTTAG,112].concat(e);t=t.concat(yield this.calculateCRCWait(t));const i=yield this.toCard(this.PCD_Transceive,t);let r;switch(i.status&&24===i.bitSize&&(r=i.data[0]),r){case 4:r="SAK indicates UID is not complete.";break;case 9:r="MIFARE Mini, 320 bytes";break;case 8:r="MIFARE 1KB";break;case 24:r="MIFARE 4KB";break;case 0:r="MIFARE Ultralight or Ultralight C";break;case 17:r="MIFARE Plus";break;case 1:r="MIFARE TNP3XXX";break;case 32:r="PICC compliant with ISO/IEC 14443-4";break;case 64:r="PICC compliant with ISO/IEC 18092 (NFC)";break;default:throw new Error("PICC_type_ERROR")}return r}))}readSectorDataWait(e,t){return r(this,void 0,void 0,(function*(){return yield this.authenticateSectorWait(e,t),yield this.getSectorDataWait(e)}))}readBlockDataWait(e,t){return r(this,void 0,void 0,(function*(){return yield this.authenticateBlockWait(e,t),yield this.getBlockDataWait(e)}))}authenticateSectorWait(e,t){return r(this,void 0,void 0,(function*(){const i=4*e;let r=[this.PICC_AUTH_KEYA,i].concat([255,255,255,255,255,255]);if(t=t.slice(0,4),r=r.concat(t),yield this.toCard(this.PCD_MFAuthent,r),!(8&(yield this.readRegister(this.Status2Reg))))throw new Error("password_authentication_ERROR")}))}authenticateBlockWait(e,t){return r(this,void 0,void 0,(function*(){let i=[this.PICC_AUTH_KEYA,e].concat([255,255,255,255,255,255]);if(t=t.slice(0,4),i=i.concat(t),yield this.toCard(this.PCD_MFAuthent,i),!(8&(yield this.readRegister(this.Status2Reg))))throw new Error("password_authentication_ERROR")}))}readAgainWait(){return r(this,void 0,void 0,(function*(){yield this.clearRegisterBitMask(this.Status2Reg,8)}))}getSectorDataWait(e){return r(this,void 0,void 0,(function*(){const t=[],i=[];for(let r=0;r<4;r++){let s=[this.PICC_READ,4*e+r];if(s=s.concat(yield this.calculateCRCWait(s)),t[r]=yield this.toCard(this.PCD_Transceive,s),!t[r].status)throw new Error("data_read_ERROR");i[r]=t[r].data}return i}))}getBlockDataWait(e){return r(this,void 0,void 0,(function*(){let t=[this.PICC_READ,e];t=t.concat(yield this.calculateCRCWait(t));const i=yield this.toCard(this.PCD_Transceive,t);if(!i.status)throw new Error("data_read_ERROR");return i.data}))}appendCRCtoBufferAndSendToCardWait(e){return r(this,void 0,void 0,(function*(){e=e.concat(yield this.calculateCRCWait(e));const t=yield this.toCard(this.PCD_Transceive,e);return t.status&&4===t.bitSize&&10==(15&t.data[0])||(t.status=!1),t}))}writeBlockDataWait(e,t){return r(this,void 0,void 0,(function*(){if(0===e||e%4==3)throw new Error("deny_Write");const i=[this.PICC_WRITE,e];let r=yield this.appendCRCtoBufferAndSendToCardWait(i);if(!r.status)throw new Error("data_write_ERROR");r=yield this.appendCRCtoBufferAndSendToCardWait(t)}))}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.keys=["tx","rx","gnd"],this.requiredKeys=["tx","rx"]}static info(){return{name:"RN42"}}wired(e){e.isValidIO(this.params.gnd)&&e.getIO(this.params.gnd).output(!1),this.uart=e.getFreeUart(),this.uart.start({tx:this.params.tx,rx:this.params.rx,baud:115200,drive:"3v"}),this.uart.onreceive=(e,t)=>{t.indexOf("CONNECT")>=0||t.indexOf("DISCONNECT"),"function"==typeof this.onreceive&&this.onreceive(e,t)}}send(e){this.uart.send(e)}sendCommand(e){this.uart.send(e+"\n"),this.obniz.wait(100)}enterCommandMode(){this.send("$$$"),this.obniz.wait(100)}config(e){this.enterCommandMode(),"object"==typeof e&&(this.sendCommand(""),e.master_slave&&this.config_masterslave(e.master_slave),e.auth&&this.config_auth(e.auth),e.hid_flag&&this.config_HIDflag(e.hid_flag),e.profile&&this.config_profile(e.profile),e.power&&this.config_power(e.power),e.display_name&&this.config_displayName(e.display_name),this.config_reboot())}config_reboot(){this.sendCommand("R,1")}config_masterslave(e){let t=-1;if("number"==typeof e)t=e;else if("string"==typeof e){const i=["slave","master","trigger","auto-connect-master","auto-connect-dtr","auto-connect-any","pairing"];for(let r=0;r<i.length;r++)if(i[r]===e){t=r;break}}-1!==t&&this.sendCommand("SM,"+t)}config_displayName(e){this.sendCommand("SN,"+e)}config_HIDflag(e){this.sendCommand("SH,"+e)}config_profile(e){let t=-1;if("number"==typeof e)t=e;else if("string"==typeof e){const i=["SPP","DUN-DCE","DUN-DTE","MDM-SPP","SPP-DUN-DCE","APL","HID"];for(let r=0;r<i.length;r++)if(i[r]===e){t=r;break}}-1!==t&&this.sendCommand("S~,"+t)}config_revert_localecho(){this.sendCommand("+")}config_auth(e){let t=-1;if("number"==typeof e)t=e;else if("string"==typeof e){const i=["open","ssp-keyboard","just-work","pincode"];for(let r=0;r<i.length;r++)if(i[r]===e){t=r;break}}-1!==t&&this.sendCommand("SA,"+t)}config_power(e){let t="0010";16>e&&e>=12?t="000C":12>e&&e>=8?t="0008":8>e&&e>=4?t="0004":4>e&&e>=0?t="0000":0>e&&e>=-4?t="FFFC":-4>e&&e>=-8?t="FFF8":-8>e&&(t="FFF4"),this.sendCommand("SY,"+t)}config_get_setting(){this.sendCommand("D")}config_get_extendSetting(){this.sendCommand("E")}}},function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function a(e){try{h(r.next(e))}catch(e){n(e)}}function o(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}h((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.displayIoNames={tx:"<tx",rx:">rx"},this.keys=["tx","rx","gnd"],this.requiredKeys=["tx","rx"]}static info(){return{name:"XBee"}}wired(e){this.uart=e.getFreeUart(),this.currentCommand=null,this.commands=[],this.isAtMode=!1,this.onFinishAtModeCallback=null,"number"==typeof this.params.gnd&&e.getIO(this.params.gnd).output(!1),this.uart.start({tx:this.params.tx,rx:this.params.rx,baud:9600,drive:"3v"}),this.uart.onreceive=(e,t)=>{this.isAtMode?this.onAtResultsRecieve(e,t):"function"==typeof this.onreceive&&this.onreceive(e,t)}}send(e){!1===this.isAtMode?this.uart.send(e):this.obniz.error("XBee is AT Command mode now. Wait for finish config.")}onAtResultsRecieve(e,t){if(!this.isAtMode)return;const i=()=>{this.currentCommand=null,this.sendCommand()};if("OK\r"===t){if("ATCN"===this.currentCommand)return this.isAtMode=!1,this.currentCommand=null,void("function"==typeof this.onFinishAtModeCallback&&(this.onFinishAtModeCallback(),this.onFinishAtModeCallback=null));i()}else"ERROR\r"===t?this.obniz.error("XBee config error : "+this.currentCommand):(console.log("XBEE : no catch message",e),i())}addCommand(e,t){const i=e+(t?" "+t:"");this.commands.push(i),!0===this.isAtMode&&null===this.currentCommand&&this.sendCommand()}sendCommand(){!0===this.isAtMode&&null===this.currentCommand&&this.commands.length>0&&(this.currentCommand="AT"+this.commands.shift(),this.uart.send(this.currentCommand+"\r"))}enterAtMode(){if(null!==this.currentCommand)return;this.isAtMode=!0,this.obniz.wait(1e3);this.currentCommand="+++",this.uart.send(this.currentCommand),this.obniz.wait(1e3)}exitAtMode(){this.addCommand("CN")}configWait(e){return r(this,void 0,void 0,(function*(){if(this.isAtMode)throw new Error("Xbee : duplicate config setting");return new Promise((t,i)=>{const r={destination_address_high:"DH",destination_address_low:"DL",source_address:"MY"},s=["destination_address"];this.enterAtMode();for(const t in e)if(2===t.length)this.addCommand(t,e[t]);else if(r[t])this.addCommand(r[t],e[t]);else if(s.includes(t)){let i=e[t].slice(0,-8);i||(i="0");const s=e[t].slice(-8);this.addCommand(r[t+"_high"],i),this.addCommand(r[t+"_low"],s)}this.exitAtMode(),this.onFinishAtModeCallback=()=>{t()}})}))}}}]);
"use strict";
class Grove_GPS {
    constructor() {
        this.keys = ['tx', 'rx', 'vcc', 'gnd'];
        this.requiredKeys = ['tx', 'rx'];
        this.ioKeys = this.keys;
        this.displayName = 'gps';
        this.displayIoNames = { tx: 'tx', rx: 'rx' };
    }
    static info() {
        return {
            name: 'Grove_GPS',
        };
    }
    wired(obniz) {
        this.obniz = obniz;
        this.obniz.setVccGnd(this.params.vcc, this.params.gnd, '5v');
        this.uart = obniz.getFreeUart();
        this.uart.start({
            tx: this.params.tx,
            rx: this.params.rx,
            baud: 9600,
        });
        this.editedData = {};
        this.editedData.enable = false;
        this.editedData.GPGSV = new Array(4);
        this.gpsInfo = {};
        this.gpsInfo._sentenceType = {
            GPGGA: 0x0001,
            GPGSA: 0x0002,
            GPGSV: 0x0004,
            GPRMC: 0x0008,
            GPVTG: 0x0010,
            GPZDA: 0x0020,
        };
        this.gpsInfo.status = 'V';
        this.gpsInfo.sentences = new Set(); // Set specifying sentence of MNEA from which data have been obtained
        this.gpsInfo.satelliteInfo = {
            satellites: [],
            inView: 0,
        };
    }
    readSentence() {
        let results = [];
        if (this.uart.isDataExists()) {
            let pos = this.uart.received.indexOf(0x0a);
            if (pos >= 0) {
                results = this.uart.received.slice(0, pos - 1);
                this.uart.received.splice(0, pos + 1);
                return this.uart.tryConvertString(results);
            }
        }
        return '';
    }
    getEditedData() {
        let n, utc, format;
        let sentence = this.readSentence();
        this.editedData.enable = false;
        this.editedData.GPGSV = new Array(4);
        while (sentence.length > 0) {
            let part = sentence.split(',');
            if (sentence.slice(-4, -3) != ',') {
                let st = part[part.length - 1].slice(0, -3);
                part.push(part[part.length - 1].slice(-3));
                part[part.length - 2] = st;
            }
            this.editedData.sentence = part.join(',');
            switch (part[0]) {
                case '$GPGGA':
                    this.editedData.GPGGA = part;
                    break;
                case '$GPGLL':
                    this.editedData.GPGLL = part;
                    break;
                case '$GPGSA':
                    this.editedData.GPGSA = part;
                    break;
                case '$GPGSV':
                    n = Number(part[2]);
                    if (n > this.editedData.GPGSV.length) {
                        while (n > this.editedData.GPGSV.length) {
                            this.editedData.GPGSV.push([]);
                        }
                    }
                    this.editedData.GPGSV[n - 1] = part;
                    break;
                case '$GPRMC':
                    this.editedData.GPRMC = part;
                    break;
                case '$GPVTG':
                    this.editedData.GPVTG = part;
                    break;
                case '$GPZDA':
                    this.editedData.GPZDA = part;
                    utc =
                        part[4] +
                            '/' +
                            part[3] +
                            '/' +
                            part[2] +
                            ' ' +
                            part[1].substring(0, 2) +
                            ':' +
                            part[1].substring(2, 4) +
                            ':' +
                            part[1].substring(4, 6) +
                            ' +00:00';
                    this.editedData.timestamp = new Date(utc);
                    break;
                default:
                    format = part[0].substr(1);
                    this.editedData[format] = part;
            }
            this.editedData.enable = true;
            sentence = this.readSentence();
        }
        return this.editedData;
    }
    getGpsInfo(editedData) {
        const NMEA_SATINSENTENCE = 4, NMEA_MAXSAT = 12;
        editedData = editedData || this.getEditedData();
        this.gpsInfo.status = 'V';
        if (editedData.enable) {
            if (editedData.GPGGA) {
                const gga = editedData.GPGGA;
                this.gpsInfo.gpsQuality = parseFloat(gga[6]); //Fix Quality: 0 = Invalid, 1 = GPS fix, 2 = DGPS fix
                this.gpsInfo.hdop = parseFloat(gga[8]); //Horizontal Dilution of Precision (HDOP)
                this.gpsInfo.altitude = parseFloat(gga[9]); //Antenna Altitude meters above mean sea level
                const latitude = this.nmea2dd(parseFloat(gga[2]));
                this.gpsInfo.latitude = gga[3] == 'N' ? latitude : -latitude;
                const longitude = this.nmea2dd(parseFloat(gga[4]));
                this.gpsInfo.longitude = gga[5] == 'E' ? longitude : -longitude;
                this.gpsInfo.sentences.add(this.gpsInfo._sentenceType.GPGGA);
            }
            if (editedData.GPGSV) {
                for (let n = 0; n < editedData.GPGSV.length; n++)
                    if (editedData.GPGSV[n]) {
                        const gsv = editedData.GPGSV[n].map(v => parseFloat(v));
                        const pack_count = gsv[1], pack_index = gsv[2], sat_count = gsv[3];
                        if (pack_index > pack_count)
                            continue;
                        this.gpsInfo.satelliteInfo.inView = sat_count;
                        let nsat = (pack_index - 1) * NMEA_SATINSENTENCE;
                        nsat =
                            nsat + NMEA_SATINSENTENCE > sat_count
                                ? sat_count - nsat
                                : NMEA_SATINSENTENCE;
                        for (let isat = 0; isat < nsat; ++isat) {
                            const isi = (pack_index - 1) * NMEA_SATINSENTENCE + isat;
                            if (this.gpsInfo.satelliteInfo.satellites.length <= isi) {
                                this.gpsInfo.satelliteInfo.satellites.push({});
                            }
                            const isatn = isat * NMEA_SATINSENTENCE;
                            this.gpsInfo.satelliteInfo.satellites[isi] = {
                                id: gsv[isatn + 4],
                                elevation: gsv[isatn + 5],
                                azimuth: gsv[isatn + 6],
                                snr: gsv[isatn + 7],
                                inUse: false,
                            };
                        }
                        this.gpsInfo.sentences.add(this.gpsInfo._sentenceType.GPGSV);
                    }
            }
            if (editedData.GPGSA) {
                const gsa = editedData.GPGSA;
                let nuse = 0;
                this.gpsInfo.fixMode = parseFloat(gsa[2]); // Fix Mode: 1=Fix not available, 2=2D, 3=3D
                this.gpsInfo.pdop = parseFloat(gsa[15]); // PDOP: Position Dilution of Precision
                this.gpsInfo.hdop = parseFloat(gsa[16]); // HDOP: Horizontal Dilution of Precision
                this.gpsInfo.vdop = parseFloat(gsa[17]); // VDOP: Vertical Dilution of Position
                for (let i = 0; i < NMEA_MAXSAT; ++i) {
                    for (let j = 0; j < this.gpsInfo.satelliteInfo.inView; ++j) {
                        if (this.gpsInfo.satelliteInfo.satellites[j] &&
                            gsa[i + 3] == this.gpsInfo.satelliteInfo.satellites[j].id) {
                            this.gpsInfo.satelliteInfo.satellites[j].inUse = true;
                            nuse++;
                        }
                    }
                }
                this.gpsInfo.satelliteInfo.inUse = nuse;
                this.gpsInfo.sentences.add(this.gpsInfo._sentenceType.GPGSA);
            }
            if (editedData.GPRMC) {
                const rmc = editedData.GPRMC;
                this.gpsInfo.status = rmc[2]; // Status Active or Void
                const latitude = this.nmea2dd(parseFloat(rmc[3]));
                this.gpsInfo.latitude = rmc[4] == 'N' ? latitude : -latitude;
                const longitude = this.nmea2dd(parseFloat(rmc[5]));
                this.gpsInfo.longitude = rmc[6] == 'E' ? longitude : -longitude;
                const NMEA_TUD_KNOTS = 1.852; // 1knot=1.852km/h
                this.gpsInfo.speed = parseFloat(rmc[7]) * NMEA_TUD_KNOTS; //unit: km/h
                this.gpsInfo.direction = rmc[8];
                this.gpsInfo.sentences.add(this.gpsInfo._sentenceType.GPRMC);
            }
            if (editedData.GPVTG) {
                const vtg = editedData.GPVTG;
                this.gpsInfo.direction = parseFloat(vtg[1]);
                this.gpsInfo.declination = parseFloat(vtg[3]);
                this.gpsInfo.speed = parseFloat(vtg[7]);
                this.gpsInfo.sentences.add(this.gpsInfo._sentenceType.GPVTG);
            }
            if (editedData.GPZDA) {
                this.gpsInfo.utc = editedData.timestamp;
                this.gpsInfo.sentences.add(this.gpsInfo._sentenceType.GPZDA);
            }
        }
        return this.gpsInfo;
    }
    //-------------------
    get latitude() {
        return this.nmea2dd(this._latitude);
    }
    get longitude() {
        return this.nmea2dd(this._longitude);
    }
    _mneaTo(format, value) {
        let result = this.nmea2dd(value);
        if (typeof format == 'string') {
            switch (format.toUpperCase()) {
                case 'DMS':
                    result = this.nmea2dms(value);
                    break;
                case 'DM':
                    result = this.nmea2dm(value);
                    break;
                case 'S':
                    result = this.nmea2s(value);
                    break;
                default:
            }
        }
        return result;
    }
    latitudeTo(format) {
        return this._mneaTo(format, this._latitude);
    }
    longitudeTo(format) {
        return this._mneaTo(format, this._longitude);
    }
    status2string(status) {
        status = status || this.status;
        if (status == 'A')
            return 'Active';
        if (status == 'V')
            return 'Void';
        return status;
    }
    fixMode2string(fixMode) {
        fixMode = fixMode || this.fixMode;
        if (fixMode == 1)
            return 'Fix not available';
        if (fixMode == 2)
            return '2D';
        if (fixMode == 3)
            return '3D';
        return fixMode;
    }
    gpsQuality2string(gpsQuality) {
        gpsQuality = gpsQuality || this.gpsQuality;
        if (gpsQuality == 0)
            return 'Invalid';
        if (gpsQuality == 1)
            return 'GPS fix';
        if (gpsQuality == 2)
            return 'DGPS fix';
        return gpsQuality;
    }
    //--- latitude/longitude MNEA format change to each unit
    nmea2dms(val) {
        //NMEA format to DMS format string (999째 99'99.9")
        val = parseFloat(val);
        let d = Math.floor(val / 100);
        let m = Math.floor((val / 100.0 - d) * 100.0);
        let s = ((val / 100.0 - d) * 100.0 - m) * 60;
        return d + '째' + m + "'" + s.toFixed(1) + '"';
    }
    nmea2dm(val) {
        //NMEA format to DM format string (999째 99.9999')
        val = parseFloat(val);
        let d = Math.floor(val / 100.0);
        let m = (val / 100.0 - d) * 100.0;
        return d + '째' + m.toFixed(4) + "'";
    }
    nmea2dd(val) {
        //NMEA format to DD format decimal (999.999999)
        val = parseFloat(val);
        let d = Math.floor(val / 100.0);
        let m = Math.floor(((val / 100.0 - d) * 100.0) / 60);
        let s = (((val / 100.0 - d) * 100.0 - m) * 60) / (60 * 60);
        return parseFloat((d + m + s).toFixed(6));
    }
    nmea2s(val) {
        //NMEA format to S format decimal (99999.9999)
        val = parseFloat(val);
        let d = Math.floor(val / 100.0);
        let m = Math.floor(((val / 100.0 - d) * 100.0) / 60);
        let s = (((val / 100.0 - d) * 100.0 - m) * 60) / (60 * 60);
        return (d + m + s) / (1.0 / 60.0 / 60.0);
    }
}
if (typeof module === 'object') {
    module.exports = Grove_GPS;
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9wYXJ0cy9Hcm92ZS9Hcm92ZV9HUFMvaW5kZXguanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE1BQU0sU0FBUztJQUNiO1FBQ0UsSUFBSSxDQUFDLElBQUksR0FBRyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ3ZDLElBQUksQ0FBQyxZQUFZLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFFakMsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDO1FBQ3hCLElBQUksQ0FBQyxXQUFXLEdBQUcsS0FBSyxDQUFDO1FBQ3pCLElBQUksQ0FBQyxjQUFjLEdBQUcsRUFBRSxFQUFFLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUUsQ0FBQztJQUMvQyxDQUFDO0lBRUQsTUFBTSxDQUFDLElBQUk7UUFDVCxPQUFPO1lBQ0wsSUFBSSxFQUFFLFdBQVc7U0FDbEIsQ0FBQztJQUNKLENBQUM7SUFFRCxLQUFLLENBQUMsS0FBSztRQUNULElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO1FBRW5CLElBQUksQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQzdELElBQUksQ0FBQyxJQUFJLEdBQUcsS0FBSyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ2hDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDO1lBQ2QsRUFBRSxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRTtZQUNsQixFQUFFLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxFQUFFO1lBQ2xCLElBQUksRUFBRSxJQUFJO1NBQ1gsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLFVBQVUsR0FBRyxFQUFFLENBQUM7UUFDckIsSUFBSSxDQUFD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Q0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDM0QsT0FBTyxVQUFVLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzVDLENBQUM7SUFDRCxNQUFNLENBQUMsR0FBRztRQUNSLDhDQUE4QztRQUM5QyxHQUFHLEdBQUcsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ3RCLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxHQUFHLEtBQUssQ0FBQyxDQUFDO1FBQ2hDLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxLQUFLLEdBQUcsQ0FBQyxDQUFDLEdBQUcsS0FBSyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDckQsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLEtBQUssR0FBRyxDQUFDLENBQUMsR0FBRyxLQUFLLEdBQUcsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDM0QsT0FBTyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEdBQUcsSUFBSSxHQUFHLElBQUksQ0FBQyxDQUFDO0lBQzNDLENBQUM7Q0FDRjtBQUVELElBQUksT0FBTyxNQUFNLEtBQUssUUFBUSxFQUFFO0lBQzlCLE1BQU0sQ0FBQyxPQUFPLEdBQUcsU0FBUyxDQUFDO0NBQzVCIiwiZmlsZSI6InBhcnRzL0dyb3ZlL0dyb3ZlX0dQUy9pbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImNsYXNzIEdyb3ZlX0dQUyB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMua2V5cyA9IFsndHgnLCAncngnLCAndmNjJywgJ2duZCddO1xuICAgIHRoaXMucmVxdWlyZWRLZXlzID0gWyd0eCcsICdyeCddO1xuXG4gICAgdGhpcy5pb0tleXMgPSB0aGlzLmtleXM7XG4gICAgdGhpcy5kaXNwbGF5TmFtZSA9ICdncHMnO1xuICAgIHRoaXMuZGlzcGxheUlvTmFtZXMgPSB7IHR4OiAndHgnLCByeDogJ3J4JyB9O1xuICB9XG5cbiAgc3RhdGljIGluZm8oKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWU6ICdHcm92ZV9HUFMnLFxuICAgIH07XG4gIH1cblxuICB3aXJlZChvYm5peikge1xuICAgIHRoaXMub2JuaXogPSBvYm5pejtcblxuICAgIHRoaXMub2JuaXouc2V0VmNjR25kKHRoaXMucGFyYW1zLnZjYywgdGhpcy5wYXJhbXMuZ25kLCAnNXYnKTtcbiAgICB0aGlzLnVhcnQgPSBvYm5pei5nZXRGcmVlVWFydCgpO1xuICAgIHRoaXMudWFydC5zdGFydCh7XG4gICAgICB0eDogdGhpcy5wYXJhbXMudHgsXG4gICAgICByeDogdGhpcy5wYXJhbXMucngsXG4gICAgICBiYXVkOiA5NjAwLFxuICAgIH0pO1xuXG4gICAgdGhpcy5lZGl0ZWREYXRhID0ge307XG4gICAgdGhpcy5lZGl0ZWREYXRhLmVuYWJsZSA9IGZhbHNlO1xuICAgIHRoaXMuZWRpdGVkRGF0YS5HUEdTViA9IG5ldyBBcnJheSg0KTtcblxuICAgIHRoaXMuZ3BzSW5mbyA9IHt9O1xuICAgIHRoaXMuZ3BzSW5mby5fc2VudGVuY2VUeXBlID0ge1xuICAgICAgR1BHR0E6IDB4MDAwMSwgLy8gR0dBIC0gR2xvYmFsIFBvc2l0aW9uaW5nIFN5c3RlbSBGaXggRGF0YVxuICAgICAgR1BHU0E6IDB4MDAwMiwgLy8gR1NBIC0gR05TUyBET1AgYW5kIGFjdGl2ZSBzYXRlbGxpdGVzXG4gICAgICBHUEdTVjogMHgwMDA0LCAvLyBHU1YgLSBTYXRlbGxpdGVzIGluIHZpZXdcbiAgICAgIEdQUk1DOiAweDAwMDgsIC8vIFJNQyAtIFJlY29tbWVuZGVkIG1pbmltdW0gc3BlY2lmaWMgR05TUyBkYXRhXG4gICAgICBHUFZURzogMHgwMDEwLCAvLyBWVEcgLSBUcmFjayBtYWRlIGdvb2QgYW5kIGdyb3VuZCBzcGVlZFxuICAgICAgR1BaREE6IDB4MDAyMCwgLy8gWkRBIC0gRGF0ZSAmIFRpbWVcbiAgICB9O1xuICAgIHRoaXMuZ3BzSW5mby5zdGF0dXMgPSAnVic7XG4gICAgdGhpcy5ncHNJbmZvLnNlbnRlbmNlcyA9IG5ldyBTZXQoKTsgLy8gU2V0IHNwZWNpZnlpbmcgc2VudGVuY2Ugb2YgTU5FQSBmcm9tIHdoaWNoIGRhdGEgaGF2ZSBiZWVuIG9idGFpbmVkXG4gICAgdGhpcy5ncHNJbmZvLnNhdGVsbGl0ZUluZm8gPSB7XG4gICAgICBzYXRlbGxpdGVzOiBbXSxcbiAgICAgIGluVmlldzogMCxcbiAgICB9O1xuICB9XG5cbiAgcmVhZFNlbnRlbmNlKCkge1xuICAgIGxldCByZXN1bHRzID0gW107XG4gICAgaWYgKHRoaXMudWFydC5pc0RhdGFFeGlzdHMoKSkge1xuICAgICAgbGV0IHBvcyA9IHRoaXMudWFydC5yZWNlaXZlZC5pbmRleE9mKDB4MGEpO1xuICAgICAgaWYgKHBvcyA+PSAwKSB7XG4gICAgICAgIHJlc3VsdHMgPSB0aGlzLnVhcnQucmVjZWl2ZWQuc2xpY2UoMCwgcG9zIC0gMSk7XG4gICAgICAgIHRoaXMudWFydC5yZWNlaXZlZC5zcGxpY2UoMCwgcG9zICsgMSk7XG4gICAgICAgIHJldHVybiB0aGlzLnVhcnQudHJ5Q29udmVydFN0cmluZyhyZXN1bHRzKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuICcnO1xuICB9XG5cbiAgZ2V0RWRpdGVkRGF0YSgpIHtcbiAgICBsZXQgbiwgdXRjLCBmb3JtYXQ7XG4gICAgbGV0IHNlbnRlbmNlID0gdGhpcy5yZWFkU2VudGVuY2UoKTtcbiAgICB0aGlzLmVkaXRlZERhdGEuZW5hYmxlID0gZmFsc2U7XG4gICAgdGhpcy5lZGl0ZWREYXRhLkdQR1NWID0gbmV3IEFycmF5KDQpO1xuICAgIHdoaWxlIChzZW50ZW5jZS5sZW5ndGggPiAwKSB7XG4gICAgICBsZXQgcGFydCA9IHNlbnRlbmNlLnNwbGl0KCcsJyk7XG4gICAgICBpZiAoc2VudGVuY2Uuc2xpY2UoLTQsIC0zKSAhPSAnLCcpIHtcbiAgICAgICAgbGV0IHN0ID0gcGFydFtwYXJ0Lmxlbmd0aCAtIDFdLnNsaWNlKDAsIC0zKTtcbiAgICAgICAgcGFydC5wdXNoKHBhcnRbcGFydC5sZW5ndGggLSAxXS5zbGljZSgtMykpO1xuICAgICAgICBwYXJ0W3BhcnQubGVuZ3RoIC0gMl0gPSBzdDtcbiAgICAgIH1cbiAgICAgIHRoaXMuZWRpdGVkRGF0YS5zZW50ZW5jZSA9IHBhcnQuam9pbignLCcpO1xuICAgICAgc3dpdGNoIChwYXJ0WzBdKSB7XG4gICAgICAgIGNhc2UgJyRHUEdHQSc6XG4gICAgICAgICAgdGhpcy5lZGl0ZWREYXRhLkdQR0dBID0gcGFydDtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnJEdQR0xMJzpcbiAgICAgICAgICB0aGlzLmVkaXRlZERhdGEuR1BHTEwgPSBwYXJ0O1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICckR1BHU0EnOlxuICAgICAgICAgIHRoaXMuZWRpdGVkRGF0YS5HUEdTQSA9IHBhcnQ7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJyRHUEdTVic6XG4gICAgICAgICAgbiA9IE51bWJlcihwYXJ0WzJdKTtcbiAgICAgICAgICBpZiAobiA+IHRoaXMuZWRpdGVkRGF0YS5HUEdTVi5sZW5ndGgpIHtcbiAgICAgICAgICAgIHdoaWxlIChuID4gdGhpcy5lZGl0ZWREYXRhLkdQR1NWLmxlbmd0aCkge1xuICAgICAgICAgICAgICB0aGlzLmVkaXRlZERhdGEuR1BHU1YucHVzaChbXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMuZWRpdGVkRGF0YS5HUEdTVltuIC0gMV0gPSBwYXJ0O1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICckR1BSTUMnOlxuICAgICAgICAgIHRoaXMuZWRpdGVkRGF0YS5HUFJNQyA9IHBhcnQ7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJyRHUFZURyc6XG4gICAgICAgICAgdGhpcy5lZGl0ZWREYXRhLkdQVlRHID0gcGFydDtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnJEdQWkRBJzpcbiAgICAgICAgICB0aGlzLmVkaXRlZERhdGEuR1BaREEgPSBwYXJ0O1xuICAgICAgICAgIHV0YyA9XG4gICAgICAgICAgICBwYXJ0WzRdICtcbiAgICAgICAgICAgICcvJyArXG4gICAgICAgICAgICBwYXJ0WzNdICtcbiAgICAgICAgICAgICcvJyArXG4gICAgICAgICAgICBwYXJ0WzJdICtcbiAgICAgICAgICAgICcgJyArXG4gICAgICAgICAgICBwYXJ0WzFdLnN1YnN0cmluZygwLCAyKSArXG4gICAgICAgICAgICAnOicgK1xuICAgICAgICAgICAgcGFydFsxXS5zdWJzdHJpbmcoMiwgNCkgK1xuICAgICAgICAgICAgJzonICtcbiAgICAgICAgICAgIHBhcnRbMV0uc3Vic3RyaW5nKDQsIDYpICtcbiAgICAgICAgICAgICcgKzAwOjAwJztcbiAgICAgICAgICB0aGlzLmVkaXRlZERhdGEudGltZXN0YW1wID0gbmV3IERhdGUodXRjKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICBmb3JtYXQgPSBwYXJ0WzBdLnN1YnN0cigxKTtcbiAgICAgICAgICB0aGlzLmVkaXRlZERhdGFbZm9ybWF0XSA9IHBhcnQ7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuZWRpdGVkRGF0YS5lbmFibGUgPSB0cnVlO1xuICAgICAgc2VudGVuY2UgPSB0aGlzLnJlYWRTZW50ZW5jZSgpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5lZGl0ZWREYXRhO1xuICB9XG5cbiAgZ2V0R3BzSW5mbyhlZGl0ZWREYXRhKSB7XG4gICAgY29uc3QgTk1FQV9TQVRJTlNFTlRFTkNFID0gNCxcbiAgICAgIE5NRUFfTUFYU0FUID0gMTI7XG4gICAgZWRpdGVkRGF0YSA9IGVkaXRlZERhdGEgfHwgdGhpcy5nZXRFZGl0ZWREYXRhKCk7XG4gICAgdGhpcy5ncHNJbmZvLnN0YXR1cyA9ICdWJztcbiAgICBpZiAoZWRpdGVkRGF0YS5lbmFibGUpIHtcbiAgICAgIGlmIChlZGl0ZWREYXRhLkdQR0dBKSB7XG4gICAgICAgIGNvbnN0IGdnYSA9IGVkaXRlZERhdGEuR1BHR0E7XG4gICAgICAgIHRoaXMuZ3BzSW5mby5ncHNRdWFsaXR5ID0gcGFyc2VGbG9hdChnZ2FbNl0pOyAvL0ZpeCBRdWFsaXR5OiAwID0gSW52YWxpZCwgMSA9IEdQUyBmaXgsIDIgPSBER1BTIGZpeFxuICAgICAgICB0aGlzLmdwc0luZm8uaGRvcCA9IHBhcnNlRmxvYXQoZ2dhWzhdKTsgLy9Ib3Jpem9udGFsIERpbHV0aW9uIG9mIFByZWNpc2lvbiAoSERPUClcbiAgICAgICAgdGhpcy5ncHNJbmZvLmFsdGl0dWRlID0gcGFyc2VGbG9hdChnZ2FbOV0pOyAvL0FudGVubmEgQWx0aXR1ZGUgbWV0ZXJzIGFib3ZlIG1lYW4gc2VhIGxldmVsXG4gICAgICAgIGNvbnN0IGxhdGl0dWRlID0gdGhpcy5ubWVhMmRkKHBhcnNlRmxvYXQoZ2dhWzJdKSk7XG4gICAgICAgIHRoaXMuZ3BzSW5mby5sYXRpdHVkZSA9IGdnYVszXSA9PSAnTicgPyBsYXRpdHVkZSA6IC1sYXRpdHVkZTtcbiAgICAgICAgY29uc3QgbG9uZ2l0dWRlID0gdGhpcy5ubWVhMmRkKHBhcnNlRmxvYXQoZ2dhWzRdKSk7XG4gICAgICAgIHRoaXMuZ3BzSW5mby5sb25naXR1ZGUgPSBnZ2FbNV0gPT0gJ0UnID8gbG9uZ2l0dWRlIDogLWxvbmdpdHVkZTtcbiAgICAgICAgdGhpcy5ncHNJbmZvLnNlbnRlbmNlcy5hZGQodGhpcy5ncHNJbmZvLl9zZW50ZW5jZVR5cGUuR1BHR0EpO1xuICAgICAgfVxuICAgICAgaWYgKGVkaXRlZERhdGEuR1BHU1YpIHtcbiAgICAgICAgZm9yIChsZXQgbiA9IDA7IG4gPCBlZGl0ZWREYXRhLkdQR1NWLmxlbmd0aDsgbisrKVxuICAgICAgICAgIGlmIChlZGl0ZWREYXRhLkdQR1NWW25dKSB7XG4gICAgICAgICAgICBjb25zdCBnc3YgPSBlZGl0ZWREYXRhLkdQR1NWW25dLm1hcCh2ID0+IHBhcnNlRmxvYXQodikpO1xuICAgICAgICAgICAgY29uc3QgcGFja19jb3VudCA9IGdzdlsxXSxcbiAgICAgICAgICAgICAgcGFja19pbmRleCA9IGdzdlsyXSxcbiAgICAgICAgICAgICAgc2F0X2NvdW50ID0gZ3N2WzNdO1xuICAgICAgICAgICAgaWYgKHBhY2tfaW5kZXggPiBwYWNrX2NvdW50KSBjb250aW51ZTtcblxuICAgICAgICAgICAgdGhpcy5ncHNJbmZvLnNhdGVsbGl0ZUluZm8uaW5WaWV3ID0gc2F0X2NvdW50O1xuICAgICAgICAgICAgbGV0IG5zYXQgPSAocGFja19pbmRleCAtIDEpICogTk1FQV9TQVRJTlNFTlRFTkNFO1xuICAgICAgICAgICAgbnNhdCA9XG4gICAgICAgICAgICAgIG5zYXQgKyBOTUVBX1NBVElOU0VOVEVOQ0UgPiBzYXRfY291bnRcbiAgICAgICAgICAgICAgICA/IHNhdF9jb3VudCAtIG5zYXRcbiAgICAgICAgICAgICAgICA6IE5NRUFfU0FUSU5TRU5URU5DRTtcblxuICAgICAgICAgICAgZm9yIChsZXQgaXNhdCA9IDA7IGlzYXQgPCBuc2F0OyArK2lzYXQpIHtcbiAgICAgICAgICAgICAgY29uc3QgaXNpID0gKHBhY2tfaW5kZXggLSAxKSAqIE5NRUFfU0FUSU5TRU5URU5DRSArIGlzYXQ7XG4gICAgICAgICAgICAgIGlmICh0aGlzLmdwc0luZm8uc2F0ZWxsaXRlSW5mby5zYXRlbGxpdGVzLmxlbmd0aCA8PSBpc2kpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdwc0luZm8uc2F0ZWxsaXRlSW5mby5zYXRlbGxpdGVzLnB1c2goe30pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGNvbnN0IGlzYXRuID0gaXNhdCAqIE5NRUFfU0FUSU5TRU5URU5DRTtcbiAgICAgICAgICAgICAgdGhpcy5ncHNJbmZvLnNhdGVsbGl0ZUluZm8uc2F0ZWxsaXRlc1tpc2ldID0ge1xuICAgICAgICAgICAgICAgIGlkOiBnc3ZbaXNhdG4gKyA0XSwgLy8gU1YgUFJOIG51bWJlclxuICAgICAgICAgICAgICAgIGVsZXZhdGlvbjogZ3N2W2lzYXRuICsgNV0sIC8vIEVsZXZhdGlvbiBpbiBkZWdyZWVzLCA5MCBtYXhpbXVtXG4gICAgICAgICAgICAgICAgYXppbXV0aDogZ3N2W2lzYXRuICsgNl0sIC8vIEF6aW11dGgsIGRlZ3JlZXMgZnJvbSB0cnVlIG5vcnRoLCAwMDAgdG8gMzU5XG4gICAgICAgICAgICAgICAgc25yOiBnc3ZbaXNhdG4gKyA3XSwgLy8gU05SLCAwMC05OSBkQiAobnVsbCB3aGVuIG5vdCB0cmFja2luZylcbiAgICAgICAgICAgICAgICBpblVzZTogZmFsc2UsXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmdwc0luZm8uc2VudGVuY2VzLmFkZCh0aGlzLmdwc0luZm8uX3NlbnRlbmNlVHlwZS5HUEdTVik7XG4gICAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKGVkaXRlZERhdGEuR1BHU0EpIHtcbiAgICAgICAgY29uc3QgZ3NhID0gZWRpdGVkRGF0YS5HUEdTQTtcbiAgICAgICAgbGV0IG51c2UgPSAwO1xuICAgICAgICB0aGlzLmdwc0luZm8uZml4TW9kZSA9IHBhcnNlRmxvYXQoZ3NhWzJdKTsgLy8gRml4IE1vZGU6IDE9Rml4IG5vdCBhdmFpbGFibGUsIDI9MkQsIDM9M0RcbiAgICAgICAgdGhpcy5ncHNJbmZvLnBkb3AgPSBwYXJzZUZsb2F0KGdzYVsxNV0pOyAvLyBQRE9QOiBQb3NpdGlvbiBEaWx1dGlvbiBvZiBQcmVjaXNpb25cbiAgICAgICAgdGhpcy5ncHNJbmZvLmhkb3AgPSBwYXJzZUZsb2F0KGdzYVsxNl0pOyAvLyBIRE9QOiBIb3Jpem9udGFsIERpbHV0aW9uIG9mIFByZWNpc2lvblxuICAgICAgICB0aGlzLmdwc0luZm8udmRvcCA9IHBhcnNlRmxvYXQoZ3NhWzE3XSk7IC8vIFZET1A6IFZlcnRpY2FsIERpbHV0aW9uIG9mIFBvc2l0aW9uXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgTk1FQV9NQVhTQVQ7ICsraSkge1xuICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdGhpcy5ncHNJbmZvLnNhdGVsbGl0ZUluZm8uaW5WaWV3OyArK2opIHtcbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgdGhpcy5ncHNJbmZvLnNhdGVsbGl0ZUluZm8uc2F0ZWxsaXRlc1tqXSAmJlxuICAgICAgICAgICAgICBnc2FbaSArIDNdID09IHRoaXMuZ3BzSW5mby5zYXRlbGxpdGVJbmZvLnNhdGVsbGl0ZXNbal0uaWRcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICB0aGlzLmdwc0luZm8uc2F0ZWxsaXRlSW5mby5zYXRlbGxpdGVzW2pdLmluVXNlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgbnVzZSsrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLmdwc0luZm8uc2F0ZWxsaXRlSW5mby5pblVzZSA9IG51c2U7XG4gICAgICAgIHRoaXMuZ3BzSW5mby5zZW50ZW5jZXMuYWRkKHRoaXMuZ3BzSW5mby5fc2VudGVuY2VUeXBlLkdQR1NBKTtcbiAgICAgIH1cbiAgICAgIGlmIChlZGl0ZWREYXRhLkdQUk1DKSB7XG4gICAgICAgIGNvbnN0IHJtYyA9IGVkaXRlZERhdGEuR1BSTUM7XG4gICAgICAgIHRoaXMuZ3BzSW5mby5zdGF0dXMgPSBybWNbMl07IC8vIFN0YXR1cyBBY3RpdmUgb3IgVm9pZFxuICAgICAgICBjb25zdCBsYXRpdHVkZSA9IHRoaXMubm1lYTJkZChwYXJzZUZsb2F0KHJtY1szXSkpO1xuICAgICAgICB0aGlzLmdwc0luZm8ubGF0aXR1ZGUgPSBybWNbNF0gPT0gJ04nID8gbGF0aXR1ZGUgOiAtbGF0aXR1ZGU7XG4gICAgICAgIGNvbnN0IGxvbmdpdHVkZSA9IHRoaXMubm1lYTJkZChwYXJzZUZsb2F0KHJtY1s1XSkpO1xuICAgICAgICB0aGlzLmdwc0luZm8ubG9uZ2l0dWRlID0gcm1jWzZdID09ICdFJyA/IGxvbmdpdHVkZSA6IC1sb25naXR1ZGU7XG4gICAgICAgIGNvbnN0IE5NRUFfVFVEX0tOT1RTID0gMS44NTI7IC8vIDFrbm90PTEuODUya20vaFxuICAgICAgICB0aGlzLmdwc0luZm8uc3BlZWQgPSBwYXJzZUZsb2F0KHJtY1s3XSkgKiBOTUVBX1RVRF9LTk9UUzsgLy91bml0OiBrbS9oXG4gICAgICAgIHRoaXMuZ3BzSW5mby5kaXJlY3Rpb24gPSBybWNbOF07XG4gICAgICAgIHRoaXMuZ3BzSW5mby5zZW50ZW5jZXMuYWRkKHRoaXMuZ3BzSW5mby5fc2VudGVuY2VUeXBlLkdQUk1DKTtcbiAgICAgIH1cbiAgICAgIGlmIChlZGl0ZWREYXRhLkdQVlRHKSB7XG4gICAgICAgIGNvbnN0IHZ0ZyA9IGVkaXRlZERhdGEuR1BWVEc7XG4gICAgICAgIHRoaXMuZ3BzSW5mby5kaXJlY3Rpb24gPSBwYXJzZUZsb2F0KHZ0Z1sxXSk7XG4gICAgICAgIHRoaXMuZ3BzSW5mby5kZWNsaW5hdGlvbiA9IHBhcnNlRmxvYXQodnRnWzNdKTtcbiAgICAgICAgdGhpcy5ncHNJbmZvLnNwZWVkID0gcGFyc2VGbG9hdCh2dGdbN10pO1xuICAgICAgICB0aGlzLmdwc0luZm8uc2VudGVuY2VzLmFkZCh0aGlzLmdwc0luZm8uX3NlbnRlbmNlVHlwZS5HUFZURyk7XG4gICAgICB9XG4gICAgICBpZiAoZWRpdGVkRGF0YS5HUFpEQSkge1xuICAgICAgICB0aGlzLmdwc0luZm8udXRjID0gZWRpdGVkRGF0YS50aW1lc3RhbXA7XG4gICAgICAgIHRoaXMuZ3BzSW5mby5zZW50ZW5jZXMuYWRkKHRoaXMuZ3BzSW5mby5fc2VudGVuY2VUeXBlLkdQWkRBKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuZ3BzSW5mbztcbiAgfVxuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgZ2V0IGxhdGl0dWRlKCkge1xuICAgIHJldHVybiB0aGlzLm5tZWEyZGQodGhpcy5fbGF0aXR1ZGUpO1xuICB9XG4gIGdldCBsb25naXR1ZGUoKSB7XG4gICAgcmV0dXJuIHRoaXMubm1lYTJkZCh0aGlzLl9sb25naXR1ZGUpO1xuICB9XG4gIF9tbmVhVG8oZm9ybWF0LCB2YWx1ZSkge1xuICAgIGxldCByZXN1bHQgPSB0aGlzLm5tZWEyZGQodmFsdWUpO1xuICAgIGlmICh0eXBlb2YgZm9ybWF0ID09ICdzdHJpbmcnKSB7XG4gICAgICBzd2l0Y2ggKGZvcm1hdC50b1VwcGVyQ2FzZSgpKSB7XG4gICAgICAgIGNhc2UgJ0RNUyc6XG4gICAgICAgICAgcmVzdWx0ID0gdGhpcy5ubWVhMmRtcyh2YWx1ZSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ0RNJzpcbiAgICAgICAgICByZXN1bHQgPSB0aGlzLm5tZWEyZG0odmFsdWUpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdTJzpcbiAgICAgICAgICByZXN1bHQgPSB0aGlzLm5tZWEycyh2YWx1ZSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cbiAgbGF0aXR1ZGVUbyhmb3JtYXQpIHtcbiAgICByZXR1cm4gdGhpcy5fbW5lYVRvKGZvcm1hdCwgdGhpcy5fbGF0aXR1ZGUpO1xuICB9XG4gIGxvbmdpdHVkZVRvKGZvcm1hdCkge1xuICAgIHJldHVybiB0aGlzLl9tbmVhVG8oZm9ybWF0LCB0aGlzLl9sb25naXR1ZGUpO1xuICB9XG4gIHN0YXR1czJzdHJpbmcoc3RhdHVzKSB7XG4gICAgc3RhdHVzID0gc3RhdHVzIHx8IHRoaXMuc3RhdHVzO1xuICAgIGlmIChzdGF0dXMgPT0gJ0EnKSByZXR1cm4gJ0FjdGl2ZSc7XG4gICAgaWYgKHN0YXR1cyA9PSAnVicpIHJldHVybiAnVm9pZCc7XG4gICAgcmV0dXJuIHN0YXR1cztcbiAgfVxuICBmaXhNb2RlMnN0cmluZyhmaXhNb2RlKSB7XG4gICAgZml4TW9kZSA9IGZpeE1vZGUgfHwgdGhpcy5maXhNb2RlO1xuICAgIGlmIChmaXhNb2RlID09IDEpIHJldHVybiAnRml4IG5vdCBhdmFpbGFibGUnO1xuICAgIGlmIChmaXhNb2RlID09IDIpIHJldHVybiAnMkQnO1xuICAgIGlmIChmaXhNb2RlID09IDMpIHJldHVybiAnM0QnO1xuICAgIHJldHVybiBmaXhNb2RlO1xuICB9XG4gIGdwc1F1YWxpdHkyc3RyaW5nKGdwc1F1YWxpdHkpIHtcbiAgICBncHNRdWFsaXR5ID0gZ3BzUXVhbGl0eSB8fCB0aGlzLmdwc1F1YWxpdHk7XG4gICAgaWYgKGdwc1F1YWxpdHkgPT0gMCkgcmV0dXJuICdJbnZhbGlkJztcbiAgICBpZiAoZ3BzUXVhbGl0eSA9PSAxKSByZXR1cm4gJ0dQUyBmaXgnO1xuICAgIGlmIChncHNRdWFsaXR5ID09IDIpIHJldHVybiAnREdQUyBmaXgnO1xuICAgIHJldHVybiBncHNRdWFsaXR5O1xuICB9XG5cbiAgLy8tLS0gbGF0aXR1ZGUvbG9uZ2l0dWRlIE1ORUEgZm9ybWF0IGNoYW5nZSB0byBlYWNoIHVuaXRcbiAgbm1lYTJkbXModmFsKSB7XG4gICAgLy9OTUVBIGZvcm1hdCB0byBETVMgZm9ybWF0IHN0cmluZyAoOTk5wrAgOTknOTkuOVwiKVxuICAgIHZhbCA9IHBhcnNlRmxvYXQodmFsKTtcbiAgICBsZXQgZCA9IE1hdGguZmxvb3IodmFsIC8gMTAwKTtcbiAgICBsZXQgbSA9IE1hdGguZmxvb3IoKHZhbCAvIDEwMC4wIC0gZCkgKiAxMDAuMCk7XG4gICAgbGV0IHMgPSAoKHZhbCAvIDEwMC4wIC0gZCkgKiAxMDAuMCAtIG0pICogNjA7XG4gICAgcmV0dXJuIGQgKyAnwrAnICsgbSArIFwiJ1wiICsgcy50b0ZpeGVkKDEpICsgJ1wiJztcbiAgfVxuICBubWVhMmRtKHZhbCkge1xuICAgIC8vTk1FQSBmb3JtYXQgdG8gRE0gZm9ybWF0IHN0cmluZyAoOTk5wrAgOTkuOTk5OScpXG4gICAgdmFsID0gcGFyc2VGbG9hdCh2YWwpO1xuICAgIGxldCBkID0gTWF0aC5mbG9vcih2YWwgLyAxMDAuMCk7XG4gICAgbGV0IG0gPSAodmFsIC8gMTAwLjAgLSBkKSAqIDEwMC4wO1xuICAgIHJldHVybiBkICsgJ8KwJyArIG0udG9GaXhlZCg0KSArIFwiJ1wiO1xuICB9XG4gIG5tZWEyZGQodmFsKSB7XG4gICAgLy9OTUVBIGZvcm1hdCB0byBERCBmb3JtYXQgZGVjaW1hbCAoOTk5Ljk5OTk5OSlcbiAgICB2YWwgPSBwYXJzZUZsb2F0KHZhbCk7XG4gICAgbGV0IGQgPSBNYXRoLmZsb29yKHZhbCAvIDEwMC4wKTtcbiAgICBsZXQgbSA9IE1hdGguZmxvb3IoKCh2YWwgLyAxMDAuMCAtIGQpICogMTAwLjApIC8gNjApO1xuICAgIGxldCBzID0gKCgodmFsIC8gMTAwLjAgLSBkKSAqIDEwMC4wIC0gbSkgKiA2MCkgLyAoNjAgKiA2MCk7XG4gICAgcmV0dXJuIHBhcnNlRmxvYXQoKGQgKyBtICsgcykudG9GaXhlZCg2KSk7XG4gIH1cbiAgbm1lYTJzKHZhbCkge1xuICAgIC8vTk1FQSBmb3JtYXQgdG8gUyBmb3JtYXQgZGVjaW1hbCAoOTk5OTkuOTk5OSlcbiAgICB2YWwgPSBwYXJzZUZsb2F0KHZhbCk7XG4gICAgbGV0IGQgPSBNYXRoLmZsb29yKHZhbCAvIDEwMC4wKTtcbiAgICBsZXQgbSA9IE1hdGguZmxvb3IoKCh2YWwgLyAxMDAuMCAtIGQpICogMTAwLjApIC8gNjApO1xuICAgIGxldCBzID0gKCgodmFsIC8gMTAwLjAgLSBkKSAqIDEwMC4wIC0gbSkgKiA2MCkgLyAoNjAgKiA2MCk7XG4gICAgcmV0dXJuIChkICsgbSArIHMpIC8gKDEuMCAvIDYwLjAgLyA2MC4wKTtcbiAgfVxufVxuXG5pZiAodHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcpIHtcbiAgbW9kdWxlLmV4cG9ydHMgPSBHcm92ZV9HUFM7XG59XG4iXX0=

{"version":3,"sources":["../src/obniz/libs/embeds/switch.ts"],"names":[],"mappings":";;AAGA,MAAM,WAAW;IAOf,YAAY,KAAU;QACpB,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;QACnB,IAAI,CAAC,MAAM,EAAE,CAAC;IAChB,CAAC;IAEM,MAAM;QACX,IAAI,CAAC,SAAS,GAAG,EAAE,CAAC;QACpB,IAAI,CAAC,oBAAoB,GAAG,GAAG,EAAE;QACjC,CAAC,CAAC;IACJ,CAAC;IAEM,WAAW,CAAC,QAA6B;QAC9C,IAAI,QAAQ,EAAE;YACZ,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;SAC/B;IACH,CAAC;IAEM,OAAO;QACZ,MAAM,IAAI,GAAQ,IAAI,CAAC;QACvB,OAAO,IAAI,OAAO,CAAC,CAAC,OAAY,EAAE,MAAW,EAAE,EAAE;YAC/C,MAAM,GAAG,GAAQ,EAAE,CAAC;YACpB,GAAG,CAAC,MAAM,GAAG,KAAK,CAAC;YACnB,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YACrB,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;QAC5B,CAAC,CAAC,CAAC;IACL,CAAC;IAEM,SAAS,CAAC,SAAkB;QACjC,MAAM,IAAI,GAAQ,IAAI,CAAC;QACvB,OAAO,IAAI,OAAO,CAAC,CAAC,OAAY,EAAE,MAAW,EAAE,EAAE;YAC/C,IAAI,CAAC,oBAAoB,GAAG,CAAC,OAAY,EAAE,EAAE;gBAC3C,IAAI,SAAS,KAAK,OAAO,EAAE;oBACzB,IAAI,CAAC,oBAAoB,GAAG,GAAG,EAAE;oBACjC,CAAC,CAAC;oBACF,OAAO,EAAE,CAAC;iBACX;YACH,CAAC,CAAC;QACJ,CAAC,CAAC,CAAC;IACL,CAAC;IAEM,QAAQ,CAAC,GAAQ;QACtB,IAAI,CAAC,KAAK,GAAG,GAAG,CAAC,KAAK,CAAC;QACvB,IAAI,IAAI,CAAC,QAAQ,EAAE;YACjB,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;SAC3B;QACD,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAEtC,MAAM,QAAQ,GAAQ,IAAI,CAAC,SAAS,CAAC,KAAK,EAAE,CAAC;QAC7C,IAAI,QAAQ,EAAE;YACZ,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;SACtB;IACH,CAAC;CACF;AAED,kBAAe,WAAW,CAAC","file":"switch.js","sourcesContent":["\r\ntype ObnizSwitchCallback = (result: boolean) => void;\r\n\r\nclass ObnizSwitch {\r\n  public Obniz: any;\r\n  public observers!: ObnizSwitchCallback[];\r\n  public onChangeForStateWait: any;\r\n  public state: any;\r\n  public onchange: any;\r\n\r\n  constructor(Obniz: any) {\r\n    this.Obniz = Obniz;\r\n    this._reset();\r\n  }\r\n\r\n  public _reset() {\r\n    this.observers = [];\r\n    this.onChangeForStateWait = () => {\r\n    };\r\n  }\r\n\r\n  public addObserver(callback: ObnizSwitchCallback) {\r\n    if (callback) {\r\n      this.observers.push(callback);\r\n    }\r\n  }\r\n\r\n  public getWait() {\r\n    const self: any = this;\r\n    return new Promise((resolve: any, reject: any) => {\r\n      const obj: any = {};\r\n      obj.switch = \"get\";\r\n      self.Obniz.send(obj);\r\n      self.addObserver(resolve);\r\n    });\r\n  }\r\n\r\n  public stateWait(isPressed: boolean) {\r\n    const self: any = this;\r\n    return new Promise((resolve: any, reject: any) => {\r\n      self.onChangeForStateWait = (pressed: any) => {\r\n        if (isPressed === pressed) {\r\n          self.onChangeForStateWait = () => {\r\n          };\r\n          resolve();\r\n        }\r\n      };\r\n    });\r\n  }\r\n\r\n  public notified(obj: any) {\r\n    this.state = obj.state;\r\n    if (this.onchange) {\r\n      this.onchange(this.state);\r\n    }\r\n    this.onChangeForStateWait(this.state);\r\n\r\n    const callback: any = this.observers.shift();\r\n    if (callback) {\r\n      callback(this.state);\r\n    }\r\n  }\r\n}\r\n\r\nexport default ObnizSwitch;\r\n"]}
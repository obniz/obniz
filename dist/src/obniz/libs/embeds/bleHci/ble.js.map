{"version":3,"sources":["../src/obniz/libs/embeds/bleHci/ble.ts"],"names":[],"mappings":"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","file":"ble.js","sourcesContent":["/**\n * @packageDocumentation\n * @module ObnizCore.Components.Ble.Hci\n */\n\nimport BleHelper from \"./bleHelper\";\nimport ObnizBLEHci from \"./hci\";\nimport CentralBindings from \"./protocol/central/bindings\";\nimport HciProtocol from \"./protocol/hci\";\nimport PeripheralBindings from \"./protocol/peripheral/bindings\";\n\nimport Obniz from \"../../../index\";\nimport BleAdvertisement from \"./bleAdvertisement\";\nimport BleCharacteristic from \"./bleCharacteristic\";\nimport BleDescriptor from \"./bleDescriptor\";\nimport BlePeripheral from \"./blePeripheral\";\nimport BleRemotePeripheral from \"./bleRemotePeripheral\";\nimport BleScan from \"./bleScan\";\nimport BleSecurity from \"./bleSecurity\";\nimport BleService from \"./bleService\";\nimport {BleDeviceAddressType, UUID} from \"./bleTypes\";\n\nexport default class ObnizBLE {\n\n  public static _dataArray2uuidHex(data: number[], reverse: boolean): UUID {\n    let uuid: any = [];\n    for (let i = 0; i < data.length; i++) {\n      uuid.push((\"00\" + data[i].toString(16).toLowerCase()).slice(-2));\n    }\n    if (reverse) {\n      uuid = uuid.reverse();\n    }\n    let str: any = uuid.join(\"\");\n    if (uuid.length >= 16) {\n      str =\n        str.slice(0, 8) +\n        \"-\" +\n        str.slice(8, 12) +\n        \"-\" +\n        str.slice(12, 16) +\n        \"-\" +\n        str.slice(16, 20) +\n        \"-\" +\n        str.slice(20);\n    }\n    return str;\n  }\n\n  public Obniz: Obniz;\n  public hci: ObnizBLEHci;\n  public hciProtocol: HciProtocol;\n  public centralBindings: CentralBindings;\n  public peripheralBindings: PeripheralBindings;\n  public _initialized: boolean;\n  public _initializeWarning: boolean;\n  public remotePeripherals: BleRemotePeripheral[];\n  public service: typeof BleService;\n  public characteristic: typeof BleCharacteristic;\n  public descriptor: typeof BleDescriptor;\n  public peripheral: BlePeripheral;\n  public advertisement: any;\n  public scan: BleScan;\n  public security: any;\n\n  constructor(obniz: Obniz) {\n    this.Obniz = obniz;\n    this.hci = new ObnizBLEHci(obniz);\n    this.hciProtocol = new HciProtocol(this.hci);\n\n    this.centralBindings = new CentralBindings(this.hciProtocol);\n    this.peripheralBindings = new PeripheralBindings(this.hciProtocol);\n\n    // let dummy = {write : ()=>{}, on:()=>{}}\n    // this.centralBindings = new CentralBindings( dummy );\n    // this.peripheralBindings = new PeripheralBindings( dummy );\n\n    this.centralBindings.init();\n    this.peripheralBindings.init();\n\n    this._initialized = false;\n    this._initializeWarning = true;\n\n    this.remotePeripherals = [];\n\n    this.service = BleService;\n    this.characteristic = BleCharacteristic;\n    this.descriptor = BleDescriptor;\n    this.peripheral = new BlePeripheral(this);\n\n    this.advertisement = new BleAdvertisement(this);\n    this.scan = new BleScan(this);\n    this.security = new BleSecurity(this);\n\n    this._bind();\n    this._reset();\n  }\n\n  public async initWait(): Promise<void> {\n    if (!this._initialized) {\n      this._initialized = true;\n      await this.hciProtocol.initWait();\n    }\n  }\n\n  public warningIfNotInitialize() {\n    if (!this._initialized && this._initializeWarning) {\n      this._initializeWarning = true;\n      this.Obniz.warning({\n        alert: \"warning\",\n        message: `BLE is not initialized. Please call 'await obniz.ble.initWait()'`,\n      });\n    }\n  }\n\n  public notified(obj: any) {\n    if (obj.hci) {\n      this.hci.notified(obj.hci);\n    }\n  }\n\n  public _reset() {\n  }\n\n  public directConnect(uuid: UUID, addressType: BleDeviceAddressType) {\n    let peripheral: any = this.findPeripheral(uuid);\n    if (!peripheral) {\n      peripheral = new BleRemotePeripheral(this, uuid);\n      this.remotePeripherals.push(peripheral);\n    }\n    if (!this.centralBindings._addresses[uuid]) {\n      const address: any = uuid.match(/.{1,2}/g)!.join(\":\");\n      this.centralBindings._addresses[uuid] = address;\n      this.centralBindings._addresseTypes[uuid] = addressType;\n      this.centralBindings._connectable[uuid] = true;\n    }\n    peripheral.connect();\n    return peripheral;\n  }\n\n  public async directConnectWait(uuid: any, addressType: any) {\n    const peripheral: any = this.directConnect(uuid, addressType);\n    await peripheral.connectWait();\n    return peripheral;\n  }\n\n  public findPeripheral(address: any) {\n    for (const key in this.remotePeripherals) {\n      if (this.remotePeripherals[key].address === address) {\n        return this.remotePeripherals[key];\n      }\n    }\n    return null;\n  }\n\n  public onStateChange() {\n  }\n\n  public onAddressChange() {\n  }\n\n  public onScanStart() {\n  }\n\n  public onScanStop() {\n    this.scan.notifyFromServer(\"onfinish\", null);\n  }\n\n  public onDiscover(uuid: any, address?: any, addressType?: any, connectable?: any, advertisement?: any, rssi?: any) {\n    let val: any = this.findPeripheral(uuid);\n    if (!val) {\n      val = new BleRemotePeripheral(this, uuid);\n      this.remotePeripherals.push(val);\n    }\n    val.discoverdOnRemote = true;\n\n    const peripheralData: any = {\n      device_type: \"ble\",\n      address_type: addressType,\n      ble_event_type: connectable\n        ? \"connectable_advertisemnt\"\n        : \"non_connectable_advertising\",\n      rssi,\n      adv_data: advertisement.advertisementRaw,\n      scan_resp: advertisement.scanResponseRaw,\n    };\n\n    val.setParams(peripheralData);\n    val._adv_data_filtered = advertisement;\n\n    this.scan.notifyFromServer(\"onfind\", val);\n  }\n\n  public async onConnect(peripheralUuid: any, error?: any) {\n    const peripheral: any = this.findPeripheral(peripheralUuid);\n    if (!error) {\n      await peripheral.discoverAllHandlesWait();\n    }\n    peripheral.notifyFromServer(\"statusupdate\", {\n      status: error ? \"disconnected\" : \"connected\",\n    });\n  }\n\n  public onDisconnect(peripheralUuid: any) {\n    const peripheral: any = this.findPeripheral(peripheralUuid);\n    peripheral.notifyFromServer(\"statusupdate\", {status: \"disconnected\"});\n  }\n\n  public onRssiUpdate() {\n  }\n\n  public onServicesDiscover(peripheralUuid: any, serviceUuids?: any) {\n    const peripheral: any = this.findPeripheral(peripheralUuid);\n    for (const serviceUuid of serviceUuids) {\n      peripheral.notifyFromServer(\"discover\", {service_uuid: serviceUuid});\n    }\n    peripheral.notifyFromServer(\"discoverfinished\", {});\n  }\n\n  public onIncludedServicesDiscover(\n    peripheralUuid: any,\n    serviceUuid?: any,\n    includedServiceUuids?: any,\n  ) {\n  }\n\n  public onCharacteristicsDiscover(peripheralUuid: any, serviceUuid?: any, characteristics?: any) {\n    const peripheral: any = this.findPeripheral(peripheralUuid);\n    const service: any = peripheral.findService({service_uuid: serviceUuid});\n    for (const char of characteristics) {\n      const obj: any = {\n        properties: char.properties.map((e: any) => BleHelper.toSnakeCase(e)),\n        characteristic_uuid: char.uuid,\n      };\n      service.notifyFromServer(\"discover\", obj);\n    }\n    service.notifyFromServer(\"discoverfinished\", {});\n  }\n\n  public onRead(\n    peripheralUuid: any,\n    serviceUuid?: any,\n    characteristicUuid?: any,\n    data?: any,\n    isNotification?: any,\n    isSuccess?: any,\n  ) {\n    const peripheral: any = this.findPeripheral(peripheralUuid);\n    const characteristic: any = peripheral.findCharacteristic({\n      service_uuid: serviceUuid,\n      characteristic_uuid: characteristicUuid,\n    });\n\n    if (isNotification) {\n      const obj: any = {\n        data: Array.from(data),\n      };\n      characteristic.notifyFromServer(\"onnotify\", obj);\n    } else {\n      const obj: any = {\n        result: isSuccess ? \"success\" : \"failed\",\n        data: Array.from(data),\n      };\n      characteristic.notifyFromServer(\"onread\", obj);\n    }\n  }\n\n  public onWrite(peripheralUuid: any, serviceUuid?: any, characteristicUuid?: any, isSuccess?: any) {\n    const peripheral: any = this.findPeripheral(peripheralUuid);\n    const characteristic: any = peripheral.findCharacteristic({\n      service_uuid: serviceUuid,\n      characteristic_uuid: characteristicUuid,\n    });\n    characteristic.notifyFromServer(\"onwrite\", {\n      result: isSuccess ? \"success\" : \"failed\",\n    });\n  }\n\n  public onBroadcast(peripheralUuid: any, serviceUuid?: any, characteristicUuid?: any, state?: any) {\n  }\n\n  public onNotify(peripheralUuid: any, serviceUuid?: any, characteristicUuid?: any, state?: any) {\n    const peripheral: any = this.findPeripheral(peripheralUuid);\n    const char: any = peripheral.findCharacteristic({\n      service_uuid: serviceUuid,\n      characteristic_uuid: characteristicUuid,\n    });\n\n    if (state) {\n      char.notifyFromServer(\"onregisternotify\", {});\n    } else {\n      char.notifyFromServer(\"onunregisternotify\", {});\n    }\n  }\n\n  public onDescriptorsDiscover(\n    peripheralUuid: any,\n    serviceUuid?: any,\n    characteristicUuid?: any,\n    descriptors?: any,\n  ) {\n    const peripheral: any = this.findPeripheral(peripheralUuid);\n    const char: any = peripheral.findCharacteristic({\n      service_uuid: serviceUuid,\n      characteristic_uuid: characteristicUuid,\n    });\n    for (const descr of descriptors) {\n      const obj: any = {\n        descriptor_uuid: descr,\n      };\n      char.notifyFromServer(\"discover\", obj);\n    }\n    char.notifyFromServer(\"discoverfinished\", {});\n  }\n\n  public onValueRead(\n    peripheralUuid: any,\n    serviceUuid?: any,\n    characteristicUuid?: any,\n    descriptorUuid?: any,\n    data?: any,\n    isSuccess?: any,\n  ) {\n    const peripheral: any = this.findPeripheral(peripheralUuid);\n    const descriptor: any = peripheral.findDescriptor({\n      service_uuid: serviceUuid,\n      characteristic_uuid: characteristicUuid,\n      descriptor_uuid: descriptorUuid,\n    });\n\n    const obj: any = {\n      result: isSuccess ? \"success\" : \"failed\",\n      data: Array.from(data),\n    };\n    descriptor.notifyFromServer(\"onread\", obj);\n  }\n\n  public onValueWrite(\n    peripheralUuid: any,\n    serviceUuid?: any,\n    characteristicUuid?: any,\n    descriptorUuid?: any,\n    isSuccess?: any,\n  ) {\n    const peripheral: any = this.findPeripheral(peripheralUuid);\n    const descriptor: any = peripheral.findDescriptor({\n      service_uuid: serviceUuid,\n      characteristic_uuid: characteristicUuid,\n      descriptor_uuid: descriptorUuid,\n    });\n\n    const obj: any = {\n      result: isSuccess ? \"success\" : \"failed\",\n    };\n    descriptor.notifyFromServer(\"onwrite\", obj);\n  }\n\n  public onHandleRead(peripheralUuid: any, handle?: any, data?: any) {\n  }\n\n  public onHandleWrite(peripheralUuid: any, handle?: any) {\n  }\n\n  public onHandleNotify(peripheralUuid: any, handle?: any, data?: any) {\n  }\n\n  public onPeripheralStateChange(state: any) {\n    // console.error(\"onPeripheralStateChange\")\n  }\n\n  public onPeripheralAddressChange(address: any) {\n    // console.error(\"onPeripheralAddressChange\")\n  }\n\n  public onPeripheralPlatform(platform: any) {\n    // console.error(\"onPeripheralPlatform\")\n  }\n\n  public onPeripheralAdvertisingStart(error: any) {\n    // console.error(\"onPeripheralAdvertisingStart\")\n  }\n\n  public onPeripheralAdvertisingStop() {\n    // console.error(\"onPeripheralAdvertisingStop\")\n  }\n\n  public onPeripheralServicesSet(error: any) {\n    // console.error(\"onPeripheralServicesSet\")\n  }\n\n  public onPeripheralAccept(clientAddress: any) {\n    this.peripheral.currentConnectedDeviceAddress = clientAddress;\n    this.peripheral.onconnectionupdates({\n      address: clientAddress,\n      status: \"connected\",\n    });\n  }\n\n  public onPeripheralMtuChange(mtu: any) {\n    // console.error(\"onPeripheralMtuChange\")\n  }\n\n  public onPeripheralDisconnect(clientAddress: any) {\n    this.peripheral.currentConnectedDeviceAddress = null;\n    this.peripheral.onconnectionupdates({\n      address: clientAddress,\n      status: \"disconnected\",\n    });\n  }\n\n  public onPeripheralRssiUpdate(rssi: any) {\n    // console.error(\"onPeripheralRssiUpdate\")\n  }\n\n  public _bind() {\n    this.centralBindings.on(\"stateChange\", this.onStateChange.bind(this));\n\n    this.centralBindings.on(\"addressChange\", this.onAddressChange.bind(this));\n\n    this.centralBindings.on(\"scanStart\", this.onScanStart.bind(this));\n    this.centralBindings.on(\"scanStop\", this.onScanStop.bind(this));\n    this.centralBindings.on(\"discover\", this.onDiscover.bind(this));\n    this.centralBindings.on(\"connect\", this.onConnect.bind(this));\n    this.centralBindings.on(\"disconnect\", this.onDisconnect.bind(this));\n    this.centralBindings.on(\"rssiUpdate\", this.onRssiUpdate.bind(this));\n    this.centralBindings.on(\n      \"servicesDiscover\",\n      this.onServicesDiscover.bind(this),\n    );\n    this.centralBindings.on(\n      \"includedServicesDiscover\",\n      this.onIncludedServicesDiscover.bind(this),\n    );\n    this.centralBindings.on(\n      \"characteristicsDiscover\",\n      this.onCharacteristicsDiscover.bind(this),\n    );\n\n    this.centralBindings.on(\"read\", this.onRead.bind(this));\n    this.centralBindings.on(\"write\", this.onWrite.bind(this));\n    this.centralBindings.on(\"broadcast\", this.onBroadcast.bind(this));\n    this.centralBindings.on(\"notify\", this.onNotify.bind(this));\n    this.centralBindings.on(\n      \"descriptorsDiscover\",\n      this.onDescriptorsDiscover.bind(this),\n    );\n    this.centralBindings.on(\"valueRead\", this.onValueRead.bind(this));\n    this.centralBindings.on(\"valueWrite\", this.onValueWrite.bind(this));\n    this.centralBindings.on(\"handleRead\", this.onHandleRead.bind(this));\n    this.centralBindings.on(\"handleWrite\", this.onHandleWrite.bind(this));\n    this.centralBindings.on(\"handleNotify\", this.onHandleNotify.bind(this));\n\n    this.peripheralBindings.on(\n      \"stateChange\",\n      this.onPeripheralStateChange.bind(this),\n    );\n    this.peripheralBindings.on(\n      \"addressChange\",\n      this.onPeripheralAddressChange.bind(this),\n    );\n    this.peripheralBindings.on(\n      \"platform\",\n      this.onPeripheralPlatform.bind(this),\n    );\n    this.peripheralBindings.on(\n      \"advertisingStart\",\n      this.onPeripheralAdvertisingStart.bind(this),\n    );\n    this.peripheralBindings.on(\n      \"advertisingStop\",\n      this.onPeripheralAdvertisingStop.bind(this),\n    );\n    this.peripheralBindings.on(\n      \"servicesSet\",\n      this.onPeripheralServicesSet.bind(this),\n    );\n    this.peripheralBindings.on(\"accept\", this.onPeripheralAccept.bind(this));\n    this.peripheralBindings.on(\n      \"mtuChange\",\n      this.onPeripheralMtuChange.bind(this),\n    );\n    this.peripheralBindings.on(\n      \"disconnect\",\n      this.onPeripheralDisconnect.bind(this),\n    );\n\n    this.peripheralBindings.on(\n      \"rssiUpdate\",\n      this.onPeripheralRssiUpdate.bind(this),\n    );\n  }\n}\n"]}
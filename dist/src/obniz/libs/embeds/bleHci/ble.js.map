{"version":3,"sources":["../src/obniz/libs/embeds/bleHci/ble.ts"],"names":[],"mappings":"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","file":"ble.js","sourcesContent":["import BleHelper from \"./bleHelper\";\r\nimport ObnizBLEHci from \"./hci\";\r\nimport CentralBindings from \"./protocol/central/bindings\";\r\nimport HciProtocol from \"./protocol/hci\";\r\nimport PeripheralBindings from \"./protocol/peripheral/bindings\";\r\n\r\nimport Obniz from \"../../../index\";\r\nimport BleAdvertisement from \"./bleAdvertisement\";\r\nimport BleCharacteristic from \"./bleCharacteristic\";\r\nimport BleDescriptor from \"./bleDescriptor\";\r\nimport BlePeripheral from \"./blePeripheral\";\r\nimport BleRemotePeripheral from \"./bleRemotePeripheral\";\r\nimport BleScan from \"./bleScan\";\r\nimport BleSecurity from \"./bleSecurity\";\r\nimport BleService from \"./bleService\";\r\nimport {BleDeviceAddressType, UUID} from \"./bleTypes\";\r\n\r\nclass ObnizBLE {\r\n\r\n  public static _dataArray2uuidHex(data: number[], reverse: boolean): UUID {\r\n    let uuid: any = [];\r\n    for (let i = 0; i < data.length; i++) {\r\n      uuid.push((\"00\" + data[i].toString(16).toLowerCase()).slice(-2));\r\n    }\r\n    if (reverse) {\r\n      uuid = uuid.reverse();\r\n    }\r\n    let str: any = uuid.join(\"\");\r\n    if (uuid.length >= 16) {\r\n      str =\r\n        str.slice(0, 8) +\r\n        \"-\" +\r\n        str.slice(8, 12) +\r\n        \"-\" +\r\n        str.slice(12, 16) +\r\n        \"-\" +\r\n        str.slice(16, 20) +\r\n        \"-\" +\r\n        str.slice(20);\r\n    }\r\n    return str;\r\n  }\r\n\r\n  public Obniz: Obniz;\r\n  public hci: ObnizBLEHci;\r\n  public hciProtocol: HciProtocol;\r\n  public centralBindings: CentralBindings;\r\n  public peripheralBindings: PeripheralBindings;\r\n  public _initialized: boolean;\r\n  public _initializeWarning: boolean;\r\n  public remotePeripherals: BleRemotePeripheral[];\r\n  public service: typeof BleService;\r\n  public characteristic: typeof BleCharacteristic;\r\n  public descriptor: typeof BleDescriptor;\r\n  public peripheral: BlePeripheral;\r\n  public advertisement: any;\r\n  public scan: BleScan;\r\n  public security: any;\r\n\r\n  constructor(obniz: Obniz) {\r\n    this.Obniz = obniz;\r\n    this.hci = new ObnizBLEHci(obniz);\r\n    this.hciProtocol = new HciProtocol(this.hci);\r\n\r\n    this.centralBindings = new CentralBindings(this.hciProtocol);\r\n    this.peripheralBindings = new PeripheralBindings(this.hciProtocol);\r\n\r\n    // let dummy = {write : ()=>{}, on:()=>{}}\r\n    // this.centralBindings = new CentralBindings( dummy );\r\n    // this.peripheralBindings = new PeripheralBindings( dummy );\r\n\r\n    this.centralBindings.init();\r\n    this.peripheralBindings.init();\r\n\r\n    this._initialized = false;\r\n    this._initializeWarning = true;\r\n\r\n    this.remotePeripherals = [];\r\n\r\n    this.service = BleService;\r\n    this.characteristic = BleCharacteristic;\r\n    this.descriptor = BleDescriptor;\r\n    this.peripheral = new BlePeripheral(this);\r\n\r\n    this.advertisement = new BleAdvertisement(this);\r\n    this.scan = new BleScan(this);\r\n    this.security = new BleSecurity(this);\r\n\r\n    this._bind();\r\n    this._reset();\r\n  }\r\n\r\n  public async initWait(): Promise<void> {\r\n    if (!this._initialized) {\r\n      this._initialized = true;\r\n      await this.hciProtocol.initWait();\r\n    }\r\n  }\r\n\r\n  public warningIfNotInitialize() {\r\n    if (!this._initialized && this._initializeWarning) {\r\n      this._initializeWarning = true;\r\n      this.Obniz.warning({\r\n        alert: \"warning\",\r\n        message: `BLE is not initialized. Please call 'await obniz.ble.initWait()'`,\r\n      });\r\n    }\r\n  }\r\n\r\n  public notified(obj: any) {\r\n    if (obj.hci) {\r\n      this.hci.notified(obj.hci);\r\n    }\r\n  }\r\n\r\n  public _reset() {\r\n  }\r\n\r\n  public directConnect(uuid: UUID, addressType: BleDeviceAddressType) {\r\n    let peripheral: any = this.findPeripheral(uuid);\r\n    if (!peripheral) {\r\n      peripheral = new BleRemotePeripheral(this, uuid);\r\n      this.remotePeripherals.push(peripheral);\r\n    }\r\n    if (!this.centralBindings._addresses[uuid]) {\r\n      const address: any = uuid.match(/.{1,2}/g)!.join(\":\");\r\n      this.centralBindings._addresses[uuid] = address;\r\n      this.centralBindings._addresseTypes[uuid] = addressType;\r\n      this.centralBindings._connectable[uuid] = true;\r\n    }\r\n    peripheral.connect();\r\n    return peripheral;\r\n  }\r\n\r\n  public async directConnectWait(uuid: any, addressType: any) {\r\n    const peripheral: any = this.directConnect(uuid, addressType);\r\n    await peripheral.connectWait();\r\n    return peripheral;\r\n  }\r\n\r\n  public findPeripheral(address: any) {\r\n    for (const key in this.remotePeripherals) {\r\n      if (this.remotePeripherals[key].address === address) {\r\n        return this.remotePeripherals[key];\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  public onStateChange() {\r\n  }\r\n\r\n  public onAddressChange() {\r\n  }\r\n\r\n  public onScanStart() {\r\n  }\r\n\r\n  public onScanStop() {\r\n    this.scan.notifyFromServer(\"onfinish\", null);\r\n  }\r\n\r\n  public onDiscover(uuid: any, address?: any, addressType?: any, connectable?: any, advertisement?: any, rssi?: any) {\r\n    let val: any = this.findPeripheral(uuid);\r\n    if (!val) {\r\n      val = new BleRemotePeripheral(this, uuid);\r\n      this.remotePeripherals.push(val);\r\n    }\r\n    val.discoverdOnRemote = true;\r\n\r\n    const peripheralData: any = {\r\n      device_type: \"ble\",\r\n      address_type: addressType,\r\n      ble_event_type: connectable\r\n        ? \"connectable_advertisemnt\"\r\n        : \"non_connectable_advertising\",\r\n      rssi,\r\n      adv_data: advertisement.advertisementRaw,\r\n      scan_resp: advertisement.scanResponseRaw,\r\n    };\r\n\r\n    val.setParams(peripheralData);\r\n    val._adv_data_filtered = advertisement;\r\n\r\n    this.scan.notifyFromServer(\"onfind\", val);\r\n  }\r\n\r\n  public async onConnect(peripheralUuid: any, error?: any) {\r\n    const peripheral: any = this.findPeripheral(peripheralUuid);\r\n    if (!error) {\r\n      await peripheral.discoverAllHandlesWait();\r\n    }\r\n    peripheral.notifyFromServer(\"statusupdate\", {\r\n      status: error ? \"disconnected\" : \"connected\",\r\n    });\r\n  }\r\n\r\n  public onDisconnect(peripheralUuid: any) {\r\n    const peripheral: any = this.findPeripheral(peripheralUuid);\r\n    peripheral.notifyFromServer(\"statusupdate\", {status: \"disconnected\"});\r\n  }\r\n\r\n  public onRssiUpdate() {\r\n  }\r\n\r\n  public onServicesDiscover(peripheralUuid: any, serviceUuids?: any) {\r\n    const peripheral: any = this.findPeripheral(peripheralUuid);\r\n    for (const serviceUuid of serviceUuids) {\r\n      peripheral.notifyFromServer(\"discover\", {service_uuid: serviceUuid});\r\n    }\r\n    peripheral.notifyFromServer(\"discoverfinished\", {});\r\n  }\r\n\r\n  public onIncludedServicesDiscover(\r\n    peripheralUuid: any,\r\n    serviceUuid?: any,\r\n    includedServiceUuids?: any,\r\n  ) {\r\n  }\r\n\r\n  public onCharacteristicsDiscover(peripheralUuid: any, serviceUuid?: any, characteristics?: any) {\r\n    const peripheral: any = this.findPeripheral(peripheralUuid);\r\n    const service: any = peripheral.findService({service_uuid: serviceUuid});\r\n    for (const char of characteristics) {\r\n      const obj: any = {\r\n        properties: char.properties.map((e: any) => BleHelper.toSnakeCase(e)),\r\n        characteristic_uuid: char.uuid,\r\n      };\r\n      service.notifyFromServer(\"discover\", obj);\r\n    }\r\n    service.notifyFromServer(\"discoverfinished\", {});\r\n  }\r\n\r\n  public onRead(\r\n    peripheralUuid: any,\r\n    serviceUuid?: any,\r\n    characteristicUuid?: any,\r\n    data?: any,\r\n    isNotification?: any,\r\n    isSuccess?: any,\r\n  ) {\r\n    const peripheral: any = this.findPeripheral(peripheralUuid);\r\n    const characteristic: any = peripheral.findCharacteristic({\r\n      service_uuid: serviceUuid,\r\n      characteristic_uuid: characteristicUuid,\r\n    });\r\n\r\n    if (isNotification) {\r\n      const obj: any = {\r\n        data: Array.from(data),\r\n      };\r\n      characteristic.notifyFromServer(\"onnotify\", obj);\r\n    } else {\r\n      const obj: any = {\r\n        result: isSuccess ? \"success\" : \"failed\",\r\n        data: Array.from(data),\r\n      };\r\n      characteristic.notifyFromServer(\"onread\", obj);\r\n    }\r\n  }\r\n\r\n  public onWrite(peripheralUuid: any, serviceUuid?: any, characteristicUuid?: any, isSuccess?: any) {\r\n    const peripheral: any = this.findPeripheral(peripheralUuid);\r\n    const characteristic: any = peripheral.findCharacteristic({\r\n      service_uuid: serviceUuid,\r\n      characteristic_uuid: characteristicUuid,\r\n    });\r\n    characteristic.notifyFromServer(\"onwrite\", {\r\n      result: isSuccess ? \"success\" : \"failed\",\r\n    });\r\n  }\r\n\r\n  public onBroadcast(peripheralUuid: any, serviceUuid?: any, characteristicUuid?: any, state?: any) {\r\n  }\r\n\r\n  public onNotify(peripheralUuid: any, serviceUuid?: any, characteristicUuid?: any, state?: any) {\r\n    const peripheral: any = this.findPeripheral(peripheralUuid);\r\n    const char: any = peripheral.findCharacteristic({\r\n      service_uuid: serviceUuid,\r\n      characteristic_uuid: characteristicUuid,\r\n    });\r\n\r\n    if (state) {\r\n      char.notifyFromServer(\"onregisternotify\", {});\r\n    } else {\r\n      char.notifyFromServer(\"onunregisternotify\", {});\r\n    }\r\n  }\r\n\r\n  public onDescriptorsDiscover(\r\n    peripheralUuid: any,\r\n    serviceUuid?: any,\r\n    characteristicUuid?: any,\r\n    descriptors?: any,\r\n  ) {\r\n    const peripheral: any = this.findPeripheral(peripheralUuid);\r\n    const char: any = peripheral.findCharacteristic({\r\n      service_uuid: serviceUuid,\r\n      characteristic_uuid: characteristicUuid,\r\n    });\r\n    for (const descr of descriptors) {\r\n      const obj: any = {\r\n        descriptor_uuid: descr,\r\n      };\r\n      char.notifyFromServer(\"discover\", obj);\r\n    }\r\n    char.notifyFromServer(\"discoverfinished\", {});\r\n  }\r\n\r\n  public onValueRead(\r\n    peripheralUuid: any,\r\n    serviceUuid?: any,\r\n    characteristicUuid?: any,\r\n    descriptorUuid?: any,\r\n    data?: any,\r\n    isSuccess?: any,\r\n  ) {\r\n    const peripheral: any = this.findPeripheral(peripheralUuid);\r\n    const descriptor: any = peripheral.findDescriptor({\r\n      service_uuid: serviceUuid,\r\n      characteristic_uuid: characteristicUuid,\r\n      descriptor_uuid: descriptorUuid,\r\n    });\r\n\r\n    const obj: any = {\r\n      result: isSuccess ? \"success\" : \"failed\",\r\n      data: Array.from(data),\r\n    };\r\n    descriptor.notifyFromServer(\"onread\", obj);\r\n  }\r\n\r\n  public onValueWrite(\r\n    peripheralUuid: any,\r\n    serviceUuid?: any,\r\n    characteristicUuid?: any,\r\n    descriptorUuid?: any,\r\n    isSuccess?: any,\r\n  ) {\r\n    const peripheral: any = this.findPeripheral(peripheralUuid);\r\n    const descriptor: any = peripheral.findDescriptor({\r\n      service_uuid: serviceUuid,\r\n      characteristic_uuid: characteristicUuid,\r\n      descriptor_uuid: descriptorUuid,\r\n    });\r\n\r\n    const obj: any = {\r\n      result: isSuccess ? \"success\" : \"failed\",\r\n    };\r\n    descriptor.notifyFromServer(\"onwrite\", obj);\r\n  }\r\n\r\n  public onHandleRead(peripheralUuid: any, handle?: any, data?: any) {\r\n  }\r\n\r\n  public onHandleWrite(peripheralUuid: any, handle?: any) {\r\n  }\r\n\r\n  public onHandleNotify(peripheralUuid: any, handle?: any, data?: any) {\r\n  }\r\n\r\n  public onPeripheralStateChange(state: any) {\r\n    // console.error(\"onPeripheralStateChange\")\r\n  }\r\n\r\n  public onPeripheralAddressChange(address: any) {\r\n    // console.error(\"onPeripheralAddressChange\")\r\n  }\r\n\r\n  public onPeripheralPlatform(platform: any) {\r\n    // console.error(\"onPeripheralPlatform\")\r\n  }\r\n\r\n  public onPeripheralAdvertisingStart(error: any) {\r\n    // console.error(\"onPeripheralAdvertisingStart\")\r\n  }\r\n\r\n  public onPeripheralAdvertisingStop() {\r\n    // console.error(\"onPeripheralAdvertisingStop\")\r\n  }\r\n\r\n  public onPeripheralServicesSet(error: any) {\r\n    // console.error(\"onPeripheralServicesSet\")\r\n  }\r\n\r\n  public onPeripheralAccept(clientAddress: any) {\r\n    this.peripheral.currentConnectedDeviceAddress = clientAddress;\r\n    this.peripheral.onconnectionupdates({\r\n      address: clientAddress,\r\n      status: \"connected\",\r\n    });\r\n  }\r\n\r\n  public onPeripheralMtuChange(mtu: any) {\r\n    // console.error(\"onPeripheralMtuChange\")\r\n  }\r\n\r\n  public onPeripheralDisconnect(clientAddress: any) {\r\n    this.peripheral.currentConnectedDeviceAddress = null;\r\n    this.peripheral.onconnectionupdates({\r\n      address: clientAddress,\r\n      status: \"disconnected\",\r\n    });\r\n  }\r\n\r\n  public onPeripheralRssiUpdate(rssi: any) {\r\n    // console.error(\"onPeripheralRssiUpdate\")\r\n  }\r\n\r\n  public _bind() {\r\n    this.centralBindings.on(\"stateChange\", this.onStateChange.bind(this));\r\n\r\n    this.centralBindings.on(\"addressChange\", this.onAddressChange.bind(this));\r\n\r\n    this.centralBindings.on(\"scanStart\", this.onScanStart.bind(this));\r\n    this.centralBindings.on(\"scanStop\", this.onScanStop.bind(this));\r\n    this.centralBindings.on(\"discover\", this.onDiscover.bind(this));\r\n    this.centralBindings.on(\"connect\", this.onConnect.bind(this));\r\n    this.centralBindings.on(\"disconnect\", this.onDisconnect.bind(this));\r\n    this.centralBindings.on(\"rssiUpdate\", this.onRssiUpdate.bind(this));\r\n    this.centralBindings.on(\r\n      \"servicesDiscover\",\r\n      this.onServicesDiscover.bind(this),\r\n    );\r\n    this.centralBindings.on(\r\n      \"includedServicesDiscover\",\r\n      this.onIncludedServicesDiscover.bind(this),\r\n    );\r\n    this.centralBindings.on(\r\n      \"characteristicsDiscover\",\r\n      this.onCharacteristicsDiscover.bind(this),\r\n    );\r\n\r\n    this.centralBindings.on(\"read\", this.onRead.bind(this));\r\n    this.centralBindings.on(\"write\", this.onWrite.bind(this));\r\n    this.centralBindings.on(\"broadcast\", this.onBroadcast.bind(this));\r\n    this.centralBindings.on(\"notify\", this.onNotify.bind(this));\r\n    this.centralBindings.on(\r\n      \"descriptorsDiscover\",\r\n      this.onDescriptorsDiscover.bind(this),\r\n    );\r\n    this.centralBindings.on(\"valueRead\", this.onValueRead.bind(this));\r\n    this.centralBindings.on(\"valueWrite\", this.onValueWrite.bind(this));\r\n    this.centralBindings.on(\"handleRead\", this.onHandleRead.bind(this));\r\n    this.centralBindings.on(\"handleWrite\", this.onHandleWrite.bind(this));\r\n    this.centralBindings.on(\"handleNotify\", this.onHandleNotify.bind(this));\r\n\r\n    this.peripheralBindings.on(\r\n      \"stateChange\",\r\n      this.onPeripheralStateChange.bind(this),\r\n    );\r\n    this.peripheralBindings.on(\r\n      \"addressChange\",\r\n      this.onPeripheralAddressChange.bind(this),\r\n    );\r\n    this.peripheralBindings.on(\r\n      \"platform\",\r\n      this.onPeripheralPlatform.bind(this),\r\n    );\r\n    this.peripheralBindings.on(\r\n      \"advertisingStart\",\r\n      this.onPeripheralAdvertisingStart.bind(this),\r\n    );\r\n    this.peripheralBindings.on(\r\n      \"advertisingStop\",\r\n      this.onPeripheralAdvertisingStop.bind(this),\r\n    );\r\n    this.peripheralBindings.on(\r\n      \"servicesSet\",\r\n      this.onPeripheralServicesSet.bind(this),\r\n    );\r\n    this.peripheralBindings.on(\"accept\", this.onPeripheralAccept.bind(this));\r\n    this.peripheralBindings.on(\r\n      \"mtuChange\",\r\n      this.onPeripheralMtuChange.bind(this),\r\n    );\r\n    this.peripheralBindings.on(\r\n      \"disconnect\",\r\n      this.onPeripheralDisconnect.bind(this),\r\n    );\r\n\r\n    this.peripheralBindings.on(\r\n      \"rssiUpdate\",\r\n      this.onPeripheralRssiUpdate.bind(this),\r\n    );\r\n  }\r\n}\r\n\r\nexport default ObnizBLE;\r\n"]}
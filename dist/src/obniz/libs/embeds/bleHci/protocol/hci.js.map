{"version":3,"sources":["../src/obniz/libs/embeds/bleHci/protocol/hci.ts"],"names":[],"mappings":"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","file":"hci.js","sourcesContent":["// let debug = require('debug')('hci');\r\nconst debug: any = () => {\r\n};\r\n\r\nconst events: any = require(\"events\");\r\n\r\nconst HCI_COMMAND_PKT: any = 0x01;\r\nconst HCI_ACLDATA_PKT: any = 0x02;\r\nconst HCI_EVENT_PKT: any = 0x04;\r\n\r\nconst ACL_START_NO_FLUSH: any = 0x00;\r\nconst ACL_CONT: any = 0x01;\r\nconst ACL_START: any = 0x02;\r\n\r\nconst EVT_DISCONN_COMPLETE: any = 0x05;\r\nconst EVT_ENCRYPT_CHANGE: any = 0x08;\r\nconst EVT_CMD_COMPLETE: any = 0x0e;\r\nconst EVT_CMD_STATUS: any = 0x0f;\r\nconst EVT_NUMBER_OF_COMPLETED_PACKETS: any = 0x13;\r\nconst EVT_LE_META_EVENT: any = 0x3e;\r\n\r\nconst EVT_LE_CONN_COMPLETE: any = 0x01;\r\nconst EVT_LE_ADVERTISING_REPORT: any = 0x02;\r\nconst EVT_LE_CONN_UPDATE_COMPLETE: any = 0x03;\r\n\r\nconst OGF_LINK_CTL: any = 0x01;\r\nconst OCF_DISCONNECT: any = 0x0006;\r\n\r\nconst OGF_HOST_CTL: any = 0x03;\r\nconst OCF_SET_EVENT_MASK: any = 0x0001;\r\nconst OCF_RESET: any = 0x0003;\r\nconst OCF_READ_LE_HOST_SUPPORTED: any = 0x006c;\r\nconst OCF_WRITE_LE_HOST_SUPPORTED: any = 0x006d;\r\n\r\nconst OGF_INFO_PARAM: any = 0x04;\r\nconst OCF_READ_LOCAL_VERSION: any = 0x0001;\r\nconst OCF_READ_BUFFER_SIZE: any = 0x0005;\r\nconst OCF_READ_BD_ADDR: any = 0x0009;\r\n\r\nconst OGF_STATUS_PARAM: any = 0x05;\r\nconst OCF_READ_RSSI: any = 0x0005;\r\n\r\nconst OGF_LE_CTL: any = 0x08;\r\nconst OCF_LE_SET_EVENT_MASK: any = 0x0001;\r\nconst OCF_LE_READ_BUFFER_SIZE: any = 0x0002;\r\nconst OCF_LE_SET_ADVERTISING_PARAMETERS: any = 0x0006;\r\nconst OCF_LE_SET_ADVERTISING_DATA: any = 0x0008;\r\nconst OCF_LE_SET_SCAN_RESPONSE_DATA: any = 0x0009;\r\nconst OCF_LE_SET_ADVERTISE_ENABLE: any = 0x000a;\r\nconst OCF_LE_SET_SCAN_PARAMETERS: any = 0x000b;\r\nconst OCF_LE_SET_SCAN_ENABLE: any = 0x000c;\r\nconst OCF_LE_CREATE_CONN: any = 0x000d;\r\nconst OCF_LE_CONN_UPDATE: any = 0x0013;\r\nconst OCF_LE_START_ENCRYPTION: any = 0x0019;\r\nconst OCF_LE_LTK_NEG_REPLY: any = 0x001b;\r\n\r\nconst DISCONNECT_CMD: any = OCF_DISCONNECT | (OGF_LINK_CTL << 10);\r\n\r\nconst SET_EVENT_MASK_CMD: any = OCF_SET_EVENT_MASK | (OGF_HOST_CTL << 10);\r\nconst RESET_CMD: any = OCF_RESET | (OGF_HOST_CTL << 10);\r\nconst READ_LE_HOST_SUPPORTED_CMD: any =\r\n  OCF_READ_LE_HOST_SUPPORTED | (OGF_HOST_CTL << 10);\r\nconst WRITE_LE_HOST_SUPPORTED_CMD: any =\r\n  OCF_WRITE_LE_HOST_SUPPORTED | (OGF_HOST_CTL << 10);\r\n\r\nconst READ_LOCAL_VERSION_CMD: any = OCF_READ_LOCAL_VERSION | (OGF_INFO_PARAM << 10);\r\nconst READ_BUFFER_SIZE_CMD: any = OCF_READ_BUFFER_SIZE | (OGF_INFO_PARAM << 10);\r\nconst READ_BD_ADDR_CMD: any = OCF_READ_BD_ADDR | (OGF_INFO_PARAM << 10);\r\n\r\nconst READ_RSSI_CMD: any = OCF_READ_RSSI | (OGF_STATUS_PARAM << 10);\r\n\r\nconst LE_SET_EVENT_MASK_CMD: any = OCF_LE_SET_EVENT_MASK | (OGF_LE_CTL << 10);\r\nconst LE_READ_BUFFER_SIZE_CMD: any = OCF_LE_READ_BUFFER_SIZE | (OGF_LE_CTL << 10);\r\nconst LE_SET_SCAN_PARAMETERS_CMD: any =\r\n  OCF_LE_SET_SCAN_PARAMETERS | (OGF_LE_CTL << 10);\r\nconst LE_SET_SCAN_ENABLE_CMD: any = OCF_LE_SET_SCAN_ENABLE | (OGF_LE_CTL << 10);\r\nconst LE_CREATE_CONN_CMD: any = OCF_LE_CREATE_CONN | (OGF_LE_CTL << 10);\r\nconst LE_CONN_UPDATE_CMD: any = OCF_LE_CONN_UPDATE | (OGF_LE_CTL << 10);\r\nconst LE_START_ENCRYPTION_CMD: any = OCF_LE_START_ENCRYPTION | (OGF_LE_CTL << 10);\r\nconst LE_SET_ADVERTISING_PARAMETERS_CMD: any =\r\n  OCF_LE_SET_ADVERTISING_PARAMETERS | (OGF_LE_CTL << 10);\r\n\r\nconst LE_SET_ADVERTISING_DATA_CMD: any =\r\n  OCF_LE_SET_ADVERTISING_DATA | (OGF_LE_CTL << 10);\r\nconst LE_SET_SCAN_RESPONSE_DATA_CMD: any =\r\n  OCF_LE_SET_SCAN_RESPONSE_DATA | (OGF_LE_CTL << 10);\r\nconst LE_SET_ADVERTISE_ENABLE_CMD: any =\r\n  OCF_LE_SET_ADVERTISE_ENABLE | (OGF_LE_CTL << 10);\r\nconst LE_LTK_NEG_REPLY_CMD: any = OCF_LE_LTK_NEG_REPLY | (OGF_LE_CTL << 10);\r\n\r\nconst HCI_OE_USER_ENDED_CONNECTION: any = 0x13;\r\n\r\nconst STATUS_MAPPER: any = require(\"./hci-status\");\r\n\r\nclass Hci extends events.EventEmitter {\r\n  public _obnizHci: any;\r\n  public _state: any;\r\n  public _handleBuffers: any;\r\n  public on: any;\r\n  public _socket: any;\r\n  public once: any;\r\n  public _handleAclsInProgress: any;\r\n  public _aclOutQueue: any;\r\n  public _aclMtu: any;\r\n  public _aclMaxInProgress: any;\r\n  public addressType: any;\r\n  public address: any;\r\n\r\n  constructor(obnizHci: any) {\r\n    super();\r\n    this._obnizHci = obnizHci;\r\n    this._state = null;\r\n\r\n    this._handleBuffers = {};\r\n\r\n    this.on(\"stateChange\", this.onStateChange.bind(this));\r\n\r\n    this._socket = {\r\n      write: (data: any) => {\r\n        const arr: any = Array.from(data);\r\n        this._obnizHci.write(arr);\r\n      },\r\n    };\r\n    this._obnizHci.onread = this.onSocketData.bind(this);\r\n  }\r\n\r\n  public async initWait() {\r\n    this.reset();\r\n    // this.setEventMask();\r\n    // this.setLeEventMask();\r\n    // this.readLocalVersion();\r\n    // this.writeLeHostSupported();\r\n    // this.readLeHostSupported();\r\n    // this.readBdAddr();\r\n\r\n    return new Promise ((resolve: any ) => {\r\n      this.once(\"stateChange\", () => {\r\n        // console.log('te');\r\n        resolve();\r\n      });\r\n    });\r\n  }\r\n\r\n  public setEventMask() {\r\n    const cmd: any = Buffer.alloc(12);\r\n    const eventMask: any = Buffer.from(\"fffffbff07f8bf3d\", \"hex\");\r\n\r\n    // header\r\n    cmd.writeUInt8(HCI_COMMAND_PKT, 0);\r\n    cmd.writeUInt16LE(SET_EVENT_MASK_CMD, 1);\r\n\r\n    // length\r\n    cmd.writeUInt8(eventMask.length, 3);\r\n\r\n    eventMask.copy(cmd, 4);\r\n\r\n    debug(\"set event mask - writing: \" + cmd.toString(\"hex\"));\r\n    this._socket.write(cmd);\r\n  }\r\n\r\n  public reset() {\r\n    const cmd: any = Buffer.alloc(4);\r\n\r\n    // header\r\n    cmd.writeUInt8(HCI_COMMAND_PKT, 0);\r\n    cmd.writeUInt16LE(OCF_RESET | (OGF_HOST_CTL << 10), 1);\r\n\r\n    // length\r\n    cmd.writeUInt8(0x00, 3);\r\n\r\n    debug(\"reset - writing: \" + cmd.toString(\"hex\"));\r\n    this._socket.write(cmd);\r\n  }\r\n\r\n  public resetBuffers() {\r\n    this._handleAclsInProgress = {};\r\n    this._handleBuffers = {};\r\n    this._aclOutQueue = [];\r\n  }\r\n\r\n  public readLocalVersion() {\r\n    const cmd: any = Buffer.alloc(4);\r\n\r\n    // header\r\n    cmd.writeUInt8(HCI_COMMAND_PKT, 0);\r\n    cmd.writeUInt16LE(READ_LOCAL_VERSION_CMD, 1);\r\n\r\n    // length\r\n    cmd.writeUInt8(0x0, 3);\r\n\r\n    debug(\"read local version - writing: \" + cmd.toString(\"hex\"));\r\n    this._socket.write(cmd);\r\n  }\r\n\r\n  public readBdAddr() {\r\n    const cmd: any = Buffer.alloc(4);\r\n\r\n    // header\r\n    cmd.writeUInt8(HCI_COMMAND_PKT, 0);\r\n    cmd.writeUInt16LE(READ_BD_ADDR_CMD, 1);\r\n\r\n    // length\r\n    cmd.writeUInt8(0x0, 3);\r\n\r\n    debug(\"read bd addr - writing: \" + cmd.toString(\"hex\"));\r\n    this._socket.write(cmd);\r\n  }\r\n\r\n  public setLeEventMask() {\r\n    const cmd: any = Buffer.alloc(12);\r\n    const leEventMask: any = Buffer.from(\"1f00000000000000\", \"hex\");\r\n\r\n    // header\r\n    cmd.writeUInt8(HCI_COMMAND_PKT, 0);\r\n    cmd.writeUInt16LE(LE_SET_EVENT_MASK_CMD, 1);\r\n\r\n    // length\r\n    cmd.writeUInt8(leEventMask.length, 3);\r\n\r\n    leEventMask.copy(cmd, 4);\r\n\r\n    debug(\"set le event mask - writing: \" + cmd.toString(\"hex\"));\r\n    this._socket.write(cmd);\r\n  }\r\n\r\n  public readLeHostSupported() {\r\n    const cmd: any = Buffer.alloc(4);\r\n\r\n    // header\r\n    cmd.writeUInt8(HCI_COMMAND_PKT, 0);\r\n    cmd.writeUInt16LE(READ_LE_HOST_SUPPORTED_CMD, 1);\r\n\r\n    // length\r\n    cmd.writeUInt8(0x00, 3);\r\n\r\n    debug(\"read LE host supported - writing: \" + cmd.toString(\"hex\"));\r\n    this._socket.write(cmd);\r\n  }\r\n\r\n  public writeLeHostSupported() {\r\n    const cmd: any = Buffer.alloc(6);\r\n\r\n    // header\r\n    cmd.writeUInt8(HCI_COMMAND_PKT, 0);\r\n    cmd.writeUInt16LE(WRITE_LE_HOST_SUPPORTED_CMD, 1);\r\n\r\n    // length\r\n    cmd.writeUInt8(0x02, 3);\r\n\r\n    // data\r\n    cmd.writeUInt8(0x01, 4); // le\r\n    cmd.writeUInt8(0x00, 5); // simul\r\n\r\n    debug(\"write LE host supported - writing: \" + cmd.toString(\"hex\"));\r\n    this._socket.write(cmd);\r\n  }\r\n\r\n  public setScanParameters() {\r\n    const cmd: any = Buffer.alloc(11);\r\n\r\n    // header\r\n    cmd.writeUInt8(HCI_COMMAND_PKT, 0);\r\n    cmd.writeUInt16LE(LE_SET_SCAN_PARAMETERS_CMD, 1);\r\n\r\n    // length\r\n    cmd.writeUInt8(0x07, 3);\r\n\r\n    // data\r\n    cmd.writeUInt8(0x01, 4); // type: 0 -> passive, 1 -> active\r\n    cmd.writeUInt16LE(0x0010, 5); // internal, ms * 1.6\r\n    cmd.writeUInt16LE(0x0010, 7); // window, ms * 1.6\r\n    cmd.writeUInt8(0x00, 9); // own address type: 0 -> public, 1 -> random\r\n    cmd.writeUInt8(0x00, 10); // filter: 0 -> all event types\r\n\r\n    debug(\"set scan parameters - writing: \" + cmd.toString(\"hex\"));\r\n    this._socket.write(cmd);\r\n  }\r\n\r\n  public setScanEnabled(enabled: boolean, filterDuplicates: boolean) {\r\n    const cmd: any = Buffer.alloc(6);\r\n\r\n    // header\r\n    cmd.writeUInt8(HCI_COMMAND_PKT, 0);\r\n    cmd.writeUInt16LE(LE_SET_SCAN_ENABLE_CMD, 1);\r\n\r\n    // length\r\n    cmd.writeUInt8(0x02, 3);\r\n\r\n    // data\r\n    cmd.writeUInt8(enabled ? 0x01 : 0x00, 4); // enable: 0 -> disabled, 1 -> enabled\r\n    cmd.writeUInt8(filterDuplicates ? 0x01 : 0x00, 5); // duplicates: 0 -> duplicates, 0 -> duplicates\r\n\r\n    debug(\"set scan enabled - writing: \" + cmd.toString(\"hex\"));\r\n    this._socket.write(cmd);\r\n  }\r\n\r\n  public createLeConn(address: any, addressType: any) {\r\n    const cmd: any = Buffer.alloc(29);\r\n\r\n    // header\r\n    cmd.writeUInt8(HCI_COMMAND_PKT, 0);\r\n    cmd.writeUInt16LE(LE_CREATE_CONN_CMD, 1);\r\n\r\n    // length\r\n    cmd.writeUInt8(0x19, 3);\r\n\r\n    // data\r\n    cmd.writeUInt16LE(0x0060, 4); // interval\r\n    cmd.writeUInt16LE(0x0030, 6); // window\r\n    cmd.writeUInt8(0x00, 8); // initiator filter\r\n\r\n    cmd.writeUInt8(addressType === \"random\" ? 0x01 : 0x00, 9); // peer address type\r\n    Buffer.from(\r\n      address\r\n        .split(\":\")\r\n        .reverse()\r\n        .join(\"\"),\r\n      \"hex\",\r\n    ).copy(cmd, 10); // peer address\r\n\r\n    cmd.writeUInt8(0x00, 16); // own address type\r\n\r\n    cmd.writeUInt16LE(0x0006, 17); // min interval\r\n    cmd.writeUInt16LE(0x000c, 19); // max interval\r\n    cmd.writeUInt16LE(0x0000, 21); // latency\r\n    cmd.writeUInt16LE(0x00c8, 23); // supervision timeout\r\n    cmd.writeUInt16LE(0x0004, 25); // min ce length\r\n    cmd.writeUInt16LE(0x0006, 27); // max ce length\r\n\r\n    debug(\"create le conn - writing: \" + cmd.toString(\"hex\"));\r\n    this._socket.write(cmd);\r\n  }\r\n\r\n  public connUpdateLe(handle: any, minInterval: any, maxInterval: any, latency: any, supervisionTimeout: any) {\r\n    const cmd: any = Buffer.alloc(18);\r\n\r\n    // header\r\n    cmd.writeUInt8(HCI_COMMAND_PKT, 0);\r\n    cmd.writeUInt16LE(LE_CONN_UPDATE_CMD, 1);\r\n\r\n    // length\r\n    cmd.writeUInt8(0x0e, 3);\r\n\r\n    // data\r\n    cmd.writeUInt16LE(handle, 4);\r\n    cmd.writeUInt16LE(Math.floor(minInterval / 1.25), 6); // min interval\r\n    cmd.writeUInt16LE(Math.floor(maxInterval / 1.25), 8); // max interval\r\n    cmd.writeUInt16LE(latency, 10); // latency\r\n    cmd.writeUInt16LE(Math.floor(supervisionTimeout / 10), 12); // supervision timeout\r\n    cmd.writeUInt16LE(0x0000, 14); // min ce length\r\n    cmd.writeUInt16LE(0x0000, 16); // max ce length\r\n\r\n    debug(\"conn update le - writing: \" + cmd.toString(\"hex\"));\r\n    this._socket.write(cmd);\r\n  }\r\n\r\n  public startLeEncryption(handle: any, random: any, diversifier: any, key: any) {\r\n    const cmd: any = Buffer.alloc(32);\r\n\r\n    // header\r\n    cmd.writeUInt8(HCI_COMMAND_PKT, 0);\r\n    cmd.writeUInt16LE(LE_START_ENCRYPTION_CMD, 1);\r\n\r\n    // length\r\n    cmd.writeUInt8(0x1c, 3);\r\n\r\n    // data\r\n    cmd.writeUInt16LE(handle, 4); // handle\r\n    random.copy(cmd, 6);\r\n    diversifier.copy(cmd, 14);\r\n    key.copy(cmd, 16);\r\n\r\n    debug(\"start le encryption - writing: \" + cmd.toString(\"hex\"));\r\n    this._socket.write(cmd);\r\n  }\r\n\r\n  public disconnect(handle: any, reason: any) {\r\n    const cmd: any = Buffer.alloc(7);\r\n\r\n    reason = reason || HCI_OE_USER_ENDED_CONNECTION;\r\n\r\n    // header\r\n    cmd.writeUInt8(HCI_COMMAND_PKT, 0);\r\n    cmd.writeUInt16LE(DISCONNECT_CMD, 1);\r\n\r\n    // length\r\n    cmd.writeUInt8(0x03, 3);\r\n\r\n    // data\r\n    cmd.writeUInt16LE(handle, 4); // handle\r\n    cmd.writeUInt8(reason, 6); // reason\r\n\r\n    debug(\"disconnect - writing: \" + cmd.toString(\"hex\"));\r\n    this._socket.write(cmd);\r\n  }\r\n\r\n  public readRssi(handle: any) {\r\n    const cmd: any = Buffer.alloc(6);\r\n\r\n    // header\r\n    cmd.writeUInt8(HCI_COMMAND_PKT, 0);\r\n    cmd.writeUInt16LE(READ_RSSI_CMD, 1);\r\n\r\n    // length\r\n    cmd.writeUInt8(0x02, 3);\r\n\r\n    // data\r\n    cmd.writeUInt16LE(handle, 4); // handle\r\n\r\n    debug(\"read rssi - writing: \" + cmd.toString(\"hex\"));\r\n    this._socket.write(cmd);\r\n  }\r\n\r\n  public writeAclDataPkt(handle: any, cid: any, data: any) {\r\n    const pkt: any = Buffer.alloc(9 + data.length);\r\n\r\n    // header\r\n    pkt.writeUInt8(HCI_ACLDATA_PKT, 0);\r\n    pkt.writeUInt16LE(handle | (ACL_START_NO_FLUSH << 12), 1);\r\n    pkt.writeUInt16LE(data.length + 4, 3); // data length 1\r\n    pkt.writeUInt16LE(data.length, 5); // data length 2\r\n    pkt.writeUInt16LE(cid, 7);\r\n\r\n    data.copy(pkt, 9);\r\n\r\n    debug(\"write acl data pkt - writing: \" + pkt.toString(\"hex\"));\r\n    this._socket.write(pkt);\r\n  }\r\n\r\n  public setAdvertisingParameters() {\r\n    const cmd: any = Buffer.alloc(19);\r\n\r\n    // header\r\n    cmd.writeUInt8(HCI_COMMAND_PKT, 0);\r\n    cmd.writeUInt16LE(LE_SET_ADVERTISING_PARAMETERS_CMD, 1);\r\n\r\n    // length\r\n    cmd.writeUInt8(15, 3);\r\n\r\n    const advertisementInterval: any = Math.floor(\r\n      (process.env.BLENO_ADVERTISING_INTERVAL\r\n        ? parseFloat(process.env.BLENO_ADVERTISING_INTERVAL)\r\n        : 100) * 1.6,\r\n    );\r\n\r\n    // data\r\n    cmd.writeUInt16LE(advertisementInterval, 4); // min interval\r\n    cmd.writeUInt16LE(advertisementInterval, 6); // max interval\r\n    cmd.writeUInt8(0x00, 8); // adv type\r\n    cmd.writeUInt8(0x00, 9); // own addr typ\r\n    cmd.writeUInt8(0x00, 10); // direct addr type\r\n    Buffer.from(\"000000000000\", \"hex\").copy(cmd, 11); // direct addr\r\n    cmd.writeUInt8(0x07, 17);\r\n    cmd.writeUInt8(0x00, 18);\r\n\r\n    debug(\"set advertisement parameters - writing: \" + cmd.toString(\"hex\"));\r\n    this._socket.write(cmd);\r\n  }\r\n\r\n  public setAdvertisingData(data: any) {\r\n    const cmd: any = Buffer.alloc(36);\r\n\r\n    cmd.fill(0x00);\r\n\r\n    // header\r\n    cmd.writeUInt8(HCI_COMMAND_PKT, 0);\r\n    cmd.writeUInt16LE(LE_SET_ADVERTISING_DATA_CMD, 1);\r\n\r\n    // length\r\n    cmd.writeUInt8(32, 3);\r\n\r\n    // data\r\n    cmd.writeUInt8(data.length, 4);\r\n    data.copy(cmd, 5);\r\n\r\n    debug(\"set advertisement data - writing: \" + cmd.toString(\"hex\"));\r\n    this._socket.write(cmd);\r\n  }\r\n\r\n  public setScanResponseData(data: any) {\r\n    const cmd: any = Buffer.alloc(36);\r\n\r\n    cmd.fill(0x00);\r\n\r\n    // header\r\n    cmd.writeUInt8(HCI_COMMAND_PKT, 0);\r\n    cmd.writeUInt16LE(LE_SET_SCAN_RESPONSE_DATA_CMD, 1);\r\n\r\n    // length\r\n    cmd.writeUInt8(32, 3);\r\n\r\n    // data\r\n    cmd.writeUInt8(data.length, 4);\r\n    data.copy(cmd, 5);\r\n\r\n    debug(\"set scan response data - writing: \" + cmd.toString(\"hex\"));\r\n    this._socket.write(cmd);\r\n  }\r\n\r\n  public setAdvertiseEnable(enabled: any) {\r\n    const cmd: any = Buffer.alloc(5);\r\n\r\n    // header\r\n    cmd.writeUInt8(HCI_COMMAND_PKT, 0);\r\n    cmd.writeUInt16LE(LE_SET_ADVERTISE_ENABLE_CMD, 1);\r\n\r\n    // length\r\n    cmd.writeUInt8(0x01, 3);\r\n\r\n    // data\r\n    cmd.writeUInt8(enabled ? 0x01 : 0x00, 4); // enable: 0 -> disabled, 1 -> enabled\r\n\r\n    debug(\"set advertise enable - writing: \" + cmd.toString(\"hex\"));\r\n    this._socket.write(cmd);\r\n  }\r\n\r\n  public leReadBufferSize() {\r\n    const cmd: any = Buffer.alloc(4);\r\n\r\n    // header\r\n    cmd.writeUInt8(HCI_COMMAND_PKT, 0);\r\n    cmd.writeUInt16LE(LE_READ_BUFFER_SIZE_CMD, 1);\r\n\r\n    // length\r\n    cmd.writeUInt8(0x0, 3);\r\n\r\n    debug(\"le read buffer size - writing: \" + cmd.toString(\"hex\"));\r\n    this._socket.write(cmd);\r\n  }\r\n\r\n  public readBufferSize() {\r\n    const cmd: any = Buffer.alloc(4);\r\n\r\n    // header\r\n    cmd.writeUInt8(HCI_COMMAND_PKT, 0);\r\n    cmd.writeUInt16LE(READ_BUFFER_SIZE_CMD, 1);\r\n\r\n    // length\r\n    cmd.writeUInt8(0x0, 3);\r\n\r\n    debug(\"read buffer size - writing: \" + cmd.toString(\"hex\"));\r\n    this._socket.write(cmd);\r\n  }\r\n\r\n  public queueAclDataPkt(handle: any, cid: any, data: any) {\r\n    let hf: any = handle | (ACL_START_NO_FLUSH << 12);\r\n    // l2cap pdu may be fragmented on hci level\r\n    let l2capPdu: any = Buffer.alloc(4 + data.length);\r\n    l2capPdu.writeUInt16LE(data.length, 0);\r\n    l2capPdu.writeUInt16LE(cid, 2);\r\n    data.copy(l2capPdu, 4);\r\n    let fragId: any = 0;\r\n\r\n    while (l2capPdu.length) {\r\n      const frag: any = l2capPdu.slice(0, this._aclMtu);\r\n      l2capPdu = l2capPdu.slice(frag.length);\r\n      const pkt: any = Buffer.alloc(5 + frag.length);\r\n\r\n      // hci header\r\n      pkt.writeUInt8(HCI_ACLDATA_PKT, 0);\r\n      pkt.writeUInt16LE(hf, 1);\r\n      hf |= ACL_CONT << 12;\r\n      pkt.writeUInt16LE(frag.length, 3); // hci pdu length\r\n\r\n      frag.copy(pkt, 5);\r\n\r\n      this._aclOutQueue.push({\r\n        handle,\r\n        pkt,\r\n        fragId: fragId++,\r\n      });\r\n    }\r\n\r\n    this.pushAclOutQueue();\r\n  }\r\n\r\n  public pushAclOutQueue() {\r\n    debug(\"pushAclOutQueue\");\r\n    let inProgress: any = 0;\r\n    for (const handle in this._handleAclsInProgress) {\r\n      inProgress += this._handleAclsInProgress[handle];\r\n    }\r\n    debug(inProgress, this._aclMaxInProgress, this._aclOutQueue.length);\r\n    while (inProgress < this._aclMaxInProgress && this._aclOutQueue.length) {\r\n      inProgress++;\r\n      this.writeOneAclDataPkt();\r\n    }\r\n\r\n    if (inProgress >= this._aclMaxInProgress && this._aclOutQueue.length) {\r\n      debug(\"acl out queue congested\");\r\n      debug(\"\\tin progress = \" + inProgress);\r\n      debug(\"\\twaiting = \" + this._aclOutQueue.length);\r\n    }\r\n  }\r\n\r\n  public writeOneAclDataPkt() {\r\n    debug(\"writeOneAclDataPkt\");\r\n    const pkt: any = this._aclOutQueue.shift();\r\n    this._handleAclsInProgress[pkt.handle]++;\r\n    debug(\r\n      \"write acl data pkt frag \" +\r\n      pkt.fragId +\r\n      \" handle \" +\r\n      pkt.handle +\r\n      \" - writing: \" +\r\n      pkt.pkt.toString(\"hex\"),\r\n    );\r\n    this._socket.write(pkt.pkt);\r\n  }\r\n\r\n  public onSocketData(array: any) {\r\n    const data: any = Buffer.from(array);\r\n    debug(\"onSocketData: \" + data.toString(\"hex\"));\r\n\r\n    const eventType: any = data.readUInt8(0);\r\n\r\n    debug(\"\\tevent type = \" + eventType);\r\n\r\n    if (HCI_EVENT_PKT === eventType) {\r\n      const subEventType: any = data.readUInt8(1);\r\n\r\n      debug(\"\\tsub event type = \" + subEventType);\r\n\r\n      if (subEventType === EVT_DISCONN_COMPLETE) {\r\n        const handle: any = data.readUInt16LE(4);\r\n        const reason: any = data.readUInt8(6);\r\n\r\n        debug(\"\\t\\thandle = \" + handle);\r\n        debug(\"\\t\\treason = \" + reason);\r\n\r\n        delete this._handleAclsInProgress[handle];\r\n        const aclOutQueue: any = [];\r\n        let discarded: any = 0;\r\n        for (const i in this._aclOutQueue) {\r\n          if (this._aclOutQueue[i].handle !== handle) {\r\n            aclOutQueue.push(this._aclOutQueue[i]);\r\n          } else {\r\n            discarded++;\r\n          }\r\n        }\r\n        if (discarded) {\r\n          debug(\"\\t\\tacls discarded = \" + discarded);\r\n        }\r\n        this._aclOutQueue = aclOutQueue;\r\n        this.pushAclOutQueue();\r\n\r\n        this.emit(\"disconnComplete\", handle, reason);\r\n      } else if (subEventType === EVT_ENCRYPT_CHANGE) {\r\n        const handle: any = data.readUInt16LE(4);\r\n        const encrypt: any = data.readUInt8(6);\r\n\r\n        debug(\"\\t\\thandle = \" + handle);\r\n        debug(\"\\t\\tencrypt = \" + encrypt);\r\n\r\n        this.emit(\"encryptChange\", handle, encrypt);\r\n      } else if (subEventType === EVT_CMD_COMPLETE) {\r\n        const ncmd: any = data.readUInt8(3);\r\n        const cmd: any = data.readUInt16LE(4);\r\n        const status: any = data.readUInt8(6);\r\n        const result: any = data.slice(7);\r\n\r\n        debug(\"\\t\\tncmd = \" + ncmd);\r\n        debug(\"\\t\\tcmd = \" + cmd);\r\n        debug(\"\\t\\tstatus = \" + status);\r\n        debug(\"\\t\\tresult = \" + result.toString(\"hex\"));\r\n\r\n        this.processCmdCompleteEvent(cmd, status, result);\r\n      } else if (subEventType === EVT_CMD_STATUS) {\r\n        const status: any = data.readUInt8(3);\r\n        const cmd: any = data.readUInt16LE(5);\r\n\r\n        debug(\"\\t\\tstatus = \" + status);\r\n        debug(\"\\t\\tcmd = \" + cmd);\r\n\r\n        this.processCmdStatusEvent(cmd, status);\r\n      } else if (subEventType === EVT_LE_META_EVENT) {\r\n        const leMetaEventType: any = data.readUInt8(3);\r\n        const leMetaEventStatus: any = data.readUInt8(4);\r\n        const leMetaEventData: any = data.slice(5);\r\n\r\n        debug(\"\\t\\tLE meta event type = \" + leMetaEventType);\r\n        debug(\"\\t\\tLE meta event status = \" + leMetaEventStatus);\r\n        debug(\"\\t\\tLE meta event data = \" + leMetaEventData.toString(\"hex\"));\r\n\r\n        this.processLeMetaEvent(\r\n          leMetaEventType,\r\n          leMetaEventStatus,\r\n          leMetaEventData,\r\n        );\r\n      } else if (subEventType === EVT_NUMBER_OF_COMPLETED_PACKETS) {\r\n        const handles: any = data.readUInt8(3);\r\n        for (let i = 0; i < handles; i++) {\r\n          const handle: any = data.readUInt16LE(4 + i * 4);\r\n          const pkts: any = data.readUInt16LE(6 + i * 4);\r\n          debug(\"\\thandle = \" + handle);\r\n          debug(\"\\t\\tcompleted = \" + pkts);\r\n          if (this._handleAclsInProgress[handle] === undefined) {\r\n            debug(\"\\t\\talready closed\");\r\n            continue;\r\n          }\r\n          if (pkts > this._handleAclsInProgress[handle]) {\r\n            // Linux kernel may send acl packets by itself, so be ready for underflow\r\n            this._handleAclsInProgress[handle] = 0;\r\n          } else {\r\n            this._handleAclsInProgress[handle] -= pkts;\r\n          }\r\n          debug(\"\\t\\tin progress = \" + this._handleAclsInProgress[handle]);\r\n        }\r\n        this.pushAclOutQueue();\r\n      }\r\n    } else if (HCI_ACLDATA_PKT === eventType) {\r\n      const flags: any = data.readUInt16LE(1) >> 12;\r\n      const handle: any = data.readUInt16LE(1) & 0x0fff;\r\n\r\n      if (ACL_START === flags) {\r\n        const cid: any = data.readUInt16LE(7);\r\n\r\n        const length: any = data.readUInt16LE(5);\r\n        const pktData: any = data.slice(9);\r\n\r\n        debug(\"\\t\\tcid = \" + cid);\r\n\r\n        if (length === pktData.length) {\r\n          debug(\"\\t\\thandle = \" + handle);\r\n          debug(\"\\t\\tdata = \" + pktData.toString(\"hex\"));\r\n\r\n          this.emit(\"aclDataPkt\", handle, cid, pktData);\r\n        } else {\r\n          this._handleBuffers[handle] = {\r\n            length,\r\n            cid,\r\n            data: pktData,\r\n          };\r\n        }\r\n      } else if (ACL_CONT === flags) {\r\n        if (!this._handleBuffers[handle] || !this._handleBuffers[handle].data) {\r\n          return;\r\n        }\r\n\r\n        this._handleBuffers[handle].data = Buffer.concat([\r\n          this._handleBuffers[handle].data,\r\n          data.slice(5),\r\n        ]);\r\n\r\n        if (\r\n          this._handleBuffers[handle].data.length ===\r\n          this._handleBuffers[handle].length\r\n        ) {\r\n          this.emit(\r\n            \"aclDataPkt\",\r\n            handle,\r\n            this._handleBuffers[handle].cid,\r\n            this._handleBuffers[handle].data,\r\n          );\r\n\r\n          delete this._handleBuffers[handle];\r\n        }\r\n      }\r\n    } else if (HCI_COMMAND_PKT === eventType) {\r\n      const cmd: any = data.readUInt16LE(1);\r\n      const len: any = data.readUInt8(3);\r\n\r\n      debug(\"\\t\\tcmd = \" + cmd);\r\n      debug(\"\\t\\tdata len = \" + len);\r\n\r\n      if (cmd === LE_SET_SCAN_ENABLE_CMD) {\r\n        const enable: any = data.readUInt8(4) === 0x1;\r\n        const filterDuplicates: any = data.readUInt8(5) === 0x1;\r\n\r\n        debug(\"\\t\\t\\tLE enable scan command\");\r\n        debug(\"\\t\\t\\tenable scanning = \" + enable);\r\n        debug(\"\\t\\t\\tfilter duplicates = \" + filterDuplicates);\r\n\r\n        this.emit(\"leScanEnableSetCmd\", enable, filterDuplicates);\r\n      }\r\n    }\r\n  }\r\n\r\n  public onSocketError(error: any) {\r\n    debug(\"onSocketError: \" + error.message);\r\n\r\n    if (error.message === \"Operation not permitted\") {\r\n      this.emit(\"stateChange\", \"unauthorized\");\r\n    } else if (error.message === \"Network is down\") {\r\n      // no-op\r\n    }\r\n  }\r\n\r\n  public processCmdCompleteEvent(cmd: any, status: any, result: any) {\r\n    if (cmd === RESET_CMD) {\r\n      this.resetBuffers();\r\n      this.setEventMask();\r\n      this.setLeEventMask();\r\n      this.readLocalVersion();\r\n      this.readBdAddr();\r\n      this.writeLeHostSupported();\r\n      this.readLeHostSupported();\r\n      this.leReadBufferSize();\r\n    } else if (cmd === READ_LE_HOST_SUPPORTED_CMD) {\r\n      if (status === 0) {\r\n        const le: any = result.readUInt8(0);\r\n        const simul: any = result.readUInt8(1);\r\n\r\n        debug(\"\\t\\t\\tle = \" + le);\r\n        debug(\"\\t\\t\\tsimul = \" + simul);\r\n      }\r\n    } else if (cmd === READ_LOCAL_VERSION_CMD) {\r\n      const hciVer: any = result.readUInt8(0);\r\n      const hciRev: any = result.readUInt16LE(1);\r\n      const lmpVer: any = result.readInt8(3);\r\n      const manufacturer: any = result.readUInt16LE(4);\r\n      const lmpSubVer: any = result.readUInt16LE(6);\r\n\r\n      if (hciVer < 0x06) {\r\n        this.emit(\"stateChange\", \"unsupported\");\r\n      } else if (this._state !== \"poweredOn\") {\r\n        this.setScanEnabled(false, true);\r\n        this.setScanParameters();\r\n      }\r\n\r\n      this.emit(\r\n        \"readLocalVersion\",\r\n        hciVer,\r\n        hciRev,\r\n        lmpVer,\r\n        manufacturer,\r\n        lmpSubVer,\r\n      );\r\n    } else if (cmd === READ_BD_ADDR_CMD) {\r\n      this.addressType = \"public\";\r\n      this.address = result\r\n        .toString(\"hex\")\r\n        .match(/.{1,2}/g)\r\n        .reverse()\r\n        .join(\":\");\r\n\r\n      debug(\"address = \" + this.address);\r\n\r\n      this.emit(\"addressChange\", this.address);\r\n    } else if (cmd === LE_SET_SCAN_PARAMETERS_CMD) {\r\n      this.emit(\"stateChange\", \"poweredOn\");\r\n\r\n      this.emit(\"leScanParametersSet\", status);\r\n    } else if (cmd === LE_SET_SCAN_ENABLE_CMD) {\r\n      this.emit(\"leScanEnableSet\", status);\r\n    } else if (cmd === LE_SET_ADVERTISING_PARAMETERS_CMD) {\r\n      this.emit(\"stateChange\", \"poweredOn\");\r\n\r\n      this.emit(\"leAdvertisingParametersSet\", status);\r\n    } else if (cmd === LE_SET_ADVERTISING_DATA_CMD) {\r\n      this.emit(\"leAdvertisingDataSet\", status);\r\n    } else if (cmd === LE_SET_SCAN_RESPONSE_DATA_CMD) {\r\n      this.emit(\"leScanResponseDataSet\", status);\r\n    } else if (cmd === LE_SET_ADVERTISE_ENABLE_CMD) {\r\n      this.emit(\"leAdvertiseEnableSet\", status);\r\n    } else if (cmd === READ_RSSI_CMD) {\r\n      const handle: any = result.readUInt16LE(0);\r\n      const rssi: any = result.readInt8(2);\r\n\r\n      debug(\"\\t\\t\\thandle = \" + handle);\r\n      debug(\"\\t\\t\\trssi = \" + rssi);\r\n\r\n      this.emit(\"rssiRead\", handle, rssi);\r\n    } else if (cmd === LE_LTK_NEG_REPLY_CMD) {\r\n      const handle: any = result.readUInt16LE(0);\r\n\r\n      debug(\"\\t\\t\\thandle = \" + handle);\r\n      this.emit(\"leLtkNegReply\", handle);\r\n    } else if (cmd === LE_READ_BUFFER_SIZE_CMD) {\r\n      if (!status) {\r\n        this.processLeReadBufferSize(result);\r\n      }\r\n    } else if (cmd === READ_BUFFER_SIZE_CMD) {\r\n      if (!status) {\r\n        const aclMtu: any = result.readUInt16LE(0);\r\n        const aclMaxInProgress: any = result.readUInt16LE(3);\r\n        // sanity\r\n        if (aclMtu && aclMaxInProgress) {\r\n          debug(\"br/edr acl mtu = \" + aclMtu);\r\n          debug(\"br/edr acl max pkts = \" + aclMaxInProgress);\r\n          this._aclMtu = aclMtu;\r\n          this._aclMaxInProgress = aclMaxInProgress;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  public processLeMetaEvent(eventType: any, status: any, data: any) {\r\n    if (eventType === EVT_LE_CONN_COMPLETE) {\r\n      this.processLeConnComplete(status, data);\r\n    } else if (eventType === EVT_LE_ADVERTISING_REPORT) {\r\n      this.processLeAdvertisingReport(status, data);\r\n    } else if (eventType === EVT_LE_CONN_UPDATE_COMPLETE) {\r\n      this.processLeConnUpdateComplete(status, data);\r\n    }\r\n  }\r\n\r\n  public processLeConnComplete(status: any, data: any) {\r\n    const handle: any = data.readUInt16LE(0);\r\n    const role: any = data.readUInt8(2);\r\n    const addressType: any = data.readUInt8(3) === 0x01 ? \"random\" : \"public\";\r\n    const address: any = data\r\n      .slice(4, 10)\r\n      .toString(\"hex\")\r\n      .match(/.{1,2}/g)\r\n      .reverse()\r\n      .join(\":\");\r\n    const interval: any = data.readUInt16LE(10) * 1.25;\r\n    const latency: any = data.readUInt16LE(12); // TODO: multiplier?\r\n    const supervisionTimeout: any = data.readUInt16LE(14) * 10;\r\n    const masterClockAccuracy: any = data.readUInt8(16); // TODO: multiplier?\r\n\r\n    debug(\"\\t\\t\\thandle = \" + handle);\r\n    debug(\"\\t\\t\\trole = \" + role);\r\n    debug(\"\\t\\t\\taddress type = \" + addressType);\r\n    debug(\"\\t\\t\\taddress = \" + address);\r\n    debug(\"\\t\\t\\tinterval = \" + interval);\r\n    debug(\"\\t\\t\\tlatency = \" + latency);\r\n    debug(\"\\t\\t\\tsupervision timeout = \" + supervisionTimeout);\r\n    debug(\"\\t\\t\\tmaster clock accuracy = \" + masterClockAccuracy);\r\n\r\n    this._handleAclsInProgress[handle] = 0;\r\n\r\n    this.emit(\r\n      \"leConnComplete\",\r\n      status,\r\n      handle,\r\n      role,\r\n      addressType,\r\n      address,\r\n      interval,\r\n      latency,\r\n      supervisionTimeout,\r\n      masterClockAccuracy,\r\n    );\r\n  }\r\n\r\n  public processLeAdvertisingReport(count: any, data: any) {\r\n    for (let i = 0; i < count; i++) {\r\n      const type: any = data.readUInt8(0);\r\n      const addressType: any = data.readUInt8(1) === 0x01 ? \"random\" : \"public\";\r\n      const address: any = data\r\n        .slice(2, 8)\r\n        .toString(\"hex\")\r\n        .match(/.{1,2}/g)\r\n        .reverse()\r\n        .join(\":\");\r\n      const eirLength: any = data.readUInt8(8);\r\n      const eir: any = data.slice(9, eirLength + 9);\r\n      const rssi: any = data.readInt8(eirLength + 9);\r\n\r\n      debug(\"\\t\\t\\ttype = \" + type);\r\n      debug(\"\\t\\t\\taddress = \" + address);\r\n      debug(\"\\t\\t\\taddress type = \" + addressType);\r\n      debug(\"\\t\\t\\teir = \" + eir.toString(\"hex\"));\r\n      debug(\"\\t\\t\\trssi = \" + rssi);\r\n\r\n      this.emit(\r\n        \"leAdvertisingReport\",\r\n        0,\r\n        type,\r\n        address,\r\n        addressType,\r\n        eir,\r\n        rssi,\r\n      );\r\n\r\n      data = data.slice(eirLength + 10);\r\n    }\r\n  }\r\n\r\n  public processLeConnUpdateComplete(status: any, data: any) {\r\n    const handle: any = data.readUInt16LE(0);\r\n    const interval: any = data.readUInt16LE(2) * 1.25;\r\n    const latency: any = data.readUInt16LE(4); // TODO: multiplier?\r\n    const supervisionTimeout: any = data.readUInt16LE(6) * 10;\r\n\r\n    debug(\"\\t\\t\\thandle = \" + handle);\r\n    debug(\"\\t\\t\\tinterval = \" + interval);\r\n    debug(\"\\t\\t\\tlatency = \" + latency);\r\n    debug(\"\\t\\t\\tsupervision timeout = \" + supervisionTimeout);\r\n\r\n    this.emit(\r\n      \"leConnUpdateComplete\",\r\n      status,\r\n      handle,\r\n      interval,\r\n      latency,\r\n      supervisionTimeout,\r\n    );\r\n  }\r\n\r\n  public processCmdStatusEvent(cmd: any, status: any) {\r\n    if (cmd === LE_CREATE_CONN_CMD) {\r\n      if (status !== 0) {\r\n        this.emit(\"leConnComplete\", status);\r\n      }\r\n    }\r\n  }\r\n\r\n  public processLeReadBufferSize(result: any) {\r\n    const aclMtu: any = result.readUInt16LE(0);\r\n    const aclMaxInProgress: any = result.readUInt8(2);\r\n    if (!aclMtu) {\r\n      // as per Bluetooth specs\r\n      debug(\"falling back to br/edr buffer size\");\r\n      this.readBufferSize();\r\n    } else {\r\n      debug(\"le acl mtu = \" + aclMtu);\r\n      debug(\"le acl max in progress = \" + aclMaxInProgress);\r\n      this._aclMtu = aclMtu;\r\n      this._aclMaxInProgress = aclMaxInProgress;\r\n    }\r\n  }\r\n\r\n  public onStateChange(state: any) {\r\n    this._state = state;\r\n  }\r\n}\r\n\r\nHci.STATUS_MAPPER = STATUS_MAPPER;\r\nexport default Hci;\r\n"]}
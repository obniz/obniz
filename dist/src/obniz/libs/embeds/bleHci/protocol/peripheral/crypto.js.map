{"version":3,"sources":["../src/obniz/libs/embeds/bleHci/protocol/peripheral/crypto.ts"],"names":[],"mappings":";;;;;AAAA;;;;GAIG;AACH,oDAA4B;AAE5B;;GAEG;AACH,SAAS,CAAC;IACR,OAAO,gBAAM,CAAC,WAAW,CAAC,EAAE,CAAC,CAAC;AAChC,CAAC;AAED;;GAEG;AACH,SAAS,EAAE,CAAC,CAAM,EAAE,EAAO,EAAE,IAAS,EAAE,IAAS,EAAE,GAAQ,EAAE,EAAO,EAAE,GAAQ,EAAE,EAAO;IACrF,MAAM,EAAE,GAAQ,MAAM,CAAC,MAAM,CAAC,CAAC,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC;IAEtD,MAAM,EAAE,GAAQ,MAAM,CAAC,MAAM,CAAC,CAAC,EAAE,EAAE,EAAE,EAAE,MAAM,CAAC,IAAI,CAAC,UAAU,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC;IAExE,IAAI,GAAG,GAAQ,GAAG,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;IAC3B,GAAG,GAAG,CAAC,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC;IAChB,GAAG,GAAG,GAAG,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;IACnB,GAAG,GAAG,CAAC,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC;IAEhB,OAAO,GAAG,CAAC;AACb,CAAC;AAED,SAAS,EAAE,CAAC,CAAM,EAAE,EAAO,EAAE,EAAO;IAClC,OAAO,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,EAAE,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AAC/D,CAAC;AAED,SAAS,CAAC,CAAC,GAAQ,EAAE,IAAS;IAC5B,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC;IAChB,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC;IAElB,MAAM,MAAM,GAAQ,gBAAM,CAAC,cAAc,CAAC,aAAa,EAAE,GAAG,EAAE,EAAE,CAAC,CAAC;IAClE,MAAM,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC;IAE7B,OAAO,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC,CAAC;AACpE,CAAC;AAED,SAAS,GAAG,CAAC,EAAO,EAAE,EAAO;IAC3B,MAAM,MAAM,GAAQ,MAAM,CAAC,KAAK,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC;IAE5C,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;QAClC,MAAM,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC,CAAC;KAC3B;IAED,OAAO,MAAM,CAAC;AAChB,CAAC;AAED,SAAS,IAAI,CAAC,KAAU;IACtB,MAAM,MAAM,GAAQ,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;IAE/C,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;QACtC,MAAM,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC;KACzC;IAED,OAAO,MAAM,CAAC;AAChB,CAAC;AAED,kBAAe;IACb,CAAC;IACD,EAAE;IACF,EAAE;IACF,CAAC;CACF,CAAC","file":"crypto.js","sourcesContent":["/**\n * @packageDocumentation\n *\n * @ignore\n */\nimport crypto from \"crypto\";\n\n/**\n * @ignore\n */\nfunction r() {\n  return crypto.randomBytes(16);\n}\n\n/**\n * @ignore\n */\nfunction c1(k: any, _r: any, pres: any, preq: any, iat: any, ia: any, rat: any, ra: any) {\n  const p1: any = Buffer.concat([iat, rat, preq, pres]);\n\n  const p2: any = Buffer.concat([ra, ia, Buffer.from(\"00000000\", \"hex\")]);\n\n  let res: any = xor(_r, p1);\n  res = e(k, res);\n  res = xor(res, p2);\n  res = e(k, res);\n\n  return res;\n}\n\nfunction s1(k: any, r1: any, r2: any) {\n  return e(k, Buffer.concat([r2.slice(0, 8), r1.slice(0, 8)]));\n}\n\nfunction e(key: any, data: any) {\n  key = swap(key);\n  data = swap(data);\n\n  const cipher: any = crypto.createCipheriv(\"aes-128-ecb\", key, \"\");\n  cipher.setAutoPadding(false);\n\n  return swap(Buffer.concat([cipher.update(data), cipher.final()]));\n}\n\nfunction xor(b1: any, b2: any) {\n  const result: any = Buffer.alloc(b1.length);\n\n  for (let i = 0; i < b1.length; i++) {\n    result[i] = b1[i] ^ b2[i];\n  }\n\n  return result;\n}\n\nfunction swap(input: any) {\n  const output: any = Buffer.alloc(input.length);\n\n  for (let i = 0; i < output.length; i++) {\n    output[i] = input[input.length - i - 1];\n  }\n\n  return output;\n}\n\nexport default {\n  r,\n  c1,\n  s1,\n  e,\n};\n"]}
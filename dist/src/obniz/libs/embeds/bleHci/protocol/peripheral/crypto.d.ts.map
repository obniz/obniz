{"version":3,"sources":["../src/obniz/libs/embeds/bleHci/protocol/peripheral/crypto.ts"],"names":[],"mappings":";AAEA,iBAAS,CAAC,WAET;AAED,iBAAS,EAAE,CAAC,CAAC,EAAE,GAAG,EAAE,EAAE,EAAE,GAAG,EAAE,IAAI,EAAE,GAAG,EAAE,IAAI,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,EAAE,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,EAAE,EAAE,GAAG,OAWtF;AAED,iBAAS,EAAE,CAAC,CAAC,EAAE,GAAG,EAAE,EAAE,EAAE,GAAG,EAAE,EAAE,EAAE,GAAG,OAEnC;AAED,iBAAS,CAAC,CAAC,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE,GAAG,OAQ7B;;;;;;;AAsBD,wBAKE","file":"crypto.d.ts","sourcesContent":["import crypto from \"crypto\";\r\n\r\nfunction r() {\r\n  return crypto.randomBytes(16);\r\n}\r\n\r\nfunction c1(k: any, _r: any, pres: any, preq: any, iat: any, ia: any, rat: any, ra: any) {\r\n  const p1: any = Buffer.concat([iat, rat, preq, pres]);\r\n\r\n  const p2: any = Buffer.concat([ra, ia, Buffer.from(\"00000000\", \"hex\")]);\r\n\r\n  let res: any = xor(_r, p1);\r\n  res = e(k, res);\r\n  res = xor(res, p2);\r\n  res = e(k, res);\r\n\r\n  return res;\r\n}\r\n\r\nfunction s1(k: any, r1: any, r2: any) {\r\n  return e(k, Buffer.concat([r2.slice(0, 8), r1.slice(0, 8)]));\r\n}\r\n\r\nfunction e(key: any, data: any) {\r\n  key = swap(key);\r\n  data = swap(data);\r\n\r\n  const cipher: any = crypto.createCipheriv(\"aes-128-ecb\", key, \"\");\r\n  cipher.setAutoPadding(false);\r\n\r\n  return swap(Buffer.concat([cipher.update(data), cipher.final()]));\r\n}\r\n\r\nfunction xor(b1: any, b2: any) {\r\n  const result: any = Buffer.alloc(b1.length);\r\n\r\n  for (let i = 0; i < b1.length; i++) {\r\n    result[i] = b1[i] ^ b2[i];\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\nfunction swap(input: any) {\r\n  const output: any = Buffer.alloc(input.length);\r\n\r\n  for (let i = 0; i < output.length; i++) {\r\n    output[i] = input[input.length - i - 1];\r\n  }\r\n\r\n  return output;\r\n}\r\n\r\nexport default {\r\n  r,\r\n  c1,\r\n  s1,\r\n  e,\r\n};\r\n"]}
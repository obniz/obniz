{"version":3,"sources":["../src/obniz/libs/embeds/bleHci/bleLocalAttributeAbstract.ts"],"names":[],"mappings":"AAAA,OAAO,oBAAoB,MAAM,wBAAwB,CAAC;AAG1D,cAAM,yBAA0B,SAAQ,oBAAoB;IACnD,cAAc,EAAE,GAAG,CAAC;IACpB,qBAAqB,EAAE,GAAG,CAAC;IAC3B,oBAAoB,EAAE,GAAG,CAAC;IAC1B,+BAA+B,EAAE,GAAG,CAAC;IACrC,qBAAqB,EAAE,GAAG,CAAC;IAC3B,IAAI,EAAE,GAAG,CAAC;IACV,YAAY,EAAE,GAAG,CAAC;IAClB,QAAQ,EAAE,GAAG,CAAC;IACd,IAAI,EAAE,GAAG,CAAC;IACV,UAAU,EAAE,GAAG,CAAC;IAChB,cAAc,EAAE,GAAG,CAAC;IACpB,OAAO,EAAE,GAAG,CAAC;IACb,gBAAgB,EAAE,GAAG,CAAC;gBAEjB,MAAM,EAAE,GAAG;IAUhB,WAAW;IAcX,IAAI,CAAC,IAAI,EAAE,GAAG,EAAE,GAAG,MAAM,EAAE,GAAG;IAY9B,cAAc,CAAC,MAAM,EAAE,GAAG,EAAE,QAAQ,CAAC,EAAE,GAAG;IAgB1C,eAAe,CAAC,IAAI,EAAE,GAAG,EAAE,MAAM,CAAC,EAAE,GAAG,EAAE,eAAe,CAAC,EAAE,GAAG,EAAE,QAAQ,CAAC,EAAE,GAAG;IAc9E,KAAK,CAAC,SAAS,EAAE,GAAG;IAKpB,IAAI;CAGZ;AAED,eAAe,yBAAyB,CAAC","file":"bleLocalAttributeAbstract.d.ts","sourcesContent":["import BleAttributeAbstract from \"./bleAttributeAbstract\";\r\nimport BleHelper from \"./bleHelper\";\r\n\r\nclass BleLocalAttributeAbstract extends BleAttributeAbstract {\r\n  public RESULT_SUCCESS: any;\r\n  public RESULT_INVALID_OFFSET: any;\r\n  public RESULT_ATTR_NOT_LONG: any;\r\n  public RESULT_INVALID_ATTRIBUTE_LENGTH: any;\r\n  public RESULT_UNLIKELY_ERROR: any;\r\n  public uuid: any;\r\n  public childrenName: any;\r\n  public children: any;\r\n  public data: any;\r\n  public parentName: any;\r\n  public characteristic: any;\r\n  public service: any;\r\n  public notifyFromServer: any;\r\n\r\n  constructor(params: any) {\r\n    super(params);\r\n\r\n    this.RESULT_SUCCESS = 0x00;\r\n    this.RESULT_INVALID_OFFSET = 0x07;\r\n    this.RESULT_ATTR_NOT_LONG = 0x0b;\r\n    this.RESULT_INVALID_ATTRIBUTE_LENGTH = 0x0d;\r\n    this.RESULT_UNLIKELY_ERROR = 0x0e;\r\n  }\r\n\r\n  public toBufferObj() {\r\n    const obj: any = {\r\n      uuid: BleHelper.uuidFilter(this.uuid),\r\n    };\r\n\r\n    if (this.childrenName) {\r\n      const key: any = this.childrenName;\r\n      obj[key] = this.children.map((e: any) => e.toBufferObj());\r\n    }\r\n\r\n    obj.emit = this.emit.bind(this);\r\n    return obj;\r\n  }\r\n\r\n  public emit(name: any, ...params: any) {\r\n    switch (name) {\r\n      case \"readRequest\":\r\n        this._onReadRequest(...params as [any, any]);\r\n        return true;\r\n      case \"writeRequest\":\r\n        this._onWriteRequest(...params as [any, any]);\r\n        return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  public _onReadRequest(offset: any, callback?: any) {\r\n    if (this.data.length >= offset) {\r\n      callback(this.RESULT_SUCCESS, Buffer.from(this.data.slice(offset)));\r\n      let address: any = null;\r\n      if (this.parentName === \"characteristic\") {\r\n        address = this.characteristic.service.peripheral\r\n          .currentConnectedDeviceAddress;\r\n      } else if (this.parentName === \"service\") {\r\n        address = this.service.peripheral.currentConnectedDeviceAddress;\r\n      }\r\n      this.notifyFromServer(\"onreadfromremote\", {address});\r\n    } else {\r\n      callback(this.RESULT_UNLIKELY_ERROR, null);\r\n    }\r\n  }\r\n\r\n  public _onWriteRequest(data: any, offset?: any, withoutResponse?: any, callback?: any) {\r\n    // console.log('onWriteRequest');\r\n    this.data = Array.from(data);\r\n    callback(this.RESULT_SUCCESS);\r\n    let address: any = null;\r\n    if (this.parentName === \"characteristic\") {\r\n      address = this.characteristic.service.peripheral\r\n        .currentConnectedDeviceAddress;\r\n    } else if (this.parentName === \"service\") {\r\n      address = this.service.peripheral.currentConnectedDeviceAddress;\r\n    }\r\n    this.notifyFromServer(\"onwritefromremote\", {address, data});\r\n  }\r\n\r\n  public write(dataArray: any) {\r\n    this.data = dataArray;\r\n    this.notifyFromServer(\"onwrite\", {result: \"success\"});\r\n  }\r\n\r\n  public read() {\r\n    this.notifyFromServer(\"onread\", {data: this.data});\r\n  }\r\n}\r\n\r\nexport default BleLocalAttributeAbstract;\r\n"]}
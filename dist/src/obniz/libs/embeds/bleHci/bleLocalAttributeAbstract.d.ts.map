{"version":3,"sources":["../src/obniz/libs/embeds/bleHci/bleLocalAttributeAbstract.ts"],"names":[],"mappings":"AAAA,OAAO,oBAAoB,MAAM,wBAAwB,CAAC;AAG1D,cAAM,yBAA0B,SAAQ,oBAAoB;IACnD,cAAc,EAAE,GAAG,CAAC;IACpB,qBAAqB,EAAE,GAAG,CAAC;IAC3B,oBAAoB,EAAE,GAAG,CAAC;IAC1B,+BAA+B,EAAE,GAAG,CAAC;IACrC,qBAAqB,EAAE,GAAG,CAAC;IAC3B,IAAI,EAAE,GAAG,CAAC;IACV,YAAY,EAAE,GAAG,CAAC;IAClB,QAAQ,EAAE,GAAG,CAAC;IACd,IAAI,EAAE,GAAG,CAAC;IACV,UAAU,EAAE,GAAG,CAAC;IAChB,cAAc,EAAE,GAAG,CAAC;IACpB,OAAO,EAAE,GAAG,CAAC;IACb,gBAAgB,EAAE,GAAG,CAAC;gBAEjB,MAAM,EAAE,GAAG;IAUhB,WAAW;IAcX,IAAI,CAAC,IAAI,EAAE,GAAG,EAAE,GAAG,MAAM,EAAE,GAAG;IAY9B,cAAc,CAAC,MAAM,EAAE,GAAG,EAAE,QAAQ,CAAC,EAAE,GAAG;IAgB1C,eAAe,CAAC,IAAI,EAAE,GAAG,EAAE,MAAM,CAAC,EAAE,GAAG,EAAE,eAAe,CAAC,EAAE,GAAG,EAAE,QAAQ,CAAC,EAAE,GAAG;IAc9E,KAAK,CAAC,SAAS,EAAE,GAAG;IAKpB,IAAI;CAGZ;AAED,eAAe,yBAAyB,CAAC","file":"bleLocalAttributeAbstract.d.ts","sourcesContent":["import BleAttributeAbstract from \"./bleAttributeAbstract\";\nimport BleHelper from \"./bleHelper\";\n\nclass BleLocalAttributeAbstract extends BleAttributeAbstract {\n  public RESULT_SUCCESS: any;\n  public RESULT_INVALID_OFFSET: any;\n  public RESULT_ATTR_NOT_LONG: any;\n  public RESULT_INVALID_ATTRIBUTE_LENGTH: any;\n  public RESULT_UNLIKELY_ERROR: any;\n  public uuid: any;\n  public childrenName: any;\n  public children: any;\n  public data: any;\n  public parentName: any;\n  public characteristic: any;\n  public service: any;\n  public notifyFromServer: any;\n\n  constructor(params: any) {\n    super(params);\n\n    this.RESULT_SUCCESS = 0x00;\n    this.RESULT_INVALID_OFFSET = 0x07;\n    this.RESULT_ATTR_NOT_LONG = 0x0b;\n    this.RESULT_INVALID_ATTRIBUTE_LENGTH = 0x0d;\n    this.RESULT_UNLIKELY_ERROR = 0x0e;\n  }\n\n  public toBufferObj() {\n    const obj: any = {\n      uuid: BleHelper.uuidFilter(this.uuid),\n    };\n\n    if (this.childrenName) {\n      const key: any = this.childrenName;\n      obj[key] = this.children.map((e: any) => e.toBufferObj());\n    }\n\n    obj.emit = this.emit.bind(this);\n    return obj;\n  }\n\n  public emit(name: any, ...params: any) {\n    switch (name) {\n      case \"readRequest\":\n        this._onReadRequest(...params as [any, any]);\n        return true;\n      case \"writeRequest\":\n        this._onWriteRequest(...params as [any, any]);\n        return true;\n    }\n    return false;\n  }\n\n  public _onReadRequest(offset: any, callback?: any) {\n    if (this.data.length >= offset) {\n      callback(this.RESULT_SUCCESS, Buffer.from(this.data.slice(offset)));\n      let address: any = null;\n      if (this.parentName === \"characteristic\") {\n        address = this.characteristic.service.peripheral\n          .currentConnectedDeviceAddress;\n      } else if (this.parentName === \"service\") {\n        address = this.service.peripheral.currentConnectedDeviceAddress;\n      }\n      this.notifyFromServer(\"onreadfromremote\", {address});\n    } else {\n      callback(this.RESULT_UNLIKELY_ERROR, null);\n    }\n  }\n\n  public _onWriteRequest(data: any, offset?: any, withoutResponse?: any, callback?: any) {\n    // console.log('onWriteRequest');\n    this.data = Array.from(data);\n    callback(this.RESULT_SUCCESS);\n    let address: any = null;\n    if (this.parentName === \"characteristic\") {\n      address = this.characteristic.service.peripheral\n        .currentConnectedDeviceAddress;\n    } else if (this.parentName === \"service\") {\n      address = this.service.peripheral.currentConnectedDeviceAddress;\n    }\n    this.notifyFromServer(\"onwritefromremote\", {address, data});\n  }\n\n  public write(dataArray: any) {\n    this.data = dataArray;\n    this.notifyFromServer(\"onwrite\", {result: \"success\"});\n  }\n\n  public read() {\n    this.notifyFromServer(\"onread\", {data: this.data});\n  }\n}\n\nexport default BleLocalAttributeAbstract;\n"]}
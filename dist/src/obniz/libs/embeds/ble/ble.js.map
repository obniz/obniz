{"version":3,"sources":["../src/obniz/libs/embeds/ble/ble.ts"],"names":[],"mappings":"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","file":"ble.js","sourcesContent":["import BleAdvertisement from \"./bleAdvertisement\";\nimport BleCharacteristic from \"./bleCharacteristic\";\nimport BleDescriptor from \"./bleDescriptor\";\nimport BlePeripheral from \"./blePeripheral\";\nimport BleRemotePeripheral from \"./bleRemotePeripheral\";\nimport BleScan from \"./bleScan\";\nimport BleSecurity from \"./bleSecurity\";\nimport BleService from \"./bleService\";\n\nclass ObnizBLE {\n\n  public static _dataArray2uuidHex(data: any, reverse: any) {\n    let uuid: any = [];\n    for (let i = 0; i < data.length; i++) {\n      uuid.push((\"00\" + data[i].toString(16).toLowerCase()).slice(-2));\n    }\n    if (reverse) {\n      uuid = uuid.reverse();\n    }\n    let str: any = uuid.join(\"\");\n    if (uuid.length >= 16) {\n      str =\n        str.slice(0, 8) +\n        \"-\" +\n        str.slice(8, 12) +\n        \"-\" +\n        str.slice(12, 16) +\n        \"-\" +\n        str.slice(16, 20) +\n        \"-\" +\n        str.slice(20);\n    }\n    return str;\n  }\n\n  public Obniz: any;\n  public remotePeripherals: any;\n  public service: any;\n  public characteristic: any;\n  public descriptor: any;\n  public peripheral: any;\n  public scanTarget: any;\n  public advertisement: any;\n  public scan: any;\n  public security: any;\n\n  constructor(Obniz: any) {\n    this.Obniz = Obniz;\n    this.remotePeripherals = [];\n\n    this.service = BleService;\n    this.characteristic = BleCharacteristic;\n    this.descriptor = BleDescriptor;\n    this.peripheral = new BlePeripheral(Obniz);\n\n    this.scanTarget = null;\n\n    this.advertisement = new BleAdvertisement(Obniz);\n    this.scan = new BleScan(Obniz);\n    this.security = new BleSecurity(Obniz);\n    this._reset();\n  }\n\n  // dummy\n  public async initWait() {\n  }\n\n  public _reset() {\n  }\n\n  public directConnect(uuid: any, addressType: any) {\n    throw new Error(\n      \"directConnect cannot use obnizOS < 3.0.0. Please update obnizOS\",\n    );\n  }\n\n  public async directConnectWait(uuid: any, addressType: any) {\n    throw new Error(\n      \"directConnectWait cannot use obnizOS < 3.0.0. Please update obnizOS\",\n    );\n  }\n\n  public findPeripheral(address: any) {\n    for (const key in this.remotePeripherals) {\n      if (this.remotePeripherals[key].address === address) {\n        return this.remotePeripherals[key];\n      }\n    }\n    return null;\n  }\n\n  public notified(obj: any) {\n    if (obj.scan_result) {\n      let val: any = this.findPeripheral(obj.scan_result.address);\n      if (!val) {\n        val = new BleRemotePeripheral(this.Obniz, obj.scan_result.address);\n        this.remotePeripherals.push(val);\n      }\n      val.discoverdOnRemote = true;\n      val.setParams(obj.scan_result);\n\n      this.scan.notifyFromServer(\"onfind\", val);\n    }\n\n    if (obj.scan_result_finish) {\n      this.scan.notifyFromServer(\"onfinish\");\n    }\n\n    const remotePeripheralCallbackFunc: any = (val: any, func: any, type: any) => {\n      let target: any = null;\n      if (val === undefined) {\n        return;\n      }\n      const p: any = this.findPeripheral(val.address);\n      if (!p) {\n        return;\n      }\n      if (type === \"peripheral\") {\n        target = p;\n      } else if (type === \"service\") {\n        target = p.findService(val);\n      } else if (type === \"characteristic\") {\n        target = p.findCharacteristic(val);\n      } else if (type === \"descriptor\") {\n        target = p.findDescriptor(val);\n      }\n      if (!target) {\n        return;\n      }\n      func(val, target);\n    };\n\n    const paramList: any = {\n      status_update: {name: \"statusupdate\", obj: \"peripheral\"},\n      get_service_result: {name: \"discover\", obj: \"peripheral\"},\n      get_service_result_finish: {\n        name: \"discoverfinished\",\n        obj: \"peripheral\",\n      },\n      get_characteristic_result: {name: \"discover\", obj: \"service\"},\n      get_characteristic_result_finish: {\n        name: \"discoverfinished\",\n        obj: \"service\",\n      },\n      write_characteristic_result: {name: \"onwrite\", obj: \"characteristic\"},\n      read_characteristic_result: {name: \"onread\", obj: \"characteristic\"},\n      register_notify_characteristic_result: {\n        name: \"onregisternotify\",\n        obj: \"characteristic\",\n      },\n      // for typo\n      register_nofity_characteristic_result: {\n        name: \"onregisternotify\",\n        obj: \"characteristic\",\n      },\n      unregister_notify_characteristic_result: {\n        name: \"onunregisternotify\",\n        obj: \"characteristic\",\n      },\n      // for typo\n      unregister_nofity_characteristic_result: {\n        name: \"onunregisternotify\",\n        obj: \"characteristic\",\n      },\n      notify_characteristic: {name: \"onnotify\", obj: \"characteristic\"},\n      // for typo\n      nofity_characteristic: {name: \"onnotify\", obj: \"characteristic\"},\n      get_descriptor_result: {name: \"discover\", obj: \"characteristic\"},\n      get_descriptor_result_finish: {\n        name: \"discoverfinished\",\n        obj: \"characteristic\",\n      },\n      write_descriptor_result: {name: \"onwrite\", obj: \"descriptor\"},\n      read_descriptor_result: {name: \"onread\", obj: \"descriptor\"},\n    };\n\n    for (const paramListKey in paramList) {\n      remotePeripheralCallbackFunc(\n        obj[paramListKey],\n        (val: any, bleobj: any) => {\n          bleobj.notifyFromServer(paramList[paramListKey].name, val);\n        },\n        paramList[paramListKey].obj,\n      );\n    }\n\n    const callbackFunc: any = (val: any, func: any, type: any) => {\n      let target: any = null;\n      if (val === undefined) {\n        return;\n      }\n      if (type === \"peripheral\") {\n        target = this.peripheral;\n      } else if (type === \"service\") {\n        target = this.peripheral.getService(val);\n      } else if (type === \"characteristic\") {\n        target = this.peripheral.findCharacteristic(val);\n      } else if (type === \"descriptor\") {\n        target = this.peripheral.findDescriptor(val);\n      }\n      if (!target) {\n        return;\n      }\n      func(val, target);\n    };\n\n    if (obj.peripheral) {\n      callbackFunc(\n        obj.peripheral.connection_status,\n        (val: any) => {\n          this.peripheral.onconnectionupdates(val);\n        },\n        \"peripheral\",\n      );\n\n      const centralParamList: any = {\n        read_characteristic_result: {name: \"onread\", obj: \"characteristic\"},\n        write_characteristic_result: {name: \"onwrite\", obj: \"characteristic\"},\n        notify_read_characteristic: {\n          name: \"onreadfromremote\",\n          obj: \"characteristic\",\n        },\n        notify_write_characteristic: {\n          name: \"onwritefromremote\",\n          obj: \"characteristic\",\n        },\n        read_descriptor_result: {name: \"onread\", obj: \"descriptor\"},\n        write_descriptor_result: {name: \"onwrite\", obj: \"descriptor\"},\n        notify_read_descriptor: {name: \"onreadfromremote\", obj: \"descriptor\"},\n        notify_write_descriptor: {\n          name: \"onwritefromremote\",\n          obj: \"descriptor\",\n        },\n      };\n\n      for (const key in centralParamList) {\n        callbackFunc(\n          obj.peripheral[key],\n          (val: any, bleobj: any) => {\n            bleobj.notifyFromServer(centralParamList[key].name, val);\n          },\n          centralParamList[key].obj,\n        );\n      }\n    }\n\n    if (obj.error) {\n      const params: any = obj.error;\n      let handled: any = false;\n      let peripheral: any;\n      let target: any;\n      if (!params.address) {\n        peripheral = this.peripheral;\n      } else {\n        peripheral = this.findPeripheral(params.address);\n      }\n\n      if (peripheral) {\n        if (\n          params.service_uuid &&\n          params.characteristic_uuid &&\n          params.descriptor_uuid\n        ) {\n          target = peripheral.findDescriptor(params);\n        } else if (params.service_uuid && params.characteristic_uuid) {\n          target = peripheral.findCharacteristic(params);\n        } else if (params.service_uuid) {\n          target = peripheral.findService(params);\n        }\n        if (target) {\n          target.notifyFromServer(\"onerror\", params);\n          handled = true;\n        } else {\n          peripheral.onerror(params);\n          handled = true;\n        }\n      }\n\n      if ([35, 36, 37, 38, 39].includes(params.function_code)) {\n        this.security.onerror(params);\n        handled = true;\n      }\n      if (!handled) {\n        this.Obniz.error(\n          `ble ${params.message} service=${\n            params.service_uuid\n          } characteristic_uuid=${params.characteristic_uuid} descriptor_uuid=${\n            params.descriptor_uuid\n          }`,\n        );\n      }\n    }\n  }\n}\n\nexport default ObnizBLE;\n"]}
{"version":3,"sources":["../src/parts/Biological/PULSE08-M5STICKC-S/index.ts"],"names":[],"mappings":"AAAA,OAAO,KAAK,MAAM,gBAAgB,CAAC;AACnC,OAAO,cAAc,MAAM,yCAAyC,CAAC;AACrE,OAAO,mBAAmB,EAAE,EAAC,cAAc,EAAC,MAAM,oCAAoC,CAAC;AAEvF,MAAM,WAAW,sBAAsB;IACrC,GAAG,CAAC,EAAE,MAAM,CAAC;IACb,GAAG,CAAC,EAAE,MAAM,CAAC;IACb,EAAE,EAAE,MAAM,CAAC;IACX,EAAE,EAAE,MAAM,CAAC;CACZ;AAED,MAAM,CAAC,OAAO,OAAO,eAAgB,YAAW,mBAAmB;WAEnD,IAAI,IAAI,cAAc;IAM7B,IAAI,EAAE,MAAM,EAAE,CAAC;IACf,YAAY,EAAE,MAAM,EAAE,CAAC;IACvB,SAAS,EAAE,GAAG,CAAC;IACf,KAAK,EAAG,KAAK,CAAC;IACd,MAAM,EAAE,GAAG,CAAC;IACZ,IAAI,EAAG,cAAc,CAAC;IACtB,aAAa,EAAE,GAAG,CAAC;;IAQnB,WAAW,CAAC,GAAG,EAAE,MAAM,GAAG,IAAI;IAI9B,WAAW,CAAC,MAAM,EAAE,MAAM,EAAE;IAI5B,KAAK,CAAC,KAAK,EAAE,KAAK;IAsClB,MAAM,CAAC,IAAI,EAAE,GAAG,GAAG,MAAM;IAazB,IAAI;CAMZ","file":"index.d.ts","sourcesContent":["import Obniz from \"../../../obniz\";\nimport PeripheralUART from \"../../../obniz/libs/io_peripherals/uart\";\nimport ObnizPartsInterface, {ObnizPartsInfo} from \"../../../obniz/ObnizPartsInterface\";\n\nexport interface Puls08M5stickcSOptions {\n  vcc?: number;\n  gnd?: number;\n  rx: number;\n  tx: number;\n}\n\nexport default class Puls08M5stickcS implements ObnizPartsInterface {\n\n  public static info(): ObnizPartsInfo {\n    return {\n      name: \"Puls08M5stickcS\",\n    };\n  }\n\n  public keys: string[];\n  public requiredKeys: string[];\n  public delimiter: any;\n  public obniz!: Obniz;\n  public params: any;\n  public uart!: PeripheralUART;\n  public receivingData: any;\n\n  constructor() {\n    this.keys = [\"vcc\", \"gnd\", \"tx\", \"rx\"];\n    this.requiredKeys = [\"tx\", \"rx\"];\n    this.delimiter = 0x0a;\n  }\n\n  public onbpmupdate(bpm: number | null) {\n    return;\n  }\n\n  public onrawupdate(values: number[]) {\n    return;\n  }\n\n  public wired(obniz: Obniz) {\n    this.obniz = obniz;\n\n    obniz.setVccGnd(this.params.vcc, this.params.gnd, \"5v\");\n    this.uart = obniz.getFreeUart();\n    this.uart.start({tx: this.params.tx, rx: this.params.rx, baud: 19200});\n    this.receivingData = [];\n\n    this.init();\n\n    this.uart.onreceive = (data: number[], text: any) => {\n      const dataToCallback: any = [];\n      data.forEach((e: any) => {\n        if (e !== this.delimiter) {\n          this.receivingData.push(e);\n          return;\n        } else {\n          const row: any = this.receivingData;\n          if (row[0] === \"#\".charCodeAt(0)) {\n            row[0] = \" \".charCodeAt(0);\n            const str: string = this.decode(row);\n            const val: number = parseInt(str);\n            const bpm: number | null = val > 0 ? 60000 / val : null;\n            this.onbpmupdate(bpm);\n          } else {\n            const str: any = this.decode(row);\n            const val: any = parseInt(str);\n            dataToCallback.push(val);\n          }\n          this.receivingData = [];\n        }\n      });\n      if (dataToCallback.length > 0) {\n        this.onrawupdate(dataToCallback);\n      }\n    };\n  }\n\n  public decode(data: any): string {\n    return Buffer.from(data).toString(\"utf8\");\n\n    // if (typeof TextDecoder !== 'undefined') {\n    //   let enc = new TextDecoder('utf-8');\n    //   let arr = new Uint8Array(data);\n    //   return enc.decode(arr);\n    // } else if (typeof Buffer !== 'undefined') {\n    // return Buffer.from(data).toString('utf8');\n    // }\n    // throw new Error('cannot decode');\n  }\n\n  public init() {\n    this.uart.send(\"@OF30\");\n    this.uart.send(0x0a);\n    this.uart.send(\"@RG2\");\n    this.uart.send(0x0a);\n  }\n}\n"]}
{"version":3,"sources":["../src/parts/Display/7SegmentLED/index.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["import Obniz from \"../../../obniz\";\nimport PeripheralIO from \"../../../obniz/libs/io_peripherals/io\";\nimport ObnizPartsInterface, {ObnizPartsInfo} from \"../../../obniz/ObnizPartsInterface\";\n\nexport interface _7SegmentLEDOptions {\n  a: number;\n  b: number;\n  c: number;\n  d: number;\n  e: number;\n  f: number;\n  g: number;\n  dp?: number;\n  common?: number;\n  commonType?: string;\n}\n\nclass _7SegmentLED implements ObnizPartsInterface {\n\n  public static info(): ObnizPartsInfo {\n    return {\n      name: \"7SegmentLED\",\n    };\n  }\n\n  public keys: string[];\n  public requiredKeys: string[];\n  public digits: number[];\n  public displayIoNames: {[key: string]: string};\n  public obniz!: Obniz;\n  public ios: PeripheralIO[];\n  public params: any;\n  public isCathodeCommon: boolean;\n  public dp?: PeripheralIO;\n  public common?: PeripheralIO;\n\n  constructor() {\n    this.keys = [\n      \"a\",\n      \"b\",\n      \"c\",\n      \"d\",\n      \"e\",\n      \"f\",\n      \"g\",\n      \"dp\",\n      \"common\",\n      \"commonType\",\n    ];\n    this.requiredKeys = [\"a\", \"b\", \"c\", \"d\", \"e\", \"f\", \"g\"];\n\n    this.digits = [\n      0x3f,\n      0x06,\n      0x5b,\n      0x4f,\n      0x66,\n      0x6d,\n      0x7d,\n      0x07,\n      0x7f,\n      0x6f,\n      0x6f,\n    ];\n\n    this.displayIoNames = {\n      a: \"a\",\n      b: \"b\",\n      c: \"c\",\n      d: \"d\",\n      e: \"e\",\n      f: \"f\",\n      g: \"g\",\n      dp: \"dp\",\n      common: \"com\",\n    };\n    this.ios = [];\n    this.isCathodeCommon = false;\n  }\n\n  public wired(obniz: Obniz) {\n    function getIO(io: any) {\n      if (io && typeof io === \"object\") {\n        if (typeof io.output === \"function\") {\n          return io;\n        }\n      }\n      return obniz.getIO(io);\n    }\n\n    function isValidIO(io: any) {\n      if (io && typeof io === \"object\") {\n        if (typeof io.output === \"function\") {\n          return true;\n        }\n      }\n      return obniz.isValidIO(io);\n    }\n\n    this.obniz = obniz;\n    this.ios = [];\n    this.ios.push(getIO(this.params.a));\n    this.ios.push(getIO(this.params.b));\n    this.ios.push(getIO(this.params.c));\n    this.ios.push(getIO(this.params.d));\n    this.ios.push(getIO(this.params.e));\n    this.ios.push(getIO(this.params.f));\n    this.ios.push(getIO(this.params.g));\n\n    this.isCathodeCommon = this.params.commonType === \"anode\" ? false : true;\n\n    for (let i = 0; i < this.ios.length; i++) {\n      this.ios[i].output(this.isCathodeCommon ? false : true);\n    }\n\n    if (isValidIO(this.params.dp)) {\n      const dp = getIO(this.params.dp);\n      dp.output(false);\n      this.dp = dp;\n    }\n    if (isValidIO(this.params.common)) {\n      this.common = getIO(this.params.common);\n      this.on();\n    }\n  }\n\n  public print(data: number) {\n    if (typeof data === \"number\") {\n      data = Math.floor(data);\n      data = data % 10;\n\n      for (let i = 0; i < 7; i++) {\n        if (this.ios[i]) {\n          let val: any = this.digits[data] & (1 << i) ? true : false;\n          if (!this.isCathodeCommon) {\n            val = !val;\n          }\n          this.ios[i].output(val);\n        }\n      }\n      this.on();\n    }\n  }\n\n  public printRaw(data: number) {\n    if (typeof data === \"number\") {\n      for (let i = 0; i < 7; i++) {\n        if (this.ios[i]) {\n          let val: any = data & (1 << i) ? true : false;\n          if (!this.isCathodeCommon) {\n            val = !val;\n          }\n          this.ios[i].output(val);\n        }\n      }\n      this.on();\n    }\n  }\n\n  public dpState(show: boolean) {\n    if (this.dp) {\n      this.dp.output(this.isCathodeCommon ? show : !show);\n    }\n  }\n\n  public on() {\n    if (this.common) {\n      this.common.output(this.isCathodeCommon ? false : true);\n    }\n  }\n\n  public off() {\n    if (this.common) {\n      this.common.output(this.isCathodeCommon ? true : false);\n    }\n  }\n}\n\nexport default _7SegmentLED;\n"]}
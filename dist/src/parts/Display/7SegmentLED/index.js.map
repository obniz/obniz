{"version":3,"sources":["../src/parts/Display/7SegmentLED/index.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["import Obniz from \"../../../obniz\";\r\nimport PeripheralIO from \"../../../obniz/libs/io_peripherals/io\";\r\nimport ObnizPartsInterface, {ObnizPartsInfo} from \"../../../obniz/ObnizPartsInterface\";\r\n\r\nexport interface _7SegmentLEDOptions {\r\n  a: number;\r\n  b: number;\r\n  c: number;\r\n  d: number;\r\n  e: number;\r\n  f: number;\r\n  g: number;\r\n  dp?: number;\r\n  common?: number;\r\n  commonType?: string;\r\n}\r\n\r\nclass _7SegmentLED implements ObnizPartsInterface {\r\n\r\n  public static info(): ObnizPartsInfo {\r\n    return {\r\n      name: \"7SegmentLED\",\r\n    };\r\n  }\r\n\r\n  public keys: string[];\r\n  public requiredKeys: string[];\r\n  public digits: number[];\r\n  public displayIoNames: {[key: string]: string};\r\n  public obniz!: Obniz;\r\n  public ios: PeripheralIO[];\r\n  public params: any;\r\n  public isCathodeCommon: boolean;\r\n  public dp?: PeripheralIO;\r\n  public common?: PeripheralIO;\r\n\r\n  constructor() {\r\n    this.keys = [\r\n      \"a\",\r\n      \"b\",\r\n      \"c\",\r\n      \"d\",\r\n      \"e\",\r\n      \"f\",\r\n      \"g\",\r\n      \"dp\",\r\n      \"common\",\r\n      \"commonType\",\r\n    ];\r\n    this.requiredKeys = [\"a\", \"b\", \"c\", \"d\", \"e\", \"f\", \"g\"];\r\n\r\n    this.digits = [\r\n      0x3f,\r\n      0x06,\r\n      0x5b,\r\n      0x4f,\r\n      0x66,\r\n      0x6d,\r\n      0x7d,\r\n      0x07,\r\n      0x7f,\r\n      0x6f,\r\n      0x6f,\r\n    ];\r\n\r\n    this.displayIoNames = {\r\n      a: \"a\",\r\n      b: \"b\",\r\n      c: \"c\",\r\n      d: \"d\",\r\n      e: \"e\",\r\n      f: \"f\",\r\n      g: \"g\",\r\n      dp: \"dp\",\r\n      common: \"com\",\r\n    };\r\n    this.ios = [];\r\n    this.isCathodeCommon = false;\r\n  }\r\n\r\n  public wired(obniz: Obniz) {\r\n    function getIO(io: any) {\r\n      if (io && typeof io === \"object\") {\r\n        if (typeof io.output === \"function\") {\r\n          return io;\r\n        }\r\n      }\r\n      return obniz.getIO(io);\r\n    }\r\n\r\n    function isValidIO(io: any) {\r\n      if (io && typeof io === \"object\") {\r\n        if (typeof io.output === \"function\") {\r\n          return true;\r\n        }\r\n      }\r\n      return obniz.isValidIO(io);\r\n    }\r\n\r\n    this.obniz = obniz;\r\n    this.ios = [];\r\n    this.ios.push(getIO(this.params.a));\r\n    this.ios.push(getIO(this.params.b));\r\n    this.ios.push(getIO(this.params.c));\r\n    this.ios.push(getIO(this.params.d));\r\n    this.ios.push(getIO(this.params.e));\r\n    this.ios.push(getIO(this.params.f));\r\n    this.ios.push(getIO(this.params.g));\r\n\r\n    this.isCathodeCommon = this.params.commonType === \"anode\" ? false : true;\r\n\r\n    for (let i = 0; i < this.ios.length; i++) {\r\n      this.ios[i].output(this.isCathodeCommon ? false : true);\r\n    }\r\n\r\n    if (isValidIO(this.params.dp)) {\r\n      const dp = getIO(this.params.dp);\r\n      dp.output(false);\r\n      this.dp = dp;\r\n    }\r\n    if (isValidIO(this.params.common)) {\r\n      this.common = getIO(this.params.common);\r\n      this.on();\r\n    }\r\n  }\r\n\r\n  public print(data: number) {\r\n    if (typeof data === \"number\") {\r\n      data = Math.floor(data);\r\n      data = data % 10;\r\n\r\n      for (let i = 0; i < 7; i++) {\r\n        if (this.ios[i]) {\r\n          let val: any = this.digits[data] & (1 << i) ? true : false;\r\n          if (!this.isCathodeCommon) {\r\n            val = !val;\r\n          }\r\n          this.ios[i].output(val);\r\n        }\r\n      }\r\n      this.on();\r\n    }\r\n  }\r\n\r\n  public printRaw(data: number) {\r\n    if (typeof data === \"number\") {\r\n      for (let i = 0; i < 7; i++) {\r\n        if (this.ios[i]) {\r\n          let val: any = data & (1 << i) ? true : false;\r\n          if (!this.isCathodeCommon) {\r\n            val = !val;\r\n          }\r\n          this.ios[i].output(val);\r\n        }\r\n      }\r\n      this.on();\r\n    }\r\n  }\r\n\r\n  public dpState(show: boolean) {\r\n    if (this.dp) {\r\n      this.dp.output(this.isCathodeCommon ? show : !show);\r\n    }\r\n  }\r\n\r\n  public on() {\r\n    if (this.common) {\r\n      this.common.output(this.isCathodeCommon ? false : true);\r\n    }\r\n  }\r\n\r\n  public off() {\r\n    if (this.common) {\r\n      this.common.output(this.isCathodeCommon ? true : false);\r\n    }\r\n  }\r\n}\r\n\r\nexport default _7SegmentLED;\r\n"]}
{"version":3,"sources":["../src/parts/Power/AXP192/index.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["import Obniz from \"../../../obniz\";\nimport ObnizPartsInterface, {ObnizPartsInfo} from \"../../../obniz/ObnizPartsInterface\";\nimport {I2cPartsAbstructOptions} from \"../../../parts/i2cParts\";\n\nexport interface AXP192Options extends I2cPartsAbstructOptions { }\n\nexport default class AXP192 implements ObnizPartsInterface {\n\n  public static info(): ObnizPartsInfo {\n    return {\n      name: \"AXP192\",\n    };\n  }\n\n  public requiredKeys: string[];\n  public keys: string[];\n  public params: any;\n\n  protected i2c: any;\n\n  constructor() {\n    this.requiredKeys = [];\n    this.keys = [\"sda\", \"scl\", \"i2c\"];\n  }\n\n  public wired(obniz: Obniz) {\n    this.params.mode = \"master\"; // for i2c\n    this.params.clock = 400 * 1000; // for i2c\n    this.i2c = obniz.getI2CWithConfig(this.params);\n  }\n\n  // Module functions\n  public set(address: number, data: number) {\n    this.i2c.write(AXP192_ADDRESS, [address, data]);\n  }\n\n  public async getWait(address: number) {\n    this.i2c.write(AXP192_ADDRESS, [address]);\n    return await this.i2c.readWait(AXP192_ADDRESS, 1);\n  }\n\n  public async setLDO2Voltage(voltage: number) {\n    if (voltage < 1.8) {\n      voltage = 1.8;\n    }\n    if (voltage > 3.3) {\n      voltage = 3.3;\n    }\n    let set = await this.getWait(REG_VOLT_SET_LDO2_3);\n    let offset = (voltage - 1.8) * 10;\n    if (offset > 15) {\n      offset = 15;\n    }\n    set = (set & 0x0f) | (offset << 4);\n    console.log(\"set voltage to \", set);\n    this.set(REG_VOLT_SET_LDO2_3, set);\n  }\n\n  public async setLDO3Voltage(voltage: number) {\n    if (voltage < 1.8) {\n      voltage = 1.8;\n    }\n    if (voltage > 3.3) {\n      voltage = 3.3;\n    }\n    let set = await this.getWait(REG_VOLT_SET_LDO2_3);\n    let offset = (voltage - 1.8) * 10;\n    if (offset > 15) {\n      offset = 15;\n    }\n    set = (set & 0xf0) | offset;\n    this.set(REG_VOLT_SET_LDO2_3, set);\n  }\n\n  public set3VLDO2_3() {\n    this.set(REG_VOLT_SET_LDO2_3, 0xcc);\n  }\n\n  public enableLDO2_3() {\n    this.set(REG_EN_DC1_LDO2_3, 0x4d);\n  }\n\n  public async toggleLDO2(val: number) {\n    const bit = val ? 1 : 0;\n    let state = await this.getWait(REG_EN_DC1_LDO2_3);\n    state = (state & LDO2_EN_MASK) | (bit << 2);\n    this.set(REG_EN_DC1_LDO2_3, state);\n  }\n\n  public async toggleLDO3(val: number) {\n    const bit = val ? 1 : 0;\n    let state = await this.getWait(REG_EN_DC1_LDO2_3);\n    state = (state & LDO3_EN_MASK) | (bit << 3);\n    this.set(REG_EN_DC1_LDO2_3, state);\n  }\n\n  public initM5StickC() {\n    this.i2c.write(AXP192_ADDRESS, [REG_EN_EXT_DC2, 0xff]);\n    this.i2c.write(AXP192_ADDRESS, [REG_VOLT_SET_LDO2_3, 0xcc]);\n    this.i2c.write(AXP192_ADDRESS, [REG_ADC_EN1, 0xff]);\n    this.i2c.write(AXP192_ADDRESS, [REG_CHARGE_CTRL1, 0xc0]);\n    this.i2c.write(AXP192_ADDRESS, [REG_CCOUNTER, 0x80]);\n    this.i2c.write(AXP192_ADDRESS, [REG_EN_DC1_LDO2_3, 0x4d]);\n    this.i2c.write(AXP192_ADDRESS, [REG_PEK, 0x0c]);\n    this.i2c.write(AXP192_ADDRESS, [REG_GPIO0, 0x02]);\n    this.i2c.write(AXP192_ADDRESS, [REG_VBUS_IPSOUT, 0xe0]);\n    this.i2c.write(AXP192_ADDRESS, [REG_CHARGE_OVTEMP, 0xfc]);\n    this.i2c.write(AXP192_ADDRESS, [REG_BCKUP_BAT, 0xa2]);\n  }\n\n  public async getVbat() {\n    this.i2c.write(AXP192_ADDRESS, [REG_VBAT_LSB]);\n    const vbat_lsb: any = await this.i2c.readWait(AXP192_ADDRESS, 1);\n    this.i2c.write(AXP192_ADDRESS, [REG_VBAT_MSB]);\n    const vbat_msb: any = await this.i2c.readWait(AXP192_ADDRESS, 1);\n    return (vbat_lsb << 4) + vbat_msb;\n  }\n}\n\nconst AXP192_ADDRESS: any = 0x34;\n\nconst REG_EN_EXT_DC2: any = 0x10;\nconst REG_EN_DC1_LDO2_3: any = 0x12;\nconst REG_VOLT_SET_LDO2_3: any = 0x28;\nconst REG_VBUS_IPSOUT: any = 0x30;\nconst REG_CHARGE_CTRL1: any = 0x33;\nconst REG_BCKUP_BAT: any = 0x35;\nconst REG_PEK: any = 0x36;\nconst REG_CHARGE_OVTEMP: any = 0x39;\nconst REG_VBAT_LSB: any = 0x78;\nconst REG_VBAT_MSB: any = 0x79;\nconst REG_ADC_EN1: any = 0x82;\nconst REG_GPIO0: any = 0x90;\nconst REG_CCOUNTER: any = 0xb8;\n\nconst LDO2_EN_MASK: any = 0xfb;\nconst LDO3_EN_MASK: any = 0xf7;\n"]}
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
class Grove_GPS {
    constructor() {
        this.keys = ["tx", "rx", "vcc", "gnd"];
        this.requiredKeys = ["tx", "rx"];
        this.ioKeys = this.keys;
        this.displayName = "gps";
        this.displayIoNames = { tx: "tx", rx: "rx" };
    }
    // -------------------
    get latitude() {
        return this.nmea2dd(this._latitude);
    }
    get longitude() {
        return this.nmea2dd(this._longitude);
    }
    static info() {
        return {
            name: "Grove_GPS",
        };
    }
    wired(obniz) {
        this.obniz = obniz;
        this.obniz.setVccGnd(this.params.vcc, this.params.gnd, "5v");
        this.uart = obniz.getFreeUart();
        this.uart.start({
            tx: this.params.tx,
            rx: this.params.rx,
            baud: 9600,
        });
        this.editedData = {};
        this.editedData.enable = false;
        this.editedData.GPGSV = new Array(4);
        this.gpsInfo = {};
        this.gpsInfo._sentenceType = {
            GPGGA: 0x0001,
            GPGSA: 0x0002,
            GPGSV: 0x0004,
            GPRMC: 0x0008,
            GPVTG: 0x0010,
            GPZDA: 0x0020,
        };
        this.gpsInfo.status = "V";
        this.gpsInfo.sentences = new Set(); // Set specifying sentence of MNEA from which data have been obtained
        this.gpsInfo.satelliteInfo = {
            satellites: [],
            inView: 0,
        };
    }
    readSentence() {
        let results = [];
        if (this.uart.isDataExists()) {
            const pos = this.uart.received.indexOf(0x0a);
            if (pos >= 0) {
                results = this.uart.received.slice(0, pos - 1);
                this.uart.received.splice(0, pos + 1);
                return this.uart.tryConvertString(results);
            }
        }
        return "";
    }
    getEditedData() {
        let n;
        let utc;
        let format;
        let sentence = this.readSentence();
        this.editedData.enable = false;
        this.editedData.GPGSV = new Array(4);
        while (sentence.length > 0) {
            const part = sentence.split(",");
            if (sentence.slice(-4, -3) !== ",") {
                const st = part[part.length - 1].slice(0, -3);
                part.push(part[part.length - 1].slice(-3));
                part[part.length - 2] = st;
            }
            this.editedData.sentence = part.join(",");
            switch (part[0]) {
                case "$GPGGA":
                    this.editedData.GPGGA = part;
                    break;
                case "$GPGLL":
                    this.editedData.GPGLL = part;
                    break;
                case "$GPGSA":
                    this.editedData.GPGSA = part;
                    break;
                case "$GPGSV":
                    n = Number(part[2]);
                    if (n > this.editedData.GPGSV.length) {
                        while (n > this.editedData.GPGSV.length) {
                            this.editedData.GPGSV.push([]);
                        }
                    }
                    this.editedData.GPGSV[n - 1] = part;
                    break;
                case "$GPRMC":
                    this.editedData.GPRMC = part;
                    break;
                case "$GPVTG":
                    this.editedData.GPVTG = part;
                    break;
                case "$GPZDA":
                    this.editedData.GPZDA = part;
                    utc =
                        part[4] +
                            "/" +
                            part[3] +
                            "/" +
                            part[2] +
                            " " +
                            part[1].substring(0, 2) +
                            ":" +
                            part[1].substring(2, 4) +
                            ":" +
                            part[1].substring(4, 6) +
                            " +00:00";
                    this.editedData.timestamp = new Date(utc);
                    break;
                default:
                    format = part[0].substr(1);
                    this.editedData[format] = part;
            }
            this.editedData.enable = true;
            sentence = this.readSentence();
        }
        return this.editedData;
    }
    getGpsInfo(editedData) {
        const NMEA_SATINSENTENCE = 4;
        const NMEA_MAXSAT = 12;
        editedData = editedData || this.getEditedData();
        this.gpsInfo.status = "V";
        if (editedData.enable) {
            if (editedData.GPGGA) {
                const gga = editedData.GPGGA;
                this.gpsInfo.gpsQuality = parseFloat(gga[6]); // Fix Quality: 0 = Invalid, 1 = GPS fix, 2 = DGPS fix
                this.gpsInfo.hdop = parseFloat(gga[8]); // Horizontal Dilution of Precision (HDOP)
                this.gpsInfo.altitude = parseFloat(gga[9]); // Antenna Altitude meters above mean sea level
                const latitude = this.nmea2dd(parseFloat(gga[2]));
                this.gpsInfo.latitude = gga[3] === "N" ? latitude : -latitude;
                const longitude = this.nmea2dd(parseFloat(gga[4]));
                this.gpsInfo.longitude = gga[5] === "E" ? longitude : -longitude;
                this.gpsInfo.sentences.add(this.gpsInfo._sentenceType.GPGGA);
            }
            if (editedData.GPGSV) {
                for (let n = 0; n < editedData.GPGSV.length; n++) {
                    if (editedData.GPGSV[n]) {
                        const gsv = editedData.GPGSV[n].map((v) => parseFloat(v));
                        const pack_count = gsv[1];
                        const pack_index = gsv[2];
                        const sat_count = gsv[3];
                        if (pack_index > pack_count) {
                            continue;
                        }
                        this.gpsInfo.satelliteInfo.inView = sat_count;
                        let nsat = (pack_index - 1) * NMEA_SATINSENTENCE;
                        nsat =
                            nsat + NMEA_SATINSENTENCE > sat_count
                                ? sat_count - nsat
                                : NMEA_SATINSENTENCE;
                        for (let isat = 0; isat < nsat; ++isat) {
                            const isi = (pack_index - 1) * NMEA_SATINSENTENCE + isat;
                            if (this.gpsInfo.satelliteInfo.satellites.length <= isi) {
                                this.gpsInfo.satelliteInfo.satellites.push({});
                            }
                            const isatn = isat * NMEA_SATINSENTENCE;
                            this.gpsInfo.satelliteInfo.satellites[isi] = {
                                id: gsv[isatn + 4],
                                elevation: gsv[isatn + 5],
                                azimuth: gsv[isatn + 6],
                                snr: gsv[isatn + 7],
                                inUse: false,
                            };
                        }
                        this.gpsInfo.sentences.add(this.gpsInfo._sentenceType.GPGSV);
                    }
                }
            }
            if (editedData.GPGSA) {
                const gsa = editedData.GPGSA;
                let nuse = 0;
                this.gpsInfo.fixMode = parseFloat(gsa[2]); // Fix Mode: 1=Fix not available, 2=2D, 3=3D
                this.gpsInfo.pdop = parseFloat(gsa[15]); // PDOP: Position Dilution of Precision
                this.gpsInfo.hdop = parseFloat(gsa[16]); // HDOP: Horizontal Dilution of Precision
                this.gpsInfo.vdop = parseFloat(gsa[17]); // VDOP: Vertical Dilution of Position
                for (let i = 0; i < NMEA_MAXSAT; ++i) {
                    for (let j = 0; j < this.gpsInfo.satelliteInfo.inView; ++j) {
                        if (this.gpsInfo.satelliteInfo.satellites[j] &&
                            gsa[i + 3] === this.gpsInfo.satelliteInfo.satellites[j].id) {
                            this.gpsInfo.satelliteInfo.satellites[j].inUse = true;
                            nuse++;
                        }
                    }
                }
                this.gpsInfo.satelliteInfo.inUse = nuse;
                this.gpsInfo.sentences.add(this.gpsInfo._sentenceType.GPGSA);
            }
            if (editedData.GPRMC) {
                const rmc = editedData.GPRMC;
                this.gpsInfo.status = rmc[2]; // Status Active or Void
                const latitude = this.nmea2dd(parseFloat(rmc[3]));
                this.gpsInfo.latitude = rmc[4] === "N" ? latitude : -latitude;
                const longitude = this.nmea2dd(parseFloat(rmc[5]));
                this.gpsInfo.longitude = rmc[6] === "E" ? longitude : -longitude;
                const NMEA_TUD_KNOTS = 1.852; // 1knot=1.852km/h
                this.gpsInfo.speed = parseFloat(rmc[7]) * NMEA_TUD_KNOTS; // unit: km/h
                this.gpsInfo.direction = rmc[8];
                this.gpsInfo.sentences.add(this.gpsInfo._sentenceType.GPRMC);
            }
            if (editedData.GPVTG) {
                const vtg = editedData.GPVTG;
                this.gpsInfo.direction = parseFloat(vtg[1]);
                this.gpsInfo.declination = parseFloat(vtg[3]);
                this.gpsInfo.speed = parseFloat(vtg[7]);
                this.gpsInfo.sentences.add(this.gpsInfo._sentenceType.GPVTG);
            }
            if (editedData.GPZDA) {
                this.gpsInfo.utc = editedData.timestamp;
                this.gpsInfo.sentences.add(this.gpsInfo._sentenceType.GPZDA);
            }
        }
        return this.gpsInfo;
    }
    _mneaTo(format, value) {
        let result = this.nmea2dd(value);
        if (typeof format === "string") {
            switch (format.toUpperCase()) {
                case "DMS":
                    result = this.nmea2dms(value);
                    break;
                case "DM":
                    result = this.nmea2dm(value);
                    break;
                case "S":
                    result = this.nmea2s(value);
                    break;
                default:
            }
        }
        return result;
    }
    latitudeTo(format) {
        return this._mneaTo(format, this._latitude);
    }
    longitudeTo(format) {
        return this._mneaTo(format, this._longitude);
    }
    status2string(status) {
        status = status || this.status;
        if (status === "A") {
            return "Active";
        }
        if (status === "V") {
            return "Void";
        }
        return status;
    }
    fixMode2string(fixMode) {
        fixMode = fixMode || this.fixMode;
        if (fixMode === 1) {
            return "Fix not available";
        }
        if (fixMode === 2) {
            return "2D";
        }
        if (fixMode === 3) {
            return "3D";
        }
        return fixMode;
    }
    gpsQuality2string(gpsQuality) {
        gpsQuality = gpsQuality || this.gpsQuality;
        if (gpsQuality === 0) {
            return "Invalid";
        }
        if (gpsQuality === 1) {
            return "GPS fix";
        }
        if (gpsQuality === 2) {
            return "DGPS fix";
        }
        return gpsQuality;
    }
    // --- latitude/longitude MNEA format change to each unit
    nmea2dms(val) {
        // NMEA format to DMS format string (999째 99'99.9")
        val = parseFloat(val);
        const d = Math.floor(val / 100);
        const m = Math.floor((val / 100.0 - d) * 100.0);
        const s = ((val / 100.0 - d) * 100.0 - m) * 60;
        return d + "째" + m + "'" + s.toFixed(1) + '"';
    }
    nmea2dm(val) {
        // NMEA format to DM format string (999째 99.9999')
        val = parseFloat(val);
        const d = Math.floor(val / 100.0);
        const m = (val / 100.0 - d) * 100.0;
        return d + "째" + m.toFixed(4) + "'";
    }
    nmea2dd(val) {
        // NMEA format to DD format decimal (999.999999)
        val = parseFloat(val);
        const d = Math.floor(val / 100.0);
        const m = Math.floor(((val / 100.0 - d) * 100.0) / 60);
        const s = (((val / 100.0 - d) * 100.0 - m) * 60) / (60 * 60);
        return parseFloat((d + m + s).toFixed(6));
    }
    nmea2s(val) {
        // NMEA format to S format decimal (99999.9999)
        val = parseFloat(val);
        const d = Math.floor(val / 100.0);
        const m = Math.floor(((val / 100.0 - d) * 100.0) / 60);
        const s = (((val / 100.0 - d) * 100.0 - m) * 60) / (60 * 60);
        return (d + m + s) / (1.0 / 60.0 / 60.0);
    }
}
exports.default = Grove_GPS;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9wYXJ0cy9Hcm92ZS9Hcm92ZV9HUFMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxNQUFNLFNBQVM7SUFnQ2I7UUFDRSxJQUFJLENBQUMsSUFBSSxHQUFHLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDdkMsSUFBSSxDQUFDLFlBQVksR0FBRyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztRQUVqQyxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7UUFDeEIsSUFBSSxDQUFDLFdBQVcsR0FBRyxLQUFLLENBQUM7UUFDekIsSUFBSSxDQUFDLGNBQWMsR0FBRyxFQUFDLEVBQUUsRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLElBQUksRUFBQyxDQUFDO0lBQzdDLENBQUM7SUF0Q0Qsc0JBQXNCO0lBQ3RCLElBQUksUUFBUTtRQUNWLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDdEMsQ0FBQztJQUVELElBQUksU0FBUztRQUNYLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDdkMsQ0FBQztJQUVNLE1BQU0sQ0FBQyxJQUFJO1FBQ2hCLE9BQU87WUFDTCxJQUFJLEVBQUUsV0FBVztTQUNsQixDQUFDO0lBQ0osQ0FBQztJQTJCTSxLQUFLLENBQUMsS0FBVTtRQUNyQixJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztRQUVuQixJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsQ0FBQztRQUM3RCxJQUFJLENBQUMsSUFBSSxHQUFHLEtBQUssQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNoQyxJQUFJLENBQUMsSUFBSSxD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eC5qcyIsInNvdXJjZXNDb250ZW50IjpbImNsYXNzIEdyb3ZlX0dQUyB7XG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgZ2V0IGxhdGl0dWRlKCkge1xuICAgIHJldHVybiB0aGlzLm5tZWEyZGQodGhpcy5fbGF0aXR1ZGUpO1xuICB9XG5cbiAgZ2V0IGxvbmdpdHVkZSgpIHtcbiAgICByZXR1cm4gdGhpcy5ubWVhMmRkKHRoaXMuX2xvbmdpdHVkZSk7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIGluZm8oKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWU6IFwiR3JvdmVfR1BTXCIsXG4gICAgfTtcbiAgfVxuXG4gIHB1YmxpYyBrZXlzOiBhbnk7XG4gIHB1YmxpYyByZXF1aXJlZEtleXM6IGFueTtcbiAgcHVibGljIGlvS2V5czogYW55O1xuICBwdWJsaWMgZGlzcGxheU5hbWU6IGFueTtcbiAgcHVibGljIGRpc3BsYXlJb05hbWVzOiBhbnk7XG4gIHB1YmxpYyBvYm5pejogYW55O1xuICBwdWJsaWMgcGFyYW1zOiBhbnk7XG4gIHB1YmxpYyB1YXJ0OiBhbnk7XG4gIHB1YmxpYyBlZGl0ZWREYXRhOiBhbnk7XG4gIHB1YmxpYyBncHNJbmZvOiBhbnk7XG4gIHB1YmxpYyBfbGF0aXR1ZGU6IGFueTtcbiAgcHVibGljIF9sb25naXR1ZGU6IGFueTtcbiAgcHVibGljIHN0YXR1czogYW55O1xuICBwdWJsaWMgZml4TW9kZTogYW55O1xuICBwdWJsaWMgZ3BzUXVhbGl0eTogYW55O1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMua2V5cyA9IFtcInR4XCIsIFwicnhcIiwgXCJ2Y2NcIiwgXCJnbmRcIl07XG4gICAgdGhpcy5yZXF1aXJlZEtleXMgPSBbXCJ0eFwiLCBcInJ4XCJdO1xuXG4gICAgdGhpcy5pb0tleXMgPSB0aGlzLmtleXM7XG4gICAgdGhpcy5kaXNwbGF5TmFtZSA9IFwiZ3BzXCI7XG4gICAgdGhpcy5kaXNwbGF5SW9OYW1lcyA9IHt0eDogXCJ0eFwiLCByeDogXCJyeFwifTtcbiAgfVxuXG4gIHB1YmxpYyB3aXJlZChvYm5pejogYW55KSB7XG4gICAgdGhpcy5vYm5peiA9IG9ibml6O1xuXG4gICAgdGhpcy5vYm5pei5zZXRWY2NHbmQodGhpcy5wYXJhbXMudmNjLCB0aGlzLnBhcmFtcy5nbmQsIFwiNXZcIik7XG4gICAgdGhpcy51YXJ0ID0gb2JuaXouZ2V0RnJlZVVhcnQoKTtcbiAgICB0aGlzLnVhcnQuc3RhcnQoe1xuICAgICAgdHg6IHRoaXMucGFyYW1zLnR4LFxuICAgICAgcng6IHRoaXMucGFyYW1zLnJ4LFxuICAgICAgYmF1ZDogOTYwMCxcbiAgICB9KTtcblxuICAgIHRoaXMuZWRpdGVkRGF0YSA9IHt9O1xuICAgIHRoaXMuZWRpdGVkRGF0YS5lbmFibGUgPSBmYWxzZTtcbiAgICB0aGlzLmVkaXRlZERhdGEuR1BHU1YgPSBuZXcgQXJyYXkoNCk7XG5cbiAgICB0aGlzLmdwc0luZm8gPSB7fTtcbiAgICB0aGlzLmdwc0luZm8uX3NlbnRlbmNlVHlwZSA9IHtcbiAgICAgIEdQR0dBOiAweDAwMDEsIC8vIEdHQSAtIEdsb2JhbCBQb3NpdGlvbmluZyBTeXN0ZW0gRml4IERhdGFcbiAgICAgIEdQR1NBOiAweDAwMDIsIC8vIEdTQSAtIEdOU1MgRE9QIGFuZCBhY3RpdmUgc2F0ZWxsaXRlc1xuICAgICAgR1BHU1Y6IDB4MDAwNCwgLy8gR1NWIC0gU2F0ZWxsaXRlcyBpbiB2aWV3XG4gICAgICBHUFJNQzogMHgwMDA4LCAvLyBSTUMgLSBSZWNvbW1lbmRlZCBtaW5pbXVtIHNwZWNpZmljIEdOU1MgZGF0YVxuICAgICAgR1BWVEc6IDB4MDAxMCwgLy8gVlRHIC0gVHJhY2sgbWFkZSBnb29kIGFuZCBncm91bmQgc3BlZWRcbiAgICAgIEdQWkRBOiAweDAwMjAsIC8vIFpEQSAtIERhdGUgJiBUaW1lXG4gICAgfTtcbiAgICB0aGlzLmdwc0luZm8uc3RhdHVzID0gXCJWXCI7XG4gICAgdGhpcy5ncHNJbmZvLnNlbnRlbmNlcyA9IG5ldyBTZXQoKTsgLy8gU2V0IHNwZWNpZnlpbmcgc2VudGVuY2Ugb2YgTU5FQSBmcm9tIHdoaWNoIGRhdGEgaGF2ZSBiZWVuIG9idGFpbmVkXG4gICAgdGhpcy5ncHNJbmZvLnNhdGVsbGl0ZUluZm8gPSB7XG4gICAgICBzYXRlbGxpdGVzOiBbXSxcbiAgICAgIGluVmlldzogMCxcbiAgICB9O1xuICB9XG5cbiAgcHVibGljIHJlYWRTZW50ZW5jZSgpIHtcbiAgICBsZXQgcmVzdWx0czogYW55ID0gW107XG4gICAgaWYgKHRoaXMudWFydC5pc0RhdGFFeGlzdHMoKSkge1xuICAgICAgY29uc3QgcG9zOiBhbnkgPSB0aGlzLnVhcnQucmVjZWl2ZWQuaW5kZXhPZigweDBhKTtcbiAgICAgIGlmIChwb3MgPj0gMCkge1xuICAgICAgICByZXN1bHRzID0gdGhpcy51YXJ0LnJlY2VpdmVkLnNsaWNlKDAsIHBvcyAtIDEpO1xuICAgICAgICB0aGlzLnVhcnQucmVjZWl2ZWQuc3BsaWNlKDAsIHBvcyArIDEpO1xuICAgICAgICByZXR1cm4gdGhpcy51YXJ0LnRyeUNvbnZlcnRTdHJpbmcocmVzdWx0cyk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBcIlwiO1xuICB9XG5cbiAgcHVibGljIGdldEVkaXRlZERhdGEoKSB7XG4gICAgbGV0IG46IGFueTsgbGV0IHV0YzogYW55OyBsZXQgZm9ybWF0OiBhbnk7XG4gICAgbGV0IHNlbnRlbmNlOiBhbnkgPSB0aGlzLnJlYWRTZW50ZW5jZSgpO1xuICAgIHRoaXMuZWRpdGVkRGF0YS5lbmFibGUgPSBmYWxzZTtcbiAgICB0aGlzLmVkaXRlZERhdGEuR1BHU1YgPSBuZXcgQXJyYXkoNCk7XG4gICAgd2hpbGUgKHNlbnRlbmNlLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IHBhcnQ6IGFueSA9IHNlbnRlbmNlLnNwbGl0KFwiLFwiKTtcbiAgICAgIGlmIChzZW50ZW5jZS5zbGljZSgtNCwgLTMpICE9PSBcIixcIikge1xuICAgICAgICBjb25zdCBzdDogYW55ID0gcGFydFtwYXJ0Lmxlbmd0aCAtIDFdLnNsaWNlKDAsIC0zKTtcbiAgICAgICAgcGFydC5wdXNoKHBhcnRbcGFydC5sZW5ndGggLSAxXS5zbGljZSgtMykpO1xuICAgICAgICBwYXJ0W3BhcnQubGVuZ3RoIC0gMl0gPSBzdDtcbiAgICAgIH1cbiAgICAgIHRoaXMuZWRpdGVkRGF0YS5zZW50ZW5jZSA9IHBhcnQuam9pbihcIixcIik7XG4gICAgICBzd2l0Y2ggKHBhcnRbMF0pIHtcbiAgICAgICAgY2FzZSBcIiRHUEdHQVwiOlxuICAgICAgICAgIHRoaXMuZWRpdGVkRGF0YS5HUEdHQSA9IHBhcnQ7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCIkR1BHTExcIjpcbiAgICAgICAgICB0aGlzLmVkaXRlZERhdGEuR1BHTEwgPSBwYXJ0O1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiJEdQR1NBXCI6XG4gICAgICAgICAgdGhpcy5lZGl0ZWREYXRhLkdQR1NBID0gcGFydDtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcIiRHUEdTVlwiOlxuICAgICAgICAgIG4gPSBOdW1iZXIocGFydFsyXSk7XG4gICAgICAgICAgaWYgKG4gPiB0aGlzLmVkaXRlZERhdGEuR1BHU1YubGVuZ3RoKSB7XG4gICAgICAgICAgICB3aGlsZSAobiA+IHRoaXMuZWRpdGVkRGF0YS5HUEdTVi5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgdGhpcy5lZGl0ZWREYXRhLkdQR1NWLnB1c2goW10pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLmVkaXRlZERhdGEuR1BHU1ZbbiAtIDFdID0gcGFydDtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcIiRHUFJNQ1wiOlxuICAgICAgICAgIHRoaXMuZWRpdGVkRGF0YS5HUFJNQyA9IHBhcnQ7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCIkR1BWVEdcIjpcbiAgICAgICAgICB0aGlzLmVkaXRlZERhdGEuR1BWVEcgPSBwYXJ0O1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiJEdQWkRBXCI6XG4gICAgICAgICAgdGhpcy5lZGl0ZWREYXRhLkdQWkRBID0gcGFydDtcbiAgICAgICAgICB1dGMgPVxuICAgICAgICAgICAgcGFydFs0XSArXG4gICAgICAgICAgICBcIi9cIiArXG4gICAgICAgICAgICBwYXJ0WzNdICtcbiAgICAgICAgICAgIFwiL1wiICtcbiAgICAgICAgICAgIHBhcnRbMl0gK1xuICAgICAgICAgICAgXCIgXCIgK1xuICAgICAgICAgICAgcGFydFsxXS5zdWJzdHJpbmcoMCwgMikgK1xuICAgICAgICAgICAgXCI6XCIgK1xuICAgICAgICAgICAgcGFydFsxXS5zdWJzdHJpbmcoMiwgNCkgK1xuICAgICAgICAgICAgXCI6XCIgK1xuICAgICAgICAgICAgcGFydFsxXS5zdWJzdHJpbmcoNCwgNikgK1xuICAgICAgICAgICAgXCIgKzAwOjAwXCI7XG4gICAgICAgICAgdGhpcy5lZGl0ZWREYXRhLnRpbWVzdGFtcCA9IG5ldyBEYXRlKHV0Yyk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgZm9ybWF0ID0gcGFydFswXS5zdWJzdHIoMSk7XG4gICAgICAgICAgdGhpcy5lZGl0ZWREYXRhW2Zvcm1hdF0gPSBwYXJ0O1xuICAgICAgfVxuXG4gICAgICB0aGlzLmVkaXRlZERhdGEuZW5hYmxlID0gdHJ1ZTtcbiAgICAgIHNlbnRlbmNlID0gdGhpcy5yZWFkU2VudGVuY2UoKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuZWRpdGVkRGF0YTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRHcHNJbmZvKGVkaXRlZERhdGE6IGFueSkge1xuICAgIGNvbnN0IE5NRUFfU0FUSU5TRU5URU5DRTogYW55ID0gNDsgY29uc3QgTk1FQV9NQVhTQVQ6IGFueSA9IDEyO1xuICAgIGVkaXRlZERhdGEgPSBlZGl0ZWREYXRhIHx8IHRoaXMuZ2V0RWRpdGVkRGF0YSgpO1xuICAgIHRoaXMuZ3BzSW5mby5zdGF0dXMgPSBcIlZcIjtcbiAgICBpZiAoZWRpdGVkRGF0YS5lbmFibGUpIHtcbiAgICAgIGlmIChlZGl0ZWREYXRhLkdQR0dBKSB7XG4gICAgICAgIGNvbnN0IGdnYTogYW55ID0gZWRpdGVkRGF0YS5HUEdHQTtcbiAgICAgICAgdGhpcy5ncHNJbmZvLmdwc1F1YWxpdHkgPSBwYXJzZUZsb2F0KGdnYVs2XSk7IC8vIEZpeCBRdWFsaXR5OiAwID0gSW52YWxpZCwgMSA9IEdQUyBmaXgsIDIgPSBER1BTIGZpeFxuICAgICAgICB0aGlzLmdwc0luZm8uaGRvcCA9IHBhcnNlRmxvYXQoZ2dhWzhdKTsgLy8gSG9yaXpvbnRhbCBEaWx1dGlvbiBvZiBQcmVjaXNpb24gKEhET1ApXG4gICAgICAgIHRoaXMuZ3BzSW5mby5hbHRpdHVkZSA9IHBhcnNlRmxvYXQoZ2dhWzldKTsgLy8gQW50ZW5uYSBBbHRpdHVkZSBtZXRlcnMgYWJvdmUgbWVhbiBzZWEgbGV2ZWxcbiAgICAgICAgY29uc3QgbGF0aXR1ZGU6IGFueSA9IHRoaXMubm1lYTJkZChwYXJzZUZsb2F0KGdnYVsyXSkpO1xuICAgICAgICB0aGlzLmdwc0luZm8ubGF0aXR1ZGUgPSBnZ2FbM10gPT09IFwiTlwiID8gbGF0aXR1ZGUgOiAtbGF0aXR1ZGU7XG4gICAgICAgIGNvbnN0IGxvbmdpdHVkZTogYW55ID0gdGhpcy5ubWVhMmRkKHBhcnNlRmxvYXQoZ2dhWzRdKSk7XG4gICAgICAgIHRoaXMuZ3BzSW5mby5sb25naXR1ZGUgPSBnZ2FbNV0gPT09IFwiRVwiID8gbG9uZ2l0dWRlIDogLWxvbmdpdHVkZTtcbiAgICAgICAgdGhpcy5ncHNJbmZvLnNlbnRlbmNlcy5hZGQodGhpcy5ncHNJbmZvLl9zZW50ZW5jZVR5cGUuR1BHR0EpO1xuICAgICAgfVxuICAgICAgaWYgKGVkaXRlZERhdGEuR1BHU1YpIHtcbiAgICAgICAgZm9yIChsZXQgbiA9IDA7IG4gPCBlZGl0ZWREYXRhLkdQR1NWLmxlbmd0aDsgbisrKSB7XG4gICAgICAgICAgaWYgKGVkaXRlZERhdGEuR1BHU1Zbbl0pIHtcbiAgICAgICAgICAgIGNvbnN0IGdzdjogYW55ID0gZWRpdGVkRGF0YS5HUEdTVltuXS5tYXAoKHY6IGFueSkgPT4gcGFyc2VGbG9hdCh2KSk7XG4gICAgICAgICAgICBjb25zdCBwYWNrX2NvdW50OiBhbnkgPSBnc3ZbMV07IGNvbnN0IHBhY2tfaW5kZXg6IGFueSA9IGdzdlsyXTsgY29uc3Qgc2F0X2NvdW50OiBhbnkgPSBnc3ZbM107XG4gICAgICAgICAgICBpZiAocGFja19pbmRleCA+IHBhY2tfY291bnQpIHtcbiAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuZ3BzSW5mby5zYXRlbGxpdGVJbmZvLmluVmlldyA9IHNhdF9jb3VudDtcbiAgICAgICAgICAgIGxldCBuc2F0OiBhbnkgPSAocGFja19pbmRleCAtIDEpICogTk1FQV9TQVRJTlNFTlRFTkNFO1xuICAgICAgICAgICAgbnNhdCA9XG4gICAgICAgICAgICAgIG5zYXQgKyBOTUVBX1NBVElOU0VOVEVOQ0UgPiBzYXRfY291bnRcbiAgICAgICAgICAgICAgICA/IHNhdF9jb3VudCAtIG5zYXRcbiAgICAgICAgICAgICAgICA6IE5NRUFfU0FUSU5TRU5URU5DRTtcblxuICAgICAgICAgICAgZm9yIChsZXQgaXNhdCA9IDA7IGlzYXQgPCBuc2F0OyArK2lzYXQpIHtcbiAgICAgICAgICAgICAgY29uc3QgaXNpOiBhbnkgPSAocGFja19pbmRleCAtIDEpICogTk1FQV9TQVRJTlNFTlRFTkNFICsgaXNhdDtcbiAgICAgICAgICAgICAgaWYgKHRoaXMuZ3BzSW5mby5zYXRlbGxpdGVJbmZvLnNhdGVsbGl0ZXMubGVuZ3RoIDw9IGlzaSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3BzSW5mby5zYXRlbGxpdGVJbmZvLnNhdGVsbGl0ZXMucHVzaCh7fSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgY29uc3QgaXNhdG46IGFueSA9IGlzYXQgKiBOTUVBX1NBVElOU0VOVEVOQ0U7XG4gICAgICAgICAgICAgIHRoaXMuZ3BzSW5mby5zYXRlbGxpdGVJbmZvLnNhdGVsbGl0ZXNbaXNpXSA9IHtcbiAgICAgICAgICAgICAgICBpZDogZ3N2W2lzYXRuICsgNF0sIC8vIFNWIFBSTiBudW1iZXJcbiAgICAgICAgICAgICAgICBlbGV2YXRpb246IGdzdltpc2F0biArIDVdLCAvLyBFbGV2YXRpb24gaW4gZGVncmVlcywgOTAgbWF4aW11bVxuICAgICAgICAgICAgICAgIGF6aW11dGg6IGdzdltpc2F0biArIDZdLCAvLyBBemltdXRoLCBkZWdyZWVzIGZyb20gdHJ1ZSBub3J0aCwgMDAwIHRvIDM1OVxuICAgICAgICAgICAgICAgIHNucjogZ3N2W2lzYXRuICsgN10sIC8vIFNOUiwgMDAtOTkgZEIgKG51bGwgd2hlbiBub3QgdHJhY2tpbmcpXG4gICAgICAgICAgICAgICAgaW5Vc2U6IGZhbHNlLFxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5ncHNJbmZvLnNlbnRlbmNlcy5hZGQodGhpcy5ncHNJbmZvLl9zZW50ZW5jZVR5cGUuR1BHU1YpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKGVkaXRlZERhdGEuR1BHU0EpIHtcbiAgICAgICAgY29uc3QgZ3NhOiBhbnkgPSBlZGl0ZWREYXRhLkdQR1NBO1xuICAgICAgICBsZXQgbnVzZTogYW55ID0gMDtcbiAgICAgICAgdGhpcy5ncHNJbmZvLmZpeE1vZGUgPSBwYXJzZUZsb2F0KGdzYVsyXSk7IC8vIEZpeCBNb2RlOiAxPUZpeCBub3QgYXZhaWxhYmxlLCAyPTJELCAzPTNEXG4gICAgICAgIHRoaXMuZ3BzSW5mby5wZG9wID0gcGFyc2VGbG9hdChnc2FbMTVdKTsgLy8gUERPUDogUG9zaXRpb24gRGlsdXRpb24gb2YgUHJlY2lzaW9uXG4gICAgICAgIHRoaXMuZ3BzSW5mby5oZG9wID0gcGFyc2VGbG9hdChnc2FbMTZdKTsgLy8gSERPUDogSG9yaXpvbnRhbCBEaWx1dGlvbiBvZiBQcmVjaXNpb25cbiAgICAgICAgdGhpcy5ncHNJbmZvLnZkb3AgPSBwYXJzZUZsb2F0KGdzYVsxN10pOyAvLyBWRE9QOiBWZXJ0aWNhbCBEaWx1dGlvbiBvZiBQb3NpdGlvblxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE5NRUFfTUFYU0FUOyArK2kpIHtcbiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuZ3BzSW5mby5zYXRlbGxpdGVJbmZvLmluVmlldzsgKytqKSB7XG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgIHRoaXMuZ3BzSW5mby5zYXRlbGxpdGVJbmZvLnNhdGVsbGl0ZXNbal0gJiZcbiAgICAgICAgICAgICAgZ3NhW2kgKyAzXSA9PT0gdGhpcy5ncHNJbmZvLnNhdGVsbGl0ZUluZm8uc2F0ZWxsaXRlc1tqXS5pZFxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgIHRoaXMuZ3BzSW5mby5zYXRlbGxpdGVJbmZvLnNhdGVsbGl0ZXNbal0uaW5Vc2UgPSB0cnVlO1xuICAgICAgICAgICAgICBudXNlKys7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuZ3BzSW5mby5zYXRlbGxpdGVJbmZvLmluVXNlID0gbnVzZTtcbiAgICAgICAgdGhpcy5ncHNJbmZvLnNlbnRlbmNlcy5hZGQodGhpcy5ncHNJbmZvLl9zZW50ZW5jZVR5cGUuR1BHU0EpO1xuICAgICAgfVxuICAgICAgaWYgKGVkaXRlZERhdGEuR1BSTUMpIHtcbiAgICAgICAgY29uc3Qgcm1jOiBhbnkgPSBlZGl0ZWREYXRhLkdQUk1DO1xuICAgICAgICB0aGlzLmdwc0luZm8uc3RhdHVzID0gcm1jWzJdOyAvLyBTdGF0dXMgQWN0aXZlIG9yIFZvaWRcbiAgICAgICAgY29uc3QgbGF0aXR1ZGU6IGFueSA9IHRoaXMubm1lYTJkZChwYXJzZUZsb2F0KHJtY1szXSkpO1xuICAgICAgICB0aGlzLmdwc0luZm8ubGF0aXR1ZGUgPSBybWNbNF0gPT09IFwiTlwiID8gbGF0aXR1ZGUgOiAtbGF0aXR1ZGU7XG4gICAgICAgIGNvbnN0IGxvbmdpdHVkZTogYW55ID0gdGhpcy5ubWVhMmRkKHBhcnNlRmxvYXQocm1jWzVdKSk7XG4gICAgICAgIHRoaXMuZ3BzSW5mby5sb25naXR1ZGUgPSBybWNbNl0gPT09IFwiRVwiID8gbG9uZ2l0dWRlIDogLWxvbmdpdHVkZTtcbiAgICAgICAgY29uc3QgTk1FQV9UVURfS05PVFM6IGFueSA9IDEuODUyOyAvLyAxa25vdD0xLjg1MmttL2hcbiAgICAgICAgdGhpcy5ncHNJbmZvLnNwZWVkID0gcGFyc2VGbG9hdChybWNbN10pICogTk1FQV9UVURfS05PVFM7IC8vIHVuaXQ6IGttL2hcbiAgICAgICAgdGhpcy5ncHNJbmZvLmRpcmVjdGlvbiA9IHJtY1s4XTtcbiAgICAgICAgdGhpcy5ncHNJbmZvLnNlbnRlbmNlcy5hZGQodGhpcy5ncHNJbmZvLl9zZW50ZW5jZVR5cGUuR1BSTUMpO1xuICAgICAgfVxuICAgICAgaWYgKGVkaXRlZERhdGEuR1BWVEcpIHtcbiAgICAgICAgY29uc3QgdnRnOiBhbnkgPSBlZGl0ZWREYXRhLkdQVlRHO1xuICAgICAgICB0aGlzLmdwc0luZm8uZGlyZWN0aW9uID0gcGFyc2VGbG9hdCh2dGdbMV0pO1xuICAgICAgICB0aGlzLmdwc0luZm8uZGVjbGluYXRpb24gPSBwYXJzZUZsb2F0KHZ0Z1szXSk7XG4gICAgICAgIHRoaXMuZ3BzSW5mby5zcGVlZCA9IHBhcnNlRmxvYXQodnRnWzddKTtcbiAgICAgICAgdGhpcy5ncHNJbmZvLnNlbnRlbmNlcy5hZGQodGhpcy5ncHNJbmZvLl9zZW50ZW5jZVR5cGUuR1BWVEcpO1xuICAgICAgfVxuICAgICAgaWYgKGVkaXRlZERhdGEuR1BaREEpIHtcbiAgICAgICAgdGhpcy5ncHNJbmZvLnV0YyA9IGVkaXRlZERhdGEudGltZXN0YW1wO1xuICAgICAgICB0aGlzLmdwc0luZm8uc2VudGVuY2VzLmFkZCh0aGlzLmdwc0luZm8uX3NlbnRlbmNlVHlwZS5HUFpEQSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmdwc0luZm87XG4gIH1cblxuICBwdWJsaWMgX21uZWFUbyhmb3JtYXQ6IGFueSwgdmFsdWU6IGFueSkge1xuICAgIGxldCByZXN1bHQ6IGFueSA9IHRoaXMubm1lYTJkZCh2YWx1ZSk7XG4gICAgaWYgKHR5cGVvZiBmb3JtYXQgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgIHN3aXRjaCAoZm9ybWF0LnRvVXBwZXJDYXNlKCkpIHtcbiAgICAgICAgY2FzZSBcIkRNU1wiOlxuICAgICAgICAgIHJlc3VsdCA9IHRoaXMubm1lYTJkbXModmFsdWUpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiRE1cIjpcbiAgICAgICAgICByZXN1bHQgPSB0aGlzLm5tZWEyZG0odmFsdWUpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiU1wiOlxuICAgICAgICAgIHJlc3VsdCA9IHRoaXMubm1lYTJzKHZhbHVlKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIHB1YmxpYyBsYXRpdHVkZVRvKGZvcm1hdDogYW55KSB7XG4gICAgcmV0dXJuIHRoaXMuX21uZWFUbyhmb3JtYXQsIHRoaXMuX2xhdGl0dWRlKTtcbiAgfVxuXG4gIHB1YmxpYyBsb25naXR1ZGVUbyhmb3JtYXQ6IGFueSkge1xuICAgIHJldHVybiB0aGlzLl9tbmVhVG8oZm9ybWF0LCB0aGlzLl9sb25naXR1ZGUpO1xuICB9XG5cbiAgcHVibGljIHN0YXR1czJzdHJpbmcoc3RhdHVzOiBhbnkpIHtcbiAgICBzdGF0dXMgPSBzdGF0dXMgfHwgdGhpcy5zdGF0dXM7XG4gICAgaWYgKHN0YXR1cyA9PT0gXCJBXCIpIHtcbiAgICAgIHJldHVybiBcIkFjdGl2ZVwiO1xuICAgIH1cbiAgICBpZiAoc3RhdHVzID09PSBcIlZcIikge1xuICAgICAgcmV0dXJuIFwiVm9pZFwiO1xuICAgIH1cbiAgICByZXR1cm4gc3RhdHVzO1xuICB9XG5cbiAgcHVibGljIGZpeE1vZGUyc3RyaW5nKGZpeE1vZGU6IGFueSkge1xuICAgIGZpeE1vZGUgPSBmaXhNb2RlIHx8IHRoaXMuZml4TW9kZTtcbiAgICBpZiAoZml4TW9kZSA9PT0gMSkge1xuICAgICAgcmV0dXJuIFwiRml4IG5vdCBhdmFpbGFibGVcIjtcbiAgICB9XG4gICAgaWYgKGZpeE1vZGUgPT09IDIpIHtcbiAgICAgIHJldHVybiBcIjJEXCI7XG4gICAgfVxuICAgIGlmIChmaXhNb2RlID09PSAzKSB7XG4gICAgICByZXR1cm4gXCIzRFwiO1xuICAgIH1cbiAgICByZXR1cm4gZml4TW9kZTtcbiAgfVxuXG4gIHB1YmxpYyBncHNRdWFsaXR5MnN0cmluZyhncHNRdWFsaXR5OiBhbnkpIHtcbiAgICBncHNRdWFsaXR5ID0gZ3BzUXVhbGl0eSB8fCB0aGlzLmdwc1F1YWxpdHk7XG4gICAgaWYgKGdwc1F1YWxpdHkgPT09IDApIHtcbiAgICAgIHJldHVybiBcIkludmFsaWRcIjtcbiAgICB9XG4gICAgaWYgKGdwc1F1YWxpdHkgPT09IDEpIHtcbiAgICAgIHJldHVybiBcIkdQUyBmaXhcIjtcbiAgICB9XG4gICAgaWYgKGdwc1F1YWxpdHkgPT09IDIpIHtcbiAgICAgIHJldHVybiBcIkRHUFMgZml4XCI7XG4gICAgfVxuICAgIHJldHVybiBncHNRdWFsaXR5O1xuICB9XG5cbiAgLy8gLS0tIGxhdGl0dWRlL2xvbmdpdHVkZSBNTkVBIGZvcm1hdCBjaGFuZ2UgdG8gZWFjaCB1bml0XG4gIHB1YmxpYyBubWVhMmRtcyh2YWw6IGFueSkge1xuICAgIC8vIE5NRUEgZm9ybWF0IHRvIERNUyBmb3JtYXQgc3RyaW5nICg5OTnCsCA5OSc5OS45XCIpXG4gICAgdmFsID0gcGFyc2VGbG9hdCh2YWwpO1xuICAgIGNvbnN0IGQ6IGFueSA9IE1hdGguZmxvb3IodmFsIC8gMTAwKTtcbiAgICBjb25zdCBtOiBhbnkgPSBNYXRoLmZsb29yKCh2YWwgLyAxMDAuMCAtIGQpICogMTAwLjApO1xuICAgIGNvbnN0IHM6IGFueSA9ICgodmFsIC8gMTAwLjAgLSBkKSAqIDEwMC4wIC0gbSkgKiA2MDtcbiAgICByZXR1cm4gZCArIFwiwrBcIiArIG0gKyBcIidcIiArIHMudG9GaXhlZCgxKSArICdcIic7XG4gIH1cblxuICBwdWJsaWMgbm1lYTJkbSh2YWw6IGFueSkge1xuICAgIC8vIE5NRUEgZm9ybWF0IHRvIERNIGZvcm1hdCBzdHJpbmcgKDk5OcKwIDk5Ljk5OTknKVxuICAgIHZhbCA9IHBhcnNlRmxvYXQodmFsKTtcbiAgICBjb25zdCBkOiBhbnkgPSBNYXRoLmZsb29yKHZhbCAvIDEwMC4wKTtcbiAgICBjb25zdCBtOiBhbnkgPSAodmFsIC8gMTAwLjAgLSBkKSAqIDEwMC4wO1xuICAgIHJldHVybiBkICsgXCLCsFwiICsgbS50b0ZpeGVkKDQpICsgXCInXCI7XG4gIH1cblxuICBwdWJsaWMgbm1lYTJkZCh2YWw6IGFueSkge1xuICAgIC8vIE5NRUEgZm9ybWF0IHRvIEREIGZvcm1hdCBkZWNpbWFsICg5OTkuOTk5OTk5KVxuICAgIHZhbCA9IHBhcnNlRmxvYXQodmFsKTtcbiAgICBjb25zdCBkOiBhbnkgPSBNYXRoLmZsb29yKHZhbCAvIDEwMC4wKTtcbiAgICBjb25zdCBtOiBhbnkgPSBNYXRoLmZsb29yKCgodmFsIC8gMTAwLjAgLSBkKSAqIDEwMC4wKSAvIDYwKTtcbiAgICBjb25zdCBzOiBhbnkgPSAoKCh2YWwgLyAxMDAuMCAtIGQpICogMTAwLjAgLSBtKSAqIDYwKSAvICg2MCAqIDYwKTtcbiAgICByZXR1cm4gcGFyc2VGbG9hdCgoZCArIG0gKyBzKS50b0ZpeGVkKDYpKTtcbiAgfVxuXG4gIHB1YmxpYyBubWVhMnModmFsOiBhbnkpIHtcbiAgICAvLyBOTUVBIGZvcm1hdCB0byBTIGZvcm1hdCBkZWNpbWFsICg5OTk5OS45OTk5KVxuICAgIHZhbCA9IHBhcnNlRmxvYXQodmFsKTtcbiAgICBjb25zdCBkOiBhbnkgPSBNYXRoLmZsb29yKHZhbCAvIDEwMC4wKTtcbiAgICBjb25zdCBtOiBhbnkgPSBNYXRoLmZsb29yKCgodmFsIC8gMTAwLjAgLSBkKSAqIDEwMC4wKSAvIDYwKTtcbiAgICBjb25zdCBzOiBhbnkgPSAoKCh2YWwgLyAxMDAuMCAtIGQpICogMTAwLjAgLSBtKSAqIDYwKSAvICg2MCAqIDYwKTtcbiAgICByZXR1cm4gKGQgKyBtICsgcykgLyAoMS4wIC8gNjAuMCAvIDYwLjApO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEdyb3ZlX0dQUztcbiJdfQ==

{"version":3,"sources":["../src/parts/Grove/Grove_MP3/index.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["import Obniz from \"../../../obniz\";\r\nimport ObnizPartsInterface, {ObnizPartsInfo} from \"../../../obniz/ObnizPartsInterface\";\r\n\r\nexport interface Grove_MP3Options {\r\n  vcc?: number;\r\n  gnd?: number;\r\n  mp3_rx: number;\r\n  mp3_tx: number;\r\n}\r\n\r\nexport default class Grove_MP3 implements ObnizPartsInterface {\r\n\r\n  public static info(): ObnizPartsInfo {\r\n    return {\r\n      name: \"Grove_MP3\",\r\n    };\r\n  }\r\n\r\n  public keys: string[];\r\n  public requiredKeys: string[];\r\n  public ioKeys: string[];\r\n  public displayName: any;\r\n  public displayIoNames: any;\r\n  public obniz!: Obniz;\r\n  public params: any;\r\n  public my_tx: any;\r\n  public my_rx: any;\r\n  public uart: any;\r\n\r\n  constructor() {\r\n    this.keys = [\"vcc\", \"gnd\", \"mp3_rx\", \"mp3_tx\"];\r\n    this.requiredKeys = [\"mp3_rx\", \"mp3_tx\"];\r\n\r\n    this.ioKeys = this.keys;\r\n    this.displayName = \"MP3\";\r\n    this.displayIoNames = {mp3_rx: \"MP3Rx\", mp3_tx: \"MP3Tx\"};\r\n  }\r\n\r\n  public wired(obniz: Obniz) {\r\n    this.obniz = obniz;\r\n    obniz.setVccGnd(this.params.vcc, this.params.gnd, \"5v\");\r\n\r\n    this.my_tx = this.params.mp3_rx;\r\n    this.my_rx = this.params.mp3_tx;\r\n\r\n    this.uart = this.obniz.getFreeUart();\r\n  }\r\n\r\n  public async initWait(strage?: any): Promise<void> {\r\n    this.uart.start({\r\n      tx: this.my_tx,\r\n      rx: this.my_rx,\r\n      baud: 9600,\r\n    });\r\n    await this.obniz.wait(100);\r\n    this.uartSend(0x0c, 0);\r\n    await this.obniz.wait(500);\r\n    this.uartSend(0x0b, 0);\r\n    await this.obniz.wait(100);\r\n\r\n    if (strage) {\r\n      if (strage === \"usb\") {\r\n        this.uartSend(0x09, 1);\r\n      } else if (strage === \"sd\") {\r\n        this.uartSend(0x09, 2);\r\n      }\r\n    } else {\r\n      this.uartSend(0x09, 2);\r\n    }\r\n    await this.obniz.wait(200);\r\n  }\r\n\r\n  public setVolume(vol: number) {\r\n    if (vol >= 0 && vol <= 31) {\r\n      this.uartSend(0x06, vol);\r\n    }\r\n  }\r\n\r\n  public volUp() {\r\n    this.uartSend(0x04, 0);\r\n  }\r\n\r\n  public volDown() {\r\n    this.uartSend(0x05, 0);\r\n  }\r\n\r\n  public play(track: any, folder?: any) {\r\n    // if (!folder) folder = {};\r\n    if (folder) {\r\n      this.uart.send([0x7e, 0xff, 0x06, 0x0f, 0x00, folder, track, 0xef]);\r\n    } else {\r\n      // Play 'MP3' folder\r\n      this.uartSend(0x12, track);\r\n    }\r\n  }\r\n\r\n  public stop() {\r\n    this.uartSend(0x16, 0);\r\n  }\r\n\r\n  public pause() {\r\n    this.uartSend(0x0e, 0);\r\n  }\r\n\r\n  public resume() {\r\n    this.uartSend(0x0d, 0);\r\n  }\r\n\r\n  public next() {\r\n    this.uartSend(0x01, 0);\r\n  }\r\n\r\n  public prev() {\r\n    this.uartSend(0x02, 0);\r\n  }\r\n\r\n  public uartSend(command: any, param: any) {\r\n    const paramM: any = param >> 8;\r\n    const paramL: any = param & 0xff;\r\n    this.uart.send([0x7e, 0xff, 0x06, command, 0x01, paramM, paramL, 0xef]);\r\n    const response: any = this.uart.readBytes();\r\n    return response;\r\n    // return response;\r\n  }\r\n}\r\n"]}
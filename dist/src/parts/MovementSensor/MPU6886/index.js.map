{"version":3,"sources":["../src/parts/MovementSensor/MPU6886/index.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["import i2cParts, {I2cPartsAbstructOptions} from \"../../i2cParts\";\r\n\r\nimport Obniz from \"../../../obniz\";\r\nimport ObnizPartsInterface, {ObnizPartsInfo} from \"../../../obniz/ObnizPartsInterface\";\r\n\r\nexport interface MPU6886Options extends I2cPartsAbstructOptions {\r\n\r\n}\r\n\r\nexport default class MPU6886 extends i2cParts implements ObnizPartsInterface {\r\n\r\n  public static info(): ObnizPartsInfo {\r\n    return {\r\n      name: \"MPU6886\",\r\n    };\r\n  }\r\n\r\n  public commands: any;\r\n  public write: any;\r\n  public params: any;\r\n  public char2short: any;\r\n\r\n  protected obniz!: Obniz;\r\n\r\n  private _accel_range: any;\r\n  private _gyro_range: any;\r\n\r\n  constructor() {\r\n    super();\r\n    this.commands = {};\r\n    this.commands.whoami = 0x75;\r\n    this.commands.accelIntelCtrl = 0x69;\r\n    this.commands.smplrtDiv = 0x19;\r\n    this.commands.intPinCfg = 0x37;\r\n    this.commands.intEnable = 0x38;\r\n    this.commands.accelXoutH = 0x3b;\r\n    this.commands.accelXoutL = 0x3c;\r\n    this.commands.accelYoutH = 0x3d;\r\n    this.commands.accelYoutL = 0x3e;\r\n    this.commands.accelZoutH = 0x3f;\r\n    this.commands.accelZoutL = 0x40;\r\n\r\n    this.commands.tempOutH = 0x41;\r\n    this.commands.tempOutL = 0x42;\r\n\r\n    this.commands.gyroXoutH = 0x43;\r\n    this.commands.gyroXoutL = 0x44;\r\n    this.commands.gyroYoutH = 0x45;\r\n    this.commands.gyroYoutL = 0x46;\r\n    this.commands.gyroZoutH = 0x47;\r\n    this.commands.gyroZoutL = 0x48;\r\n\r\n    this.commands.userCtrl = 0x6a;\r\n    this.commands.pwrMgmt1 = 0x6b;\r\n    this.commands.pwrMgmt2 = 0x6c;\r\n    this.commands.config = 0x1a;\r\n    this.commands.gyroConfig = 0x1b;\r\n    this.commands.accelConfig = 0x1c;\r\n    this.commands.accelConfig2 = 0x1d;\r\n    this.commands.fifoEn = 0x23;\r\n  }\r\n\r\n  public wired(obniz: Obniz) {\r\n    super.wired(obniz);\r\n\r\n    this.init();\r\n  }\r\n\r\n  public i2cInfo() {\r\n    return {\r\n      address: 0x68,\r\n      clock: 100000,\r\n      voltage: \"3v\",\r\n    };\r\n  }\r\n\r\n  public async whoamiWait(): Promise<number> {\r\n    const result = await this.readWait(this.commands.whoami, 1);\r\n    return result[0];\r\n  }\r\n\r\n  public init() {\r\n    this.write(this.commands.pwrMgmt1, 0x00);\r\n    this.obniz.wait(10);\r\n    this.write(this.commands.pwrMgmt1, 0x01 << 7);\r\n    this.obniz.wait(10);\r\n    this.write(this.commands.pwrMgmt1, 0x01 << 0);\r\n    this.obniz.wait(10);\r\n    this.setConfig(\r\n      this.params.accelerometer_range || 2,\r\n      this.params.gyroscope_range || 250,\r\n    );\r\n    this.obniz.wait(1);\r\n    this.write(this.commands.config, 0x01);\r\n    this.obniz.wait(1);\r\n    this.write(this.commands.smplrtDiv, 0x05);\r\n    this.obniz.wait(1);\r\n    this.write(this.commands.intEnable, 0x00);\r\n    this.obniz.wait(1);\r\n    this.write(this.commands.accelConfig2, 0x00);\r\n    this.obniz.wait(1);\r\n    this.write(this.commands.userCtrl, 0x00);\r\n    this.obniz.wait(1);\r\n    this.write(this.commands.fifoEn, 0x00);\r\n    this.obniz.wait(1);\r\n    this.write(this.commands.intPinCfg, 0x22);\r\n    this.obniz.wait(1);\r\n    this.write(this.commands.intEnable, 0x01);\r\n    this.obniz.wait(1);\r\n  }\r\n\r\n  public setConfig(accelerometer_range: number, gyroscope_range: number) {\r\n    // accel range set (0x00:2g, 0x08:4g, 0x10:8g, 0x18:16g)\r\n    switch (accelerometer_range) {\r\n      case 2:\r\n        this.write(this.commands.accelConfig, 0x00);\r\n        break;\r\n      case 4:\r\n        this.write(this.commands.accelConfig, 0x08);\r\n        break;\r\n      case 8:\r\n        this.write(this.commands.accelConfig, 0x10);\r\n        break;\r\n      case 16:\r\n        this.write(this.commands.accelConfig, 0x18);\r\n        break;\r\n      default:\r\n        throw new Error(\"accel_range variable 2,4,8,16 setting\");\r\n    }\r\n    // gyro range & LPF set (0x00:250, 0x08:500, 0x10:1000, 0x18:2000[deg/s])\r\n    switch (gyroscope_range) {\r\n      case 250:\r\n        this.write(this.commands.gyroConfig, 0x00);\r\n        break;\r\n      case 500:\r\n        this.write(this.commands.gyroConfig, 0x08);\r\n        break;\r\n      case 1000:\r\n        this.write(this.commands.gyroConfig, 0x10);\r\n        break;\r\n      case 2000:\r\n        this.write(this.commands.gyroConfig, 0x18);\r\n        break;\r\n      default:\r\n        throw new Error(\"accel_range variable 250,500,1000,2000 setting\");\r\n    }\r\n    this._accel_range = accelerometer_range;\r\n    this._gyro_range = gyroscope_range;\r\n  }\r\n\r\n  public async getAllDataWait(): Promise<{\r\n    accelerometer: {\r\n      x: number,\r\n      y: number,\r\n      z: number,\r\n    },\r\n    temperature: number,\r\n    gyroscope: {\r\n      x: number,\r\n      y: number,\r\n      z: number,\r\n    },\r\n  }> {\r\n    const raw_data = await this.readWait(this.commands.accelXoutH, 14); // request all data\r\n    const ac_scale = this._accel_range / 32768;\r\n    const gy_scale = this._gyro_range / 32768;\r\n\r\n    const accelerometer = {\r\n      x: this.char2short(raw_data[0], raw_data[1]) * ac_scale,\r\n      y: this.char2short(raw_data[2], raw_data[3]) * ac_scale,\r\n      z: this.char2short(raw_data[4], raw_data[5]) * ac_scale,\r\n    };\r\n    const temperature =\r\n      this.char2short(raw_data[6], raw_data[7]) / 326.8 + 25.0;\r\n    const gyroscope = {\r\n      x: this.char2short(raw_data[8], raw_data[9]) * gy_scale,\r\n      y: this.char2short(raw_data[10], raw_data[11]) * gy_scale,\r\n      z: this.char2short(raw_data[12], raw_data[13]) * gy_scale,\r\n    };\r\n\r\n    return {\r\n      accelerometer,\r\n      temperature,\r\n      gyroscope,\r\n    };\r\n  }\r\n\r\n  public async getTempWait(): Promise<number> {\r\n    return (await this.getAllDataWait()).temperature;\r\n  }\r\n\r\n  public async getAccelWait(): Promise<{\r\n    x: number,\r\n    y: number,\r\n    z: number,\r\n}> {\r\n    return (await this.getAllDataWait()).accelerometer;\r\n  }\r\n\r\n  public async getGyroWait(): Promise<{\r\n    x: number,\r\n    y: number,\r\n    z: number,\r\n  }> {\r\n    return (await this.getAllDataWait()).gyroscope;\r\n  }\r\n}\r\n"]}
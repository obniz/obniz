{"version":3,"sources":["../src/parts/MovementSensor/FlickHat/index.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["import Obniz from \"../../../obniz\";\r\nimport PeripheralI2C from \"../../../obniz/libs/io_peripherals/i2c\";\r\nimport ObnizPartsInterface, {ObnizPartsInfo} from \"../../../obniz/ObnizPartsInterface\";\r\n\r\nexport interface FlickHatOptions {\r\n  vcc?: number;\r\n  sda: number;\r\n  scl: number;\r\n  reset: number;\r\n  ts: number;\r\n  gnd: number;\r\n  led1?: number;\r\n  led2?: number;\r\n}\r\n\r\nexport type FlickHat_Direction = \"west\" | \"east\" | \"north\" | \"south\";\r\nexport type FlickHat_Direction2 = \"west\" | \"east\" | \"north\" | \"south\" | \"center\";\r\n\r\nexport interface FlickHat_XYZ {\r\n  x: number;\r\n  y: number;\r\n  z: number;\r\n  seq: number;\r\n}\r\n\r\nexport interface FlickHat_Gesture {\r\n  action: \"gesture\";\r\n  from: FlickHat_Direction;\r\n  to: FlickHat_Direction;\r\n  seq: number;\r\n  raw: any;\r\n}\r\n\r\nexport interface FlickHat_Touch {\r\n  action: \"touch\";\r\n  positions: FlickHat_Direction2[];\r\n  seq: number;\r\n  raw: any;\r\n}\r\n\r\nexport interface FlickHat_Tap {\r\n  action: \"tap\";\r\n  positions: FlickHat_Direction2[];\r\n  seq: number;\r\n  raw: any;\r\n}\r\n\r\nexport interface FlickHat_DoubleTap {\r\n  action: \"doubletap\";\r\n  positions: FlickHat_Direction2[];\r\n  seq: number;\r\n  raw: any;\r\n}\r\n\r\nexport interface FlickHat_AirWheel {\r\n  delta: number;\r\n  rotation: number;\r\n  seq: number;\r\n  raw: any;\r\n}\r\n\r\nexport default class FlickHat implements ObnizPartsInterface {\r\n\r\n  public static info(): ObnizPartsInfo {\r\n    return {\r\n      name: \"FlickHat\",\r\n    };\r\n  }\r\n\r\n  public keys: string[];\r\n  public requiredKeys: string[];\r\n  public displayIoNames: any;\r\n  public params: any;\r\n\r\n  public address: any;\r\n  public io_reset: any;\r\n  public io_ts: any;\r\n  public i2c!: PeripheralI2C;\r\n  public led1: any;\r\n  public led2: any;\r\n  public onfwinfo?: (fwInfo: any) => void;\r\n  public fwInfo: any;\r\n  public rotation: any;\r\n  public lastRotation: any;\r\n  public readSize: any;\r\n  public debugprint: any;\r\n  public xyz: any;\r\n  public onxyz?: (xyz: FlickHat_XYZ) => void;\r\n  public lastGesture: any;\r\n  public ongestureall: any;\r\n  public ongesture?: (gesture: FlickHat_Gesture) => void;\r\n  public lastTouch: any;\r\n  public ontouch?: (touch: FlickHat_Touch) => void;\r\n  public ontap?: ((tap: FlickHat_Tap) => void);\r\n  public ondoubletap: any;\r\n  public onairwheel?: (airwheel: FlickHat_AirWheel) => void ;\r\n  public statusInfo: any;\r\n\r\n  protected obniz!: Obniz;\r\n\r\n  constructor() {\r\n    this.keys = [\"vcc\", \"gnd\", \"sda\", \"scl\", \"reset\", \"ts\", \"led1\", \"led2\"];\r\n    this.requiredKeys = [\"gnd\", \"sda\", \"scl\", \"reset\", \"ts\"];\r\n\r\n    this.displayIoNames = {\r\n      // vcc: 'vcc', //5v\r\n      sda: \"sda\",\r\n      scl: \"scl\",\r\n      gnd: \"gnd\",\r\n      reset: \"reset\",\r\n      ts: \"ts\",\r\n    };\r\n  }\r\n\r\n  public wired(obniz: Obniz) {\r\n    this.obniz = obniz;\r\n\r\n    this.address = 0x42;\r\n\r\n    if (this.obniz.isValidIO(this.params.vcc)) {\r\n      this.obniz.getIO(this.params.vcc).drive(\"5v\");\r\n      this.obniz.getIO(this.params.vcc).output(true);\r\n    }\r\n    this.obniz.getIO(this.params.gnd).output(false);\r\n\r\n    this.io_reset = this.obniz.getIO(this.params.reset);\r\n    this.io_reset.drive(\"3v\");\r\n\r\n    this.io_ts = this.obniz.getIO(this.params.ts);\r\n    this.io_ts.drive(\"open-drain\");\r\n    this.io_ts.pull(\"3v\");\r\n\r\n    this.params.mode = \"master\";\r\n    this.params.pull = \"3v\";\r\n    this.params.clock = 100 * 1000; // 100KHz\r\n\r\n    // PeripheralI2C\r\n    this.i2c = this.obniz.getI2CWithConfig(this.params);\r\n\r\n    if (this.obniz.isValidIO(this.params.led1)) {\r\n      this.led1 = this.obniz.wired(\"LED\", {anode: this.params.led1});\r\n    }\r\n    if (this.obniz.isValidIO(this.params.led2)) {\r\n      this.led2 = this.obniz.wired(\"LED\", {anode: this.params.led2});\r\n    }\r\n  }\r\n\r\n  public async start(callback: (fwInfo: any) => void): Promise<void> {\r\n    this.io_ts.pull(\"3v\");\r\n\r\n    this.io_reset.output(false);\r\n    await this.obniz.wait(50);\r\n    this.io_reset.output(true);\r\n    await this.obniz.wait(50);\r\n\r\n    this.onfwinfo = callback;\r\n    this.fwInfo = {\r\n      fwValid: 0,\r\n      fwInfoReceived: false,\r\n    };\r\n    this.rotation = 0;\r\n    this.lastRotation = 0;\r\n    this.readSize = 132;\r\n\r\n    await this.polling();\r\n    await this.obniz.wait(200);\r\n\r\n    this.i2c.write(this.address, [\r\n      0x10,\r\n      0x00,\r\n      0x00,\r\n      0xa2,\r\n      0xa1,\r\n      0x00,\r\n      0x00,\r\n      0x00,\r\n      0x1f,\r\n      0x00,\r\n      0x00,\r\n      0x00,\r\n      0xff,\r\n      0xff,\r\n      0xff,\r\n      0xff,\r\n    ]);\r\n    await this.obniz.wait(100);\r\n\r\n    this.i2c.write(this.address, [\r\n      0x10,\r\n      0x00,\r\n      0x00,\r\n      0xa2,\r\n      0x80,\r\n      0x00,\r\n      0x00,\r\n      0x00,\r\n      0x3f,\r\n      0x00,\r\n      0x00,\r\n      0x00,\r\n      0x3f,\r\n      0x00,\r\n      0x00,\r\n      0x00,\r\n    ]);\r\n  }\r\n\r\n  public _dataArray2string(data: any) {\r\n    let result: any = \"\";\r\n    for (const n of data) {\r\n      result += String.fromCharCode(n);\r\n    }\r\n    return result;\r\n  }\r\n\r\n  public async polling(timeout?: any) {\r\n    timeout = timeout || 3000; // default: 3s\r\n\r\n    // DataOutputConfigMask\t2byte\r\n    // const maskDSPStatus = 1;\r\n    const maskGestureInfo: any = 1 << 1;\r\n    const maskTouchInfo: any = 1 << 2;\r\n    const maskAirWheelInfo: any = 1 << 3;\r\n    const maskXYZPosition: any = 1 << 4;\r\n\r\n    // SystemInfo\t1byte\r\n    const sysPositionValid: any = 1;\r\n    const sysAirWheelValid: any = 1 << 1;\r\n    // const sysDSPRunning = 1 << 7;\r\n\r\n    const startTime: any = new Date();\r\n    let ts: any = true;\r\n    while (ts && (new Date() as any) - startTime < timeout) {\r\n      ts = await this.io_ts.inputWait();\r\n    }\r\n    if (!ts) {\r\n      this.io_ts.pull(\"0v\");\r\n      // await this.obniz.wait(1);\r\n\r\n      const data: any = await this.i2c.readWait(this.address, this.readSize);\r\n      const size: any = data[0];\r\n      // let flag = data[1];\r\n      const seq: any = data[2];\r\n      const msgID: any = data[3];\r\n\r\n      if (size !== 0xff && size > 0) {\r\n        if (this.debugprint || this.obniz.debugprint) {\r\n          console.log(\r\n            \"flickHat: \" + data.slice(0, size).map((v: any) => \"0x\" + v.toString(16)),\r\n          );\r\n        }\r\n        let configmask: any;\r\n        let sysinfo: any;\r\n        let gesture: any;\r\n        let touch: any;\r\n        let airwheel: any;\r\n        let statusInfo: any;\r\n        let fwInfo: any;\r\n        switch (msgID) {\r\n          case 0x91: // sensor data output\r\n            configmask = data[4] | (data[5] << 8); // little endian\r\n            // let timestamp = data[6]; // 200hz, 8-bit counter, max ~1.25sec\r\n            sysinfo = data[7];\r\n            // let dspstatus = data.slice(8, 10);\r\n            gesture = data.slice(10, 14);\r\n            touch = data.slice(14, 18);\r\n            airwheel = data.slice(18, 20);\r\n            // let xyz = data.slice(20, 26);\r\n            // let noisepow = data.slice(27, 30);\r\n            if (\r\n              gesture[0] === 255 &&\r\n              gesture[1] === 255 &&\r\n              gesture[2] === 255 &&\r\n              gesture[3] === 255\r\n            ) {\r\n              break;\r\n            }\r\n\r\n            if (configmask & maskXYZPosition && sysinfo & sysPositionValid) {\r\n              const xyz: any = {\r\n                // little endian\r\n                x: (data[20] | (data[21] << 8)) / 65536,\r\n                y: (data[22] | (data[23] << 8)) / 65536,\r\n                z: (data[24] | (data[25] << 8)) / 65536,\r\n                seq,\r\n              };\r\n              this.xyz = xyz;\r\n              if (typeof this.onxyz === \"function\") {\r\n                this.onxyz(xyz);\r\n              }\r\n            }\r\n\r\n            if (configmask & maskGestureInfo && gesture[0] > 0) {\r\n              this.lastGesture = gesture[0];\r\n              const gestures: any = [\r\n                [\"\", \"\", \"\"], // no gesture\r\n                [\"garbage\", \"\", \"\"],\r\n                [\"flick\", \"west\", \"east\"], // 2\r\n                [\"flick\", \"east\", \"west\"], // 3\r\n                [\"flick\", \"south\", \"north\"], // 4\r\n                [\"flick\", \"north\", \"south\"], // 5\r\n                [\"circle\", \"clockwise\", \"\"],\r\n                [\"circle\", \"counter-clockwise\", \"\"],\r\n                [\"wave\", \"x\", \"\"],\r\n                [\"wave\", \"y\", \"\"],\r\n                [\"hold\", \"\", \"\"],\r\n              ];\r\n              for (const index in gestures) {\r\n                if (\r\n                  index === gesture[0] &&\r\n                  typeof this.ongestureall === \"function\"\r\n                ) {\r\n                  this.ongestureall({\r\n                    action: gestures[index][0],\r\n                    from: gestures[index][1],\r\n                    to: gestures[index][2],\r\n                    raw: gesture,\r\n                    seq,\r\n                  });\r\n                }\r\n                if (\r\n                  index === gesture[0] &&\r\n                  gestures[index][0] === \"flick\" &&\r\n                  typeof this.ongesture === \"function\"\r\n                ) {\r\n                  this.ongesture({\r\n                    action: \"gesture\",\r\n                    from: gestures[index][1],\r\n                    to: gestures[index][2],\r\n                    raw: gesture,\r\n                    seq,\r\n                  });\r\n                }\r\n              }\r\n            }\r\n\r\n            if (\r\n              configmask & maskTouchInfo &&\r\n              !(touch[0] === 0 && touch[1] === 0) &&\r\n              touch[3] === 0\r\n            ) {\r\n              // console.log('touch: ' + touch.map(v => '0x' + v.toString(16)));\r\n              const touchAction: any = touch[0] | (touch[1] << 8); // little endian\r\n              if (touchAction === 0xffff) {\r\n                break;\r\n              }\r\n              // let touchCount = touch[2] * 5; // touch counter value * 5[ms]\r\n              const actions: any = [\r\n                [\"touch\", \"south\"], // 0\r\n                [\"touch\", \"west\"], // 1\r\n                [\"touch\", \"north\"], // 2\r\n                [\"touch\", \"east\"], // 3\r\n                [\"touch\", \"center\"], // 4\r\n                [\"tap\", \"south\"], // 5\r\n                [\"tap\", \"west\"], // 6\r\n                [\"tap\", \"north\"], // 7\r\n                [\"tap\", \"east\"], // 8\r\n                [\"tap\", \"center\"], // 9\r\n                [\"doubletap\", \"south\"], // 10\r\n                [\"doubletap\", \"west\"], // 11\r\n                [\"doubletap\", \"north\"], // 12\r\n                [\"doubletap\", \"east\"], // 13\r\n                [\"doubletap\", \"center\"], // 14\r\n              ];\r\n\r\n              const touches: any = [];\r\n              const taps: any = [];\r\n              const doubletaps: any = [];\r\n              this.lastTouch = touchAction;\r\n\r\n              let comp: any = 1;\r\n              for (const index in actions) {\r\n                const value: any = actions[index];\r\n                if (touchAction & comp) {\r\n                  // console.log(`touchAction:${touchAction.toString(16)}, comp:${comp.toString(16)}, index:${index}, group:${group}`);\r\n                  switch (value[0]) {\r\n                    case \"touch\":\r\n                      touches.push(value[1]);\r\n                      break;\r\n                    case \"tap\":\r\n                      taps.push(value[1]);\r\n                      break;\r\n                    case \"doubletap\":\r\n                      doubletaps.push(value[1]);\r\n                      break;\r\n                    default:\r\n                  }\r\n                }\r\n                comp <<= 1;\r\n              }\r\n\r\n              if (touches.length > 0 && typeof this.ontouch === \"function\") {\r\n                this.ontouch({\r\n                  action: \"touch\",\r\n                  positions: touches,\r\n                  raw: touch,\r\n                  seq,\r\n                });\r\n              }\r\n\r\n              if (taps.length > 0 && typeof this.ontap === \"function\") {\r\n                this.ontap({\r\n                  action: \"tap\",\r\n                  positions: taps,\r\n                  raw: touch,\r\n                  seq,\r\n                });\r\n              }\r\n\r\n              if (\r\n                doubletaps.length > 0 &&\r\n                typeof this.ondoubletap === \"function\"\r\n              ) {\r\n                this.ondoubletap({\r\n                  action: \"doubletap\",\r\n                  positions: doubletaps,\r\n                  raw: touch,\r\n                  seq,\r\n                });\r\n              }\r\n            }\r\n\r\n            if (configmask & maskAirWheelInfo && sysinfo & sysAirWheelValid) {\r\n              const delta: any = (airwheel[0] - this.lastRotation) / 32.0;\r\n              this.rotation += delta * 360.0;\r\n              this.rotation %= 360;\r\n              if (delta !== 0 && delta > -0.5 && delta < 0.5) {\r\n                if (typeof this.onairwheel === \"function\") {\r\n                  this.onairwheel({\r\n                    delta: delta * 360.0,\r\n                    rotation: this.rotation,\r\n                    raw: airwheel,\r\n                    seq,\r\n                  });\r\n                }\r\n              }\r\n              this.lastRotation = airwheel[0];\r\n            }\r\n            break;\r\n\r\n          case 0x15: // system status\r\n            statusInfo = {\r\n              msgId: data[4],\r\n              maxCmdSize: data[5],\r\n              error: data[6] | (data[7] << 8), // little endian\r\n            };\r\n            this.statusInfo = statusInfo;\r\n            if (this.debugprint || this.obniz.debugprint) {\r\n              console.log(\r\n                `flickHat: system status: {msgId: ${\r\n                  statusInfo.msgId\r\n                }, maxCmdSize: ${statusInfo.maxCmdSize}, error: ${\r\n                  statusInfo.error\r\n                }}`,\r\n              );\r\n            }\r\n            break;\r\n\r\n          case 0x83: // farmware information\r\n            fwInfo = {\r\n              fwValid: data[4] === 0xaa,\r\n              hwRev: [data[5], data[6]],\r\n              paramStartAddr: data[7] * 128,\r\n              libLoaderVer: [data[8], data[9]],\r\n              libLoaderPlatform: data[10],\r\n              fwStartAddr: data[11] * 128,\r\n              fwVersion: this._dataArray2string(data.slice(12, 132)).split(\r\n                \"\\0\",\r\n              )[0],\r\n              fwInfoReceived: true,\r\n            };\r\n            this.fwInfo = fwInfo;\r\n            if (typeof this.onfwinfo === \"function\") {\r\n              this.onfwinfo(fwInfo);\r\n            }\r\n            this.readSize = 26;\r\n            break;\r\n\r\n          default:\r\n            console.error(\r\n              `unknown message: 0x${msgID.toString(16)}, data:${data\r\n                .slice(0, size)\r\n                .map((v: any) => \"0x\" + v.toString(16))}`,\r\n            );\r\n        }\r\n      }\r\n\r\n      this.io_ts.pull(\"3v\");\r\n      // await this.obniz.wait(1);\r\n    }\r\n  }\r\n}\r\n"]}
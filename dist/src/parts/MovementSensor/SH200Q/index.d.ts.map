{"version":3,"sources":["../src/parts/MovementSensor/SH200Q/index.ts"],"names":[],"mappings":"AAAA,OAAO,QAAQ,EAAE,EAAC,uBAAuB,EAAC,MAAM,gBAAgB,CAAC;AAEjE,OAAO,KAAK,MAAM,gBAAgB,CAAC;AACnC,OAAO,mBAAmB,EAAE,EAAC,cAAc,EAAC,MAAM,oCAAoC,CAAC;AAEvF,MAAM,WAAW,aAAc,SAAQ,uBAAuB;CAC7D;AAED,MAAM,CAAC,OAAO,OAAO,MAAO,SAAQ,QAAS,YAAW,mBAAmB;WAE3D,IAAI,IAAI,cAAc;IAM7B,QAAQ,EAAE,GAAG,CAAC;IACd,aAAa,EAAE,GAAG,CAAC;IACnB,aAAa,EAAE,GAAG,CAAC;IACnB,KAAK,EAAE,GAAG,CAAC;IACX,UAAU,EAAE,GAAG,CAAC;IAEvB,SAAS,CAAC,KAAK,EAAG,KAAK,CAAC;IAExB,OAAO,CAAC,YAAY,CAAM;IAC1B,OAAO,CAAC,WAAW,CAAM;;IAuBlB,KAAK,CAAC,KAAK,EAAE,KAAK;IAIlB,OAAO;;;;;IAQD,UAAU,IAAI,OAAO,CAAC,MAAM,CAAC;IAK7B,QAAQ;IAkCd,SAAS,CAAC,mBAAmB,EAAE,MAAM,EAAE,eAAe,EAAE,MAAM;IAyCxD,YAAY;IAUZ,cAAc,IAAI,OAAO,CAAC;QACrC,aAAa,EAAE;YACb,CAAC,EAAE,MAAM,CAAC;YACV,CAAC,EAAE,MAAM,CAAC;YACV,CAAC,EAAE,MAAM,CAAC;SACX,CAAC;QACF,WAAW,EAAE,MAAM,CAAC;QACpB,SAAS,EAAE;YACT,CAAC,EAAE,MAAM,CAAC;YACV,CAAC,EAAE,MAAM,CAAC;YACV,CAAC,EAAE,MAAM,CAAC;SACX,CAAC;KACH,CAAC;IA0BW,WAAW,IAAI,OAAO,CAAC,MAAM,CAAC;IAK9B,YAAY,IAAI,OAAO,CAAC;QACnC,CAAC,EAAE,MAAM,CAAC;QACV,CAAC,EAAE,MAAM,CAAC;QACV,CAAC,EAAE,MAAM,CAAC;KACb,CAAC;IAIa,WAAW,IAAI,OAAO,CAAC;QAClC,CAAC,EAAE,MAAM,CAAC;QACV,CAAC,EAAE,MAAM,CAAC;QACV,CAAC,EAAE,MAAM,CAAC;KACX,CAAC;CAGH","file":"index.d.ts","sourcesContent":["import i2cParts, {I2cPartsAbstructOptions} from \"../../i2cParts\";\r\n\r\nimport Obniz from \"../../../obniz\";\r\nimport ObnizPartsInterface, {ObnizPartsInfo} from \"../../../obniz/ObnizPartsInterface\";\r\n\r\nexport interface SH200QOptions extends I2cPartsAbstructOptions {\r\n}\r\n\r\nexport default class SH200Q extends i2cParts implements ObnizPartsInterface {\r\n\r\n  public static info(): ObnizPartsInfo {\r\n    return {\r\n      name: \"SH200Q\",\r\n    };\r\n  }\r\n\r\n  public commands: any;\r\n  public writeFlagWait: any;\r\n  public clearFlagWait: any;\r\n  public write: any;\r\n  public char2short: any;\r\n\r\n  protected obniz!: Obniz;\r\n\r\n  private _accel_range: any;\r\n  private _gyro_range: any;\r\n\r\n  constructor() {\r\n    super();\r\n    this.commands = {};\r\n    this.commands.whoami = 0x30;\r\n\r\n    this.commands.accConfig = 0x0e;\r\n    this.commands.gyroConfig = 0x0f;\r\n    this.commands.gyroDlpf = 0x11;\r\n    this.commands.fifoConfig = 0x12;\r\n    this.commands.accRange = 0x16;\r\n    this.commands.gyroRange = 0x2b;\r\n    this.commands.outputAcc = 0x00;\r\n    this.commands.outputGyro = 0x06;\r\n    this.commands.outputTemp = 0x0c;\r\n    this.commands.regSet1 = 0xba;\r\n    this.commands.regSet2 = 0xca;\r\n    this.commands.adcReset = 0xc2;\r\n    this.commands.softReset = 0x7f;\r\n    this.commands.reset = 0x75;\r\n  }\r\n\r\n  public wired(obniz: Obniz) {\r\n    super.wired(obniz);\r\n  }\r\n\r\n  public i2cInfo() {\r\n    return {\r\n      address: 0x6c,\r\n      clock: 100000,\r\n      voltage: \"3v\",\r\n    };\r\n  }\r\n\r\n  public async whoamiWait(): Promise<number> {\r\n    const result = await this.readWait(this.commands.whoami, 1);\r\n    return result[0];\r\n  }\r\n\r\n  public async initWait() {\r\n    await this.resetAdcWait();\r\n\r\n    await this.writeFlagWait(0xd8, 7);\r\n    await this.obniz.wait(1);\r\n    await this.clearFlagWait(0xd8, 7);\r\n\r\n    await this.write(0x78, 0x61);\r\n    await this.obniz.wait(1);\r\n    await this.write(0x78, 0x00);\r\n\r\n    // set acc odr 256hz\r\n    await this.write(this.commands.accConfig, 0x91);\r\n\r\n    // set gyro odr 500hz\r\n    await this.write(this.commands.gyroConfig, 0x13);\r\n\r\n    // set gyro dlpf 50hz\r\n    await this.write(this.commands.gyroDlpf, 0x03);\r\n\r\n    // set no buffer mode\r\n    await this.write(this.commands.fifoConfig, 0x00);\r\n\r\n    this.setConfig(8, 2000);\r\n\r\n    await this.write(this.commands.regSet1, 0xc0);\r\n\r\n    // ADC Reset\r\n    await this.writeFlagWait(this.commands.regSet2, 4);\r\n    await this.obniz.wait(1);\r\n    await this.clearFlagWait(this.commands.regSet2, 4);\r\n    await this.obniz.wait(10);\r\n  }\r\n\r\n  public setConfig(accelerometer_range: number, gyroscope_range: number) {\r\n    // accel range set (0x00:2g, 0x08:4g, 0x10:8g, 0x18:16g)\r\n    switch (accelerometer_range) {\r\n      case 4:\r\n        this.write(this.commands.accRange, 0x00);\r\n        break;\r\n      case 8:\r\n        this.write(this.commands.accRange, 0x01);\r\n        break;\r\n      case 16:\r\n        this.write(this.commands.accRange, 0x10);\r\n        break;\r\n      default:\r\n        throw new Error(\"accel_range variable 4,8,16 setting\");\r\n    }\r\n    // gyro range & LPF set (0x00:250, 0x08:500, 0x10:1000, 0x18:2000[deg/s])\r\n    switch (gyroscope_range) {\r\n      case 125:\r\n        this.write(this.commands.gyroRange, 0x04);\r\n        break;\r\n      case 250:\r\n        this.write(this.commands.gyroRange, 0x03);\r\n        break;\r\n      case 500:\r\n        this.write(this.commands.gyroRange, 0x02);\r\n        break;\r\n      case 1000:\r\n        this.write(this.commands.gyroRange, 0x01);\r\n        break;\r\n      case 2000:\r\n        this.write(this.commands.gyroRange, 0x00);\r\n        break;\r\n      default:\r\n        throw new Error(\r\n          \"gyroscope_range variable 125,250,500,1000,2000 setting\",\r\n        );\r\n    }\r\n    this._accel_range = accelerometer_range;\r\n    this._gyro_range = gyroscope_range;\r\n  }\r\n\r\n  public async resetAdcWait() {\r\n    // set 0xC2 bit2 1-->0\r\n    const tempdata: any = await this.readWait(this.commands.adcReset, 1);\r\n    tempdata[0] = tempdata[0] | 0x04; // tempdata[0] = 0x0E; //CC\r\n    this.write(this.commands.adcReset, tempdata);\r\n    await this.obniz.wait(1);\r\n    tempdata[0] = tempdata[0] & 0xfb; // tempdata[0] = 0x0A; //C8\r\n    this.write(this.commands.adcReset, tempdata);\r\n  }\r\n\r\n  public async getAllDataWait(): Promise<{\r\n    accelerometer: {\r\n      x: number,\r\n      y: number,\r\n      z: number,\r\n    },\r\n    temperature: number,\r\n    gyroscope: {\r\n      x: number,\r\n      y: number,\r\n      z: number,\r\n    },\r\n  }> {\r\n    const raw_data: any = await this.readWait(this.commands.outputAcc, 14); // request all data\r\n    const ac_scale: any = this._accel_range / 32768;\r\n    const gy_scale: any = this._gyro_range / 32768;\r\n\r\n    const accelerometer: any = {\r\n      x: this.char2short(raw_data[0], raw_data[1]) * ac_scale,\r\n      y: this.char2short(raw_data[2], raw_data[3]) * ac_scale,\r\n      z: this.char2short(raw_data[4], raw_data[5]) * ac_scale,\r\n    };\r\n    const gyroscope: any = {\r\n      x: this.char2short(raw_data[6], raw_data[7]) * gy_scale,\r\n      y: this.char2short(raw_data[8], raw_data[9]) * gy_scale,\r\n      z: this.char2short(raw_data[10], raw_data[11]) * gy_scale,\r\n    };\r\n\r\n    const temperature: any =\r\n      this.char2short(raw_data[12], raw_data[13]) / 333.87 + 21.0;\r\n\r\n    return {\r\n      accelerometer,\r\n      temperature,\r\n      gyroscope,\r\n    };\r\n  }\r\n\r\n  public async getTempWait(): Promise<number> {\r\n    const raw_data: any = await this.readWait(this.commands.outputTemp, 2); // request all data\r\n    return this.char2short(raw_data[1], raw_data[0]) / 333.87 + 21.0;\r\n  }\r\n\r\n  public async getAccelWait(): Promise<{\r\n    x: number,\r\n    y: number,\r\n    z: number,\r\n}> {\r\n    return (await this.getAllDataWait()).accelerometer;\r\n  }\r\n\r\n  public async getGyroWait(): Promise<{\r\n    x: number,\r\n    y: number,\r\n    z: number,\r\n  }> {\r\n    return (await this.getAllDataWait()).gyroscope;\r\n  }\r\n}\r\n"]}
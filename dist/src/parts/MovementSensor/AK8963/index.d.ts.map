{"version":3,"sources":["../src/parts/MovementSensor/AK8963/index.ts"],"names":[],"mappings":"AAAA;;;GAGG;AAEH,OAAO,KAAK,MAAM,gBAAgB,CAAC;AACnC,OAAO,aAAa,MAAM,wCAAwC,CAAC;AACnE,OAAO,mBAAmB,EAAE,EAAC,cAAc,EAAC,MAAM,oCAAoC,CAAC;AAEvF,MAAM,WAAY,aAAa;IAC7B,GAAG,CAAC,EAAE,MAAM,CAAC;IACb,GAAG,CAAC,EAAE,MAAM,CAAC;IACb,GAAG,CAAC,EAAE,MAAM,CAAC;IACb,GAAG,CAAC,EAAE,MAAM,CAAC;IACb,GAAG,CAAC,EAAE,aAAa,CAAC;IACpB,OAAO,CAAC,EAAE,MAAM,CAAC;IACjB,SAAS,CAAC,EAAE,MAAM,CAAC;CACpB;AAED,MAAM,CAAC,OAAO,OAAO,MAAO,YAAW,mBAAmB;WAE1C,IAAI,IAAI,cAAc;IAM7B,IAAI,EAAE,MAAM,EAAE,CAAC;IACf,YAAY,EAAE,MAAM,EAAE,CAAC;IACvB,MAAM,EAAE,GAAG,CAAC;IAEnB,SAAS,CAAC,KAAK,EAAG,KAAK,CAAC;IAExB,OAAO,CAAC,QAAQ,CAAM;IACtB,OAAO,CAAC,GAAG,CAAiB;IAC5B,OAAO,CAAC,UAAU,CAAK;;IAOhB,KAAK,CAAC,KAAK,EAAE,KAAK;IAWlB,SAAS,CAAC,SAAS,EAAE,MAAM;IAcrB,OAAO,IAAI,OAAO,CAAC;QAC9B,CAAC,EAAE,MAAM,CAAC;QACV,CAAC,EAAE,MAAM,CAAC;QACV,CAAC,EAAE,MAAM,CAAC;KACX,CAAC;IAUK,UAAU,CAAC,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM;CAOjD","file":"index.d.ts","sourcesContent":["/**\n * @packageDocumentation\n * @module Parts.AK8963\n */\n\nimport Obniz from \"../../../obniz\";\nimport PeripheralI2C from \"../../../obniz/libs/io_peripherals/i2c\";\nimport ObnizPartsInterface, {ObnizPartsInfo} from \"../../../obniz/ObnizPartsInterface\";\n\nexport interface  AK8963Options {\n  gnd?: number;\n  vcc?: number;\n  sda?: number;\n  scl?: number;\n  i2c?: PeripheralI2C;\n  address?: number;\n  adb_cycle?: number;\n}\n\nexport default class AK8963 implements ObnizPartsInterface {\n\n  public static info(): ObnizPartsInfo {\n    return {\n      name: \"AK8963\",\n    };\n  }\n\n  public keys: string[];\n  public requiredKeys: string[];\n  public params: any;\n\n  protected obniz!: Obniz;\n\n  private _address: any;\n  private i2c!: PeripheralI2C;\n  private _adc_cycle = 0;\n\n  constructor() {\n    this.keys = [\"gnd\", \"vcc\", \"sda\", \"scl\", \"i2c\", \"address\", \"adb_cycle\"];\n    this.requiredKeys = [];\n  }\n\n  public wired(obniz: Obniz) {\n    this.obniz = obniz;\n    obniz.setVccGnd(this.params.vcc, this.params.gnd, \"5v\");\n    this.params.clock = 100000;\n    this.params.pull = \"3v\";\n    this.params.mode = \"master\";\n    this._address = this.params.address || 0x0c;\n    this.i2c = obniz.getI2CWithConfig(this.params);\n    this.setConfig(this.params.adc_cycle || 8);\n  }\n\n  public setConfig(ADC_cycle: number) {\n    switch (ADC_cycle) {\n      case 8:\n        this.i2c.write(this._address, [0x0a, 0x12]);\n        break;\n      case 100:\n        this.i2c.write(this._address, [0x0a, 0x16]);\n        break;\n      default:\n        throw new Error(\"ADC_cycle variable 8,100 setting\");\n    }\n    this._adc_cycle = ADC_cycle;\n  }\n\n  public async getWait(): Promise<{\n    x: number,\n    y: number,\n    z: number,\n  }> {\n    this.i2c.write(this._address, [0x03]); // request AK8963 data\n    const raw_data_AK8963 = await this.i2c.readWait(this._address, 7); // read 7byte(read mag_data[6] to refresh)\n    return {\n      x: this.char2short(raw_data_AK8963[0], raw_data_AK8963[1]),\n      y: this.char2short(raw_data_AK8963[2], raw_data_AK8963[3]),\n      z: this.char2short(raw_data_AK8963[4], raw_data_AK8963[5]),\n    };\n  }\n\n  public char2short(valueH: number, valueL: number) {\n    const buffer = new ArrayBuffer(2);\n    const dv = new DataView(buffer);\n    dv.setUint8(0, valueH);\n    dv.setUint8(1, valueL);\n    return dv.getInt16(0, false);\n  }\n}\n"]}
{"version":3,"sources":["../src/parts/MovementSensor/AK8963/index.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["import Obniz from \"../../../obniz\";\r\nimport PeripheralI2C from \"../../../obniz/libs/io_peripherals/i2c\";\r\nimport ObnizPartsInterface, {ObnizPartsInfo} from \"../../../obniz/ObnizPartsInterface\";\r\n\r\nexport interface AK8963Options {\r\n  gnd?: number;\r\n  vcc?: number;\r\n  sda?: number;\r\n  scl?: number;\r\n  i2c?: PeripheralI2C;\r\n  address?: number;\r\n  adb_cycle?: number;\r\n}\r\n\r\nexport default class AK8963 implements ObnizPartsInterface {\r\n\r\n  public static info(): ObnizPartsInfo {\r\n    return {\r\n      name: \"AK8963\",\r\n    };\r\n  }\r\n\r\n  public keys: string[];\r\n  public requiredKeys: string[];\r\n  public params: any;\r\n\r\n  protected obniz!: Obniz;\r\n\r\n  private _address: any;\r\n  private i2c!: PeripheralI2C;\r\n  private _adc_cycle = 0;\r\n\r\n  constructor() {\r\n    this.keys = [\"gnd\", \"vcc\", \"sda\", \"scl\", \"i2c\", \"address\", \"adb_cycle\"];\r\n    this.requiredKeys = [];\r\n  }\r\n\r\n  public wired(obniz: Obniz) {\r\n    this.obniz = obniz;\r\n    obniz.setVccGnd(this.params.vcc, this.params.gnd, \"5v\");\r\n    this.params.clock = 100000;\r\n    this.params.pull = \"3v\";\r\n    this.params.mode = \"master\";\r\n    this._address = this.params.address || 0x0c;\r\n    this.i2c = obniz.getI2CWithConfig(this.params);\r\n    this.setConfig(this.params.adc_cycle || 8);\r\n  }\r\n\r\n  public setConfig(ADC_cycle: number) {\r\n    switch (ADC_cycle) {\r\n      case 8:\r\n        this.i2c.write(this._address, [0x0a, 0x12]);\r\n        break;\r\n      case 100:\r\n        this.i2c.write(this._address, [0x0a, 0x16]);\r\n        break;\r\n      default:\r\n        throw new Error(\"ADC_cycle variable 8,100 setting\");\r\n    }\r\n    this._adc_cycle = ADC_cycle;\r\n  }\r\n\r\n  public async getWait(): Promise<{\r\n    x: number,\r\n    y: number,\r\n    z: number,\r\n  }> {\r\n    this.i2c.write(this._address, [0x03]); // request AK8963 data\r\n    const raw_data_AK8963 = await this.i2c.readWait(this._address, 7); // read 7byte(read mag_data[6] to refresh)\r\n    return {\r\n      x: this.char2short(raw_data_AK8963[0], raw_data_AK8963[1]),\r\n      y: this.char2short(raw_data_AK8963[2], raw_data_AK8963[3]),\r\n      z: this.char2short(raw_data_AK8963[4], raw_data_AK8963[5]),\r\n    };\r\n  }\r\n\r\n  public char2short(valueH: number, valueL: number) {\r\n    const buffer = new ArrayBuffer(2);\r\n    const dv = new DataView(buffer);\r\n    dv.setUint8(0, valueH);\r\n    dv.setUint8(1, valueL);\r\n    return dv.getInt16(0, false);\r\n  }\r\n}\r\n"]}
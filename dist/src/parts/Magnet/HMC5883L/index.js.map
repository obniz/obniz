{"version":3,"sources":["../src/parts/Magnet/HMC5883L/index.ts"],"names":[],"mappings":";AAAA;;;GAGG;;;;;;;;;;;AAaH,MAAqB,QAAQ;IAqB3B;QATO,YAAO,GAAG;YACf,MAAM,EAAE,IAAI;YACZ,KAAK,EAAE,CAAC,IAAI,EAAE,IAAI,CAAC;YACnB,IAAI,EAAE,CAAC,IAAI,CAAC;SACb,CAAC;QAMA,IAAI,CAAC,IAAI,GAAG,CAAC,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,CAAC,CAAC;QACzC,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC;IACzB,CAAC;IAtBM,MAAM,CAAC,IAAI;QAChB,OAAO;YACL,IAAI,EAAE,UAAU;SACjB,CAAC;IACJ,CAAC;IAoBM,KAAK,CAAC,KAAY;QACvB,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;QACnB,KAAK,CAAC,SAAS,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;QAE7C,IAAI,CAAC,MAAM,CAAC,KAAK,GAAG,MAAM,CAAC;QAC3B,IAAI,CAAC,MAAM,CAAC,IAAI,GAAG,IAAI,CAAC;QACxB,IAAI,CAAC,MAAM,CAAC,IAAI,GAAG,QAAQ,CAAC;QAE5B,IAAI,CAAC,GAAG,GAAG,KAAK,CAAC,gBAAgB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QAE/C,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;IACvB,CAAC;IAEM,IAAI;QACT,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;QACxD,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;IACvB,CAAC;IAEY,GAAG;;YACd,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;YACvD,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC;YAEnE,MAAM,GAAG,GAAQ,EAAE,CAAC;YACpB,MAAM,IAAI,GAAG,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC,CAAC;YAC7B,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,EAAE;gBAC1B,IAAI,GAAG,GAAG,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,GAAG,MAAM,CAAC,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC;gBACnD,IAAI,GAAG,GAAG,MAAM,EAAE;oBAChB,GAAG,GAAG,GAAG,GAAG,KAAK,CAAC;iBACnB;gBACD,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC;aACpB;YAED,OAAO,GAAG,CAAC;QACb,CAAC;KAAA;CACF;AA5DD,2BA4DC","file":"index.js","sourcesContent":["/**\n * @packageDocumentation\n * @module Parts.HMC5883L\n */\n\nimport Obniz from \"../../../obniz\";\nimport PeripheralI2C from \"../../../obniz/libs/io_peripherals/i2c\";\nimport ObnizPartsInterface, {ObnizPartsInfo} from \"../../../obniz/ObnizPartsInterface\";\n\nexport interface  HMC5883LOptions {\n  gnd?: number;\n  sda?: number;\n  scl?: number;\n  i2c?: PeripheralI2C;\n}\n\nexport default class HMC5883L implements ObnizPartsInterface {\n\n  public static info(): ObnizPartsInfo {\n    return {\n      name: \"HMC5883L\",\n    };\n  }\n\n  public keys: string[];\n  public requiredKeys: string[];\n  public params: any;\n\n  public address = {\n    device: 0x1e,\n    reset: [0x02, 0x00], // Continuous Measurment Mode\n    xMSB: [0x03],\n  };\n  public i2c!: PeripheralI2C;\n\n  protected obniz!: Obniz;\n\n  constructor() {\n    this.keys = [\"gnd\", \"sda\", \"scl\", \"i2c\"];\n    this.requiredKeys = [];\n  }\n\n  public wired(obniz: Obniz) {\n    this.obniz = obniz;\n    obniz.setVccGnd(null, this.params.gnd, \"3v\");\n\n    this.params.clock = 100000;\n    this.params.pull = \"3v\";\n    this.params.mode = \"master\";\n\n    this.i2c = obniz.getI2CWithConfig(this.params);\n\n    this.obniz.wait(500);\n  }\n\n  public init() {\n    this.i2c.write(this.address.device, this.address.reset);\n    this.obniz.wait(500);\n  }\n\n  public async get() {\n    this.i2c.write(this.address.device, this.address.xMSB);\n    const readed = await this.i2c.readWait(this.address.device, 2 * 3);\n\n    const obj: any = {};\n    const keys = [\"x\", \"y\", \"z\"];\n    for (let i = 0; i < 3; i++) {\n      let val = (readed[i * 2] << 8) | readed[i * 2 + 1];\n      if (val & 0x8000) {\n        val = val - 65536;\n      }\n      obj[keys[i]] = val;\n    }\n\n    return obj;\n  }\n}\n"]}
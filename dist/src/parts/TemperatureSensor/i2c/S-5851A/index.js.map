{"version":3,"sources":["../src/parts/TemperatureSensor/i2c/S-5851A/index.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["// sensor response not found\nimport Obniz from \"../../../../obniz\";\nimport PeripheralI2C from \"../../../../obniz/libs/io_peripherals/i2c\";\nimport ObnizPartsInterface, {ObnizPartsInfo} from \"../../../../obniz/ObnizPartsInterface\";\n\nexport interface S5851AOptions {\n  vcc: number;\n  gnd: number;\n  sda: number;\n  scl: number;\n  addr0: number;\n  addr1: number;\n  addressmode: string;\n}\n\nexport default class S5851A implements ObnizPartsInterface {\n\n  public static info(): ObnizPartsInfo {\n    return {\n      name: \"S5851A\",\n    };\n  }\n\n  public requiredKeys: string[];\n  public keys: string[];\n  public io_adr0: any;\n  public params: any;\n  public io_adr1: any;\n  public address: any;\n\n  protected obniz!: Obniz;\n  protected i2c!: PeripheralI2C;\n  protected i2c0!: PeripheralI2C;\n\n  constructor() {\n    this.requiredKeys = [\"vcc\", \"gnd\", \"adr0\", \"adr1\", \"adr_select\"];\n    this.keys = [\"sda\", \"scl\", \"adr0\", \"adr1\", \"adr_select\", \"i2c\"];\n  }\n\n  public wired(obniz: Obniz) {\n    // params: pwr, gnd, sda, scl, adr0, adr1, adr_select\n    this.io_adr0 = obniz.getIO(this.params.adr0);\n    this.io_adr1 = obniz.getIO(this.params.adr1);\n\n    this.obniz.setVccGnd(this.params.vcc, this.params.gnd, \"5v\");\n\n    switch (this.params.adr_select) {\n      case 8:\n        this.io_adr0.output(false);\n        this.io_adr1.output(false);\n        this.address = 0x48;\n        break;\n      case 9:\n        this.io_adr0.pull(null);\n        this.io_adr1.output(false);\n        this.address = 0x49;\n        break;\n      case \"A\":\n        this.io_adr0.output(true);\n        this.io_adr1.output(false);\n        this.address = 0x4a;\n        break;\n      case \"B\":\n        this.io_adr0.output(false);\n        this.io_adr1.output(true);\n        this.address = 0x4b;\n        break;\n      case \"C\":\n        this.io_adr0.pull(null);\n        this.io_adr1.output(true);\n        this.address = 0x4c;\n        break;\n      case \"D\":\n        this.io_adr0.output(true);\n        this.io_adr1.output(true);\n        this.address = 0x4d;\n        break;\n      case \"E\":\n        this.io_adr0.output(false);\n        this.io_adr1.pull(null);\n        this.address = 0x4e;\n        break;\n      case \"F\":\n        this.io_adr0.output(true);\n        this.io_adr1.pull(null);\n        this.address = 0x4f;\n        break;\n      default:\n        this.io_adr0.output(false);\n        this.io_adr1.output(false);\n        this.address = 0x48;\n        break;\n    }\n    console.log(\"i2c address=\" + this.address);\n\n    this.params.clock = this.params.clock || 400 * 1000; // for i2c\n    this.params.mode = this.params.mode || \"master\"; // for i2c\n    this.params.pull = this.params.pull || \"5v\"; // for i2c\n    this.i2c = obniz.getI2CWithConfig(this.params);\n    // obniz.i2c0.write(address, [0x20, 0x24]);\n  }\n\n  public async getTempWait(): Promise<number> {\n    // console.log(\"gettempwait\");\n    // obniz.i2c0.write(address, [0x20, 0x24]);\n    // obniz.i2c0.write(address, [0xE0, 0x00]);\n    const ret: any = await this.i2c0.readWait(this.address, 2);\n    // console.log('ret:' + ret);\n    const tempBin: any =\n      ret[0].toString(2) + (\"00000000\" + ret[1].toString(2)).slice(-8);\n    const temperature: any = -45 + 175 * (parseInt(tempBin, 2) / (65536 - 1));\n    return temperature;\n  }\n\n  public async getHumdWait(): Promise<number> {\n    this.i2c.write(this.address, [0x20, 0x24]);\n    this.i2c.write(this.address, [0xe0, 0x00]);\n    const ret: any = await this.i2c.readWait(this.address, 4);\n    const humdBin: any =\n      ret[2].toString(2) + (\"00000000\" + ret[3].toString(2)).slice(-8);\n    const humidity: any = 100 * (parseInt(humdBin, 2) / (65536 - 1));\n    return humidity;\n  }\n}\n"]}